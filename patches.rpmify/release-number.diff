From: Andreas Gruenbacher <agruen@suse.de>
Subject: Hard-code the RPM release number; don't get it from .config

The release number really belongs to the source tree, not the
configuration file. We had at least one error report where people
did something like cloneconfig, and ended up with a release number
that didn't match the source tree.

Signed-off-by: Andreas Gruenbacher <agruen@suse.de>

Index: linux-2.6.10/Makefile
===================================================================
--- linux-2.6.10.orig/Makefile
+++ linux-2.6.10/Makefile
@@ -158,8 +158,11 @@ endif
 LOCALVERSION = $(subst $(space),, \
 	       $(shell cat /dev/null $(localversion-files:%~=)) \
 	       $(patsubst "%",%,$(CONFIG_LOCALVERSION)))
+ifneq ($(wildcard $(srctree)/rpm-release),)
+RPM_RELEASE := -$(shell cat $(srctree)/rpm-release)
+endif
 
-KERNELRELEASE=$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)$(EXTRAVERSION)$(LOCALVERSION)
+KERNELRELEASE=$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)$(EXTRAVERSION)$(LOCALVERSION)$(RPM_RELEASE)
 
 # SUBARCH tells the usermode build what the underlying arch is.  That is set
 # first, and if a usermode build is happening, the "ARCH=um" on the command
