From: Jeff Mahoney <jeffm@suse.com>
Subject: powerpc: kvm build failure workaround
Patch-mainline: Hopefully never

 This patch works around an issue with gcc 4.5 that is failing the build
 with:
 arch/powerpc/kvm/book3s.c:1102:23: error: 'ext_bkp.vrsave' may be used uninitialized in this function

 The warning is incorrect, so we work around it by explicitly setting it to
 0.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>
---

 arch/powerpc/kvm/book3s.c  |    6 ++++++
 arch/powerpc/kvm/powerpc.c |    2 +-
 2 files changed, 7 insertions(+), 1 deletion(-)

--- a/arch/powerpc/kvm/book3s.c
+++ b/arch/powerpc/kvm/book3s.c
@@ -1318,6 +1318,12 @@ int __kvmppc_vcpu_run(struct kvm_run *kv
 #endif
 	ulong ext_msr;
 
+#ifdef CONFIG_ALTIVEC
+	/* JDM This is functionally unnecessary but works around an
+	 * over-eager unintialized usage checker in gcc 4.5 */
+	ext_bkp.vrsave = current->thread.vrsave;
+#endif
+
 	/* No need to go into the guest when all we do is going out */
 	if (signal_pending(current)) {
 		kvm_run->exit_reason = KVM_EXIT_INTR;

--- a/arch/powerpc/kvm/powerpc.c
+++ b/arch/powerpc/kvm/powerpc.c
@@ -287,7 +287,7 @@ static void kvmppc_complete_dcr_load(str
 static void kvmppc_complete_mmio_load(struct kvm_vcpu *vcpu,
                                       struct kvm_run *run)
 {
-	u64 gpr;
+	u64 uninitialized_var(gpr);
 
 	if (run->mmio.len > sizeof(gpr)) {
 		printk(KERN_ERR "bad MMIO length: %d\n", run->mmio.len);
