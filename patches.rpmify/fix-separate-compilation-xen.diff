From: Andreas Gruenbacher <agruen@suse.de>
Subject: Xen fixes for building with O=

Signed-off-by: Andreas Gruenbacher <agruen@suse.de>

Index: linux-2.6.13/arch/xen/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/Makefile
+++ linux-2.6.13/arch/xen/Makefile
@@ -32,7 +32,7 @@ ifneq ($(KBUILD_SRC),)
 	$(Q)ln -fsn ../include/asm-$(XENARCH) include2/asm
 endif
 
-include/.asm-ignore: include/asm
+include/.asm-ignore: $(objtree)/include/asm
 	@rm -f include/.asm-ignore
 	@mv include/asm include/.asm-ignore
 	@echo '  SYMLINK include/asm -> include/asm-$(XENARCH)'
@@ -49,8 +49,9 @@ arch/xen/arch:
 	@mkdir -p arch/xen
 	@ln -fsn $(srctree)/arch/xen/$(XENARCH) $@
 
-arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/linux/version.h \
-				   include/config/MARKER
+arch/$(XENARCH)/kernel/asm-offsets.s: $(objtree)/include/asm \
+				      $(objtree)/include/linux/version.h \
+				      include/config/MARKER
 
 include/asm-$(ARCH)/asm_offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
Index: linux-2.6.13/arch/xen/i386/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/i386/Makefile
+++ linux-2.6.13/arch/xen/i386/Makefile
@@ -108,8 +108,11 @@ AFLAGS += $(xenflags-y)
 prepare: include/asm-$(XENARCH)/asm_offsets.h
 CLEAN_FILES += include/asm-$(XENARCH)/asm_offsets.h
 
-arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/.asm-ignore \
-	include/linux/version.h include/config/MARKER
+arch/$(XENARCH)/kernel/asm-offsets.s: \
+	$(objtree)/include/asm \
+	include/.asm-ignore \
+	$(objtree)/include/linux/version.h \
+	include/config/MARKER
 
 include/asm-$(XENARCH)/asm_offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
Index: linux-2.6.13/arch/xen/x86_64/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/x86_64/Makefile
+++ linux-2.6.13/arch/xen/x86_64/Makefile
@@ -84,8 +84,11 @@ AFLAGS += $(xenflags-y)
 prepare: include/asm-$(XENARCH)/asm_offsets.h
 CLEAN_FILES += include/asm-$(XENARCH)/asm_offsets.h
 
-arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/.asm-ignore \
-	include/linux/version.h include/config/MARKER
+arch/$(XENARCH)/kernel/asm-offsets.s: \
+	$(objtree)/include/asm \
+	include/.asm-ignore \
+	$(objtree)/include/linux/version.h \
+	include/config/MARKER
 
 include/asm-$(XENARCH)/offset.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
