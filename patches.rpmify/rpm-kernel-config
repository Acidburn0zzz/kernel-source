diff -uNrp linux-2.6.5/Makefile linux-2.6.5.rpmify/Makefile
--- linux-2.6.5/Makefile	2004-04-04 23:38:44.000000000 +0200
+++ linux-2.6.5.rpmify/Makefile	2004-04-04 23:39:54.000000000 +0200
@@ -1,7 +1,7 @@
 VERSION = 2
 PATCHLEVEL = 6
 SUBLEVEL = 5
-EXTRAVERSION =
+EXTRAVERSION = -$(shell echo $(CONFIG_RELEASE)-$(CONFIG_CFGNAME))
 NAME=Zonked Quokka
 
 # *DOCUMENTATION*
@@ -872,8 +872,8 @@ tags: FORCE
 
 .PHONY: rpm
 
-# Remove hyphens since they have special meaning in RPM filenames
-KERNELPATH=kernel-$(subst -,,$(KERNELRELEASE))
+# Replace hyphens since they have special meaning in RPM filenames
+KERNELPATH=kernel-$(subst -,_,$(KERNELRELEASE))
 
 #	If you do a make spec before packing the tarball you can rpm -ta it
 
diff -uNrp linux-2.6.5/arch/alpha/Kconfig linux-2.6.5.rpmify/arch/alpha/Kconfig
--- linux-2.6.5/arch/alpha/Kconfig	2004-04-04 05:37:40.000000000 +0200
+++ linux-2.6.5.rpmify/arch/alpha/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -34,6 +34,7 @@ config GENERIC_ISA_DMA
 
 source "init/Kconfig"
 
+source "rpmify/Kconfig"
 
 menu "System setup"
 
diff -uNrp linux-2.6.5/arch/arm/Kconfig linux-2.6.5.rpmify/arch/arm/Kconfig
--- linux-2.6.5/arch/arm/Kconfig	2004-04-04 05:37:07.000000000 +0200
+++ linux-2.6.5.rpmify/arch/arm/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -744,3 +744,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/cris/Kconfig linux-2.6.5.rpmify/arch/cris/Kconfig
--- linux-2.6.5/arch/cris/Kconfig	2004-04-04 05:38:15.000000000 +0200
+++ linux-2.6.5.rpmify/arch/cris/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -220,3 +220,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/h8300/Kconfig linux-2.6.5.rpmify/arch/h8300/Kconfig
--- linux-2.6.5/arch/h8300/Kconfig	2004-04-04 05:37:41.000000000 +0200
+++ linux-2.6.5.rpmify/arch/h8300/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -438,3 +438,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/i386/Kconfig linux-2.6.5.rpmify/arch/i386/Kconfig
--- linux-2.6.5/arch/i386/Kconfig	2004-04-04 23:38:46.000000000 +0200
+++ linux-2.6.5.rpmify/arch/i386/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -1396,6 +1396,8 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
 config X86_SMP
 	bool
 	depends on SMP && !X86_VOYAGER
diff -uNrp linux-2.6.5/arch/ia64/Kconfig linux-2.6.5.rpmify/arch/ia64/Kconfig
--- linux-2.6.5/arch/ia64/Kconfig	2004-04-04 23:38:48.000000000 +0200
+++ linux-2.6.5.rpmify/arch/ia64/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -619,3 +619,6 @@ endmenu
 source "security/Kconfig"
 
 source "crypto/Kconfig"
+
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/m68k/Kconfig linux-2.6.5.rpmify/arch/m68k/Kconfig
--- linux-2.6.5/arch/m68k/Kconfig	2004-04-04 05:37:23.000000000 +0200
+++ linux-2.6.5.rpmify/arch/m68k/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -696,3 +696,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/m68knommu/Kconfig linux-2.6.5.rpmify/arch/m68knommu/Kconfig
--- linux-2.6.5/arch/m68knommu/Kconfig	2004-04-04 05:37:37.000000000 +0200
+++ linux-2.6.5.rpmify/arch/m68knommu/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -588,3 +588,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/parisc/Kconfig linux-2.6.5.rpmify/arch/parisc/Kconfig
--- linux-2.6.5/arch/parisc/Kconfig	2004-04-04 05:37:24.000000000 +0200
+++ linux-2.6.5.rpmify/arch/parisc/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -230,3 +230,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/ppc/Kconfig linux-2.6.5.rpmify/arch/ppc/Kconfig
--- linux-2.6.5/arch/ppc/Kconfig	2004-04-04 05:38:22.000000000 +0200
+++ linux-2.6.5.rpmify/arch/ppc/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -1230,3 +1230,6 @@ endmenu
 source "security/Kconfig"
 
 source "crypto/Kconfig"
+
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/ppc64/Kconfig linux-2.6.5.rpmify/arch/ppc64/Kconfig
--- linux-2.6.5/arch/ppc64/Kconfig	2004-04-04 23:38:44.000000000 +0200
+++ linux-2.6.5.rpmify/arch/ppc64/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -465,3 +465,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/s390/Kconfig linux-2.6.5.rpmify/arch/s390/Kconfig
--- linux-2.6.5/arch/s390/Kconfig	2004-04-04 23:38:49.000000000 +0200
+++ linux-2.6.5.rpmify/arch/s390/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -430,3 +430,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/sh/Kconfig linux-2.6.5.rpmify/arch/sh/Kconfig
--- linux-2.6.5/arch/sh/Kconfig	2004-04-04 05:38:23.000000000 +0200
+++ linux-2.6.5.rpmify/arch/sh/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -798,3 +798,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/sparc/Kconfig linux-2.6.5.rpmify/arch/sparc/Kconfig
--- linux-2.6.5/arch/sparc/Kconfig	2004-04-04 05:36:10.000000000 +0200
+++ linux-2.6.5.rpmify/arch/sparc/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -456,3 +456,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/sparc64/Kconfig linux-2.6.5.rpmify/arch/sparc64/Kconfig
--- linux-2.6.5/arch/sparc64/Kconfig	2004-04-04 05:38:13.000000000 +0200
+++ linux-2.6.5.rpmify/arch/sparc64/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -708,3 +708,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/um/Kconfig linux-2.6.5.rpmify/arch/um/Kconfig
--- linux-2.6.5/arch/um/Kconfig	2004-04-04 23:38:46.000000000 +0200
+++ linux-2.6.5.rpmify/arch/um/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -324,3 +324,5 @@ config GCOV
 
 endmenu
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/arch/v850/Kconfig linux-2.6.5.rpmify/arch/v850/Kconfig
--- linux-2.6.5/arch/v850/Kconfig	2004-04-04 05:37:06.000000000 +0200
+++ linux-2.6.5.rpmify/arch/v850/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -340,4 +340,6 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
 #############################################################################
diff -uNrp linux-2.6.5/arch/x86_64/Kconfig linux-2.6.5.rpmify/arch/x86_64/Kconfig
--- linux-2.6.5/arch/x86_64/Kconfig	2004-04-04 05:37:41.000000000 +0200
+++ linux-2.6.5.rpmify/arch/x86_64/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -505,3 +505,5 @@ source "crypto/Kconfig"
 
 source "lib/Kconfig"
 
+source "rpmify/Kconfig"
+
diff -uNrp linux-2.6.5/rpmify/Kconfig linux-2.6.5.rpmify/rpmify/Kconfig
--- linux-2.6.5/rpmify/Kconfig	1970-01-01 01:00:00.000000000 +0100
+++ linux-2.6.5.rpmify/rpmify/Kconfig	2004-04-04 23:39:24.000000000 +0200
@@ -0,0 +1,32 @@
+#
+# Build options
+#
+
+menu "Build options"
+
+config SUSE_KERNEL
+	bool
+	default y
+
+config CFGNAME
+	string "Configuration name"
+	default ""
+	help
+	  The name of the kernel configuration used. The configuration
+	  files provided in arch/$ARCH/defconfig.$CFGNAME set the
+	  CONFIG_CFGNAME option to $CFGNAME. The configuration name is
+	  part of the EXTRAVERSION.
+
+config RELEASE
+	string "Release number"
+	default "0"
+	help
+	  The release number of the kernel sources. The configuration
+	  files provided in arch/$ARCH/defconfig.$CFGNAME set the
+	  CONFIG_RELEASE option to the RPM release number of the
+	  kernel source package. The release number of the kernel
+	  sources and of all binary kernel packages built from those
+	  sources should be the same. The release number is part of
+	  the EXTRAVERSION.
+
+endmenu
diff -uNrp linux-2.6.5/scripts/mkspec linux-2.6.5.rpmify/scripts/mkspec
--- linux-2.6.5/scripts/mkspec	2004-04-04 05:36:14.000000000 +0200
+++ linux-2.6.5.rpmify/scripts/mkspec	2004-04-04 23:39:24.000000000 +0200
@@ -24,7 +24,7 @@ PROVIDES="$PROVIDES kernel-$VERSION.$PAT
 
 echo "Name: kernel"
 echo "Summary: The Linux Kernel"
-echo "Version: "$VERSION.$PATCHLEVEL.$SUBLEVEL$EXTRAVERSION | sed -e "s/-//g"
+echo "Version: "$VERSION.$PATCHLEVEL.$SUBLEVEL$EXTRAVERSION | sed -e "s/-/_/g"
 # we need to determine the NEXT version number so that uname and
 # rpm -q will agree
 echo "Release: `. $srctree/scripts/mkversion`"
@@ -33,7 +33,7 @@ echo "Group: System Environment/Kernel"
 echo "Vendor: The Linux Community"
 echo "URL: http://www.kernel.org"
 echo -n "Source: kernel-$VERSION.$PATCHLEVEL.$SUBLEVEL"
-echo "$EXTRAVERSION.tar.gz" | sed -e "s/-//g"
+echo "$EXTRAVERSION.tar.gz" | sed -e "s/-/_/g"
 echo "BuildRoot: /var/tmp/%{name}-%{PACKAGE_VERSION}-root"
 echo "Provides: $PROVIDES"
 echo "%define __spec_install_post /usr/lib/rpm/brp-compress || :"
@@ -46,7 +46,8 @@ echo "%prep"
 echo "%setup -q"
 echo ""
 echo "%build"
-echo "make clean all"
+echo "make clean"
+echo "make all"
 echo ""
 echo "%install"
 echo 'mkdir -p $RPM_BUILD_ROOT/boot $RPM_BUILD_ROOT/lib $RPM_BUILD_ROOT/lib/modules'
