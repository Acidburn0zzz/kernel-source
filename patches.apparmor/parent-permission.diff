From: Andreas Gruenbacher <agruen@suse.de>
Subject: Allow permission functions to tell between parent and leaf checks

Set the LOOKUP_CONTINUE flag when checking parent permissions. This allows
permission functions to tell between parent and leaf checks.

Signed-off-by: Andreas Gruenbacher <agruen@suse.de>
Signed-off-by: John Johansen <jjohansen@suse.de>

---
 fs/namei.c |    2 ++
 1 file changed, 2 insertions(+)

Index: linux-2.6.26/fs/namei.c
===================================================================
--- linux-2.6.26.orig/fs/namei.c
+++ linux-2.6.26/fs/namei.c
@@ -1531,6 +1531,8 @@ static inline int may_create(struct inod
 	if (IS_DEADDIR(dir))
 		return -ENOENT;
 
+	if (nd)
+		nd->flags |= LOOKUP_CONTINUE;
 	if (dir->i_op->may_create) {
 		if (IS_RDONLY(dir))
 			return -EROFS;
