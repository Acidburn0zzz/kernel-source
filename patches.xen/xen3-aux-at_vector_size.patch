Subject: increase AT_VECTOR_SIZE to terminate saved_auxv properly
From: Olaf Hering <olh@suse.de>
References: 310037

include/asm-powerpc/elf.h has 6 entries in ARCH_DLINFO.
fs/binfmt_elf.c has 14 unconditional NEW_AUX_ENT entries and 2
conditional NEW_AUX_ENT entries.
So in the worst case, saved_auxv does not get an AT_NULL entry at the
end.

The saved_auxv array must be terminated with an AT_NULL entry.
Make the size of mm_struct->saved_auxv arch dependend,
based on the number of ARCH_DLINFO entries.

Signed-off-by: Olaf Hering <olh@suse.de>

Automatically created from "patches.fixes/aux-at_vector_size.patch" by xen-port-patches.py

Index: head-2007-12-11/include/asm-x86/mach-xen/asm/system_64.h
===================================================================
--- head-2007-12-11.orig/include/asm-x86/mach-xen/asm/system_64.h	2007-12-11 11:17:36.000000000 +0100
+++ head-2007-12-11/include/asm-x86/mach-xen/asm/system_64.h	2007-12-11 11:44:13.000000000 +0100
@@ -11,6 +11,12 @@
 
 #ifdef __KERNEL__
 
+#ifdef CONFIG_IA32_EMULATION
+#define AT_VECTOR_SIZE_ARCH 2
+#else
+#define AT_VECTOR_SIZE_ARCH 1
+#endif
+
 #define __SAVE(reg,offset) "movq %%" #reg ",(14-" #offset ")*8(%%rsp)\n\t"
 #define __RESTORE(reg,offset) "movq (14-" #offset ")*8(%%rsp),%%" #reg "\n\t"
 
