Subject: Use correct PUD for memory hotadd

From: Jan Beulich <jbeulich@novell.com>

Memory >39bits has a different PUD.

Cc: "Tolentino, Matthew E" <matthew.e.tolentino@intel.com>

Signed-off-by: Andi Kleen <ak@suse.de>

Automatically created from "patches.arch/x86_64-hotadd-pud" by xen-port-patches.py

Index: head-2006-02-20/arch/x86_64/mm/init-xen.c
===================================================================
--- head-2006-02-20.orig/arch/x86_64/mm/init-xen.c	2006-02-20 09:53:09.000000000 +0100
+++ head-2006-02-20/arch/x86_64/mm/init-xen.c	2006-02-20 14:07:23.000000000 +0100
@@ -659,7 +659,7 @@ void __meminit init_memory_mapping(unsig
 		pud_t *pud;
 
 		if (after_bootmem) {
-			pud = pud_offset_k(pgd, __PAGE_OFFSET);
+			pud = pud_offset_k(pgd, start & PGDIR_MASK);
 			make_page_readonly(pud, XENFEAT_writable_page_tables);
 			pud_phys = __pa(pud);
 		} else {
