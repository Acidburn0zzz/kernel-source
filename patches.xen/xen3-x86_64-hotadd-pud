Subject: Use correct PUD for memory hotadd

From: Jan Beulich <jbeulich@novell.com>

Memory >39bits has a different PUD.

Cc: "Tolentino, Matthew E" <matthew.e.tolentino@intel.com>

Signed-off-by: Andi Kleen <ak@suse.de>

Automatically created from "patches.arch/x86_64-hotadd-pud" by xen-port-patches.py

Index: head-2006-03-24/arch/x86_64/mm/init-xen.c
===================================================================
--- head-2006-03-24.orig/arch/x86_64/mm/init-xen.c	2006-03-25 09:15:23.000000000 -0700
+++ head-2006-03-24/arch/x86_64/mm/init-xen.c	2006-03-25 09:26:47.000000000 -0700
@@ -645,7 +645,7 @@
 		pud_t *pud;
 
 		if (after_bootmem) {
-			pud = pud_offset_k(pgd, __PAGE_OFFSET);
+			pud = pud_offset_k(pgd, start & PGDIR_MASK);
 			make_page_readonly(pud, XENFEAT_writable_page_tables);
 			pud_phys = __pa(pud);
 		} else {
