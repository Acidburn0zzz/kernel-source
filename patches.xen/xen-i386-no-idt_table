From: jbeulich@novell.com
Subject: eliminate idt_table

$subject says it all.

Index: head-2006-03-02/arch/i386/kernel/head-xen.S
===================================================================
--- head-2006-03-02.orig/arch/i386/kernel/head-xen.S	2006-03-02 11:44:01.000000000 +0100
+++ head-2006-03-02/arch/i386/kernel/head-xen.S	2006-03-02 11:44:35.000000000 +0100
@@ -112,6 +112,7 @@ ENTRY(empty_zero_page)
  */
 .data
 
+#ifndef CONFIG_XEN
 ready:	.byte 0
 
 .globl idt_descr
@@ -130,6 +131,7 @@ cpu_gdt_descr:
 	.long cpu_gdt_table
 
 	.fill NR_CPUS-1,8,0		# space for the other GDT descriptors
+#endif
 
 ENTRY(cpu_gdt_table)
 	.quad 0x0000000000000000	/* NULL descriptor */
Index: head-2006-03-02/arch/i386/kernel/traps-xen.c
===================================================================
--- head-2006-03-02.orig/arch/i386/kernel/traps-xen.c	2006-03-02 11:41:02.000000000 +0100
+++ head-2006-03-02/arch/i386/kernel/traps-xen.c	2006-03-02 11:44:35.000000000 +0100
@@ -63,13 +63,6 @@ struct desc_struct default_ldt[] = { { 0
 /* Do we ignore FPU interrupts ? */
 char ignore_fpu_irq = 0;
 
-/*
- * The IDT has to be page-aligned to simplify the Pentium
- * F0 0F bug workaround.. We have a special link segment
- * for this.
- */
-struct desc_struct idt_table[256] __attribute__((__section__(".data.idt"))) = { {0, 0}, };
-
 asmlinkage void divide_error(void);
 asmlinkage void debug(void);
 asmlinkage void nmi(void);
@@ -989,14 +982,6 @@ asmlinkage void math_emulate(long arg)
 #ifdef CONFIG_X86_F00F_BUG
 void __init trap_init_f00f_bug(void)
 {
-	__set_fixmap(FIX_F00F_IDT, __pa(&idt_table), PAGE_KERNEL_RO);
-
-	/*
-	 * Update the IDT descriptor and reload the IDT so that
-	 * it uses the read-only mapped virtual address.
-	 */
-	idt_descr.address = fix_to_virt(FIX_F00F_IDT);
-	load_idt(&idt_descr);
 }
 #endif
 
Index: head-2006-03-02/arch/i386/mm/fault-xen.c
===================================================================
--- head-2006-03-02.orig/arch/i386/mm/fault-xen.c	2006-03-02 11:34:25.000000000 +0100
+++ head-2006-03-02/arch/i386/mm/fault-xen.c	2006-03-02 11:44:35.000000000 +0100
@@ -469,7 +469,7 @@ bad_area_nosemaphore:
 		return;
 	}
 
-#ifdef CONFIG_X86_F00F_BUG
+#if 0
 	/*
 	 * Pentium F0 0F C7 C8 bug workaround.
 	 */
