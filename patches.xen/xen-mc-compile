From: ak@suse.de
Subject: Fix Xen compilation with multicore scheduler

Just add some dummy arrays - CONFIG_SCHED_MC isn't actually set.
The Xen guest doesn't know anything about topology, so just
fake it.

TBD get rid of the config option too. It won't compile
if someone enables it.

Index: linux-2.6.15/arch/i386/xen/kernel/smp.c
===================================================================
--- linux-2.6.15.orig/arch/i386/xen/kernel/smp.c
+++ linux-2.6.15/arch/i386/xen/kernel/smp.c
@@ -30,6 +30,8 @@
 
 #define xxprint(msg) HYPERVISOR_console_io(CONSOLEIO_write, strlen(msg), msg)
 
+int cpu_llc_id[NR_CPUS] __cpuinitdata = {[0 ... NR_CPUS-1] = BAD_APICID};
+
 /*
  *	Some notes on x86 processor bugs affecting SMP operation:
  *
Index: linux-2.6.15/include/asm-i386/mach-xen/asm/processor.h
===================================================================
--- linux-2.6.15.orig/include/asm-i386/mach-xen/asm/processor.h
+++ linux-2.6.15/include/asm-i386/mach-xen/asm/processor.h
@@ -106,6 +106,7 @@ extern struct cpuinfo_x86 cpu_data[];
 extern	int phys_proc_id[NR_CPUS];
 extern	int cpu_core_id[NR_CPUS];
 extern char ignore_fpu_irq;
+extern int cpu_llc_id[];
 
 extern void identify_cpu(struct cpuinfo_x86 *);
 extern void print_cpu_info(struct cpuinfo_x86 *);
Index: linux-2.6.15/include/asm-x86_64/mach-xen/asm/processor.h
===================================================================
--- linux-2.6.15.orig/include/asm-x86_64/mach-xen/asm/processor.h
+++ linux-2.6.15/include/asm-x86_64/mach-xen/asm/processor.h
@@ -93,6 +93,7 @@ extern char ignore_irq13;
 extern void identify_cpu(struct cpuinfo_x86 *);
 extern void print_cpu_info(struct cpuinfo_x86 *);
 extern unsigned int init_intel_cacheinfo(struct cpuinfo_x86 *c);
+extern int cpu_llc_id[];
 
 /*
  * EFLAGS bits
Index: linux-2.6.15/arch/x86_64/xen/kernel/smp.c
===================================================================
--- linux-2.6.15.orig/arch/x86_64/xen/kernel/smp.c
+++ linux-2.6.15/arch/x86_64/xen/kernel/smp.c
@@ -33,6 +33,11 @@
 
 #define xxprint(msg) HYPERVISOR_console_io(CONSOLEIO_write, strlen(msg), msg)
 
+/* Last level cache ID of each logical CPU */
+int cpu_llc_id[NR_CPUS] __cpuinitdata = {[0 ... NR_CPUS-1] = BAD_APICID};
+
+
+
 #else
 /*
  *	Smarter SMP flushing macros. 
