From: jbeulich@novell.com
Subject: use totalram_pages in favor of num_physpages for sizing boot time allocations
References: bnc#509753
Patch-mainline: not yet (in -mm as of 2009-08-20)

Some of the calculations (i.e. those not intending to use high memory)
should likely even use (totalram_pages - totalhigh_pages).

Acked-by: Rusty Russell <rusty@rustcorp.com.au>
Acked-by: Ingo Molnar <mingo@elte.hu>

Automatically created from "patches.fixes/use-totalram_pages" by xen-port-patches.py

--- head-2009-09-02.orig/arch/x86/kernel/microcode_core-xen.c	2009-09-02 11:59:54.000000000 +0200
+++ head-2009-09-02/arch/x86/kernel/microcode_core-xen.c	2009-09-02 12:09:53.000000000 +0200
@@ -97,8 +97,8 @@ static ssize_t microcode_write(struct fi
 {
 	ssize_t ret = -EINVAL;
 
- 	if ((len >> PAGE_SHIFT) > num_physpages) {
-		pr_err("microcode: too much data (max %ld pages)\n", num_physpages);
+ 	if ((len >> PAGE_SHIFT) > totalram_pages) {
+		pr_err("microcode: too much data (max %ld pages)\n", totalram_pages);
 		return ret;
  	}
 
