From: ccoffing@novell.com
Subject: Suppress Xen virtual framebuffer and keyboard setup in dom0
Patch-mainline: obsolete

---
 drivers/xen/xenfb/xenfb.c   |    3 +++
 drivers/xen/xenkbd/xenkbd.c |    3 +++
 2 files changed, 6 insertions(+)

--- linux-2.6.18.orig/drivers/xen/xenfb/xenfb.c
+++ linux-2.6.18/drivers/xen/xenfb/xenfb.c
@@ -370,6 +370,9 @@ static int __init xenfb_probe(void)
 	struct evtchn_alloc_unbound alloc_unbound;
 	struct xenbus_transaction xbt;
 
+	if (is_initial_xendomain())
+		return -ENODEV;
+
 	info = kmalloc(sizeof(*info), GFP_KERNEL);
 	if (info == NULL)
 		return -ENOMEM;
--- linux-2.6.18.orig/drivers/xen/xenkbd/xenkbd.c
+++ linux-2.6.18/drivers/xen/xenkbd/xenkbd.c
@@ -81,6 +81,9 @@ int __init xenkbd_init(void)
 	struct evtchn_alloc_unbound alloc_unbound;
 	struct xenbus_transaction xbt;
 
+	if (is_initial_xendomain())
+		return -ENODEV;
+
 	dev = kmalloc(sizeof(*dev), GFP_KERNEL);
 	input_dev = input_allocate_device();
 	if (!dev || !input_dev)
