From: ccoffing@novell.com
Subject: Suppress Xen virtual framebuffer and keyboard setup in dom0
Patch-mainline: obsolete

Index: head-2006-08-28/drivers/xen/xenfb/xenfb.c
===================================================================
--- head-2006-08-28.orig/drivers/xen/xenfb/xenfb.c	2006-08-28 10:59:11.000000000 +0200
+++ head-2006-08-28/drivers/xen/xenfb/xenfb.c	2006-08-28 10:59:14.000000000 +0200
@@ -370,6 +370,9 @@ static int __init xenfb_probe(void)
 	struct evtchn_alloc_unbound alloc_unbound;
 	struct xenbus_transaction xbt;
 
+	if (is_initial_xendomain())
+		return -ENODEV;
+
 	info = kmalloc(sizeof(*info), GFP_KERNEL);
 	if (info == NULL)
 		return -ENOMEM;
Index: head-2006-08-28/drivers/xen/xenkbd/xenkbd.c
===================================================================
--- head-2006-08-28.orig/drivers/xen/xenkbd/xenkbd.c	2006-08-28 10:59:11.000000000 +0200
+++ head-2006-08-28/drivers/xen/xenkbd/xenkbd.c	2006-08-28 10:59:14.000000000 +0200
@@ -81,6 +81,9 @@ int __init xenkbd_init(void)
 	struct evtchn_alloc_unbound alloc_unbound;
 	struct xenbus_transaction xbt;
 
+	if (is_initial_xendomain())
+		return -ENODEV;
+
 	dev = kmalloc(sizeof(*dev), GFP_KERNEL);
 	input_dev = input_allocate_device();
 	if (!dev || !input_dev)
