From: jbeulich@novell.com
Subject: xenfb: don't use irq before it gets set up
Patch-mainline: obsolete
References: bnc#445659

The helper thread shouldn't be started before xenfb_connect_backend().

Index: head-2008-11-17/drivers/xen/fbfront/xenfb.c
===================================================================
--- head-2008-11-17.orig/drivers/xen/fbfront/xenfb.c	2008-11-17 13:42:08.000000000 +0100
+++ head-2008-11-17/drivers/xen/fbfront/xenfb.c	2008-11-18 17:58:35.000000000 +0100
@@ -683,6 +689,10 @@ static int __devinit xenfb_probe(struct 
 	}
 	info->fb_info = fb_info;
 
+	ret = xenfb_connect_backend(dev, info);
+	if (ret < 0)
+		goto error;
+
 	/* FIXME should this be delayed until backend XenbusStateConnected? */
 	info->kthread = kthread_run(xenfb_thread, info, "xenfb thread");
 	if (IS_ERR(info->kthread)) {
@@ -692,10 +702,6 @@ static int __devinit xenfb_probe(struct 
 		goto error;
 	}
 
-	ret = xenfb_connect_backend(dev, info);
-	if (ret < 0)
-		goto error;
-
 	xenfb_make_preferred_console();
 	return 0;
 
