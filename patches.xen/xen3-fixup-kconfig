Subject: Fix xen configuration.
From: jbeulich@novell.com
Patch-mainline: obsolete

Index: head-2008-02-20/arch/x86/Kconfig
===================================================================
--- head-2008-02-20.orig/arch/x86/Kconfig	2008-02-20 15:30:01.000000000 +0100
+++ head-2008-02-20/arch/x86/Kconfig	2008-02-01 16:40:47.000000000 +0100
@@ -675,7 +675,7 @@ config I8K
 
 config X86_REBOOTFIXUPS
 	bool "Enable X86 board specific fixups for reboot"
-	depends on X86_32 && X86
+	depends on X86_32 && !X86_XEN
 	default n
 	---help---
 	  This enables chipset and/or board specific fixups to be done
Index: head-2008-02-20/drivers/cpufreq/Kconfig
===================================================================
--- head-2008-02-20.orig/drivers/cpufreq/Kconfig	2008-02-20 15:30:01.000000000 +0100
+++ head-2008-02-20/drivers/cpufreq/Kconfig	2007-12-11 10:45:49.000000000 +0100
@@ -1,5 +1,6 @@
 config CPU_FREQ
 	bool "CPU Frequency scaling"
+	depends on !XEN
 	help
 	  CPU Frequency scaling allows you to change the clock speed of 
 	  CPUs on the fly. This is a nice method to save power, because 
Index: head-2008-02-20/drivers/video/Kconfig
===================================================================
--- head-2008-02-20.orig/drivers/video/Kconfig	2008-02-20 15:30:01.000000000 +0100
+++ head-2008-02-20/drivers/video/Kconfig	2007-12-11 10:45:49.000000000 +0100
@@ -1541,7 +1541,7 @@ config FB_CYBLA
 	tristate "Cyberblade/i1 support"
 	depends on FB && PCI && X86_32 && !64BIT
 	select FB_CFB_IMAGEBLIT
-	select VIDEO_SELECT
+	select VIDEO_SELECT if !XEN
 	---help---
 	  This driver is supposed to support the Trident Cyberblade/i1
 	  graphics core integrated in the VIA VT8601A North Bridge,
Index: head-2008-02-20/drivers/xen/Kconfig
===================================================================
--- head-2008-02-20.orig/drivers/xen/Kconfig	2008-02-20 15:30:01.000000000 +0100
+++ head-2008-02-20/drivers/xen/Kconfig	2008-02-20 15:32:18.000000000 +0100
@@ -30,6 +30,9 @@ config XEN_XENBUS_DEV
 	def_bool y
 	depends on PROC_FS
 
+config XEN_NETDEV_ACCEL_SFC_UTIL
+	tristate
+
 config XEN_BACKEND
         tristate "Backend driver support"
         default XEN_PRIVILEGED_GUEST
@@ -79,15 +82,11 @@ config XEN_NETDEV_PIPELINED_TRANSMITTER
 	  are unsure; or if you experience network hangs when this option is
 	  enabled; then you must say N here.
 
-config XEN_NETDEV_ACCEL_SFC_UTIL
-        tristate
-        default n
-
 config XEN_NETDEV_ACCEL_SFC_BACKEND
 	tristate "Network-device backend driver acceleration for Solarflare NICs"
-        depends on XEN_NETDEV_BACKEND
-        select XEN_NETDEV_ACCEL_SFC_UTIL
-        default m
+	depends on SFC && SFC_RESOURCE && XEN_NETDEV_BACKEND
+	select XEN_NETDEV_ACCEL_SFC_UTIL
+	default m
 
 config XEN_NETDEV_LOOPBACK
 	tristate "Network-device loopback driver"
@@ -185,6 +184,12 @@ config XEN_NETDEV_FRONTEND
 	  dedicated device-driver domain, or your master control domain
 	  (domain 0), then you almost certainly want to say Y here.
 
+config XEN_NETDEV_ACCEL_SFC_FRONTEND
+	tristate "Network-device frontend driver acceleration for Solarflare NICs"
+	depends on XEN_NETDEV_FRONTEND
+	select XEN_NETDEV_ACCEL_SFC_UTIL
+	default XEN_NETDEV_FRONTEND
+
 config XEN_GRANT_DEV
 	tristate "User-space granted page access driver"
 	default XEN_PRIVILEGED_GUEST
@@ -192,12 +197,6 @@ config XEN_GRANT_DEV
 	  Device for accessing (in user-space) pages that have been granted
 	  by other domains.
 
-config XEN_NETDEV_ACCEL_SFC_FRONTEND
-	tristate "Network-device frontend driver acceleration for Solarflare NICs"
-	depends on XEN_NETDEV_FRONTEND
-        select XEN_NETDEV_ACCEL_SFC_UTIL
-	default m
-
 config XEN_FRAMEBUFFER
 	tristate "Framebuffer-device frontend driver"
 	depends on FB
Index: head-2008-02-20/kernel/power/Kconfig
===================================================================
--- head-2008-02-20.orig/kernel/power/Kconfig	2008-02-20 15:30:01.000000000 +0100
+++ head-2008-02-20/kernel/power/Kconfig	2007-12-11 10:45:49.000000000 +0100
@@ -100,13 +100,13 @@ config SUSPEND
 config HIBERNATION_UP_POSSIBLE
 	bool
 	depends on X86 || PPC64_SWSUSP || PPC32
-	depends on !SMP
+	depends on !SMP && !XEN
 	default y
 
 config HIBERNATION_SMP_POSSIBLE
 	bool
 	depends on (X86 && !X86_VOYAGER) || PPC64_SWSUSP
-	depends on SMP
+	depends on SMP && !XEN
 	default y
 
 config HIBERNATION
