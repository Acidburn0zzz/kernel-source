From: jbeulich@novell.com
Subject: use architecture install script when available

This allows automatic generation of an initrd during install as well as
backing up the previous kernel.

Signed-off-by: Jan Beulich <jbeulich@novell.com>
Index: xen-2005-08-19/arch/xen/Makefile
===================================================================
--- xen-2005-08-19.orig/arch/xen/Makefile	2005-08-19 08:49:22.103649912 +0200
+++ xen-2005-08-19/arch/xen/Makefile	2005-08-19 14:15:59.431403248 +0200
@@ -63,8 +63,13 @@
 vmlinuz: vmlinux
 	$(Q)$(MAKE) $(build)=arch/xen/boot vmlinuz
 
+ifeq ($(INSTALL_PATH),)
+install.sh := $(shell find $(srctree)/arch/$(XENARCH) -name install.sh)
+endif
+
 XINSTALL_NAME ?= $(KERNELRELEASE)
 install: vmlinuz
+ifeq ($(install.sh),)
 	mkdir -p $(INSTALL_PATH)/boot
 	ln -f -s vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX) $(INSTALL_PATH)/boot/vmlinuz-$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)$(XENGUEST)$(INSTALL_SUFFIX)
 	rm -f $(INSTALL_PATH)/boot/vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX)
@@ -75,6 +80,9 @@
 	ln -f -s vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX) $(INSTALL_PATH)/boot/vmlinuz-$(VERSION).$(PATCHLEVEL)$(XENGUEST)$(INSTALL_SUFFIX)
 	mkdir -p $(INSTALL_PATH)/usr/include/xen/linux
 	install -m0644 $(srctree)/include/asm-xen/linux-public/*.h $(INSTALL_PATH)/usr/include/xen/linux
+else
+	sh $(install.sh) $(KERNELRELEASE) $< System.map "$(INSTALL_PATH)"
+endif
 
 archclean:
 	@if [ -e arch/xen/arch ]; then $(MAKE) $(clean)=arch/xen/arch; fi;
