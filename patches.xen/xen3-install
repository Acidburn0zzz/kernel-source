From: jbeulich@novell.com
Subject: use architecture install script when available

This allows automatic generation of an initrd during install as well as
backing up the previous kernel.

Signed-off-by: Jan Beulich <jbeulich@novell.com>
Index: linux-2.6.13/arch/xen/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/Makefile
+++ linux-2.6.13/arch/xen/Makefile
@@ -62,11 +62,16 @@ all: vmlinuz
 
 vmlinuz: vmlinux
 	$(Q)$(MAKE) $(build)=arch/xen/boot vmlinuz
 
+ifeq ($(INSTALL_PATH),)
+install.sh := $(shell find $(srctree)/arch/$(XENARCH) -name install.sh)
+endif
+
 XINSTALL_NAME ?= $(KERNELRELEASE)
 install: vmlinuz
 install kernel_install:
+ifeq ($(install.sh),)
 	mkdir -p $(INSTALL_PATH)/boot
 	ln -f -s vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX) $(INSTALL_PATH)/boot/vmlinuz-$(VERSION).$(PATCHLEVEL).$(SUBLEVEL)$(XENGUEST)$(INSTALL_SUFFIX)
 	rm -f $(INSTALL_PATH)/boot/vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX)
 	install -m0644 vmlinuz $(INSTALL_PATH)/boot/vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX)
@@ -75,8 +80,11 @@ install kernel_install:
 	install -m0664 System.map $(INSTALL_PATH)/boot/System.map-$(XINSTALL_NAME)$(INSTALL_SUFFIX)
 	ln -f -s vmlinuz-$(XINSTALL_NAME)$(INSTALL_SUFFIX) $(INSTALL_PATH)/boot/vmlinuz-$(VERSION).$(PATCHLEVEL)$(XENGUEST)$(INSTALL_SUFFIX)
 	mkdir -p $(INSTALL_PATH)/usr/include/xen/linux
 	install -m0644 $(srctree)/include/asm-xen/linux-public/*.h $(INSTALL_PATH)/usr/include/xen/linux
+else
+	sh $(install.sh) $(KERNELRELEASE) $< System.map "$(INSTALL_PATH)"
+endif
 
 archclean:
 	@if [ -e arch/xen/arch ]; then $(MAKE) $(clean)=arch/xen/arch; fi;
 	@rm -f arch/xen/arch include/.asm-ignore include/asm-xen/asm
