From: Thomas Renninger <trenn@suse.de>
Subject: Adopt Xen to x2APIC patchset
References: fate#303984 and fate#303948
Patch-Mainline: never

Signed-off-by: Thomas Renninger <trenn@suse.de>

---
 arch/x86/kernel/Makefile           |    2 ++
 include/asm-x86/mach-xen/asm/smp.h |    3 +++
 2 files changed, 5 insertions(+)

Index: linux-2.6.26/arch/x86/kernel/Makefile
===================================================================
--- linux-2.6.26.orig/arch/x86/kernel/Makefile
+++ linux-2.6.26/arch/x86/kernel/Makefile
@@ -106,8 +106,10 @@ obj-$(CONFIG_X86_XEN)		+= fixup.o
 ifeq ($(CONFIG_X86_64),y)
         obj-$(CONFIG_X86_LOCAL_APIC)	+= genapic_64.o genapic_flat_64.o genx2apic_uv_x.o
 	obj-$(CONFIG_X86_XEN_GENAPIC)	+= genapic_64.o genapic_xen_64.o
+ifeq ($(CONFIG_XEN),)
         obj-y				+= genx2apic_cluster.o
         obj-y				+= genx2apic_phys.o
+endif
 	obj-y				+= tlb_uv.o bios_uv.o
         obj-$(CONFIG_X86_PM_TIMER)	+= pmtimer_64.o
         obj-$(CONFIG_AUDIT)		+= audit_64.o
Index: linux-2.6.26/include/asm-x86/mach-xen/asm/smp.h
===================================================================
--- linux-2.6.26.orig/include/asm-x86/mach-xen/asm/smp.h
+++ linux-2.6.26/include/asm-x86/mach-xen/asm/smp.h
@@ -31,6 +31,9 @@ extern int smp_num_siblings;
 extern unsigned int num_processors;
 extern cpumask_t cpu_initialized;
 
+extern void detect_extended_topology(struct cpuinfo_x86 *c);
+
+
 DECLARE_PER_CPU(cpumask_t, cpu_sibling_map);
 DECLARE_PER_CPU(cpumask_t, cpu_core_map);
 DECLARE_PER_CPU(u16, cpu_llc_id);
