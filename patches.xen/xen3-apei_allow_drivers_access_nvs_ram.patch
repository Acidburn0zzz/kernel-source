From: Yinghai Lu <yinghai@kernel.org>
Subject: [PATCH] x86: allow NVS can be accessed by driver
References: none
Patch-Mainline: submitted, aiming for 3.2

APEI related...

Signed-off-by: Yinghai Lu <yinghai@kernel.org>
Signed-off-by: Thomas Renninger <trenn@suse.de>

Automatically created from "patches.drivers/apei_allow_drivers_access_nvs_ram.patch" by xen-port-patches.py

--- head-2011-09-23.orig/arch/x86/kernel/e820-xen.c	2011-09-23 16:02:14.000000000 +0200
+++ head-2011-09-23/arch/x86/kernel/e820-xen.c	2011-09-23 16:02:43.000000000 +0200
@@ -1083,7 +1083,8 @@ void __init e820_reserve_resources(void)
 		 * pcibios_resource_survey()
 		 */
 		if (e820.map[i].type != E820_RESERVED || res->start < (1ULL<<20)) {
-			res->flags |= IORESOURCE_BUSY;
+			if (e820.map[i].type != E820_NVS)
+				res->flags |= IORESOURCE_BUSY;
 			insert_resource(&iomem_resource, res);
 		}
 		res++;
