From: plc@novell.com
Subject: fix updating of req_prod_pvt in the receive ring for the flipping case
Patch-mainline: obsolete

jb: Adjusted to not use an extra variable.

---
 drivers/xen/netfront/netfront.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

--- a/drivers/xen/netfront/netfront.c
+++ b/drivers/xen/netfront/netfront.c
@@ -852,8 +852,8 @@
 			/* Check return status of HYPERVISOR_memory_op(). */
 			if (unlikely(np->rx_mcl[i].result != i))
 				panic("Unable to reduce memory reservation\n");
-			while (i--)
-				BUG_ON(np->rx_mcl[i].result);
+			while (nr_flips--)
+				BUG_ON(np->rx_mcl[nr_flips].result);
 		} else {
 			if (HYPERVISOR_memory_op(XENMEM_decrease_reservation,
 						 &reservation) != i)
