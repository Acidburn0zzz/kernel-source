From: olh@suse.de
Subject: kbuild: full dependency check on asm-offsets.h


 arch/xen/Makefile             |    4 ++--
 arch/xen/i386/Makefile        |    6 +++---
 arch/xen/i386/kernel/head.S   |    2 +-
 arch/xen/kernel/asm-offsets.c |    1 +
 arch/xen/x86_64/Makefile      |    8 ++++----
 5 files changed, 11 insertions(+), 10 deletions(-)

Index: linux-2.6.13/arch/xen/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/Makefile
+++ linux-2.6.13/arch/xen/Makefile
@@ -52,11 +52,11 @@ arch/xen/arch:
 arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/linux/version.h \
 				   include/config/MARKER
 
-include/asm-$(ARCH)/asm_offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
+include/asm-$(ARCH)/asm-offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
 
 prepare: include/.asm-ignore include/asm-xen/asm \
-	arch/xen/arch include/asm-$(ARCH)/asm_offsets.h include2/asm ;
+	arch/xen/arch include/asm-$(ARCH)/asm-offsets.h include2/asm ;
 
 all: vmlinuz
 
Index: linux-2.6.13/arch/xen/i386/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/i386/Makefile
+++ linux-2.6.13/arch/xen/i386/Makefile
@@ -98,11 +98,11 @@ xenflags-y += -Iinclude/asm-xen/asm-i386
 CFLAGS += $(xenflags-y)
 AFLAGS += $(xenflags-y)
 
-prepare: include/asm-$(XENARCH)/asm_offsets.h
-CLEAN_FILES += include/asm-$(XENARCH)/asm_offsets.h
+prepare: include/asm-$(XENARCH)/asm-offsets.h
+CLEAN_FILES += include/asm-$(XENARCH)/asm-offsets.h
 
 arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/.asm-ignore \
 	include/linux/version.h include/config/MARKER
 
-include/asm-$(XENARCH)/asm_offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
+include/asm-$(XENARCH)/asm-offsets.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
Index: linux-2.6.13/arch/xen/i386/kernel/head.S
===================================================================
--- linux-2.6.13.orig/arch/xen/i386/kernel/head.S
+++ linux-2.6.13/arch/xen/i386/kernel/head.S
@@ -21,7 +21,7 @@
 #include <linux/linkage.h>
 #include <asm/segment.h>
 #include <asm/thread_info.h>
-#include <asm/asm_offsets.h>
+#include <asm/asm-offsets.h>
 #include <asm-xen/xen-public/arch-x86_32.h>
 
 /*
Index: linux-2.6.13/arch/xen/x86_64/Makefile
===================================================================
--- linux-2.6.13.orig/arch/xen/x86_64/Makefile
+++ linux-2.6.13/arch/xen/x86_64/Makefile
@@ -79,8 +79,8 @@ xenflags-y += -Iinclude/asm-xen/asm-x86_
 CFLAGS += $(xenflags-y)
 AFLAGS += $(xenflags-y)
 
-prepare: include/asm-$(XENARCH)/asm_offsets.h
-CLEAN_FILES += include/asm-$(XENARCH)/asm_offsets.h
+prepare: include/asm-$(XENARCH)/asm-offsets.h
+CLEAN_FILES += include/asm-$(XENARCH)/asm-offsets.h
 
 arch/$(XENARCH)/kernel/asm-offsets.s: include/asm include/.asm-ignore \
 	include/linux/version.h include/config/MARKER
@@ -88,6 +88,6 @@ arch/$(XENARCH)/kernel/asm-offsets.s: in
 include/asm-$(XENARCH)/offset.h: arch/$(XENARCH)/kernel/asm-offsets.s
 	$(call filechk,gen-asm-offsets)
 
-include/asm-$(XENARCH)/asm_offsets.h: include/asm-$(XENARCH)/offset.h
-	ln -fsn offset.h include/asm-$(XENARCH)/asm_offsets.h
+include/asm-$(XENARCH)/asm-offsets.h: include/asm-$(XENARCH)/offset.h
+	ln -fsn offset.h include/asm-$(XENARCH)/asm-offsets.h
 	ln -fsn offset.h include/asm-$(XENARCH)/asm_offset.h
Index: linux-2.6.13/arch/xen/kernel/asm-offsets.c
===================================================================
--- /dev/null
+++ linux-2.6.13/arch/xen/kernel/asm-offsets.c
@@ -0,0 +1 @@
+/* Dummy file to make kbuild happy - unused! */
