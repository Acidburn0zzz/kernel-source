From: jbeulich@novell.com
Subject: fix placement of some routines/data
Patch-mainline: obsolete

Index: head-2008-03-06/arch/x86/kernel/e820_32-xen.c
===================================================================
--- head-2008-03-06.orig/arch/x86/kernel/e820_32-xen.c	2008-03-06 10:51:44.000000000 +0100
+++ head-2008-03-06/arch/x86/kernel/e820_32-xen.c	2008-03-05 15:22:37.000000000 +0100
@@ -17,7 +17,7 @@
 #include <asm/setup.h>
 #include <xen/interface/memory.h>
 
-struct e820map e820;
+struct e820map __initdata e820;
 struct change_member {
 	struct e820entry *pbios; /* pointer to original bios entry */
 	unsigned long long addr; /* address for this change point */
Index: head-2008-03-06/arch/x86/kernel/traps_32-xen.c
===================================================================
--- head-2008-03-06.orig/arch/x86/kernel/traps_32-xen.c	2008-03-06 10:52:57.000000000 +0100
+++ head-2008-03-06/arch/x86/kernel/traps_32-xen.c	2008-03-03 15:24:49.000000000 +0100
@@ -1180,7 +1180,7 @@ asmlinkage void math_emulate(long arg)
  * NB. All these are "trap gates" (i.e. events_mask isn't set) except
  * for those that specify <dpl>|4 in the second field.
  */
-static trap_info_t trap_table[] = {
+static const trap_info_t __cpuinitconst trap_table[] = {
 	{  0, 0, __KERNEL_CS, (unsigned long)divide_error		},
 	{  1, 0|4, __KERNEL_CS, (unsigned long)debug			},
 	{  3, 3|4, __KERNEL_CS, (unsigned long)int3			},
@@ -1236,7 +1236,7 @@ void __init trap_init(void)
 	cpu_init();
 }
 
-void smp_trap_init(trap_info_t *trap_ctxt)
+void __cpuinit smp_trap_init(trap_info_t *trap_ctxt)
 {
 	const trap_info_t *t = trap_table;
 
Index: head-2008-03-06/arch/x86/kernel/traps_64-xen.c
===================================================================
--- head-2008-03-06.orig/arch/x86/kernel/traps_64-xen.c	2008-03-03 14:54:20.000000000 +0100
+++ head-2008-03-06/arch/x86/kernel/traps_64-xen.c	2008-03-03 15:24:49.000000000 +0100
@@ -1195,7 +1195,7 @@ EXPORT_SYMBOL_GPL(math_state_restore);
  * NB. All these are "interrupt gates" (i.e. events_mask is set) because we
  * specify <dpl>|4 in the second field.
  */
-static trap_info_t trap_table[] = {
+static const trap_info_t __cpuinitconst trap_table[] = {
         {  0, 0|4, __KERNEL_CS, (unsigned long)divide_error               },
         {  1, 0|4, __KERNEL_CS, (unsigned long)debug                      },
         {  3, 3|4, __KERNEL_CS, (unsigned long)int3                       },
@@ -1236,7 +1236,7 @@ void __init trap_init(void)
 	cpu_init();
 }
 
-void smp_trap_init(trap_info_t *trap_ctxt)
+void __cpuinit smp_trap_init(trap_info_t *trap_ctxt)
 {
 	const trap_info_t *t = trap_table;
 
Index: head-2008-03-06/arch/x86/mm/ioremap-xen.c
===================================================================
--- head-2008-03-06.orig/arch/x86/mm/ioremap-xen.c	2008-03-07 09:15:58.000000000 +0100
+++ head-2008-03-06/arch/x86/mm/ioremap-xen.c	2008-03-07 09:48:42.000000000 +0100
@@ -190,7 +190,7 @@ int touch_pte_range(struct mm_struct *mm
 EXPORT_SYMBOL(touch_pte_range);
 
 #ifdef CONFIG_X86_32
-int page_is_ram(unsigned long pagenr)
+int __init page_is_ram(unsigned long pagenr)
 {
 	unsigned long addr, end;
 	int i;
