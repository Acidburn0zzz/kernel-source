From: jbeulich@novell.com
Subject: fix placement of some routines
Patch-mainline: obsolete

Index: head-2008-01-28/arch/x86/kernel/acpi/boot-xen.c
===================================================================
--- head-2008-01-28.orig/arch/x86/kernel/acpi/boot-xen.c	2008-01-28 13:49:05.000000000 +0100
+++ head-2008-01-28/arch/x86/kernel/acpi/boot-xen.c	2008-01-28 13:49:13.000000000 +0100
@@ -106,7 +106,7 @@ enum acpi_irq_model_id acpi_irq_model = 
 #if defined(CONFIG_X86_64) && !defined(CONFIG_XEN)
 
 /* rely on all ACPI tables being in the direct mapping */
-char *__acpi_map_table(unsigned long phys_addr, unsigned long size)
+char *__init __acpi_map_table(unsigned long phys_addr, unsigned long size)
 {
 	if (!phys_addr || !size)
 		return NULL;
@@ -131,7 +131,7 @@ char *__acpi_map_table(unsigned long phy
  * from the fixed base.  That's why we start at FIX_IO_APIC_BASE_END and
  * count idx down while incrementing the phys address.
  */
-char *__acpi_map_table(unsigned long phys, unsigned long size)
+char *__init __acpi_map_table(unsigned long phys, unsigned long size)
 {
 	unsigned long base, offset, mapped_size;
 	int idx;
Index: head-2008-01-28/arch/x86/kernel/traps_32-xen.c
===================================================================
--- head-2008-01-28.orig/arch/x86/kernel/traps_32-xen.c	2008-01-28 13:49:01.000000000 +0100
+++ head-2008-01-28/arch/x86/kernel/traps_32-xen.c	2008-01-28 13:49:13.000000000 +0100
@@ -1139,7 +1139,7 @@ asmlinkage void math_emulate(long arg)
  * NB. All these are "trap gates" (i.e. events_mask isn't set) except
  * for those that specify <dpl>|4 in the second field.
  */
-static trap_info_t trap_table[] = {
+static __cpuinitdata trap_info_t trap_table[] = {
 	{  0, 0, __KERNEL_CS, (unsigned long)divide_error		},
 	{  1, 0|4, __KERNEL_CS, (unsigned long)debug			},
 	{  3, 3|4, __KERNEL_CS, (unsigned long)int3			},
@@ -1200,7 +1200,7 @@ void __init trap_init(void)
 	cpu_init();
 }
 
-void smp_trap_init(trap_info_t *trap_ctxt)
+void __cpuinit smp_trap_init(trap_info_t *trap_ctxt)
 {
 	const trap_info_t *t = trap_table;
 
Index: head-2008-01-28/arch/x86/kernel/traps_64-xen.c
===================================================================
--- head-2008-01-28.orig/arch/x86/kernel/traps_64-xen.c	2008-01-28 13:49:05.000000000 +0100
+++ head-2008-01-28/arch/x86/kernel/traps_64-xen.c	2008-01-28 13:49:13.000000000 +0100
@@ -1161,7 +1161,7 @@ asmlinkage void math_state_restore(void)
  * NB. All these are "interrupt gates" (i.e. events_mask is set) because we
  * specify <dpl>|4 in the second field.
  */
-static trap_info_t trap_table[] = {
+static __cpuinitdata trap_info_t trap_table[] = {
         {  0, 0|4, __KERNEL_CS, (unsigned long)divide_error               },
         {  1, 0|4, __KERNEL_CS, (unsigned long)debug                      },
         {  3, 3|4, __KERNEL_CS, (unsigned long)int3                       },
@@ -1202,7 +1202,7 @@ void __init trap_init(void)
 	cpu_init();
 }
 
-void smp_trap_init(trap_info_t *trap_ctxt)
+void __cpuinit smp_trap_init(trap_info_t *trap_ctxt)
 {
 	const trap_info_t *t = trap_table;
 
Index: head-2008-01-28/arch/x86/mm/init_64-xen.c
===================================================================
--- head-2008-01-28.orig/arch/x86/mm/init_64-xen.c	2008-01-28 13:48:58.000000000 +0100
+++ head-2008-01-28/arch/x86/mm/init_64-xen.c	2008-01-28 13:49:13.000000000 +0100
@@ -703,7 +703,7 @@ static void __init find_early_table_spac
 		(table_start << PAGE_SHIFT) + tables);
 }
 
-static void xen_finish_init_mapping(void)
+static void __init xen_finish_init_mapping(void)
 {
 	unsigned long i, start, end;
 
Index: head-2008-01-28/drivers/acpi/osl.c
===================================================================
--- head-2008-01-28.orig/drivers/acpi/osl.c	2008-01-28 12:16:46.000000000 +0100
+++ head-2008-01-28/drivers/acpi/osl.c	2008-01-28 13:49:13.000000000 +0100
@@ -272,7 +272,11 @@ acpi_physical_address __init acpi_os_get
 		return acpi_find_rsdp();
 }
 
-void __iomem *acpi_os_map_memory(acpi_physical_address phys, acpi_size size)
+void __iomem *
+#ifdef CONFIG_XEN
+__init_refok
+#endif
+acpi_os_map_memory(acpi_physical_address phys, acpi_size size)
 {
 	if (phys > ULONG_MAX) {
 		printk(KERN_ERR PREFIX "Cannot map memory that high\n");
