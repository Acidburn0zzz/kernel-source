From: jbeulich@novell.com
Subject: fix for crash when booting without ACPI

Ordering was broken in the course of separating XEN-overridden sources
from those getting used through symlink creation.

Signed-off-by: Jan Beulich <jbeulich@novell.com>
Index: xen-2005-08-19/arch/xen/i386/pci/Makefile
===================================================================
--- xen-2005-08-19.orig/arch/xen/i386/pci/Makefile	2005-08-19 08:49:22.392605984 +0200
+++ xen-2005-08-19/arch/xen/i386/pci/Makefile	2005-08-19 14:08:53.073219544 +0200
@@ -17,7 +17,7 @@
 c-pci-$(CONFIG_X86_VISWS)	:= visws.o fixup.o
 pci-$(CONFIG_X86_VISWS)		:=
 c-pci-$(CONFIG_X86_NUMAQ)	:= numa.o
-pci-$(CONFIG_X86_NUMAQ)		:= irq.o
+l-pci-$(CONFIG_X86_NUMAQ)	:= irq.o
 
 obj-y				+= $(pci-y)
 c-obj-y				+= $(c-pci-y) common.o
@@ -27,6 +27,7 @@
 $(patsubst %.o,$(obj)/%.c,$(c-obj-y) $(c-link)):
 	@ln -fsn $(srctree)/arch/i386/pci/$(notdir $@) $@
 
-obj-y	+= $(c-obj-y) $(l-pci-y)
+# Make sure irq.o gets linked in before common.o
+obj-y	+= $(patsubst common.o,$(l-pci-y) common.o,$(c-obj-y))
 
 clean-files += $(patsubst %.o,%.c,$(c-obj-y) $(c-obj-) $(c-link))
Index: xen-2005-08-19/arch/xen/x86_64/pci/Makefile
===================================================================
--- xen-2005-08-19.orig/arch/xen/x86_64/pci/Makefile	2005-08-19 08:49:22.511587896 +0200
+++ xen-2005-08-19/arch/xen/x86_64/pci/Makefile	2005-08-19 14:08:53.075219240 +0200
@@ -30,8 +30,9 @@
 $(patsubst %.o,$(obj)/%.c,$(c-i386-obj-y)):
 	@ln -fsn $(srctree)/arch/i386/pci/$(notdir $@) $@
 
-obj-y	+= $(c-i386-obj-y) $(c-obj-y)
-obj-y	+= $(c-xen-obj-y)
+# Make sure irq.o gets linked in before common.o
+obj-y	+= $(patsubst common.o,$(c-xen-obj-y) common.o,$(c-i386-obj-y))
+obj-y	+= $(c-obj-y)
 
 clean-files += $(patsubst %.o,%.c,$(c-obj-y) $(c-obj-) $(c-link))
 clean-files += $(patsubst %.o,%.c,$(c-i386-obj-y) $(c-i386-obj-))
