From: jbeulich@novell.com
Subject: Don't automatically reboot on panic (match native)

$subject says it all.

Index: head-2006-04-21/arch/i386/kernel/setup-xen.c
===================================================================
--- head-2006-04-21.orig/arch/i386/kernel/setup-xen.c	2006-04-21 13:31:17.000000000 +0200
+++ head-2006-04-21/arch/i386/kernel/setup-xen.c	2006-04-21 13:31:42.000000000 +0200
@@ -74,11 +74,6 @@ void __init find_max_pfn(void);
 /* Allows setting of maximum possible memory size  */
 static unsigned long xen_override_max_pfn;
 
-static int xen_panic_event(struct notifier_block *, unsigned long, void *);
-static struct notifier_block xen_panic_block = {
-	xen_panic_event, NULL, 0 /* try to go last */
-};
-
 extern char hypercall_page[PAGE_SIZE];
 EXPORT_SYMBOL(hypercall_page);
 
@@ -1682,14 +1677,6 @@ void __init setup_arch(char **cmdline_p)
 	physdev_op_t op;
 	unsigned long max_low_pfn;
 
-	/* Force a quick death if the kernel panics (not domain 0). */
-	extern int panic_timeout;
-	if (!panic_timeout && !(xen_start_info->flags & SIF_INITDOMAIN))
-		panic_timeout = 1;
-
-	/* Register a call for panic conditions. */
-	notifier_chain_register(&panic_notifier_list, &xen_panic_block);
-
 	HYPERVISOR_vm_assist(VMASST_CMD_enable, VMASST_TYPE_4gb_segments);
 	HYPERVISOR_vm_assist(VMASST_CMD_enable,
 			     VMASST_TYPE_writable_pagetables);
@@ -1923,14 +1910,6 @@ void __init setup_arch(char **cmdline_p)
 	}
 }
 
-static int
-xen_panic_event(struct notifier_block *this, unsigned long event, void *ptr)
-{
-	HYPERVISOR_shutdown(SHUTDOWN_crash);
-	/* we're never actually going to get here... */
-	return NOTIFY_DONE;
-}
-
 #include "setup_arch_post.h"
 /*
  * Local Variables:
