From: jbeulich@novell.com
Subject: Allow Xen console to be independently configured

Index: head-2006-08-08/drivers/xen/Kconfig
===================================================================
--- head-2006-08-08.orig/drivers/xen/Kconfig	2006-08-09 17:53:32.000000000 +0200
+++ head-2006-08-08/drivers/xen/Kconfig	2006-08-09 17:06:03.000000000 +0200
@@ -172,6 +172,12 @@ config XEN_NETDEV_FRONTEND
 	  dedicated device-driver domain, or your master control domain
 	  (domain 0), then you almost certainly want to say Y here.
 
+config XEN_CONSOLE
+	bool "Xen virtual console"
+	default y
+	help
+	  The Xen virtual console is ...
+
 config XEN_SCRUB_PAGES
 	bool "Scrub memory before freeing it to Xen"
 	default y
Index: head-2006-08-08/drivers/xen/console/Makefile
===================================================================
--- head-2006-08-08.orig/drivers/xen/console/Makefile	2006-08-09 17:53:32.000000000 +0200
+++ head-2006-08-08/drivers/xen/console/Makefile	2006-08-09 17:06:03.000000000 +0200
@@ -1,2 +1,2 @@
 
-obj-y	:= console.o xencons_ring.o
+obj-$(CONFIG_XEN_CONSOLE)	:= console.o xencons_ring.o
Index: head-2006-08-08/include/xen/xencons.h
===================================================================
--- head-2006-08-08.orig/include/xen/xencons.h	2006-08-09 17:02:55.000000000 +0200
+++ head-2006-08-08/include/xen/xencons.h	2006-08-09 17:54:32.000000000 +0200
@@ -1,6 +1,8 @@
 #ifndef __ASM_XENCONS_H__
 #define __ASM_XENCONS_H__
 
+#ifdef CONFIG_XEN_CONSOLE
+
 void xencons_force_flush(void);
 void xencons_resume(void);
 
@@ -11,4 +13,11 @@ void xencons_tx(void);
 int xencons_ring_init(void);
 int xencons_ring_send(const char *data, unsigned len);
 
+#else
+
+static inline void xencons_force_flush(void) {}
+static inline void xencons_resume(void) {}
+
+#endif
+
 #endif /* __ASM_XENCONS_H__ */
