Subject: xen3 i386 build fixes.
From: jbeulich@novell.com
Patch-mainline: obsolete

$subject says all.

Index: head-2007-09-03/arch/i386/kernel/Makefile
===================================================================
--- head-2007-09-03.orig/arch/i386/kernel/Makefile	2007-09-03 09:44:16.000000000 +0200
+++ head-2007-09-03/arch/i386/kernel/Makefile	2007-09-03 09:52:51.000000000 +0200
@@ -58,7 +58,7 @@ endif
 # Note: kbuild does not track this dependency due to usage of .incbin
 $(obj)/vsyscall.o: $(obj)/vsyscall-int80.so $(obj)/vsyscall-sysenter.so
 targets += $(foreach F,int80 sysenter,vsyscall-$F.o vsyscall-$F.so)
-targets += vsyscall-note.o vsyscall.lds
+targets += $(vsyscall_note) vsyscall.lds
 
 # The DSO images are built using a special linker script.
 quiet_cmd_syscall = SYSCALL $@
Index: head-2007-09-03/arch/i386/kernel/crash.c
===================================================================
--- head-2007-09-03.orig/arch/i386/kernel/crash.c	2007-09-03 09:44:16.000000000 +0200
+++ head-2007-09-03/arch/i386/kernel/crash.c	2007-09-03 09:52:51.000000000 +0200
@@ -27,11 +27,10 @@
 
 #include <mach_ipi.h>
 
-
+#ifndef CONFIG_XEN
 /* This keeps a track of which one is crashing cpu. */
 static int crashing_cpu;
 
-#ifndef CONFIG_XEN
 #if defined(CONFIG_SMP) && defined(CONFIG_X86_LOCAL_APIC)
 static atomic_t waiting_for_crash_ipi;
 
@@ -128,9 +127,9 @@ void machine_crash_shutdown(struct pt_re
 	/* The kernel is broken so disable interrupts */
 	local_irq_disable();
 
+#ifndef CONFIG_XEN
 	/* Make a note of crashing cpu. Will be used in NMI callback.*/
 	crashing_cpu = safe_smp_processor_id();
-#ifndef CONFIG_XEN
 	nmi_shootdown_cpus();
 	lapic_shutdown();
 #if defined(CONFIG_X86_IO_APIC)
Index: head-2007-09-03/include/asm-i386/mach-xen/asm/page.h
===================================================================
--- head-2007-09-03.orig/include/asm-i386/mach-xen/asm/page.h	2007-09-03 09:42:56.000000000 +0200
+++ head-2007-09-03/include/asm-i386/mach-xen/asm/page.h	2007-09-03 09:52:51.000000000 +0200
@@ -37,14 +37,6 @@
 #include <xen/interface/xen.h>
 #include <xen/features.h>
 
-#define arch_free_page(_page,_order)		\
-({	int foreign = PageForeign(_page);	\
-	if (foreign)				\
-		PageForeignDestructor(_page);	\
-	foreign;				\
-})
-#define HAVE_ARCH_FREE_PAGE
-
 #ifdef CONFIG_X86_USE_3DNOW
 
 #include <asm/mmx.h>
