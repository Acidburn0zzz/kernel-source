Subject: xen3 i386 build fixes.
From: kraxel@suse.de.

Index: head-2006-01-13/include/asm-i386/system.h
===================================================================
--- head-2006-01-13.orig/include/asm-i386/system.h	2006-01-13 12:08:08.950487480 +0100
+++ head-2006-01-13/include/asm-i386/system.h	2006-01-13 12:09:48.780311040 +0100
@@ -336,7 +336,7 @@ static inline unsigned long long __cmpxc
 				      unsigned long long new)
 {
 	unsigned long long prev;
-	__asm__ __volatile__(LOCK_PREFIX "cmpxchg8b %3"
+	__asm__ __volatile__(LOCK "cmpxchg8b %3"
 			     : "=A"(prev)
 			     : "b"((unsigned long)new),
 			       "c"((unsigned long)(new >> 32)),
Index: head-2006-01-13/include/asm-i386/mach-xen/asm/pgtable.h
===================================================================
--- head-2006-01-13.orig/include/asm-i386/mach-xen/asm/pgtable.h	2006-01-13 12:08:08.949487632 +0100
+++ head-2006-01-13/include/asm-i386/mach-xen/asm/pgtable.h	2006-01-13 12:09:48.782310736 +0100
@@ -2,6 +2,7 @@
 #define _I386_PGTABLE_H
 
 #include <linux/config.h>
+#include <linux/sched.h>
 #include <asm/hypervisor.h>
 
 /*
Index: head-2006-01-13/arch/i386/xen/kernel/cpu/mtrr/main.c
===================================================================
--- head-2006-01-13.orig/arch/i386/xen/kernel/cpu/mtrr/main.c	2006-01-13 11:30:35.808017200 +0100
+++ head-2006-01-13/arch/i386/xen/kernel/cpu/mtrr/main.c	2006-01-13 12:09:48.784310432 +0100
@@ -67,8 +67,10 @@ int mtrr_add_page(unsigned long base, un
 	op.u.add_memtype.pfn     = base;
 	op.u.add_memtype.nr_pfns = size;
 	op.u.add_memtype.type    = type;
-	if ((error = HYPERVISOR_dom0_op(&op)))
+	if ((error = HYPERVISOR_dom0_op(&op))) {
+		BUG_ON(error > 0);
 		return error;
+	}
 
 	if (increment)
 		++usage_table[op.u.add_memtype.reg];
@@ -131,8 +133,12 @@ int mtrr_del_page(int reg, unsigned long
 	if (--usage_table[reg] < 1) {
 		op.cmd = DOM0_DEL_MEMTYPE;
 		op.u.del_memtype.handle = 0;
-		op.u.add_memtype.reg    = reg;
-		(void)HYPERVISOR_dom0_op(&op);
+		op.u.del_memtype.reg    = reg;
+		error = HYPERVISOR_dom0_op(&op);
+		if (error) {
+			BUG_ON(error > 0);
+			goto out;
+		}
 	}
 	error = reg;
  out:
