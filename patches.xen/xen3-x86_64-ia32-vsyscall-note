From: jbeulich@novell.com
Subject: fix problem when building outside of the source tree

.

Signed-off-by: Jan Beulich <jbeulich@novell.com>
Index: xen-2005-08-19/arch/xen/x86_64/ia32/Makefile
===================================================================
--- xen-2005-08-19.orig/arch/xen/x86_64/ia32/Makefile	2005-08-19 19:57:45.797961680 +0200
+++ xen-2005-08-19/arch/xen/x86_64/ia32/Makefile	2005-08-19 20:19:02.000000000 +0200
@@ -36,8 +36,8 @@
 	$(call if_changed,syscall)
 
 AFLAGS_vsyscall-int80.o = -m32 -I$(obj)
-AFLAGS_vsyscall-sysenter.o = -m32
-AFLAGS_vsyscall-syscall.o = -m32
+AFLAGS_vsyscall-sysenter.o = -m32 -I$(obj)
+AFLAGS_vsyscall-syscall.o = -m32 -I$(obj)
 CFLAGS_ia32_ioctl.o += -Ifs/
 
 s-link	:= vsyscall-syscall.o vsyscall-sysenter.o vsyscall-sigreturn.o
@@ -48,13 +48,11 @@
 $(patsubst %.o,$(obj)/%.c,$(c-obj-y) $(c-link)) $(patsubst %.o,$(obj)/%.S,$(s-obj-y) $(s-link)):
 	@ln -fsn $(srctree)/arch/x86_64/ia32/$(notdir $@) $@
 
-$(obj)/vsyscall-int80.S: $(obj)/vsyscall-sigreturn.S ../../i386/kernel/vsyscall-note.S
-$(obj)/vsyscall-sysenter.S: $(obj)/vsyscall-sigreturn.S
-$(obj)/vsyscall-syscall.S: $(obj)/vsyscall-sigreturn.S
-
-../../i386/kernel/vsyscall-note.S:
-	@ln -fsn $(srctree)/arch/i386/kernel/$(notdir $@) $(srctree)/arch/xen/i386/kernel/$(notdir $@)
-	make -C arch/xen/i386/kernel vsyscall-note.S
+$(obj)/vsyscall-int80.o $(obj)/vsyscall-sysenter.o $(obj)/vsyscall-syscall.o: \
+	$(obj)/vsyscall-sigreturn.S $(obj)/../../i386/kernel/vsyscall-note.S
+
+$(obj)/../../i386/kernel/vsyscall-note.S:
+	@ln -fsn $(srctree)/arch/i386/kernel/$(notdir $@) $@
 
 obj-y	+= $(c-obj-y) $(s-obj-y)
 
