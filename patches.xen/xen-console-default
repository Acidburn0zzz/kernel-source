From: jbeulich@novell.com
Subject: Make Xen console default to vfb if that is built into the kernel
Patch-mainline: obsolete

Index: head-2007-04-27/drivers/xen/console/console.c
===================================================================
--- head-2007-04-27.orig/drivers/xen/console/console.c	2007-04-27 15:30:56.000000000 +0200
+++ head-2007-04-27/drivers/xen/console/console.c	2007-04-27 15:33:44.000000000 +0200
@@ -82,13 +82,19 @@ static int xc_num = -1;
 
 void xencons_early_setup(void)
 {
-	extern int console_use_vt;
-
 	if (is_initial_xendomain()) {
+#ifdef CONFIG_XEN_DISABLE_SERIAL
 		xc_mode = XC_SERIAL;
+#endif
 	} else {
+#ifdef CONFIG_XEN_FRAMEBUFFER
+		xc_mode = XC_XVC;
+#else
+		extern int console_use_vt;
+
 		xc_mode = XC_TTY;
 		console_use_vt = 0;
+#endif
 	}
 }
 
@@ -630,6 +636,8 @@ static int __init xencons_init(void)
 
 	switch (xc_mode) {
 	case XC_XVC:
+		printk(KERN_INFO "xencons_init: Initializing xen vfb;"
+		       " pass xencons=tty to prevent this\n");
 		DRV(xencons_driver)->name        = "xvc";
 		DRV(xencons_driver)->major       = XEN_XVC_MAJOR;
 		DRV(xencons_driver)->minor_start = XEN_XVC_MINOR;
