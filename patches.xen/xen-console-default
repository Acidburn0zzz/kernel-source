From: jbeulich@novell.com
Subject: Make Xen console default to vfb if that is built into the kernel
Patch-mainline: obsolete

---
 drivers/xen/console/console.c |   12 ++++++++++--
 1 file changed, 10 insertions(+), 2 deletions(-)

--- a/drivers/xen/console/console.c	2007-08-27 14:01:27.000000000 -0400
+++ b/drivers/xen/console/console.c	2007-08-27 14:01:27.000000000 -0400
@@ -82,13 +82,19 @@ static int xc_num = -1;
 
 void xencons_early_setup(void)
 {
-	extern int console_use_vt;
-
 	if (is_initial_xendomain()) {
+#ifdef CONFIG_XEN_DISABLE_SERIAL
 		xc_mode = XC_SERIAL;
+#endif
 	} else {
+#ifdef CONFIG_XEN_FRAMEBUFFER
+		xc_mode = XC_XVC;
+#else
+		extern int console_use_vt;
+
 		xc_mode = XC_TTY;
 		console_use_vt = 0;
+#endif
 	}
 }
 
@@ -630,6 +636,8 @@ static int __init xencons_init(void)
 
 	switch (xc_mode) {
 	case XC_XVC:
+		printk(KERN_INFO "xencons_init: Initializing xen vfb;"
+		       " pass xencons=tty to prevent this\n");
 		DRV(xencons_driver)->name        = "xvc";
 		DRV(xencons_driver)->major       = XEN_XVC_MAJOR;
 		DRV(xencons_driver)->minor_start = XEN_XVC_MINOR;
