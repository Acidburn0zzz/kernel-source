From: Ian.Pratt@cl.cam.ac.uk
Subject: Replace asm wbinvd with wbinvd() call for Xen compat

Xen reimplements wbinvd slightly differently, so the asm statements
should be eliminated.

Acked-by: garloff@suse.de

Index: linux-2.6.10/drivers/mtd/maps/nettel.c
===================================================================
--- linux-2.6.10.orig/drivers/mtd/maps/nettel.c	2005-02-22 12:32:25.000000000 +0100
+++ linux-2.6.10/drivers/mtd/maps/nettel.c	2005-02-22 12:49:37.000000000 +0100
@@ -270,7 +270,7 @@
 	maxsize = AMD_WINDOW_MAXSIZE;
 
 	*amdpar = SC520_PAR(SC520_PAR_BOOTCS, amdaddr, maxsize);
-	__asm__ ("wbinvd");
+	wbinvd();
 
 	nettel_amd_map.phys = amdaddr;
 	nettel_amd_map.virt = ioremap_nocache(amdaddr, maxsize);
@@ -380,7 +380,7 @@
 	 */
 	intel1addr = intel0addr + intel0size;
 	*intel1par = SC520_PAR(intel1cs, intel1addr, maxsize);
-	__asm__ ("wbinvd");
+	wbinvd();
 
 	maxsize += intel0size;
 
@@ -405,7 +405,7 @@
 	intel1size = intel_mtd->size - intel0size;
 	if (intel1size > 0) {
 		*intel1par = SC520_PAR(intel1cs, intel1addr, intel1size);
-		__asm__ ("wbinvd");
+		wbinvd();
 	} else {
 		*intel1par = 0;
 	}
