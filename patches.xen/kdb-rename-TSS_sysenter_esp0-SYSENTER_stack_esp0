From: Jeff Mahoney <jeffm@suse.com>
Subject: [PATCH] kdb: use SYSENTER_stack_esp0 instead of TSS_sysenter_esp0
Patch-mainline: Doubtful

 patches.xen/xen3-auto-arch-i386.diff renames TSS_sysenter_esp0 to
 SYSENTER_stack_esp0, which causes the debug kernel to fail compilation.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>

---

 kdb/kdba_bt_x86.c |   10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

--- a/kdb/kdba_bt_x86.c	2007-10-19 13:43:38.000000000 -0400
+++ b/kdb/kdba_bt_x86.c	2007-10-19 14:18:26.000000000 -0400
@@ -3164,18 +3164,18 @@
 	    bb_is_int_reg(dst->base_rc) &&
 	    full_register_dst) {
 #ifndef	CONFIG_X86_64
-		/* mov from TSS_sysenter_esp0+offset to esp to fix up the
+		/* mov from SYSENTER_stack_esp0+offset to esp to fix up the
 		 * sysenter stack, it leaves esp well defined.  mov
-		 * TSS_sysenter_esp0+offset(%esp),%esp is followed by up to 5
+		 * SYSENTER_stack_esp0+offset(%esp),%esp is followed by up to 5
 		 * push instructions to mimic the hardware stack push.  If
-		 * TSS_sysenter_esp0 is offset then only 3 words will be
+		 * SYSENTER_stack_esp0 is offset then only 3 words will be
 		 * pushed.
 		 */
 		if (dst->base_rc == BBRG_RSP &&
-		    src->disp >= TSS_sysenter_esp0 &&
+		    src->disp >= SYSENTER_stack_esp0 &&
 		    bb_is_osp_defined(BBRG_RSP)) {
 			int pushes;
-			pushes = src->disp == TSS_sysenter_esp0 ? 5 : 3;
+			pushes = src->disp == SYSENTER_stack_esp0 ? 5 : 3;
 			bb_reg_code_set_offset(BBRG_RSP,
 				bb_reg_code_offset(BBRG_RSP) +
 					pushes * KDB_WORD_SIZE);
