From: jbeulich@novell.com
Subject: Don't force a reboot on panics

This is supposed to be configurable on the comand line, not hard-coded.

Signed-off-by: Jan Beulich <jbeulich@novell.com>
Index: xen-2005-08-19/arch/xen/i386/kernel/setup.c
===================================================================
--- xen-2005-08-19.orig/arch/xen/i386/kernel/setup.c	2005-08-19 13:53:09.517661792 +0200
+++ xen-2005-08-19/arch/xen/i386/kernel/setup.c	2005-08-19 14:14:31.550763136 +0200
@@ -69,11 +69,6 @@
 /* Allows setting of maximum possible memory size  */
 static unsigned long xen_override_max_pfn;
 
-static int xen_panic_event(struct notifier_block *, unsigned long, void *);
-static struct notifier_block xen_panic_block = {
-	xen_panic_event, NULL, 0 /* try to go last */
-};
-
 int disable_pse __devinitdata = 0;
 
 /*
@@ -1530,14 +1525,6 @@
 	physdev_op_t op;
 	unsigned long max_low_pfn;
 
-	/* Force a quick death if the kernel panics. */
-	extern int panic_timeout;
-	if (panic_timeout == 0)
-		panic_timeout = 1;
-
-	/* Register a call for panic conditions. */
-	notifier_chain_register(&panic_notifier_list, &xen_panic_block);
-
 	HYPERVISOR_vm_assist(VMASST_CMD_enable, VMASST_TYPE_4gb_segments);
 	HYPERVISOR_vm_assist(VMASST_CMD_enable,
 			     VMASST_TYPE_writable_pagetables);
@@ -1765,14 +1752,6 @@
 	}
 }
 
-static int
-xen_panic_event(struct notifier_block *this, unsigned long event, void *ptr)
-{
-	HYPERVISOR_crash();    
-	/* we're never actually going to get here... */
-	return NOTIFY_DONE;
-}
-
 #include "setup_arch_post.h"
 /*
  * Local Variables:
