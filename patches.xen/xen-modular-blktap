From: ccoffing@novell.com
Subject: Allow actually using CONFIG_XEN_BLKDEV_TAP=m
Patch-mainline: obsolete

Index: head-2007-10-15/arch/i386/mm/hypervisor.c
===================================================================
--- head-2007-10-15.orig/arch/i386/mm/hypervisor.c	2007-10-19 17:17:09.000000000 +0200
+++ head-2007-10-15/arch/i386/mm/hypervisor.c	2007-10-19 17:17:59.000000000 +0200
@@ -56,6 +56,7 @@ void xen_l1_entry_update(pte_t *ptr, pte
 	u.val = __pte_val(val);
 	BUG_ON(HYPERVISOR_mmu_update(&u, 1, NULL, DOMID_SELF) < 0);
 }
+EXPORT_SYMBOL_GPL(xen_l1_entry_update);
 
 void xen_l2_entry_update(pmd_t *ptr, pmd_t val)
 {
Index: head-2007-10-15/drivers/xen/blktap/Makefile
===================================================================
--- head-2007-10-15.orig/drivers/xen/blktap/Makefile	2007-10-19 17:17:15.000000000 +0200
+++ head-2007-10-15/drivers/xen/blktap/Makefile	2007-04-27 15:30:48.000000000 +0200
@@ -1,5 +1,5 @@
 LINUXINCLUDE += -I../xen/include/public/io
 
-obj-$(CONFIG_XEN_BLKDEV_TAP) := xenblktap.o
+obj-$(CONFIG_XEN_BLKDEV_TAP) := blktap.o
 
-xenblktap-y := xenbus.o interface.o blktap.o 
+blktap-y := xenbus.o interface.o blocktap.o
Index: head-2007-10-15/drivers/xen/blktap/blktap.c
===================================================================
--- head-2007-10-15.orig/drivers/xen/blktap/blktap.c	2007-10-19 17:17:15.000000000 +0200
+++ head-2007-10-15/drivers/xen/blktap/blktap.c	2007-06-22 09:21:11.000000000 +0200
@@ -116,13 +116,7 @@ typedef struct tap_blkif {
 static struct tap_blkif *tapfds[MAX_TAP_DEV];
 static int blktap_next_minor;
 
-static int __init set_blkif_reqs(char *str)
-{
-	get_option(&str, &blkif_reqs);
-	return 1;
-}
-__setup("blkif_reqs=", set_blkif_reqs);
-
+module_param(blkif_reqs, int, 0);
 /* Run-time switchable: /sys/module/blktap/parameters/ */
 static unsigned int log_stats = 0;
 static unsigned int debug_lvl = 0;
Index: head-2007-10-15/drivers/xen/blktap/blocktap.c
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ head-2007-10-15/drivers/xen/blktap/blocktap.c	2007-04-27 15:30:48.000000000 +0200
@@ -0,0 +1 @@
+#include "blktap.c"
