From: ccoffing@novell.com
Subject: Allow actually using CONFIG_XEN_BLKDEV_TAP=m
Patch-mainline: obsolete

Index: head-2006-10-16/drivers/xen/blktap/Makefile
===================================================================
--- head-2006-10-16.orig/drivers/xen/blktap/Makefile	2006-10-26 10:29:04.000000000 +0200
+++ head-2006-10-16/drivers/xen/blktap/Makefile	2006-10-16 11:09:39.000000000 +0200
@@ -1,3 +1,4 @@
 LINUXINCLUDE += -I../xen/include/public/io
-obj-y	:= xenbus.o interface.o blktap.o 
+obj-$(CONFIG_XEN_BLKDEV_TAP) := blkbktap.o
+blkbktap-y	:= xenbus.o interface.o blktap.o
 
Index: head-2006-10-16/drivers/xen/blktap/blktap.c
===================================================================
--- head-2006-10-16.orig/drivers/xen/blktap/blktap.c	2006-10-16 10:36:03.000000000 +0200
+++ head-2006-10-16/drivers/xen/blktap/blktap.c	2006-10-26 12:10:54.000000000 +0200
@@ -134,13 +134,7 @@ typedef struct domid_translate {
 static domid_translate_t  translate_domid[MAX_TAP_DEV];
 static tap_blkif_t *tapfds[MAX_TAP_DEV];
 
-static int __init set_blkif_reqs(char *str)
-{
-	get_option(&str, &blkif_reqs);
-	return 1;
-}
-__setup("blkif_reqs=", set_blkif_reqs);
-
+module_param(blkif_reqs, int, 0);
 /* Run-time switchable: /sys/module/blktap/parameters/ */
 static unsigned int log_stats = 0;
 static unsigned int debug_lvl = 0;
Index: head-2006-10-16/mm/memory.c
===================================================================
--- head-2006-10-16.orig/mm/memory.c	2006-10-26 10:29:04.000000000 +0200
+++ head-2006-10-16/mm/memory.c	2006-10-16 11:49:54.000000000 +0200
@@ -895,6 +895,8 @@ unsigned long zap_page_range(struct vm_a
 	return end;
 }
 
+EXPORT_SYMBOL_GPL(zap_page_range);
+
 /*
  * Do a quick page-table lookup for a single page.
  */
