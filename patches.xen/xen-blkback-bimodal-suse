Subject: backward compatibility
Signed-off-by: Gerd Hoffmann <kraxel@suse.de>
Patch-mainline: obsolete

---
 linux-2.6-xen-sparse/drivers/xen/blkback/xenbus.c |    6 ++++++
 linux-2.6-xen-sparse/drivers/xen/blktap/xenbus.c  |    6 ++++++
 2 files changed, 12 insertions(+)

Index: head-2007-10-15/drivers/xen/blkback/xenbus.c
===================================================================
--- head-2007-10-15.orig/drivers/xen/blkback/xenbus.c	2007-10-22 10:35:02.000000000 +0200
+++ head-2007-10-15/drivers/xen/blkback/xenbus.c	2007-10-22 10:49:56.000000000 +0200
@@ -488,6 +488,12 @@ static int connect_ring(struct backend_i
 		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_32;
 	else if (0 == strcmp(protocol, XEN_IO_PROTO_ABI_X86_64))
 		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_64;
+#if 1 /* maintain compatibility with early sles10-sp1 and paravirt netware betas */
+	else if (0 == strcmp(protocol, "1"))
+		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_32;
+	else if (0 == strcmp(protocol, "2"))
+		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_64;
+#endif
 	else {
 		xenbus_dev_fatal(dev, err, "unknown fe protocol %s", protocol);
 		return -1;
Index: head-2007-10-15/drivers/xen/blktap/xenbus.c
===================================================================
--- head-2007-10-15.orig/drivers/xen/blktap/xenbus.c	2007-10-22 10:35:17.000000000 +0200
+++ head-2007-10-15/drivers/xen/blktap/xenbus.c	2007-10-22 10:50:02.000000000 +0200
@@ -432,6 +432,12 @@ static int connect_ring(struct backend_i
 		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_32;
 	else if (0 == strcmp(protocol, XEN_IO_PROTO_ABI_X86_64))
 		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_64;
+#if 1 /* maintain compatibility with early sles10-sp1 and paravirt netware betas */
+	else if (0 == strcmp(protocol, "1"))
+		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_32;
+	else if (0 == strcmp(protocol, "2"))
+		be->blkif->blk_protocol = BLKIF_PROTOCOL_X86_64;
+#endif
 	else {
 		xenbus_dev_fatal(dev, err, "unknown fe protocol %s", protocol);
 		return -1;
