#!/bin/sh
#
# to be run from the pre-commit hook, runs check-patch on every added or
# modified file in patches.*/

err=0
files=$(git diff-index --name-only --cached --diff-filter=ACM HEAD)
for file in $files; do
    case "$file" in
    patches.*/*)
        git show :$file | "$(dirname "$0")"/check-patch --stdin $file
        if test $? != 0; then
            err=1
        fi
    esac
done
if test "$err" != 0; then
    echo "Aborting."
    exit "$err"
fi
