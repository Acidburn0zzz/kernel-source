Index: linux-2.6.8/drivers/infiniband/hw/mellanox-hca/mosal/mosal_mlock.c
===================================================================
--- linux-2.6.8.orig/drivers/infiniband/hw/mellanox-hca/mosal/mosal_mlock.c
+++ linux-2.6.8/drivers/infiniband/hw/mellanox-hca/mosal/mosal_mlock.c
@@ -294,6 +294,13 @@ int find_m_lock_unlock_ptrs(sys_lock_ptr
 #ifdef __ia64__
   return 0;
 #elif LINUX_KERNEL_2_6
+  /* Original programmer of this should have his or her programming license
+     revoked. -AK */
+#if 1
+  extern void sys_mlock(void), sys_munlock(void);
+  *lock_p = sys_mlock; 
+  *unlock_p = sys_munlock;  return 0;
+#else
   char *modname;
   const char *name;
   unsigned long offset, size, n;
@@ -318,7 +325,7 @@ int find_m_lock_unlock_ptrs(sys_lock_ptr
     return 0;
   }
   else return -1;
-
+#endif
 #elif defined(sys_call_table) || defined(USE_SYS_CALL_TABLE) || ( defined(__x86_64__) && !defined(RH_AS_3_0) )
   *lock_p = (sys_lock_ptr_t)sys_call_table[__NR_mlock]; 
   *unlock_p = (sys_lock_ptr_t)sys_call_table[__NR_munlock]; 
Index: linux-2.6.8/mm/mlock.c
===================================================================
--- linux-2.6.8.orig/mm/mlock.c
+++ linux-2.6.8/mm/mlock.c
@@ -7,6 +7,7 @@
 
 #include <linux/mman.h>
 #include <linux/mm.h>
+#include <linux/module.h>
 
 
 static int mlock_fixup(struct vm_area_struct * vma, 
@@ -123,6 +124,7 @@ asmlinkage long sys_mlock(unsigned long 
 	up_write(&current->mm->mmap_sem);
 	return error;
 }
+EXPORT_SYMBOL(sys_mlock);
 
 asmlinkage long sys_munlock(unsigned long start, size_t len)
 {
@@ -135,6 +137,7 @@ asmlinkage long sys_munlock(unsigned lon
 	up_write(&current->mm->mmap_sem);
 	return ret;
 }
+EXPORT_SYMBOL(sys_munlock);
 
 static int do_mlockall(int flags)
 {
