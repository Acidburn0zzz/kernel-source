diff -Naur 20-fetchop/arch/ia64/kernel/sal.c 30-exports/arch/ia64/kernel/sal.c
--- 20-fetchop/arch/ia64/kernel/sal.c	Thu Feb 26 11:08:09 2004
+++ 30-exports/arch/ia64/kernel/sal.c	Thu Feb 26 11:09:49 2004
@@ -13,12 +13,15 @@
 #include <linux/smp.h>
 #include <linux/spinlock.h>
 #include <linux/string.h>
+#include <linux/module.h>
 
 #include <asm/page.h>
 #include <asm/sal.h>
 #include <asm/pal.h>
 
 spinlock_t sal_lock __cacheline_aligned = SPIN_LOCK_UNLOCKED;
+EXPORT_SYMBOL(sal_lock);
+
 unsigned long sal_platform_features;
 
 static struct {
@@ -33,6 +36,8 @@
 }
 
 ia64_sal_handler ia64_sal = (ia64_sal_handler) default_handler;
+EXPORT_SYMBOL(ia64_sal);
+
 ia64_sal_desc_ptc_t *ia64_ptc_domain_info;
 
 const char *
diff -Naur 20-fetchop/arch/ia64/kernel/smpboot.c 30-exports/arch/ia64/kernel/smpboot.c
--- 20-fetchop/arch/ia64/kernel/smpboot.c	Thu Feb 26 11:06:14 2004
+++ 30-exports/arch/ia64/kernel/smpboot.c	Thu Feb 26 11:08:08 2004
@@ -465,6 +465,7 @@
 EXPORT_SYMBOL(cpu_to_node_map);
 /* which logical CPUs are on which nodes */
 cpumask_t node_to_cpu_mask[MAX_NUMNODES] __cacheline_aligned;
+EXPORT_SYMBOL(node_to_cpu_mask);
 
 /*
  * Build cpu to node mapping and initialize the per node cpu masks.
diff -Naur 20-fetchop/arch/ia64/sn/kernel/bte.c 30-exports/arch/ia64/sn/kernel/bte.c
--- 20-fetchop/arch/ia64/sn/kernel/bte.c	Thu Feb 26 11:06:41 2004
+++ 30-exports/arch/ia64/sn/kernel/bte.c	Thu Feb 26 11:08:44 2004
@@ -7,6 +7,7 @@
  */
 
 #include <linux/config.h>
+#include <linux/module.h>
 #include <asm/sn/sgi.h>
 #include <asm/sn/nodepda.h>
 #include <asm/sn/addrs.h>
@@ -169,6 +170,7 @@
 
 	return bte_status;
 }
+EXPORT_SYMBOL(bte_copy);
 
 
 /*
@@ -405,7 +407,7 @@
 bte_init_cpu(void)
 {
 	/* Called by setup.c as each cpu is being added to the nodepda */
-	if (local_node_data->active_cpu_count & 0x1) {
+	if (get_slice() == 0) {
 		pda->cpu_bte_if[0] = &(nodepda->bte_if[0]);
 		pda->cpu_bte_if[1] = &(nodepda->bte_if[1]);
 	} else {
diff -Naur 20-fetchop/arch/ia64/sn/kernel/setup.c 30-exports/arch/ia64/sn/kernel/setup.c
--- 20-fetchop/arch/ia64/sn/kernel/setup.c	Thu Feb 26 11:06:15 2004
+++ 30-exports/arch/ia64/sn/kernel/setup.c	Thu Feb 26 11:08:09 2004
@@ -50,6 +50,7 @@
 #include <asm/sn/sn2/shub.h>
 
 DEFINE_PER_CPU(struct pda_s, pda_percpu);
+EXPORT_SYMBOL(per_cpu__pda_percpu);
 
 #define MAX_PHYS_MEMORY		(1UL << 49)     /* 1 TB */
 
@@ -66,8 +67,11 @@
 unsigned long sn_rtc_cycles_per_second;   
 
 partid_t sn_partid = -1;
+EXPORT_SYMBOL(sn_partid);
 char sn_system_serial_number_string[128];
+EXPORT_SYMBOL(sn_system_serial_number_string);
 u64 sn_partition_serial_number;
+EXPORT_SYMBOL(sn_partition_serial_number);
 
 short physical_node_map[MAX_PHYSNODE_ID];
 
diff -Naur 20-fetchop/include/asm-ia64/sn/sn_sal.h 30-exports/include/asm-ia64/sn/sn_sal.h
--- 20-fetchop/include/asm-ia64/sn/sn_sal.h	Thu Feb 26 11:08:25 2004
+++ 30-exports/include/asm-ia64/sn/sn_sal.h	Thu Feb 26 11:10:07 2004
@@ -13,6 +13,7 @@
 
 
 #include <linux/config.h>
+#include <asm/sn/sgi.h>
 #include <asm/sal.h>
 #include <asm/sn/sn_cpuid.h>
 #include <asm/sn/arch.h>
diff -Naur 20-fetchop/kernel/sched.c 30-exports/kernel/sched.c
--- 20-fetchop/kernel/sched.c	Thu Feb 26 11:07:42 2004
+++ 30-exports/kernel/sched.c	Thu Feb 26 11:09:18 2004
@@ -2215,6 +2215,7 @@
 {
 	return setscheduler(pid, policy, param);
 }
+EXPORT_SYMBOL(sys_sched_setscheduler);
 
 /**
  * sys_sched_setparam - set/change the RT priority of a thread
diff -Naur 20-fetchop/mm/page_alloc.c 30-exports/mm/page_alloc.c
--- 20-fetchop/mm/page_alloc.c	Thu Feb 26 11:06:05 2004
+++ 30-exports/mm/page_alloc.c	Thu Feb 26 11:07:53 2004
@@ -40,6 +40,7 @@
 unsigned long totalhigh_pages;
 int nr_swap_pages;
 int numnodes = 1;
+EXPORT_SYMBOL(numnodes);
 int sysctl_lower_zone_protection = 0;
 
 EXPORT_SYMBOL(totalram_pages);
