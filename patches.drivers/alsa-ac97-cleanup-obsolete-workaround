From: Takashi Iwai <tiwai@suse.de>
Subject: [ALSA] ac97 - Clean up obsolete workarounds
Patch-mainline: 2.6.16-git
References: 116387

[ALSA] ac97 - Clean up obsolete workarounds

Clean up obsolete workarounds provided only for nm256.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
commit fcfb2f42e38479faf111be9156b7cd529cb0ed15
tree 8fb4b79ec5bfe861bb3259fab1ddc51690e6d5e7
parent 02771e1cc9f83ec96ae49b92894a112976880e3f
author Takashi Iwai <tiwai@suse.de> Wed, 15 Mar 2006 15:08:20 +0100
committer Takashi Iwai <tiwai@suse.de> Wed, 15 Mar 2006 16:47:20 +0100

 include/sound/ac97_codec.h  |    3 ---
 sound/pci/ac97/ac97_codec.c |    8 --------
 2 files changed, 0 insertions(+), 11 deletions(-)

diff --git a/include/sound/ac97_codec.h b/include/sound/ac97_codec.h
index dee766c..b45a737 100644
--- a/include/sound/ac97_codec.h
+++ b/include/sound/ac97_codec.h
@@ -446,8 +446,6 @@ struct snd_ac97_template {
 	unsigned short num;	/* number of codec: 0 = primary, 1 = secondary */
 	unsigned short addr;	/* physical address of codec [0-3] */
 	unsigned int scaps;	/* driver capabilities */
-	unsigned int limited_regs; /* allow limited registers only */
-	DECLARE_BITMAP(reg_accessed, 0x80); /* bit flags */
 	const struct snd_ac97_res_table *res_table;	/* static resolution */
 };
 
@@ -477,7 +475,6 @@ struct snd_ac97 {
 	unsigned int rates[6];	/* see AC97_RATES_* defines */
 	unsigned int spdif_status;
 	unsigned short regs[0x80]; /* register cache */
-	unsigned int limited_regs; /* allow limited registers only */
 	DECLARE_BITMAP(reg_accessed, 0x80); /* bit flags */
 	union {			/* vendor specific code */
 		struct {
diff --git a/sound/pci/ac97/ac97_codec.c b/sound/pci/ac97/ac97_codec.c
index c5bbdcb..278319b 100644
--- a/sound/pci/ac97/ac97_codec.c
+++ b/sound/pci/ac97/ac97_codec.c
@@ -192,9 +192,6 @@ static const struct ac97_codec_id snd_ac
 
 static int snd_ac97_valid_reg(struct snd_ac97 *ac97, unsigned short reg)
 {
-	if (ac97->limited_regs && ! test_bit(reg, ac97->reg_accessed))
-  		return 0;
-
 	/* filter some registers for buggy codecs */
 	switch (ac97->id) {
 	case AC97_ID_AK4540:
@@ -1008,9 +1005,6 @@ static int snd_ac97_try_volume_mix(struc
 		break;
 	}
 
-	if (ac97->limited_regs && test_bit(reg, ac97->reg_accessed))
-		return 1; /* allow without check */
-
 	val = snd_ac97_read(ac97, reg);
 	if (!(val & mask)) {
 		/* nothing seems to be here - mute flag is not set */
@@ -1866,8 +1860,6 @@ int snd_ac97_mixer(struct snd_ac97_bus *
 	ac97->num = template->num;
 	ac97->addr = template->addr;
 	ac97->scaps = template->scaps;
-	ac97->limited_regs = template->limited_regs;
-	memcpy(ac97->reg_accessed, template->reg_accessed, sizeof(ac97->reg_accessed));
 	ac97->res_table = template->res_table;
 	bus->codec[ac97->num] = ac97;
 	mutex_init(&ac97->reg_mutex);
