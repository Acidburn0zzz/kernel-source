From: Takashi Iwai <tiwai@suse.de>
Subject: [ALSA] hda-intel - Fix race in remove
Patch-mainline: 
References: 167869

[ALSA] hda-intel - Fix race in remove

Call iounmap after free_irq to avoid invalid accesses in the
shared irq during removal of the driver.

Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
commit b7ccba57b4210bf69de1c06a1826196fdf137c9f
tree c856c9125d657bc36a8b8b16bad76659e35db56c
parent 6f9162743620f7dc0deca0f3daec8a4ab55903f4
author Takashi Iwai <tiwai@suse.de> Thu, 01 Jun 2006 00:00:00 +0200
committer Takashi Iwai <tiwai@suse.de> Thu, 01 Jun 2006 12:31:10 +0200

 sound/pci/hda/hda_intel.c |    4 ++--
 1 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/sound/pci/hda/hda_intel.c b/sound/pci/hda/hda_intel.c
index 0154389..4070b5c 100644
--- a/sound/pci/hda/hda_intel.c
+++ b/sound/pci/hda/hda_intel.c
@@ -1402,10 +1402,10 @@ static int azx_free(struct azx *chip)
 		msleep(1);
 	}
 
-	if (chip->remap_addr)
-		iounmap(chip->remap_addr);
 	if (chip->irq >= 0)
 		free_irq(chip->irq, (void*)chip);
+	if (chip->remap_addr)
+		iounmap(chip->remap_addr);
 
 	if (chip->bdl.area)
 		snd_dma_free_pages(&chip->bdl);
