From: Alexey Dobriyan <adobriyan@gmail.com>
Subject: [ALSA] vx - Fix memory leak on error path
Patch-mainline: 2.6.16-git
References: 

[ALSA] vx - Fix memory leak on error path

Noticed by Eric Sesterhenn on kernel-janitors@

Signed-off-by: Alexey Dobriyan <adobriyan@gmail.com>
Signed-off-by: Andrew Morton <akpm@osdl.org>
Signed-off-by: Takashi Iwai <tiwai@suse.de>

---
commit 57f2326dbba8ea825951313e9fc7de9fd8b72d04
tree b3010c9995358ff99fcede996f5ace4546bfb3ad
parent 5a7099d0ca3d82197d8f7b0b4f28b608820e1638
author Alexey Dobriyan <adobriyan@gmail.com> Mon, 06 Mar 2006 14:21:30 +0100
committer Takashi Iwai <tiwai@suse.de> Mon, 06 Mar 2006 15:20:46 +0100

 sound/drivers/vx/vx_pcm.c |    6 +++++-
 1 files changed, 5 insertions(+), 1 deletions(-)

diff --git a/sound/drivers/vx/vx_pcm.c b/sound/drivers/vx/vx_pcm.c
index 2195e25..c4af849 100644
--- a/sound/drivers/vx/vx_pcm.c
+++ b/sound/drivers/vx/vx_pcm.c
@@ -1253,9 +1253,13 @@ static int vx_init_audio_io(struct vx_co
 
 	/* allocate pipes */
 	chip->playback_pipes = kmalloc(sizeof(struct vx_pipe *) * chip->audio_outs, GFP_KERNEL);
+	if (!chip->playback_pipes)
+		return -ENOMEM;
 	chip->capture_pipes = kmalloc(sizeof(struct vx_pipe *) * chip->audio_ins, GFP_KERNEL);
-	if (! chip->playback_pipes || ! chip->capture_pipes)
+	if (!chip->capture_pipes) {
+		kfree(chip->playback_pipes);
 		return -ENOMEM;
+	}
 
 	memset(chip->playback_pipes, 0, sizeof(struct vx_pipe *) * chip->audio_outs);
 	memset(chip->capture_pipes, 0, sizeof(struct vx_pipe *) * chip->audio_ins);
