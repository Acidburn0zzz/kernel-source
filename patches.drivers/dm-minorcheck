Date: Wed, 22 Sep 2004 18:25:30 -0700
From: agk@redhat.com
Subject: device-mapper: fix minor number check

# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/09/22 18:25:30-07:00 agk@redhat.com 
#   [PATCH] device-mapper: fix minor number check
#   
#   Fix minor number allocation check: (1 << MINORBITS) is invalid.
#   
#   Signed-off-by: Andrew Morton <akpm@osdl.org>
#   Signed-off-by: Linus Torvalds <torvalds@osdl.org>
# 
# drivers/md/dm.c
#   2004/09/22 13:34:57-07:00 agk@redhat.com +2 -2
#   device-mapper: fix minor number check
# 
diff -Nru a/drivers/md/dm.c b/drivers/md/dm.c
--- a/drivers/md/dm.c	2004-09-22 20:15:17 -07:00
+++ b/drivers/md/dm.c	2004-09-22 20:15:17 -07:00
@@ -647,7 +647,7 @@
 {
 	int r, m;
 
-	if (minor > (1 << MINORBITS))
+	if (minor >= (1 << MINORBITS))
 		return -EINVAL;
 
 	down(&_minor_lock);
@@ -697,7 +697,7 @@
 		goto out;
 	}
 
-	if (m > (1 << MINORBITS)) {
+	if (m >= (1 << MINORBITS)) {
 		idr_remove(&_minor_idr, m);
 		r = -ENOSPC;
 		goto out;
