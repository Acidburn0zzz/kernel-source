From: Jens Axboe <axboe@suse.de>
Subject: Wait for current command to finish in ata_do_simple_cmd()
Patch-mainline: 
References: 114648

A hack to wait a little while for the current command to complete, before
issuing a new one.

Acked-by: 
Signed-off-by: 

--- linux-2.6.13/drivers/scsi/libata-core.c~	2005-09-01 12:22:19.000000000 +0200
+++ linux-2.6.13/drivers/scsi/libata-core.c	2005-09-01 12:24:38.000000000 +0200
@@ -3738,8 +3738,8 @@
 	unsigned long flags;
 	int rc;
 
-	qc = ata_qc_new_init(ap, dev);
-	BUG_ON(qc == NULL);
+	while ((qc = ata_qc_new_init(ap, dev)) == NULL)
+		msleep(10);
 
 	qc->tf.command = cmd;
 	qc->tf.flags |= ATA_TFLAG_DEVICE;
