From: Atul.Mukker@lsil.com
Subject: fix data corruption bug in megaraid driver
Patch-mainline: 2.6.9
References: 49023
Acked-by: mantel@suse.de

diff -urNp linux-2.6.8/drivers/scsi/megaraid/megaraid_mbox.c linux-2.6.8.SUSE/drivers/scsi/megaraid/megaraid_mbox.c
--- linux-2.6.8/drivers/scsi/megaraid/megaraid_mbox.c	2004-12-08 10:53:09.259058934 +0100
+++ linux-2.6.8.SUSE/drivers/scsi/megaraid/megaraid_mbox.c	2004-12-08 10:55:34.343792343 +0100
@@ -10,7 +10,7 @@
  *	   2 of the License, or (at your option) any later version.
  *
  * FILE		: megaraid_mbox.c
- * Version	: v2.20.3.1 (August 24 2004)
+ * Version	: v2.20.4 (September 27 2004)
  *
  * Authors:
  * 	Atul Mukker		<Atul.Mukker@lsil.com>
@@ -197,7 +197,7 @@ MODULE_PARM_DESC(debug_level, "Debug lev
  * ### global data ###
  */
 static uint8_t megaraid_mbox_version[8] =
-	{ 0x02, 0x20, 0x02, 0x00, 7, 22, 20, 4 };
+	{ 0x02, 0x20, 0x04, 0x00, 9, 27, 20, 4 };
 
 
 /*
@@ -3562,7 +3562,7 @@ megaraid_cmm_register(adapter_t *adapter
 	for (i = 0; i < MBOX_MAX_USER_CMDS; i++) {
 
 		scb			= adapter->uscb_list + i;
-		ccb			= raid_dev->ccb_list + i;
+		ccb			= raid_dev->uccb_list + i;
 
 		scb->ccb		= (caddr_t)ccb;
 		ccb->mbox64		= raid_dev->umbox64 + i;
diff -urNp linux-2.6.8/drivers/scsi/megaraid/megaraid_mbox.h linux-2.6.8.SUSE/drivers/scsi/megaraid/megaraid_mbox.h
--- linux-2.6.8/drivers/scsi/megaraid/megaraid_mbox.h	2004-12-08 10:53:09.261058614 +0100
+++ linux-2.6.8.SUSE/drivers/scsi/megaraid/megaraid_mbox.h	2004-12-08 10:55:34.348791541 +0100
@@ -21,8 +21,8 @@
 #include "megaraid_ioctl.h"
 
 
-#define MEGARAID_VERSION	"2.20.3.1"
-#define MEGARAID_EXT_VERSION	"(Release Date: Tue Aug 24 09:43:35 EDT 2004)"
+#define MEGARAID_VERSION	"2.20.4.0"
+#define MEGARAID_EXT_VERSION	"(Release Date: Mon Sep 27 22:15:07 EDT 2004)"
 
 
 /*
