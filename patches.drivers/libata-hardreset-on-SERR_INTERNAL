From: Tejun Heo <htejun@gmail.com>
Subject: [PATCH] libata: hardreset on SERR_INTERNAL
References: 241334

There was a rare report where SB600 reported SERR_INTERNAL and SRST
couldn't get it out of the failure mode.  Hardreset on SERR_INTERNAL.
As the problem is intermittent, whether this fixes the problem or not
hasn't been verified yet, but hardresetting the channel on internal
error is a good idea anyway.

Signed-off-by: Tejun Heo <htejun@gmail.com>
---
 drivers/ata/libata-eh.c |    2 +-
 1 files changed, 1 insertion(+), 1 deletion(-)

--- linux-2.6.20.orig/drivers/ata/libata-eh.c
+++ linux-2.6.20/drivers/ata/libata-eh.c
@@ -1055,7 +1055,7 @@ static void ata_eh_analyze_serror(struct
 	}
 	if (serror & SERR_INTERNAL) {
 		err_mask |= AC_ERR_SYSTEM;
-		action |= ATA_EH_SOFTRESET;
+		action |= ATA_EH_HARDRESET;
 	}
 	if (serror & (SERR_PHYRDY_CHG | SERR_DEV_XCHG))
 		ata_ehi_hotplugged(&ehc->i);
