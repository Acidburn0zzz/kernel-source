I neglected to initialize a couple of registers that are usually
zero, but not always.  :-)

Please apply.

jeremy


# This is a BitKeeper generated patch for the following project:
# Project Name: Linux kernel tree
# This patch format is intended for GNU patch command version 2.5 or higher.
# This patch includes the following deltas:
#	           ChangeSet	1.1783  -> 1.1784 
#	drivers/scsi/sata_vsc.c	1.6     -> 1.7    
#
# The following is the BitKeeper ChangeSet Log
# --------------------------------------------
# 04/04/22	jeremy@tomahawk.engr.sgi.com	1.1784
# Fix sata_vsc to initialize upper address pointer registers.
# --------------------------------------------
#
diff -Nru a/drivers/scsi/sata_vsc.c b/drivers/scsi/sata_vsc.c
--- a/drivers/scsi/sata_vsc.c	Thu Apr 22 19:14:14 2004
+++ b/drivers/scsi/sata_vsc.c	Thu Apr 22 19:14:14 2004
@@ -44,6 +44,9 @@
 #define VSC_SATA_TF_ALTSTATUS_OFFSET	0x28
 #define VSC_SATA_TF_CTL_OFFSET		0x29
 
+#define VSC_SATA_UP_DESCRIPTOR_OFFSET	0x64
+#define VSC_SATA_UP_DATA_BUFFER_OFFSET	0x6C
+
 /* DMA base */
 #define VSC_SATA_DMA_CMD_OFFSET		0x70
 
@@ -234,6 +236,8 @@
 	port->ctl_addr		= base + VSC_SATA_TF_CTL_OFFSET;
 	port->bmdma_addr	= base + VSC_SATA_DMA_CMD_OFFSET;
 	port->scr_addr		= base + VSC_SATA_SCR_STATUS_OFFSET;
+	writel(0, base + VSC_SATA_UP_DESCRIPTOR_OFFSET);
+	writel(0, base + VSC_SATA_UP_DATA_BUFFER_OFFSET);
 }
 

