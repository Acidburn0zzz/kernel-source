diff -u linux-2.6.8/drivers/infiniband/ulp/ipoib/ipoib_multicast.c-o linux-2.6.8/drivers/infiniband/ulp/ipoib/ipoib_multicast.c
--- linux-2.6.8/drivers/infiniband/ulp/ipoib/ipoib_multicast.c-o	2004-08-31 12:07:54.000000000 +0000
+++ linux-2.6.8/drivers/infiniband/ulp/ipoib/ipoib_multicast.c	2004-08-31 12:23:27.269072374 +0000
@@ -1100,14 +1100,17 @@
                                        ) {
   struct net_device *dev = dev_ptr;
   struct tTS_IPOIB_DEVICE_PRIVATE_STRUCT *priv = dev->priv;
-  struct in_device *in_dev = in_dev_get(dev);
+  struct in_device *in_dev;
   struct list_head *ptr, *tmp;
   struct ip_mc_list *im;
   tTS_IPOIB_MULTICAST_GROUP mcast;
   LIST_HEAD(remove_list);
   unsigned long flags;
 
+  rcu_read_lock();
+  in_dev = __in_dev_get(dev);
   if (!in_dev) {
+    rcu_read_unlock();
     return;
   }
 
@@ -1136,7 +1139,7 @@
     clear_bit(TS_IPOIB_MCAST_FLAG_FOUND, &mcast->flags);
   }
 
-  read_lock(&in_dev->lock);
+  read_lock(&in_dev->mc_list_lock);
 
   /* Mark all of the entries that are found or don't exist */
   for (im = in_dev->mc_list; im; im = im->next) {
@@ -1199,7 +1202,8 @@
     }
   }
 
-  read_unlock(&in_dev->lock);
+  read_unlock(&in_dev->mc_list_lock);
+  rcu_read_unlock();
 
   /* Remove all of the entries don't exist anymore */
   list_for_each_safe(ptr, tmp, &priv->multicast_list) {
diff -u linux-2.6.8/drivers/infiniband/core/mad_static.c-o linux-2.6.8/drivers/infiniband/core/mad_static.c
--- linux-2.6.8/drivers/infiniband/core/mad_static.c-o	2004-08-31 12:07:54.000000000 +0000
+++ linux-2.6.8/drivers/infiniband/core/mad_static.c	2004-08-31 12:14:51.263228516 +0000
@@ -49,6 +49,7 @@
   struct in_device *idev;
 
   read_lock(&dev_base_lock);
+  rcu_read_lock();
   for (dev = dev_base; dev; dev = dev->next) {
     if (dev->flags & IFF_LOOPBACK) {
       continue;
@@ -59,10 +60,10 @@
       continue;
     }
 
-    read_lock(&idev->lock);
+    read_lock(&idev->mc_list_lock);
 
     if (!idev->ifa_list) {
-      read_unlock(&idev->lock);
+      read_unlock(&idev->mc_list_lock);
       in_dev_put(idev);
       continue;
     }
@@ -87,10 +88,11 @@
                dev->name, i[0], i[1], i[2], i[3], lid_base);
     }
 
-    read_unlock(&idev->lock);
+    read_unlock(&idev->mc_list_lock);
     in_dev_put(idev);
     break;
   }
+  rcu_read_unlock();
   read_unlock(&dev_base_lock);
 
   if (!lid_base) {
