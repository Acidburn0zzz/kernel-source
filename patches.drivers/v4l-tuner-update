Subject: [patch] v4l: tuner update
From: kraxel@suse.de
Patch-mainline: not yet

tuner module update

Signed-off-by: Gerd Knorr <kraxel@suse.de>
---
 drivers/media/video/tda9887.c |    6 ++++--
 drivers/media/video/tuner.c   |   14 ++++++++++++--
 include/media/tuner.h         |    2 ++
 3 files changed, 18 insertions(+), 4 deletions(-)

Index: linux-2.6.10/include/media/tuner.h
===================================================================
--- linux-2.6.10.orig/include/media/tuner.h	2004-12-29 23:57:53.000000000 +0100
+++ linux-2.6.10/include/media/tuner.h	2005-01-07 16:45:48.102885002 +0100
@@ -77,6 +77,7 @@
 #define TUNER_MICROTUNE_4042FI5  49	/* FusionHDTV 3 Gold - 4042 FI5 (3X 8147) */
 #define TUNER_TCL_2002N          50
 #define TUNER_PHILIPS_FM1256_IH3   51
+#define TUNER_THOMSON_DTT7610    52
 
 #define NOTUNER 0
 #define PAL     1	/* PAL_BG */
@@ -97,6 +98,7 @@
 #define HITACHI 9
 #define Panasonic 10
 #define TCL     11
+#define THOMSON 12
 
 #define TUNER_SET_TYPE               _IOW('t',1,int)    /* set tuner type */
 #define TUNER_SET_TVFREQ             _IOW('t',2,int)    /* set tv freq */
Index: linux-2.6.10/drivers/media/video/tuner.c
===================================================================
--- linux-2.6.10.orig/drivers/media/video/tuner.c	2004-12-30 00:00:10.000000000 +0100
+++ linux-2.6.10/drivers/media/video/tuner.c	2005-01-07 16:45:56.202361942 +0100
@@ -1,5 +1,5 @@
 /*
- * $Id: tuner.c,v 1.31 2004/11/10 11:07:24 kraxel Exp $
+ * $Id: tuner.c,v 1.34 2005/01/04 16:31:20 kraxel Exp $
  */
 
 #include <linux/module.h>
@@ -265,6 +265,11 @@ static struct tunertype tuners[] = {
 	{ "Philips PAL/SECAM_D (FM 1256 I-H3)", Philips, PAL,
 	  16*160.00,16*442.00,0x01,0x02,0x04,0x8e,623 },
 
+	{ "Thomson DDT 7610 ATSC/NTSC)", THOMSON, ATSC,
+	  16*157.25,16*454.00,0x39,0x3a,0x3c,0x8e,732},
+	{ "Philips FQ1286", Philips, NTSC,
+	  16*160.00,16*454.00,0x41,0x42,0x04,0x8e,940}, // UHF band untested
+
 };
 #define TUNERS ARRAY_SIZE(tuners)
 
@@ -663,7 +668,8 @@ static void mt2050_set_if_freq(struct i2
 	int ret;
 	unsigned char buf[6];
 
-	dprintk("mt2050_set_if_freq freq=%d\n",freq);
+	dprintk("mt2050_set_if_freq freq=%d if1=%d if2=%d\n",
+		freq,if1,if2);
 
 	f_lo1=freq+if1;
 	f_lo1=(f_lo1/1000000)*1000000;
@@ -727,6 +733,10 @@ static void mt2050_set_tv_freq(struct i2
                 // PAL
                 if2 = 38900*1000;
         }
+#if 0
+	// testing for DVB ...
+	if2 = 36166667;
+#endif
 	mt2050_set_if_freq(c, freq*62500, if2);
 	mt2050_set_antenna(c, tv_antenna);
 }
Index: linux-2.6.10/drivers/media/video/tda9887.c
===================================================================
--- linux-2.6.10.orig/drivers/media/video/tda9887.c	2004-12-29 23:59:46.000000000 +0100
+++ linux-2.6.10/drivers/media/video/tda9887.c	2005-01-07 16:45:56.203361754 +0100
@@ -1,4 +1,5 @@
 #include <linux/module.h>
+#include <linux/moduleparam.h>
 #include <linux/kernel.h>
 #include <linux/i2c.h>
 #include <linux/types.h>
@@ -27,6 +28,7 @@
 
 /* Addresses to scan */
 static unsigned short normal_i2c[] = {
+	0x84 >>1,
 	0x86 >>1,
 	0x96 >>1,
 	I2C_CLIENT_END,
@@ -437,14 +439,14 @@ static int tda9887_set_pinnacle(struct t
 {
 	unsigned int bCarrierMode = UNSET;
 
-	if (t->std & V4L2_STD_PAL) {
+	if (t->std & V4L2_STD_625_50) {
 		if ((1 == t->pinnacle_id) || (7 == t->pinnacle_id)) {
 			bCarrierMode = cIntercarrier;
 		} else {
 			bCarrierMode = cQSS;
 		}
 	}
-	if (t->std & V4L2_STD_NTSC) {
+	if (t->std & V4L2_STD_525_60) {
                 if ((5 == t->pinnacle_id) || (6 == t->pinnacle_id)) {
 			bCarrierMode = cIntercarrier;
 		} else {
