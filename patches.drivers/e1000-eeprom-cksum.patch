From: Karsten Keil <kkeil@novell.com>
Subject: Fix bad eeprom checksum misdetection on some notebooks
Reference: 190417 235315
Mainline: never

This workaround fix a problem on some Lenovo notebooks where the first
call to e1000_validate_eeprom_checksum fails, because the PCIe was in a deep
powersave state. Better would be that Lenovo fix this via a BIOS update, but
maybe that will never happen...

--- linux/drivers/net/e1000/e1000_main.c.org	2007-02-02 22:01:18.000000000 +0100
+++ linux/drivers/net/e1000/e1000_main.c	2007-02-02 22:11:58.000000000 +0100
@@ -950,8 +950,12 @@ e1000_probe(struct pci_dev *pdev,
 	/* make sure the EEPROM is good */
 
 	if (e1000_validate_eeprom_checksum(&adapter->hw) < 0) {
-		DPRINTK(PROBE, ERR, "The EEPROM Checksum Is Not Valid\n");
-		goto err_eeprom;
+		/* On some hardware the first attemp fails */
+		if (e1000_validate_eeprom_checksum(&adapter->hw) < 0) {
+			DPRINTK(PROBE, ERR, "The EEPROM Checksum Is Not Valid\n");
+			goto err_eeprom;
+		} else
+			DPRINTK(PROBE, INFO, "The EEPROM Checksum failed in the first read, now OK\n");	
 	}
 
 	/* copy the MAC address out of the EEPROM */
