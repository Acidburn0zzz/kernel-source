Subject: fix netperf UDP_RR hang
From: wenxiong@us.ibm.com
References: 176892 - LTC23863

netperf hangs after a long time of testing.

Signed-off-by: Olaf Hering <olh@suse.de>

---
 drivers/net/s2io.c |    6 ++----
 1 file changed, 2 insertions(+), 4 deletions(-)

Index: linux-2.6.16/drivers/net/s2io.c
===================================================================
--- linux-2.6.16.orig/drivers/net/s2io.c
+++ linux-2.6.16/drivers/net/s2io.c
@@ -459,7 +459,7 @@ static int init_shared_mem(struct s2io_n
 		}
 	}
 
-	nic->ufo_in_band_v = kmalloc((sizeof(u64) * size), GFP_KERNEL);
+	nic->ufo_in_band_v = kzalloc((sizeof(u64) * size), GFP_KERNEL);
 	if (!nic->ufo_in_band_v)
 		return -ENOMEM;
 
@@ -2049,7 +2049,7 @@ static struct sk_buff *s2io_txdl_getskb(
 				       frag->size, PCI_DMA_TODEVICE);
 		}
 	}
-	txdlp->Host_Control = 0;
+	memset(txdlp, 0, (sizeof(TxD_t) * fifo_data->max_txds));
 	return(skb);
 }
 
@@ -3563,8 +3563,6 @@ static int s2io_xmit(struct sk_buff *skb
 					sp->ufo_in_band_v,
 					sizeof(u64), PCI_DMA_TODEVICE);
 		txdp++;
-		txdp->Control_1 = 0;
-		txdp->Control_2 = 0;
 	}
 
 	txdp->Buffer_Pointer = pci_map_single
