Subject: Linux-RT 2.6.27-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
---
 arch/powerpc/kernel/entry_32.S  |    4 ++--
 arch/powerpc/kernel/irq.c       |    1 -
 arch/powerpc/kernel/ppc_ksyms.c |    1 -
 3 files changed, 2 insertions(+), 4 deletions(-)

Index: linux-2.6.26-RT/arch/powerpc/kernel/entry_32.S
===================================================================
--- linux-2.6.26-RT.orig/arch/powerpc/kernel/entry_32.S
+++ linux-2.6.26-RT/arch/powerpc/kernel/entry_32.S
@@ -1031,7 +1031,7 @@ global_dbcr0:
 #endif /* !(CONFIG_4xx || CONFIG_BOOKE) */
 
 do_work:			/* r10 contains MSR_KERNEL here */
-	andi.	r0,r9,_TIF_NEED_RESCHED
+	andi.	r0,r9,(_TIF_NEED_RESCHED)
 	beq	do_user_signal
 
 do_resched:			/* r10 contains MSR_KERNEL here */
@@ -1045,7 +1045,7 @@ recheck:
 	MTMSRD(r10)		/* disable interrupts */
 	rlwinm	r9,r1,0,0,(31-THREAD_SHIFT)
 	lwz	r9,TI_FLAGS(r9)
-	andi.	r0,r9,_TIF_NEED_RESCHED
+	andi.	r0,r9,(_TIF_NEED_RESCHED)
 	bne-	do_resched
 	andi.	r0,r9,_TIF_USER_WORK_MASK
 	beq	restore_user
Index: linux-2.6.26-RT/arch/powerpc/kernel/irq.c
===================================================================
--- linux-2.6.26-RT.orig/arch/powerpc/kernel/irq.c
+++ linux-2.6.26-RT/arch/powerpc/kernel/irq.c
@@ -84,7 +84,6 @@ extern int tau_interrupts(int);
 #endif /* CONFIG_PPC32 */
 
 #ifdef CONFIG_PPC64
-EXPORT_SYMBOL(irq_desc);
 
 int distribute_irqs = 1;
 
Index: linux-2.6.26-RT/arch/powerpc/kernel/ppc_ksyms.c
===================================================================
--- linux-2.6.26-RT.orig/arch/powerpc/kernel/ppc_ksyms.c
+++ linux-2.6.26-RT/arch/powerpc/kernel/ppc_ksyms.c
@@ -165,7 +165,6 @@ EXPORT_SYMBOL(screen_info);
 
 #ifdef CONFIG_PPC32
 EXPORT_SYMBOL(timer_interrupt);
-EXPORT_SYMBOL(irq_desc);
 EXPORT_SYMBOL(tb_ticks_per_jiffy);
 EXPORT_SYMBOL(cacheable_memcpy);
 #endif
