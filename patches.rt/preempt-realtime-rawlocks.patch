Subject: Linux-RT 2.6.27-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Tony Jones <tonyj@suse.de>
---
 drivers/oprofile/oprofilefs.c  |    2 +-
 drivers/pci/access.c           |    2 +-
 drivers/video/console/vgacon.c |    2 +-
 include/linux/oprofile.h       |    2 +-
 include/linux/percpu_counter.h |    2 +-
 kernel/kprobes.c               |    2 +-
 kernel/softlockup.c            |    2 +-
 7 files changed, 7 insertions(+), 7 deletions(-)

Index: linux-2.6.27-RT/drivers/oprofile/oprofilefs.c
===================================================================
--- linux-2.6.27-RT.orig/drivers/oprofile/oprofilefs.c
+++ linux-2.6.27-RT/drivers/oprofile/oprofilefs.c
@@ -21,7 +21,7 @@
 
 #define OPROFILEFS_MAGIC 0x6f70726f
 
-DEFINE_SPINLOCK(oprofilefs_lock);
+DEFINE_RAW_SPINLOCK(oprofilefs_lock);
 
 static struct inode * oprofilefs_get_inode(struct super_block * sb, int mode)
 {
Index: linux-2.6.27-RT/drivers/pci/access.c
===================================================================
--- linux-2.6.27-RT.orig/drivers/pci/access.c
+++ linux-2.6.27-RT/drivers/pci/access.c
@@ -12,7 +12,7 @@
  * configuration space.
  */
 
-static DEFINE_SPINLOCK(pci_lock);
+static DEFINE_RAW_SPINLOCK(pci_lock);
 
 /*
  *  Wrappers for all PCI configuration access functions.  They just check
Index: linux-2.6.27-RT/drivers/video/console/vgacon.c
===================================================================
--- linux-2.6.27-RT.orig/drivers/video/console/vgacon.c
+++ linux-2.6.27-RT/drivers/video/console/vgacon.c
@@ -51,7 +51,7 @@
 #include <video/vga.h>
 #include <asm/io.h>
 
-static DEFINE_SPINLOCK(vga_lock);
+static DEFINE_RAW_SPINLOCK(vga_lock);
 static int cursor_size_lastfrom;
 static int cursor_size_lastto;
 static u32 vgacon_xres;
Index: linux-2.6.27-RT/include/linux/oprofile.h
===================================================================
--- linux-2.6.27-RT.orig/include/linux/oprofile.h
+++ linux-2.6.27-RT/include/linux/oprofile.h
@@ -152,7 +152,7 @@ ssize_t oprofilefs_ulong_to_user(unsigne
 int oprofilefs_ulong_from_user(unsigned long * val, char const __user * buf, size_t count);
 
 /** lock for read/write safety */
-extern spinlock_t oprofilefs_lock;
+extern raw_spinlock_t oprofilefs_lock;
 
 /**
  * Add the contents of a circular buffer to the event buffer.
Index: linux-2.6.27-RT/include/linux/percpu_counter.h
===================================================================
--- linux-2.6.27-RT.orig/include/linux/percpu_counter.h
+++ linux-2.6.27-RT/include/linux/percpu_counter.h
@@ -16,7 +16,7 @@
 #ifdef CONFIG_SMP
 
 struct percpu_counter {
-	spinlock_t lock;
+	raw_spinlock_t lock;
 	s64 count;
 #ifdef CONFIG_HOTPLUG_CPU
 	struct list_head list;	/* All percpu_counters are on a list */
Index: linux-2.6.27-RT/kernel/kprobes.c
===================================================================
--- linux-2.6.27-RT.orig/kernel/kprobes.c
+++ linux-2.6.27-RT/kernel/kprobes.c
@@ -72,7 +72,7 @@ static bool kprobe_enabled;
 DEFINE_MUTEX(kprobe_mutex);		/* Protects kprobe_table */
 static DEFINE_PER_CPU(struct kprobe *, kprobe_instance) = NULL;
 static struct {
-	spinlock_t lock ____cacheline_aligned;
+	raw_spinlock_t lock ____cacheline_aligned;
 } kretprobe_table_locks[KPROBE_TABLE_SIZE];
 
 static spinlock_t *kretprobe_table_lock_ptr(unsigned long hash)
Index: linux-2.6.27-RT/kernel/softlockup.c
===================================================================
--- linux-2.6.27-RT.orig/kernel/softlockup.c
+++ linux-2.6.27-RT/kernel/softlockup.c
@@ -19,7 +19,7 @@
 
 #include <asm/irq_regs.h>
 
-static DEFINE_SPINLOCK(print_lock);
+static DEFINE_RAW_SPINLOCK(print_lock);
 
 static DEFINE_PER_CPU(unsigned long, touch_timestamp);
 static DEFINE_PER_CPU(unsigned long, print_timestamp);
