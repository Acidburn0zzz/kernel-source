Subject: Linux-RT 2.6.24-rc8-rt1
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
From: Thomas Gleixner <tglx@linutronix.de>
Date: Tue, 15 Jan 2008 15:02:44 +0200
Subject: kvm: add need_resched_delayed()

Check, whether this is really necessary here.

Signed-off-by: Thomas Gleixner <tgxl@linutronix.de>

---
 drivers/kvm/kvm_main.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

Index: linux-2.6.24-rc8-rt1/drivers/kvm/kvm_main.c
===================================================================
--- linux-2.6.24-rc8-rt1.orig/drivers/kvm/kvm_main.c	2008-01-16 22:28:06.000000000 -0500
+++ linux-2.6.24-rc8-rt1/drivers/kvm/kvm_main.c	2008-01-16 22:28:06.000000000 -0500
@@ -2015,7 +2015,7 @@ again:
 
 	local_irq_disable();
 
-	if (need_resched()) {
+	if (need_resched() || need_resched_delayed()) {
 		local_irq_enable();
 		preempt_enable();
 		r = 1;
