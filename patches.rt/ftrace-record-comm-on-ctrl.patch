Subject: Linux-RT 2.6.27-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
From: Steven Rostedt <srostedt@redhat.com>
Subject: ftrace: record comm on function ctrl change

On stress tests, it is possible for the comm of that disables the
ftracer to be lost. Record it on turning on or off the function tracer.

Signed-off-by: Steven Rostedt <srostedt@redhat.com>
---
 kernel/trace/trace.c |    2 ++
 1 file changed, 2 insertions(+)

Index: linux-2.6.26.3-rt6/kernel/trace/trace.c
===================================================================
--- linux-2.6.26.3-rt6.orig/kernel/trace/trace.c	2008-09-05 00:22:28.000000000 -0400
+++ linux-2.6.26.3-rt6/kernel/trace/trace.c	2008-09-05 00:22:29.000000000 -0400
@@ -1267,10 +1267,12 @@ void tracing_start_function_trace(void)
 	register_ftrace_function(&trace_ops);
 	if (tracer_enabled)
 		ftrace_function_enabled = 1;
+	tracing_record_cmdline(current);
 }
 
 void tracing_stop_function_trace(void)
 {
+	tracing_record_cmdline(current);
 	ftrace_function_enabled = 0;
 	unregister_ftrace_function(&trace_ops);
 }
