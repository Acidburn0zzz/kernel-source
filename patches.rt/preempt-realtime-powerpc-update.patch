Subject: Linux-RT 2.6.27-RT
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Tony Jones <tonyj@suse.de>
---
 arch/powerpc/Kconfig.debug              |    4 ++++
 arch/powerpc/include/asm/hw_irq.h       |    2 +-
 arch/powerpc/include/asm/pmac_feature.h |    2 +-
 arch/powerpc/kernel/idle.c              |    2 +-
 4 files changed, 7 insertions(+), 3 deletions(-)

Index: linux-2.6.27-RT/arch/powerpc/Kconfig.debug
===================================================================
--- linux-2.6.27-RT.orig/arch/powerpc/Kconfig.debug
+++ linux-2.6.27-RT/arch/powerpc/Kconfig.debug
@@ -2,6 +2,10 @@ menu "Kernel hacking"
 
 source "lib/Kconfig.debug"
 
+config TRACE_IRQFLAGS_SUPPORT
+	bool
+	default y
+
 config DEBUG_STACKOVERFLOW
 	bool "Check for stack overflows"
 	depends on DEBUG_KERNEL
Index: linux-2.6.27-RT/arch/powerpc/include/asm/hw_irq.h
===================================================================
--- linux-2.6.27-RT.orig/arch/powerpc/include/asm/hw_irq.h
+++ linux-2.6.27-RT/arch/powerpc/include/asm/hw_irq.h
@@ -127,7 +127,7 @@ static inline int irqs_disabled_flags(un
 	return (flags & MSR_EE) == 0;
 }
 
-#include <linux/trace_irqflags.h>
+#include <linux/irqflags.h>
 
 #endif /* CONFIG_PPC64 */
 
Index: linux-2.6.27-RT/arch/powerpc/include/asm/pmac_feature.h
===================================================================
--- linux-2.6.27-RT.orig/arch/powerpc/include/asm/pmac_feature.h
+++ linux-2.6.27-RT/arch/powerpc/include/asm/pmac_feature.h
@@ -378,7 +378,7 @@ extern struct macio_chip* macio_find(str
  * Those are exported by pmac feature for internal use by arch code
  * only like the platform function callbacks, do not use directly in drivers
  */
-extern spinlock_t feature_lock;
+extern raw_spinlock_t feature_lock;
 extern struct device_node *uninorth_node;
 extern u32 __iomem *uninorth_base;
 
Index: linux-2.6.27-RT/arch/powerpc/kernel/idle.c
===================================================================
--- linux-2.6.27-RT.orig/arch/powerpc/kernel/idle.c
+++ linux-2.6.27-RT/arch/powerpc/kernel/idle.c
@@ -91,7 +91,7 @@ void cpu_idle(void)
 		tick_nohz_restart_sched_tick();
 		if (cpu_should_die())
 			cpu_die();
-		preempt_enable_no_resched();
+		__preempt_enable_no_resched();
 		schedule();
 		preempt_disable();
 	}
