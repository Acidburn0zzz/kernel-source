Date: Fri, 30 May 2008 00:51:04 +0200
From: Carsten Emde <c.emde@osadl.org>
To: Steven Rostedt <rostedt@goodmis.org>
Subject: Re: 2.6.25.4-rt4 Compile Fix
Parts/Attachments:
   1 Shown    10 lines  Text
   2 Shown    33 lines  Text
----------------------------------------

Hi Steven,
> We are pleased to announce the 2.6.25.4-rt4 tree, which can be
> downloaded from the location:
Unfortunately, this kernel does not compile on 32-bit machines. Attached
comes a simple patch for the name change eip to ip.

Another problem is that kernel/trace/trace.c no longer finds NR_syscalls
at line #1625. Don't have a patch at hand. Will try to find one tomorrow.

        Carsten.

Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>

---
 arch/x86/kernel/apic_32.c  |    2 +-
 arch/x86/kernel/irq_32.c   |    2 +-
 arch/x86/kernel/traps_32.c |    2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

Index: linux-2.6.25.4-rt6/arch/x86/kernel/apic_32.c
===================================================================
--- linux-2.6.25.4-rt6.orig/arch/x86/kernel/apic_32.c	2008-06-05 23:39:16.000000000 -0400
+++ linux-2.6.25.4-rt6/arch/x86/kernel/apic_32.c	2008-06-05 23:40:43.000000000 -0400
@@ -599,7 +599,7 @@ void smp_apic_timer_interrupt(struct pt_
 {
 	struct pt_regs *old_regs = set_irq_regs(regs);
 
-	ftrace_event_irq(-1, user_mode(regs), regs->eip);
+	ftrace_event_irq(-1, user_mode(regs), regs->ip);
 	/*
 	 * NOTE! We'd better ACK the irq immediately,
 	 * because timer handling can be slow.
Index: linux-2.6.25.4-rt6/arch/x86/kernel/irq_32.c
===================================================================
--- linux-2.6.25.4-rt6.orig/arch/x86/kernel/irq_32.c	2008-06-05 23:39:55.000000000 -0400
+++ linux-2.6.25.4-rt6/arch/x86/kernel/irq_32.c	2008-06-05 23:40:43.000000000 -0400
@@ -91,7 +91,7 @@ unsigned int do_IRQ(struct pt_regs *regs
 
 	old_regs = set_irq_regs(regs);
 	irq_enter();
-	ftrace_event_irq(irq, user_mode(regs), regs->eip);
+	ftrace_event_irq(irq, user_mode(regs), regs->ip);
 #ifdef CONFIG_DEBUG_STACKOVERFLOW
 	/* Debugging check for stack overflow: is there less than 1KB free? */
 	{
Index: linux-2.6.25.4-rt6/arch/x86/kernel/traps_32.c
===================================================================
--- linux-2.6.25.4-rt6.orig/arch/x86/kernel/traps_32.c	2008-06-05 23:40:04.000000000 -0400
+++ linux-2.6.25.4-rt6/arch/x86/kernel/traps_32.c	2008-06-05 23:40:43.000000000 -0400
@@ -826,7 +826,7 @@ __kprobes void do_nmi(struct pt_regs * r
 
 	nmi_enter();
 
-	ftrace_event_irq(-1, user_mode(regs), regs->eip);
+	ftrace_event_irq(-1, user_mode(regs), regs->ip);
 
 	cpu = smp_processor_id();
 
