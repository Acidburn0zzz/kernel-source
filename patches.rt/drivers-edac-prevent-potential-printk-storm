From: "Timothy R. Chavez" <tim.chavez@linux.vnet.ibm.com>
Subject: Prevent potential EDAC printk storm

limit EDAC system messages to avoid crippling the system with a 
printk storm.

Signed-off-by: Keith Mannthey <kmannth@us.ibm.com>
Signed-off-by: Timothy R. Chavez <tim.chavez@linux.vnet.ibm.com>

Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>

Index: linux-2.6.22/drivers/edac/amd64_edac.c
===================================================================
--- linux-2.6.22.orig/drivers/edac/amd64_edac.c
+++ linux-2.6.22/drivers/edac/amd64_edac.c
@@ -67,10 +67,12 @@
 #include "edac_core.h"
 
 #define amd64_printk(level, fmt, arg...) \
-	edac_printk(level, "amd64", fmt, ##arg)
+	if (printk_ratelimit()) \
+		edac_printk(level, "amd64", fmt, ##arg)
 
 #define amd64_mc_printk(mci, level, fmt, arg...) \
-	edac_mc_chipset_printk(mci, level, "amd64", fmt, ##arg)
+	if (printk_ratelimit()) \
+		edac_mc_chipset_printk(mci, level, "amd64", fmt, ##arg)
 
 /* Throughout the comments in this code, the following terms are used:
  *
Index: linux-2.6.22/drivers/edac/i5000_edac.c
===================================================================
--- linux-2.6.22.orig/drivers/edac/i5000_edac.c
+++ linux-2.6.22/drivers/edac/i5000_edac.c
@@ -31,10 +31,12 @@
 #define EDAC_MOD_STR      "i5000_edac"
 
 #define i5000_printk(level, fmt, arg...) \
-        edac_printk(level, "i5000", fmt, ##arg)
+	if (printk_ratelimit())	\
+        	edac_printk(level, "i5000", fmt, ##arg)
 
 #define i5000_mc_printk(mci, level, fmt, arg...) \
-        edac_mc_chipset_printk(mci, level, "i5000", fmt, ##arg)
+	if (printk_ratelimit()) \
+	        edac_mc_chipset_printk(mci, level, "i5000", fmt, ##arg)
 
 #ifndef PCI_DEVICE_ID_INTEL_FBD_0
 #define PCI_DEVICE_ID_INTEL_FBD_0	0x25F5

_______________________________________________
rtibm-dev mailing list
rtibm-dev@forge.novell.com
http://forge.novell.com/mailman/listinfo/rtibm-dev
