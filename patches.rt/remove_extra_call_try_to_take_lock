From slert-devel-bounces+sdietrich=novell.com@suse.de Fri Feb 15 18:53:22 2008
Return-path: <slert-devel-bounces+sdietrich=novell.com@suse.de>
Received: from Relay2.suse.de ([149.44.160.89]) by emea5-mh.id5.novell.com
	with ESMTP (TLS encrypted); Fri, 15 Feb 2008 18:53:22 +0100
Received: from Fourier.suse.de (fourier.suse.de [149.44.160.40]) by
	Relay2.suse.de (Postfix) with ESMTP id 0C2F61C4B213 for
	<sdietrich@novell.com>; Fri, 15 Feb 2008 18:53:22 +0100 (CET)
Received: from fourier.suse.de (localhost [127.0.0.1]) by Fourier.suse.de
	(Postfix) with ESMTP id 084661E4279A for <sdietrich@novell.com>; Fri, 15
	Feb 2008 18:53:22 +0100 (CET)
Received: from Relay2.suse.de (relay2.suse.de [149.44.160.89]) by
	Fourier.suse.de (Postfix) with ESMTP id 43D581E42795 for
	<slert-devel@mailman.suse.de>; Fri, 15 Feb 2008 18:53:20 +0100 (CET)
Received: by Relay2.suse.de (Postfix) id 35D541C4C878; Fri, 15 Feb 2008
	18:53:20 +0100 (CET)
Received: from relay2.suse.de (localhost [127.0.0.1]) by Relay2.suse.de
	(Postfix) with ESMTP id 23D751C4BF45 for <slert-devel@suse.de>; Fri, 15 Feb
	2008 18:53:20 +0100 (CET)
X-Virus-Scanned: by amavisd-new at relay2.suse.de
X-Spam-Score: -2.499
X-Spam-Level: 
X-Spam-Status: No, score=-2.499 tagged_above=-20 required=5
	tests=[BAYES_00=-2.599, RDNS_DYNAMIC=0.1]
Received: from mx2.suse.de ([195.135.220.15]) by relay2.suse.de
	(relay2.suse.de [149.44.160.89]) (amavisd-new, port 10025) with ESMTP id
	eYEhEHswXoeL for <slert-devel@suse.de>; Fri, 15 Feb 2008 18:53:14 +0100
	(CET)
Received: from novell1.haskins.net (75-130-111-13.dhcp.oxfr.ma.charter.com
	[75.130.111.13]) by mx2.suse.de (Postfix) with ESMTP id 4037235559 for
	<slert-devel@suse.de>; Fri, 15 Feb 2008 18:53:14 +0100 (CET)
Received: from novell1.haskins.net (localhost [127.0.0.1]) by
	novell1.haskins.net (Postfix) with ESMTP id 50CB13FC1D5 for
	<slert-devel@suse.de>; Fri, 15 Feb 2008 12:26:21 -0500 (EST)
From: Gregory Haskins <ghaskins@novell.com>
To: slert-devel@suse.de
Date: Fri, 15 Feb 2008 12:26:21 -0500
Message-ID: <20080215172621.25573.81422.stgit@novell1.haskins.net>
In-Reply-To: <20080215172421.25573.85164.stgit@novell1.haskins.net>
References: <20080215172421.25573.85164.stgit@novell1.haskins.net>
User-Agent: StGIT/0.12.1
MIME-Version: 1.0
Content-Type: text/plain; charset="utf-8"
Subject: [slert-devel] [PATCH 09/10] remove the extra call to
	try_to_take_lock
X-BeenThere: slert-devel@suse.de
X-Mailman-Version: 2.1.4
Precedence: list
List-Id: All things slert <slert-devel.suse.de>
List-Unsubscribe: <https://mailman.suse.de/mailman/listinfo/slert-devel>,
	<mailto:slert-devel-request@suse.de?subject=unsubscribe>
List-Archive: <https://mailman.suse.de/mailman/private/slert-devel>
List-Post: <mailto:slert-devel@suse.de>
List-Help: <mailto:slert-devel-request@suse.de?subject=help>
List-Subscribe: <https://mailman.suse.de/mailman/listinfo/slert-devel>,
	<mailto:slert-devel-request@suse.de?subject=subscribe>
Sender: slert-devel-bounces+sdietrich=novell.com@suse.de
Errors-To: slert-devel-bounces+sdietrich=novell.com@suse.de
X-Evolution-Source: imap://sdietrich@prv1-3.novell.com/
Content-Transfer-Encoding: 8bit

From: Peter W. Morreale <pmorreale@novell.com>

Remove the redundant attempt to get the lock.  While it is true that the
exit path with this patch adds an un-necessary xchg (in the event the
lock is granted without further traversal in the loop) experimentation
shows that we almost never encounter this situation. 

Signed-off-by: Peter W. Morreale <pmorreale@novell.com>
---

 kernel/rtmutex.c |    6 ------
 1 files changed, 0 insertions(+), 6 deletions(-)

diff --git a/kernel/rtmutex.c b/kernel/rtmutex.c
index 3ada393..65c2eac 100644
--- a/kernel/rtmutex.c
+++ b/kernel/rtmutex.c
@@ -710,12 +710,6 @@ rt_spin_lock_slowlock(struct rt_mutex *lock)
 	spin_lock_irqsave(&lock->wait_lock, flags);
 	init_lists(lock);
 
-	/* Try to acquire the lock again: */
-	if (try_to_take_rt_mutex(lock)) {
-		spin_unlock_irqrestore(&lock->wait_lock, flags);
-		return;
-	}
-
 	BUG_ON(rt_mutex_owner(lock) == current);
 
 	/*

