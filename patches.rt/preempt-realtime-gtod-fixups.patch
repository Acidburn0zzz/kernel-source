Subject: Linux-RT 2.6.24-rc2-rt1
From: http://www.kernel.org/pub/linux/kernel/projects/rt/
Acked-by: Sven-Thorsten Dietrich <sdietrich@suse.de>
---
 kernel/time/timekeeping.c |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

Index: linux-2.6.23-rc4/kernel/time/timekeeping.c
===================================================================
--- linux-2.6.23-rc4.orig/kernel/time/timekeeping.c	2007-08-31 21:51:50.000000000 +0200
+++ linux-2.6.23-rc4/kernel/time/timekeeping.c	2007-08-31 21:51:50.000000000 +0200
@@ -352,9 +352,13 @@ static int timekeeping_suspend(struct sy
 {
 	unsigned long flags;
 
+	/*
+	 * Read the CMOS outside the raw xtime_lock:
+	 */
+	timekeeping_suspend_time = read_persistent_clock();
+
 	write_seqlock_irqsave(&xtime_lock, flags);
 	timekeeping_suspended = 1;
-	timekeeping_suspend_time = read_persistent_clock();
 	write_sequnlock_irqrestore(&xtime_lock, flags);
 
 	clockevents_notify(CLOCK_EVT_NOTIFY_SUSPEND, NULL);
