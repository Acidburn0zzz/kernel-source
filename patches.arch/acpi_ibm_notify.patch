From: Thomas Renninger <trenn@suse.de>
Subject: Fix Thinkpad A21m shutdown
Patch-mainline: not yet, will repost
References: 150851

The A21m Thinkpad (maybe also others) have a GDCK method and a DOCK device.
It seems that on others machines the GDCK is the docking device.
Installing the notify handler for a GDCK device fails.
When module is unloaded it is tried to remove the never installed
notify handler for the GDCK method which seems to freeze the machine.

Fix: Do not set notify_installed when installing the notify handler fails.

 drivers/acpi/ibm_acpi.c |    4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

Signed-off-by: Thomas Renninger <trenn@suse.de>

Index: b/drivers/acpi/ibm_acpi.c
===================================================================
--- a/drivers/acpi/ibm_acpi.c
+++ b/drivers/acpi/ibm_acpi.c
@@ -2502,7 +2502,7 @@ static int __init setup_notify(struct ib
 	int ret;
 
 	if (!*ibm->handle)
-		return 0;
+		return 1;
 
 	ret = acpi_bus_get_device(*ibm->handle, &ibm->device);
 	if (ret < 0) {
@@ -2609,6 +2609,8 @@ static int __init ibm_init(struct ibm_st
 		}
 		if (ret < 0)
 			return ret;
+		if (ret > 0)
+			return 0;
 	}
 
 	return 0;
