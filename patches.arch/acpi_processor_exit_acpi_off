From: Thomas Renninger <trenn@suse.de>
Subject: Exit ACPI processor module gracefully if acpi is disabled
Patch-mainline: not yet
References: 165803

 drivers/acpi/processor_core.c |    6 ++++++
 1 file changed, 6 insertions(+)

Signed-off-by: Thomas Renninger <trenn@suse.de>

--- a/drivers/acpi/processor_core.c	2007-10-31 17:43:30.000000000 -0400
+++ b/drivers/acpi/processor_core.c	2007-10-31 17:44:11.000000000 -0400
@@ -1030,6 +1030,8 @@ void acpi_processor_uninstall_hotplug_no
  * ACPI, but needs symbols from this driver
  */
 
+static int processor_driver_registered = 0;
+
 static int __init acpi_processor_init(void)
 {
 	int result = 0;
@@ -1055,6 +1057,8 @@ static int __init acpi_processor_init(vo
 		return result;
 	}
 
+	processor_driver_registered = 1;
+
 	acpi_processor_install_hotplug_notify();
 
 	acpi_thermal_cpufreq_init();
@@ -1071,11 +1075,13 @@ static void __exit acpi_processor_exit(v
 
 	acpi_thermal_cpufreq_exit();
 
+	if (processor_driver_registered) {
 	acpi_processor_uninstall_hotplug_notify();
 
 	acpi_bus_unregister_driver(&acpi_processor_driver);
 
 	remove_proc_entry(ACPI_PROCESSOR_CLASS, acpi_root_dir);
+	}
 
 	return;
 }
