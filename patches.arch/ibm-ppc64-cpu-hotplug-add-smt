--- ameslab-current/arch/ppc64/kernel/smp.c	2004-05-05 15:37:08.000000000 -0500
+++ new/arch/ppc64/kernel/smp.c	2004-05-05 15:37:49.000000000 -0500
@@ -463,6 +463,9 @@ static inline void look_for_more_cpus(vo
 		       maxcpus);
 
 	/* Make those cpus (which might appear later) possible too. */
+	if ((cur_cpu_spec->cpu_features & CPU_FTR_SMT) && ((naca->smt_state == SMT_ON) || (naca->smt_state == SMT_DYNAMIC))) {
+		maxcpus *= 2;
+	}
 	for (i = 0; i < maxcpus; i++)
 		cpu_set(i, cpu_possible_map);
 }
