--- ameslab-current/arch/ppc64/kernel/smp.c	2004-05-05 15:37:08.000000000 -0500
+++ new/arch/ppc64/kernel/smp.c	2004-05-05 15:37:49.000000000 -0500
@@ -453,7 +453,10 @@ static inline void look_for_more_cpus(vo
 	}
 
 	maxcpus = ireg[num_addr_cell + num_size_cell];
-	/* DRENG need to account for threads here too */
+
+	/* Double maxcpus for processors which have SMT capability */
+	if (cur_cpu_spec->cpu_features & CPU_FTR_SMT)
+		maxcpus *= 2;
 
 	if (maxcpus > NR_CPUS) {
 		printk(KERN_WARNING
