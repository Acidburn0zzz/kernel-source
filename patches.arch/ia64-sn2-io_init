From: Mark Maule <maule@sgi.com>
Subject: Disable MSI for all Altix PCI devices.
Patch-mainline: temporary
References: 146439

Temporary patch to make pci_enable_msi() fail gracefully on altix.  Will be
removed after 2.6.16 releases and the msi abstraction patches start flowing.

Signed-off-by: Mark Maule <maule@sgi.com>
Acked-by: Raymund Will <rw@suse.de>

Index: linux-2.6.14/arch/ia64/sn/kernel/io_init.c
===================================================================
--- linux-2.6.14.orig/arch/ia64/sn/kernel/io_init.c	2006-01-10 09:29:57.172407877 -0600
+++ linux-2.6.14/arch/ia64/sn/kernel/io_init.c	2006-01-25 09:50:00.308356617 -0600
@@ -407,6 +407,13 @@
 		pcidev_info->pdi_sn_irq_info = NULL;
 		kfree(sn_irq_info);
 	}
+
+	/*
+	 * MSI currently not supported on altix.  Remove this when
+	 * the MSI abstraction patches are integrated into the kernel
+	 * (sometime after 2.6.16 releases)
+	 */
+	dev->no_msi = 1;
 }
 
 /*
