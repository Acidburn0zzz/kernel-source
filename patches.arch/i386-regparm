diff -u linux-regparm/arch/i386/Makefile-REGPARM linux-regparm/arch/i386/Makefile
--- linux-regparm/arch/i386/Makefile-REGPARM	2003-09-28 10:53:14.000000000 +0200
+++ linux-regparm/arch/i386/Makefile	2004-01-21 03:00:20.333097536 +0100
@@ -47,6 +47,11 @@
 cflags-$(CONFIG_MCYRIXIII)	+= $(call check_gcc,-march=c3,-march=i486) $(align)-functions=0 $(align)-jumps=0 $(align)-loops=0
 cflags-$(CONFIG_MVIAC3_2)	+= $(call check_gcc,-march=c3-2,-march=i686)
 
+# -mregparm=3 doesn't work on old crufty 2.95
+# The -Wpacked argument was only added with gcc 3.0, check if the compiler
+# supports it and only enable regparm when it works.
+cflags-$(CONFIG_REGPARM) 	+= $(shell if $(CC) -Wpacked -S -o /dev/null -xc /dev/null > /dev/null 2>&1; then echo "-mregparm=3"; fi ;)
+
 CFLAGS += $(cflags-y)
 
 # Default subarch .c files
diff -u linux-regparm/arch/i386/Kconfig-REGPARM linux-regparm/arch/i386/Kconfig
--- linux-regparm/arch/i386/Kconfig-REGPARM	2004-01-09 09:27:09.000000000 +0100
+++ linux-regparm/arch/i386/Kconfig	2004-01-21 02:53:28.922641432 +0100
@@ -820,6 +820,14 @@
 	depends on (((X86_SUMMIT || X86_GENERICARCH) && NUMA) || (X86 && EFI))
 	default y
 
+config REGPARM
+	bool "Use register arguments (EXPERIMENTAL)"
+	default n
+	help
+	Compile the kernel with -mregparm=3. This uses an different ABI
+	and passes the first three arguments of a function call in registers.
+	This will probably break binary only modules.	
+	
 endmenu
 
 
