 ChangeSet 1.1417.9.3 2004/02/17 14:53:37 moilanen@zippy.ltc.austin.ibm.com
   Fix for rtas_error_log_buffer_max not being reported correctly and thus truncating
   error log read by rtas_errd.
 arch/ppc64/kernel/rtasd.c 1.20 2004/02/17 14:53:30 moilanen@zippy.ltc.austin.ibm.com
   Fix for rtas_error_log_buffer_max not being reported correctly and thus truncating
   error log read by rtas_errd.
diff -purN linux-2.5/arch/ppc64/kernel/rtasd.c linuxppc64-2.5/arch/ppc64/kernel/rtasd.c
--- linux-2.5/arch/ppc64/kernel/rtasd.c	2004-03-16 11:30:38.000000000 +0000
+++ linuxppc64-2.5/arch/ppc64/kernel/rtasd.c	2004-03-17 00:46:46.000000000 +0000
@@ -330,6 +331,10 @@ static int get_eventscan_parms(void)
 		printk(KERN_ERR "rtasd: truncated error log from %d to %d bytes\n", rtas_error_log_max, RTAS_ERROR_LOG_MAX);
 		rtas_error_log_max = RTAS_ERROR_LOG_MAX;
 	}
+
+	/* Make room for the sequence number */
+	rtas_error_log_buffer_max = rtas_error_log_max + sizeof(int);
+
 	of_node_put(node);
 
 	return 0;
@@ -459,9 +459,6 @@ static int __init rtas_init(void)
 	if (kernel_thread(rtasd, 0, CLONE_FS) < 0)
 		printk(KERN_ERR "Failed to start RTAS daemon\n");
 
-	/* Make room for the sequence number */
-	rtas_error_log_buffer_max = rtas_error_log_max + sizeof(int);
-
 	return 0;
 }
 
