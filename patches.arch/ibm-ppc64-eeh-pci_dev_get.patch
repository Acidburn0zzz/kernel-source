Index: eeh.c
===================================================================
RCS file: /home/linas/cvsroot/eeh/arch/ppc64/kernel/eeh.c,v
retrieving revision 1.2
diff -u -p -r1.2 eeh.c
--- eeh/arch/ppc64/kernel/eeh.c	19 May 2004 19:32:28 -0000	1.2
+++ eeh/arch/ppc64/kernel/eeh.c	19 May 2004 20:53:02 -0000
@@ -529,6 +529,9 @@ unsigned long eeh_check_failure(void *to
 		spin_unlock_irqrestore(&eeh_eventlist_lock, flags);
 
 		schedule_work(&eeh_event_wq);
+
+		/* do not pci_dev_put */
+		return val;
 	} else {
 		__get_cpu_var(false_positives)++;
 	}
@@ -766,6 +769,7 @@ void eeh_add_device_late(struct pci_dev 
 	       pci_pretty_name(dev));
 #endif
 
+	pci_dev_get (dev);
 	pci_addr_cache_insert_device (dev);
 }
 EXPORT_SYMBOL(eeh_add_device_late);
