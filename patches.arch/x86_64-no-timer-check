From: ak@suse.de
Subject: force no_timer_check on ATI board

Fix frequent time is running too fast problems.
Still a kludge, but should be ok.

I added a timer_check option so that it can be overwritten again

Index: linux-2.6.13/arch/x86_64/kernel/io_apic.c
===================================================================
--- linux-2.6.13.orig/arch/x86_64/kernel/io_apic.c
+++ linux-2.6.13/arch/x86_64/kernel/io_apic.c
@@ -44,6 +44,7 @@
 int sis_apic_bug; /* not actually supported, dummy for compile */
 
 static int no_timer_check;
+static int force_timer_check;
 
 static DEFINE_SPINLOCK(ioapic_lock);
 
@@ -270,6 +271,13 @@ void __init check_ioapic(void) 
 #endif
 					/* RED-PEN skip them on mptables too? */
 					return;
+				case PCI_VENDOR_ID_ATI:
+					if (force_timer_check) 
+						break;
+					printk(KERN_INFO
+ "ATI board detected: Enabling no_timer_check. Overwrite with timer_check\n");				       
+					no_timer_check = 1;
+					break;					
 				} 
 
 				/* No multi-function device? */
@@ -1712,6 +1720,14 @@ static int __init notimercheck(char *s)
 }
 __setup("no_timer_check", notimercheck);
 
+
+static int __init enable_timer_check(char *s)
+{
+	force_timer_check = 1;	
+	return 1;
+}
+__setup("timer_check", enable_timer_check);
+
 /*
  *
  * IRQ's that are handled by the PIC in the MPS IOAPIC case.
Index: linux-2.6.13/Documentation/x86_64/boot-options.txt
===================================================================
--- linux-2.6.13.orig/Documentation/x86_64/boot-options.txt
+++ linux-2.6.13/Documentation/x86_64/boot-options.txt
@@ -32,6 +32,9 @@ APICs
 
    no_timer_check Don't check the IO-APIC timer. This can work around
 		 problems with incorrect timer initialization on some boards.
+   timer_check	 Do check the IO-APIC timer. On ATI boards we force 
+		 no_timer_check now, but if that causes problems it can
+		 be turned off again with this option.
 
 Early Console
 
