Subject: Disable mmconfig by default
From: ak@suse.de
References: 145753 (some more)
Subject: Default to pci=nommconf

We still have lots of trouble with broken MCFG tables. Disable
mmconfig by default for now. 

Index: linux-2.6.16/arch/i386/pci/common.c
===================================================================
--- linux-2.6.16.orig/arch/i386/pci/common.c
+++ linux-2.6.16/arch/i386/pci/common.c
@@ -20,8 +20,7 @@
 extern  void pcibios_sort(void);
 #endif
 
-unsigned int pci_probe = PCI_PROBE_BIOS | PCI_PROBE_CONF1 | PCI_PROBE_CONF2 |
-				PCI_PROBE_MMCONF;
+unsigned int pci_probe = PCI_PROBE_BIOS | PCI_PROBE_CONF1 | PCI_PROBE_CONF2;
 
 int pci_routeirq;
 int pcibios_last_bus = -1;
@@ -209,6 +208,10 @@ char * __devinit  pcibios_setup(char *st
 		pci_probe &= ~PCI_PROBE_MMCONF;
 		return NULL;
 	}
+	else if (!strcmp(str, "mmconf")) {
+		pci_probe |= PCI_PROBE_MMCONF;
+		return NULL;
+	}
 #endif
 	else if (!strcmp(str, "noacpi")) {
 		acpi_noirq_set();
