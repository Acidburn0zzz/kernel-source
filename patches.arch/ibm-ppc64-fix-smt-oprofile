diff -urN --exclude-from=/home/anton/dontdiff linux-2.6.5/arch/ppc64/kernel/sysfs.c linux-2.6.5-build/arch/ppc64/kernel/sysfs.c
--- linux-2.6.5/arch/ppc64/kernel/sysfs.c	2004-05-11 09:56:07.000000000 +1000
+++ linux-2.6.5-build/arch/ppc64/kernel/sysfs.c	2004-05-15 08:03:47.166805367 +1000
@@ -114,6 +114,7 @@
 	unsigned long hid0;
 	unsigned long set, reset;
 	int ret;
+	unsigned int ctrl;
 
 	/* Only need to enable them once */
 	if (__get_cpu_var(pmcs_enabled))
@@ -158,6 +159,16 @@
 		char *ptr = (char *)&paca[smp_processor_id()].xLpPaca;
 		ptr[0xBB] = 1;
 	}
+
+	/* 
+	 * On SMT machines we have to set the run latch in the ctrl register
+	 * in order to make PMC6 spin.
+	 */
+	if (cur_cpu_spec->cpu_features & CPU_FTR_SMT) {
+		ctrl = mfspr(CTRLF);
+		ctrl |= RUNLATCH;
+		mtspr(CTRLT, ctrl);
+	}
 }
 #endif
 
