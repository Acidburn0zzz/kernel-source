Date: Sun, 18 Apr 2004 16:41:00 +1000
From: Anton Blanchard <anton@samba.org>
To: olh@suse.de
Subject: add platform to oops

Hi,

This will give us the platform type in an oops, useful so we know
straight away if it was on iseries, pseries or pseries LPAR.

Anton

---

 forakpm-anton/arch/ppc64/kernel/traps.c |   18 ++++++++++++++++++
 1 files changed, 18 insertions(+)

diff -puN arch/ppc64/kernel/traps.c~ppc64-add-platform-to-oops arch/ppc64/kernel/traps.c
--- forakpm/arch/ppc64/kernel/traps.c~ppc64-add-platform-to-oops	2004-04-11 14:57:31.673034448 +1000
+++ forakpm-anton/arch/ppc64/kernel/traps.c	2004-04-11 14:57:31.678034383 +1000
@@ -92,6 +92,24 @@ void die(const char *str, struct pt_regs
 	printk("NUMA ");
 	nl = 1;
 #endif
+	switch(systemcfg->platform) {
+		case PLATFORM_PSERIES:
+			printk("PSERIES ");
+			nl = 1;
+			break;
+		case PLATFORM_PSERIES_LPAR:
+			printk("PSERIES LPAR ");
+			nl = 1;
+			break;
+		case PLATFORM_ISERIES_LPAR:
+			printk("ISERIES LPAR ");
+			nl = 1;
+			break;
+		case PLATFORM_POWERMAC:
+			printk("POWERMAC ");
+			nl = 1;
+			break;
+	}
 	if (nl)
 		printk("\n");
 	show_regs(regs);

_

