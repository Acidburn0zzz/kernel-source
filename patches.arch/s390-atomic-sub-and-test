From: Hannes Reinecke <hare@suse.de>
Subject: missing atomic_sub_and_test on S/390

S/390 is missing an implementation of atomic_sub_and_test, required
for reiser4.

--- linux-2.6.12/include/asm-s390/atomic.h.orig	2005-06-17 21:48:29.000000000 +0200
+++ linux-2.6.12/include/asm-s390/atomic.h	2005-07-04 15:41:03.000000000 +0200
@@ -90,6 +90,10 @@ static __inline__ int atomic_dec_and_tes
 {
 	return __CS_LOOP(v, 1, "sr") == 0;
 }
+static __inline__ int atomic_sub_and_test(int i, atomic_t * v)
+{
+	return __CS_LOOP(v, i, "sr") == 0;
+}
 static __inline__ void atomic_clear_mask(unsigned long mask, atomic_t * v)
 {
 	       __CS_LOOP(v, ~mask, "nr");
