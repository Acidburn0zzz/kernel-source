Subject: Don't disable interrupts while reading throttling state
From: ak@suse.de

Avoids a lot of WARN_ON warnings about rdmsr_on_cpu->smp_call_function_single 
with interrupts disabled on Penryn class hardware.

I reviewed the code path and cannot find anything that needs to really have
interrupts disabled.

Signed-off-by: Andi Kleen <ak@suse.de>

Index: linux-2.6.23/drivers/acpi/processor_throttling.c
===================================================================
--- linux-2.6.23.orig/drivers/acpi/processor_throttling.c
+++ linux-2.6.23/drivers/acpi/processor_throttling.c
@@ -572,14 +572,12 @@ static int acpi_processor_get_throttling
 		return -ENODEV;
 
 	pr->throttling.state = 0;
-	local_irq_disable();
 	value = 0;
 	ret = acpi_read_throttling_status(pr, &value);
 	if (ret >= 0) {
 		state = acpi_get_throttling_state(pr, value);
 		pr->throttling.state = state;
 	}
-	local_irq_enable();
 
 	return 0;
 }
@@ -717,14 +715,12 @@ static int acpi_processor_set_throttling
 	if (state < pr->throttling_platform_limit)
 		return -EPERM;
 
-	local_irq_disable();
 	value = 0;
 	ret = acpi_get_throttling_value(pr, state, &value);
 	if (ret >= 0) {
 		acpi_write_throttling_state(pr, value);
 		pr->throttling.state = state;
 	}
-	local_irq_enable();
 
 	return 0;
 }
