From: Alex Williamson <alex.williamson@hp.com>
Subject: Fix return value for ia64_pci_legacy_write()
Patch-mainline: expected for 2.6.16
References: 140675

I noticed that starting X on an HP IPF system w/ SLES10 that X spews many
thousand lines of "I/O write failed".  Turns out this is a kernel bug.  When
using the legacy_io sysfs interface, the generic ia64 write routine always
returns 0.  Thus user space assumes the write() failed.  I sent a patch to Tony
to fix this in upstream, hopefully he'll get it in before 2.6.15 is tagged. 
Thread here:

http://marc.theaimsgroup.com/?l=linux-ia64&m=113520371031615

Please apply to the SLES10 tree, this will help all non-SGI ia64 systems (SGI
has a different machine vector here that appears to return the correct value).

Acked-by: rw@suse.de

diff -r 513446906e2e arch/ia64/pci/pci.c
--- a/arch/ia64/pci/pci.c	Wed Dec 21 19:05:15 2005
+++ b/arch/ia64/pci/pci.c	Wed Dec 21 14:52:44 2005
@@ -700,7 +700,7 @@
  */
 int ia64_pci_legacy_write(struct pci_dev *bus, u16 port, u32 val, u8 size)
 {
-	int ret = 0;
+	int ret = size;
 
 	switch (size) {
 	case 1:
