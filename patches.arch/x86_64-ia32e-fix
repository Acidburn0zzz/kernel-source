diff -u linux-2.6.3/arch/i386/kernel/microcode.c-o linux-2.6.3/arch/i386/kernel/microcode.c
--- linux-2.6.3/arch/i386/kernel/microcode.c-o	2004-02-19 09:01:09.000000000 +0100
+++ linux-2.6.3/arch/i386/kernel/microcode.c	2004-02-19 09:16:14.000000000 +0100
@@ -371,8 +371,9 @@
 	spin_lock_irqsave(&microcode_update_lock, flags);          
 
 	/* write microcode via MSR 0x79 */
-	wrmsr(MSR_IA32_UCODE_WRITE, (u64)(uci->mc->bits), 
-	      (u64)(uci->mc->bits) >> 32);
+	wrmsr(MSR_IA32_UCODE_WRITE,
+	       (unsigned long) uci->mc->bits, 
+	       (unsigned long) uci->mc->bits >> 16 >> 16);
 	wrmsr(MSR_IA32_UCODE_REV, 0, 0);
 
 	__asm__ __volatile__ ("cpuid" : : : "ax", "bx", "cx", "dx");
diff -u linux-2.6.3/arch/x86_64/kernel/setup.c-o linux-2.6.3/arch/x86_64/kernel/setup.c
--- linux-2.6.3/arch/x86_64/kernel/setup.c-o	2004-02-19 09:01:09.000000000 +0100
+++ linux-2.6.3/arch/x86_64/kernel/setup.c	2004-02-19 09:09:27.000000000 +0100
@@ -588,6 +588,7 @@
 
 static void __init detect_ht(void)
 {
+#ifdef CONFIG_SMP
 	extern	int phys_proc_id[NR_CPUS];
 	
 	u32 	eax, ebx, ecx, edx;
@@ -631,6 +632,7 @@
 		printk(KERN_INFO  "CPU: Physical Processor ID: %d\n",
 		       phys_proc_id[cpu]);
 	}
+#endif
 }
 	
 #define LVL_1_INST	1
diff -u linux-2.6.3/arch/x86_64/kernel/Makefile-o linux-2.6.3/arch/x86_64/kernel/Makefile
--- linux-2.6.3/arch/x86_64/kernel/Makefile-o	2004-02-19 09:01:09.000000000 +0100
+++ linux-2.6.3/arch/x86_64/kernel/Makefile	2004-02-19 09:15:41.000000000 +0100
@@ -33,4 +33,4 @@
 cpuid-$(subst m,y,$(CONFIG_X86_CPUID))  += ../../i386/kernel/cpuid.o
 topology-y                     += ../../i386/mach-default/topology.o
 swiotlb-$(CONFIG_SWIOTLB)      += ../../ia64/lib/swiotlb.o
-microcode-$(CONFIG_MICROCODE)  += ../../i386/kernel/microcode.o
+microcode-$(subst m,y,$(CONFIG_X86_CPUID))  += ../../i386/kernel/microcode.o
diff -u linux-2.6.3/arch/x86_64/kernel/x8664_ksyms.c-o linux-2.6.3/arch/x86_64/kernel/x8664_ksyms.c
--- linux-2.6.3/arch/x86_64/kernel/x8664_ksyms.c-o	2004-02-19 09:01:09.000000000 +0100
+++ linux-2.6.3/arch/x86_64/kernel/x8664_ksyms.c	2004-02-19 09:08:04.000000000 +0100
@@ -194,7 +194,9 @@
 
 EXPORT_SYMBOL(die_chain);
 
+#ifdef CONFIG_SMP_
 EXPORT_SYMBOL(cpu_sibling_map);
+#endif
 
 extern void do_softirq_thunk(void);
 EXPORT_SYMBOL_NOVERS(do_softirq_thunk);
