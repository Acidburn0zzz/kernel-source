Subject:  Quieten down microcode update driver
From: ak@suse.de
Patch-Mainline: partially in 2.6.17

Only log data in microcode driver when something is changed
Otherwise it was far too noisy on large systems.

From: jbeulich@novell.com
References: 158643

Rather than removing the messages entirely, suppress them only by default (and
suppress one more message as well as lower all those messages' severities).

Index: head-2006-03-24/arch/i386/kernel/microcode.c
===================================================================
--- head-2006-03-24.orig/arch/i386/kernel/microcode.c	2006-03-27 13:44:35.000000000 -0700
+++ head-2006-03-24/arch/i386/kernel/microcode.c	2006-03-27 13:46:38.000000000 -0700
@@ -90,6 +90,9 @@
 MODULE_AUTHOR("Tigran Aivazian <tigran@veritas.com>");
 MODULE_LICENSE("GPL");
 
+static int verbose;
+module_param(verbose, int, 0644);
+
 #define MICROCODE_VERSION 	"1.14"
 
 #define DEFAULT_UCODE_DATASIZE 	(2000) 	  /* 2000 bytes */
@@ -196,14 +199,16 @@
 	pr_debug("   Checksum 0x%x\n", cksum);
 
 	if (mc_header->rev < uci->rev) {
-		printk(KERN_ERR "microcode: CPU%d not 'upgrading' to earlier revision"
-		       " 0x%x (current=0x%x)\n", cpu_num, mc_header->rev, uci->rev);
+		if (verbose)
+			printk(KERN_WARNING "microcode: CPU%d not 'upgrading' to earlier revision"
+			       " 0x%x (current=0x%x)\n", cpu_num, mc_header->rev, uci->rev);
 		goto out;
 	} else if (mc_header->rev == uci->rev) {
 		/* notify the caller of success on this cpu */
 		uci->err = MC_SUCCESS;
-		printk(KERN_ERR "microcode: CPU%d already at revision"
-			" 0x%x (current=0x%x)\n", cpu_num, mc_header->rev, uci->rev);
+		if (verbose)
+			printk(KERN_INFO "microcode: CPU%d already at revision 0x%x\n",
+				cpu_num, uci->rev);
 		goto out;
 	}
 
@@ -369,7 +374,8 @@
 	struct ucode_cpu_info *uci = ucode_cpu_info + cpu_num;
 
 	if (uci->mc == NULL) {
-		printk(KERN_INFO "microcode: No new microcode data for CPU%d\n", cpu_num);
+		if (verbose)
+			printk(KERN_INFO "microcode: No new microcode data for CPU%d\n", cpu_num);
 		return;
 	}
 
