ChangeSet
  1.1713.17.43 04/04/12 12:48:13 akpm@osdl.org[torvalds] +1 -0
  [PATCH] ppc64: Register secondary threads in NUMA init code
  
  From: Anton Blanchard <anton@samba.org>
  
  Register secondary threads in NUMA init code

  arch/ppc64/mm/numa.c
    1.23 04/04/12 10:54:08 akpm@osdl.org[torvalds] +3 -0
    ppc64: Register secondary threads in NUMA init code

diff -Nru a/arch/ppc64/mm/numa.c b/arch/ppc64/mm/numa.c
--- a/arch/ppc64/mm/numa.c	Tue Apr 13 07:30:26 2004
+++ b/arch/ppc64/mm/numa.c	Tue Apr 13 07:30:26 2004
@@ -124,6 +124,9 @@
 			max_domain = numa_domain;
 
 		map_cpu_to_node(cpu_nr, numa_domain);
+		/* register the second thread on an SMT machine */
+		if (cur_cpu_spec->cpu_features & CPU_FTR_SMT)
+			map_cpu_to_node(cpu_nr ^ 0x1, numa_domain);
 	}
 
 	for (; memory; memory = of_find_node_by_type(memory, "memory")) {
.........................................................................
# vim: syntax=diff

