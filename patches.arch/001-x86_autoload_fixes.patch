From: Ben Hutchings <ben@decadent.org.uk>
Subject: x86/cpu: Fix overrun check in arch_print_cpu_modalias()
References: http://lists.opensuse.org/opensuse-kernel/2011-11/msg00075.html
Patch-Mainline: efd82e4c361b00ebd2da12a1111a1e2ab9eb3fc8 undefined
Git-commit: efd82e4c361b00ebd2da12a1111a1e2ab9eb3fc8


Signed-off-by: Thomas Renninger <trenn@suse.de>

snprintf() does not return a negative value when truncating.

Signed-off-by: Ben Hutchings <ben@decadent.org.uk>

diff --git a/arch/x86/kernel/cpu/match.c b/arch/x86/kernel/cpu/match.c
index 940e2d4..2dfa52b 100644
--- a/arch/x86/kernel/cpu/match.c
+++ b/arch/x86/kernel/cpu/match.c
@@ -67,7 +67,7 @@ ssize_t arch_print_cpu_modalias(struct device *dev,
 	for (i = 0; i < NCAPINTS*32; i++) {
 		if (boot_cpu_has(i)) {
 			n = snprintf(buf, size, ",%04X", i);
-			if (n < 0) {
+			if (n >= size) {
 				WARN(1, "x86 features overflow page\n");
 				break;
 			}
