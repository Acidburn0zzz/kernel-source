diff -u linux/include/asm-x86_64/msi.h-o linux/include/asm-x86_64/msi.h
--- linux/include/asm-x86_64/msi.h-o	2004-09-24 13:04:06.000000000 +0200
+++ linux/include/asm-x86_64/msi.h	2004-09-27 12:19:56.000000000 +0200
@@ -7,10 +7,11 @@
 #define ASM_MSI_H
 
 #include <asm/desc.h>
+#include <asm/smp.h>
 
 #define LAST_DEVICE_VECTOR		232
 #define MSI_DEST_MODE			MSI_LOGICAL_MODE
 #define MSI_TARGET_CPU_SHIFT		12
-#define MSI_TARGET_CPU			TARGET_CPUS
+#define MSI_TARGET_CPU			hard_smp_processor_id()
 
 #endif /* ASM_MSI_H */
