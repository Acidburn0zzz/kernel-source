ChangeSet
  1.1513 04/03/16 11:33:48 saleon@ambient.ltc.austin.ibm.com +1 -0
  Fix log_rtas_error bug.

  arch/ppc64/kernel/rtas.c
    1.29 04/03/16 11:33:38 saleon@ambient.ltc.austin.ibm.com +4 -2
    Fix log_rtas_error bug where the results from the call that resulted in an error where lost due the attempt to log the error.

diff -Nru a/arch/ppc64/kernel/rtas.c b/arch/ppc64/kernel/rtas.c
--- a/arch/ppc64/kernel/rtas.c	Wed Mar 17 12:22:52 2004
+++ b/arch/ppc64/kernel/rtas.c	Wed Mar 17 12:22:52 2004
@@ -131,7 +131,7 @@
 void
 log_rtas_error(struct rtas_args	*rtas_args)
 {
-	struct rtas_args err_args;
+	struct rtas_args err_args, temp_args;
 
 	err_args.token = rtas_token("rtas-last-error");
 	err_args.nargs = 2;
@@ -142,15 +142,17 @@
 	err_args.args[1] = RTAS_ERROR_LOG_MAX;
 	err_args.args[2] = 0;
 
+	temp_args = *rtas_args;
 	get_paca()->xRtas = err_args;
 
 	PPCDBG(PPCDBG_RTAS, "\tentering rtas with 0x%lx\n",
 	       (void *)__pa((unsigned long)&err_args));
 	enter_rtas((void *)__pa((unsigned long)&get_paca()->xRtas));
 	PPCDBG(PPCDBG_RTAS, "\treturned from rtas ...\n");
+	
 
 	err_args = get_paca()->xRtas;
-	get_paca()->xRtas = *rtas_args;
+	get_paca()->xRtas = temp_args;
 
 	if (err_args.rets[0] == 0)
 		log_error(rtas_err_buf, ERR_TYPE_RTAS_LOG, 0);
.........................................................................
# vim: syntax=diff

