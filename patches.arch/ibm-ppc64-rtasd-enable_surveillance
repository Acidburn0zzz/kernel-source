ChangeSet 1.1417.10.1 2004/02/17 11:12:29 moilanen@zippy.ltc.austin.ibm.com
  Safeguard rtasd against FW bugs seen on earlier systems.
arch/ppc64/kernel/rtasd.c 1.19 2004/02/17 11:12:22 moilanen@zippy.ltc.austin.ibm.com
  Safeguard against FW bugs seen on early systems.
diff -purN linux-2.5/arch/ppc64/kernel/rtasd.c linuxppc64-2.5/arch/ppc64/kernel/rtasd.c
--- linux-2.5/arch/ppc64/kernel/rtasd.c	2004-03-16 11:30:38.000000000 +0000
+++ linuxppc64-2.5/arch/ppc64/kernel/rtasd.c	2004-03-17 00:46:46.000000000 +0000
@@ -405,8 +410,7 @@ static int rtasd(void *unused)
 
 	if (surveillance_timeout != -1) {
 		DEBUG("enabling surveillance\n");
-		if (enable_surveillance(surveillance_timeout))
-			goto error_vfree;
+		enable_surveillance(surveillance_timeout);
 		DEBUG("surveillance enabled\n");
 	}
 
@@ -430,10 +434,6 @@ static int rtasd(void *unused)
 			cpu = first_cpu_const(mk_cpumask_const(cpu_online_map));
 	}
 
-error_vfree:
-	if (rtas_log_buf)
-		vfree(rtas_log_buf);
-	rtas_log_buf = NULL;
 error:
 	/* Should delete proc entries */
 	return -EINVAL;
