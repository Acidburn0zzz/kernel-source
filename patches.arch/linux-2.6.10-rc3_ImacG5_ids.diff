Subject: imac g5 and current g5 support
From: olh@suse.de
Patch-mainline: almost

http://perso.magic.fr/l_indien/linux-ImacG5/index.htm

diff -urNbBp /usr/src/linux-2.6.10-rc3/arch/ppc64/kernel/pmac_feature.c linux-2.6.10-rc3/arch/ppc64/kernel/pmac_feature.c
--- /usr/src/linux-2.6.10-rc3/arch/ppc64/kernel/pmac_feature.c	2004-12-12 11:26:42.000000000 +0100
+++ linux-2.6.10-rc3/arch/ppc64/kernel/pmac_feature.c	2004-12-12 12:45:31.000000000 +0100
@@ -347,6 +347,10 @@ static struct pmac_mb_def pmac_mb_defs[]
 		PMAC_TYPE_POWERMAC_G5,		g5_features,
 		0,
 	},
+	{	"PowerMac8,1",			"IMac G5",
+		PMAC_TYPE_POWERMAC_G5,		g5_features,
+		0,
+	},
 	{       "RackMac3,1",                   "XServe G5",
 		PMAC_TYPE_POWERMAC_G5,          g5_features,
 		0,

diff -urNbBp /usr/src/linux-2.6.10-rc3/drivers/net/sungem.c linux-2.6.10-rc3/drivers/net/sungem.c
--- /usr/src/linux-2.6.10-rc3/drivers/net/sungem.c	2004-12-12 11:26:42.000000000 +0100
+++ linux-2.6.10-rc3/drivers/net/sungem.c	2004-12-12 12:45:31.000000000 +0100
@@ -109,6 +109,8 @@ static struct pci_device_id gem_pci_tbl[
 	  PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0UL },
 	{ PCI_VENDOR_ID_APPLE, PCI_DEVICE_ID_APPLE_K2_GMAC,
 	  PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0UL },
+       { PCI_VENDOR_ID_APPLE, PCI_DEVICE_ID_APPLE_SH_SUNGEM,
+          PCI_ANY_ID, PCI_ANY_ID, 0, 0, 0UL },
 	{0, }
 };
 
diff -urNbBp /usr/src/linux-2.6.10-rc3/drivers/pci/pci.ids linux-2.6.10-rc3/drivers/pci/pci.ids
--- /usr/src/linux-2.6.10-rc3/drivers/pci/pci.ids	2004-12-12 11:26:42.000000000 +0100
+++ linux-2.6.10-rc3/drivers/pci/pci.ids	2004-12-12 12:45:31.000000000 +0100
@@ -2189,6 +2189,14 @@
 	0049  K2 HT-PCI Bridge
 	004b  U3 AGP
 	004c  K2 GMAC (Sun GEM)
+	004f  Shasta Mac I/O
+	0050  Shasta IDE
+	0051  Shasta (Sun GEM)
+	0052  Shasta FireWire
+	0053  Shasta PCI Bridge
+	0054  Shasta PCI Bridge
+	0055  Shasta PCI Bridge
+	0058  U3L AGP Bridge
 	1645  Tigon3 Gigabit Ethernet NIC (BCM5701)
 106c  Hyundai Electronics America
 	8801  Dual Pentium ISA/PCI Motherboard
diff -urNbBp /usr/src/linux-2.6.10-rc3/include/linux/pci_ids.h linux-2.6.10-rc3/include/linux/pci_ids.h
--- /usr/src/linux-2.6.10-rc3/include/linux/pci_ids.h	2004-12-12 11:26:42.000000000 +0100
+++ linux-2.6.10-rc3/include/linux/pci_ids.h	2004-12-12 12:45:31.000000000 +0100
@@ -846,6 +846,9 @@
 #define PCI_DEVICE_ID_APPLE_KEYLARGO_I	0x003e
 #define PCI_DEVICE_ID_APPLE_K2_ATA100	0x0043
 #define PCI_DEVICE_ID_APPLE_K2_GMAC	0x004c
+#define PCI_DEVICE_ID_APPLE_SH_ATA      0x0050
+#define PCI_DEVICE_ID_APPLE_SH_SUNGEM   0x0051
+#define PCI_DEVICE_ID_APPLE_SH_FW       0x0052
 #define PCI_DEVICE_ID_APPLE_TIGON3	0x1645
 
 #define PCI_VENDOR_ID_YAMAHA		0x1073

