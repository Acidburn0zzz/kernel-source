Index: linux-2.6.5/drivers/isdn/capi/capi.c
===================================================================
--- linux-2.6.5.orig/drivers/isdn/capi/capi.c
+++ linux-2.6.5/drivers/isdn/capi/capi.c
@@ -924,8 +924,8 @@ capi_ioctl(struct inode *inode, struct f
 			if ((mp = nccip->minorp) != 0) {
 				count += atomic_read(&mp->ttyopencount);
 			}
-			up(&cdev->ncci_list_sem);
 #endif /* CONFIG_ISDN_CAPI_MIDDLEWARE */
+			up(&cdev->ncci_list_sem);
 			return count;
 		}
 		return 0;
