From: garloff@suse.de
Subject: Allow isp1020 exception handling

Minimal fix to allow exception handling with qlogicisp.
Incomplete fix: The isp1020 would need more changes to have 
well-working exception handling in 2.6.

Index: linux-2.6.10/drivers/scsi/qlogicisp.h
===================================================================
--- linux-2.6.10.orig/drivers/scsi/qlogicisp.h
+++ linux-2.6.10/drivers/scsi/qlogicisp.h
@@ -62,8 +62,8 @@ int isp1020_detect(Scsi_Host_Template *)
 int isp1020_release(struct Scsi_Host *);
 const char * isp1020_info(struct Scsi_Host *);
 int isp1020_queuecommand(Scsi_Cmnd *, void (* done)(Scsi_Cmnd *));
 int isp1020_abort(Scsi_Cmnd *);
-int isp1020_reset(Scsi_Cmnd *, unsigned int);
+int isp1020_reset(Scsi_Cmnd *);
 int isp1020_biosparam(struct scsi_device *, struct block_device *,
 		sector_t, int[]);
 #endif /* _QLOGICISP_H */
Index: linux-2.6.10/drivers/scsi/qlogicisp.c
===================================================================
--- linux-2.6.10.orig/drivers/scsi/qlogicisp.c
+++ linux-2.6.10/drivers/scsi/qlogicisp.c
@@ -1201,9 +1201,9 @@ int isp1020_abort(Scsi_Cmnd *Cmnd)
 	return return_status;
 }
 
 
-int isp1020_reset(Scsi_Cmnd *Cmnd, unsigned int reset_flags)
+int isp1020_reset(Scsi_Cmnd *Cmnd)
 {
 	u_short param[6];
 	struct Scsi_Host *host;
 	struct isp1020_hostdata *hostdata;
@@ -1983,8 +1983,10 @@ static Scsi_Host_Template driver_templat
 	.detect			= isp1020_detect,
 	.release		= isp1020_release,
 	.info			= isp1020_info,	
 	.queuecommand		= isp1020_queuecommand,
+	.eh_abort_handler	= isp1020_abort,
+	.eh_bus_reset_handler	= isp1020_reset,
 	.bios_param		= isp1020_biosparam,
 	.can_queue		= QLOGICISP_REQ_QUEUE_LEN,
 	.this_id		= -1,
 	.sg_tablesize		= QLOGICISP_MAX_SG(QLOGICISP_REQ_QUEUE_LEN),
