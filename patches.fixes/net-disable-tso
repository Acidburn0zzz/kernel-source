From: okir@suse.de

This patch turns off TSO for all network devices by default, because
TSO performance in current kernels is so bad (bug #45666).

Once this gets fixed, we can remove this hack again.

Index: linux-2.6.8/drivers/net/bcm/b57um.c
===================================================================
--- linux-2.6.8.orig/drivers/net/bcm/b57um.c	2004-09-23 16:36:15.000000000 +0200
+++ linux-2.6.8/drivers/net/bcm/b57um.c	2004-09-23 16:39:01.000000000 +0200
@@ -1077,7 +1077,8 @@
 #ifdef BCM_VLAN
 	dev->features |= NETIF_F_HW_VLAN_TX | NETIF_F_HW_VLAN_RX;
 #endif
-#ifdef BCM_TSO
+/* Disable TSO for now, it's slow and broken */
+#if 0 && defined(BCM_TSO)
 	if ((pDevice->TaskToOffload & LM_TASK_OFFLOAD_TCP_SEGMENTATION) &&
 		enable_tso[board_idx]) {
 		dev->features |= NETIF_F_TSO;
Index: linux-2.6.8/net/core/dev.c
===================================================================
--- linux-2.6.8.orig/net/core/dev.c	2004-09-23 16:36:19.000000000 +0200
+++ linux-2.6.8/net/core/dev.c	2004-09-23 16:36:39.000000000 +0200
@@ -2943,6 +2943,12 @@
 		dev->features &= ~NETIF_F_SG;
 	}
 
+	if (dev->features & NETIF_F_TSO) {
+		printk("%s: TCP Segmentation Offload (TSO) disabled by default\n",
+			dev->name);
+		dev->features &= ~NETIF_F_TSO;
+	}
+
 	/*
 	 *	nil rebuild_header routine,
 	 *	that should be never called and used as just bug trap.
