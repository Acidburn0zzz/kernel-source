Subject: MCA when shutting down tulip quad-NIC 
From: andrew.patterson@hp.com
References: SUSE39204

Shutting down the network causes an MCA because of an IO TLB error when
a DEC quad 10/100 card is in any slot.  This problem was originally seen
on an HP rx4640.

Acked-by: Olaf Kirch <okir@suse.de>

Index: linux-2.6.9/drivers/net/tulip/tulip_core.c
===================================================================
--- linux-2.6.9.orig/drivers/net/tulip/tulip_core.c	2005-01-03 12:33:08.000000000 +0100
+++ linux-2.6.9/drivers/net/tulip/tulip_core.c	2005-01-03 12:34:58.000000000 +0100
@@ -1770,6 +1771,10 @@ static void __devexit tulip_remove_one (
 		return;
 
 	tp = netdev_priv(dev);
+
+	/* shoot NIC in the head before deallocating descriptors */
+	pci_disable_device(tp->pdev);
+
 	unregister_netdev(dev);
 	pci_free_consistent (pdev,
 			     sizeof (struct tulip_rx_desc) * RX_RING_SIZE +

