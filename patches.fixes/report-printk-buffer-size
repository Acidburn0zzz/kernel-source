ChangeSet
  1.1617.1.2 04/05/04 18:10:36 akpm@osdl.org[torvalds] +1 -0
  [PATCH] report size of printk buffer
  
  From: <Andries.Brouwer@cwi.nl>
  
  In the old days the printk log buffer had a constant size, and dmesg asked
  for the 4096, later 8192, later 16384 bytes in there.  These days the
  printk log buffer has variable size, and it is not easy for dmesg to do the
  right thing, especially when doing a "read and clear".  The patch below
  adds a syslog subfuntion that reports the buffer size.

  kernel/printk.c
    1.37 04/05/04 10:48:06 akpm@osdl.org[torvalds] +4 -0
    report size of printk buffer

diff -Nru a/kernel/printk.c b/kernel/printk.c
--- a/kernel/printk.c	Wed May  5 06:29:42 2004
+++ b/kernel/printk.c	Wed May  5 06:29:42 2004
@@ -240,6 +240,7 @@
  * 	7 -- Enable printk's to console
  *	8 -- Set level of messages printed to console
  *	9 -- Return number of unread characters in the log buffer
+ *     10 -- Return size of the log buffer
  */
 int do_syslog(int type, char __user * buf, int len)
 {
@@ -358,6 +359,9 @@
 		break;
 	case 9:		/* Number of chars in the log buffer */
 		error = log_end - log_start;
+		break;
+	case 10:	/* Size of the log buffer */
+		error = log_buf_len;
 		break;
 	default:
 		error = -EINVAL;
.........................................................................
# vim: syntax=diff

