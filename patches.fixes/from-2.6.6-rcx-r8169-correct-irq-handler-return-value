#date: 2004-04-13
#id: 1.1371.686.9
#tag: other
#time: 14:25:05
#title: r8169: correct irq handler return value
#who: romieu@fr.zoreil.com
#
# ChangeSet
#   1.1371.686.9 04/04/13 14:25:05 romieu@fr.zoreil.com +1 -0
#   [PATCH] r8169: correct irq handler return value
#   
#   The irq handler must not return 1 when the status register is null
#   during the firt iteration.
#
# drivers/net/r8169.c +2 -2
#   2.6.5-netdev2 - r8169 update
#
diff -Nru a/drivers/net/r8169.c b/drivers/net/r8169.c
--- a/drivers/net/r8169.c	Tue Apr 27 23:15:26 2004
+++ b/drivers/net/r8169.c	Tue Apr 27 23:15:26 2004
@@ -1537,8 +1537,8 @@
 	do {
 		status = RTL_R16(IntrStatus);
 
-		/* h/w no longer present (hotplug?) or major error, bail */
-		if (status == 0xFFFF)
+		/* hotplug/major error/no more work/shared irq */
+		if ((status == 0xFFFF) || !status)
 			break;
 
 		handled = 1;
