From: unknown
Subject: add permission check to moxa serial driver
Patch-mainline: no
References: 65375

add permission check to moxa serial driver

Acked-by: Marcus Meissner <meissner@suse.de>

diff -u linux-2.6.10/drivers/char/moxa.c linux-2.6.10/drivers/char/moxa.c
--- linux-2.6.10/drivers/char/moxa.c	2004-12-28 16:52:06.000000000 +0000
+++ linux-2.6.10/drivers/char/moxa.c	2005-01-07 23:08:12.600929528 +0000
@@ -807,6 +807,8 @@
 	case TIOCSSERIAL:
 		return moxa_set_serial_info(ch, argp);
 	default:
+		if(!capable(CAP_SYS_RAWIO))
+			return -EPERM;
 		retval = MoxaDriverIoctl(cmd, arg, port);
 	}
 	return (retval);
