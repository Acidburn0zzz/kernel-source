From: Hannes Reinecke <hare@suse.de>
Subject: Send 'change' uevent for device-mapper table resume

Device-mapper tables are only ever useable after an 'resume'
ioctl has been issued. But to know when this happens we need to
generate an uevent to notify udev so that it can take appropriate
action.

As discussed with agk and kay at OLS we should be sending 'change' events
for resume; suspend events doesn't give you anything interesting and indeed
might lead to failures as any I/O on that table will be blocked anyway.

Signed-off-by: Kay Sievers <kay.sievers@vrfy.org>
Signed-off-by: Hannes Reinecke <hare@suse.de>

--- linux-2.6.16/drivers/md/dm.c.orig	2006-05-23 12:18:09.000000000 +0200
+++ linux-2.6.16/drivers/md/dm.c	2006-05-26 14:09:16.000000000 +0200
@@ -1247,6 +1248,7 @@ int dm_resume(struct mapped_device *md)
 
 	dm_table_unplug_all(map);
 
+	kobject_uevent(&md->disk->kobj, KOBJ_CHANGE);
 	r = 0;
 
 out:
