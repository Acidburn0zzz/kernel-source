From: vojtech@suse.cz
Subject: Fix USB kbd LEDs and return from MUX mode.

===================================================================

ChangeSet@1.1977.1.1, 2005-01-28 21:11:52+01:00, vojtech@silver.ucw.cz
  input: Fix MUX mode disabling.
  
  Signed-off-by: Vojtech Pavlik <vojtech@suse.cz>


 i8042.c |    5 +++--
 1 files changed, 3 insertions(+), 2 deletions(-)

===================================================================

diff -Nru a/drivers/input/serio/i8042.c b/drivers/input/serio/i8042.c
--- a/drivers/input/serio/i8042.c	2005-02-02 20:29:55 +01:00
+++ b/drivers/input/serio/i8042.c	2005-02-02 20:29:55 +01:00
@@ -482,7 +482,7 @@
 	if (i8042_command(&param, I8042_CMD_AUX_LOOP) || param != 0x0f)
 		return -1;
 	param = mode ? 0x56 : 0xf6;
-	if (i8042_command(&param, I8042_CMD_AUX_LOOP) || param != 0xa9)
+	if (i8042_command(&param, I8042_CMD_AUX_LOOP) || param != (mode ? 0xa9 : 0x09))
 		return -1;
 	param = mode ? 0xa4 : 0xa5;
 	if (i8042_command(&param, I8042_CMD_AUX_LOOP) || param == (mode ? 0x5b : 0x5a))
@@ -787,7 +787,8 @@
  * Disable MUX mode if present.
  */
 
-	i8042_set_mux_mode(0, NULL);
+	if (i8042_mux_present)
+		i8042_set_mux_mode(0, NULL);
 
 /*
  * Restore the original control register setting.

===================================================================

ChangeSet@1.1994, 2005-02-02 17:54:35+01:00, vojtech@silver.ucw.cz
  input: Fix HID LED mapping. LEDs were ignored because the usage
         value contains the page code in high 16 bits.
  
  Signed-off-by: Vojtech Pavlik <vojtech@suse.cz>


 hid-debug.h |    2 +-
 hid-input.c |    4 ++--
 2 files changed, 3 insertions(+), 3 deletions(-)

===================================================================

diff -Nru a/drivers/usb/input/hid-debug.h b/drivers/usb/input/hid-debug.h
--- a/drivers/usb/input/hid-debug.h	2005-02-02 20:29:32 +01:00
+++ b/drivers/usb/input/hid-debug.h	2005-02-02 20:29:32 +01:00
@@ -86,12 +86,12 @@
       {0, 0x92, "D-PadRight"},
       {0, 0x93, "D-PadLeft"},
   {  7, 0, "Keyboard" },
+  {  8, 0, "LED" },
       {0, 0x01, "NumLock"},
       {0, 0x02, "CapsLock"},
       {0, 0x03, "ScrollLock"},
       {0, 0x04, "Compose"},
       {0, 0x05, "Kana"},
-  {  8, 0, "LED" },
   {  9, 0, "Button" },
   { 10, 0, "Ordinal" },
   { 12, 0, "Consumer" },
diff -Nru a/drivers/usb/input/hid-input.c b/drivers/usb/input/hid-input.c
--- a/drivers/usb/input/hid-input.c	2005-02-02 20:29:32 +01:00
+++ b/drivers/usb/input/hid-input.c	2005-02-02 20:29:32 +01:00
@@ -185,9 +185,9 @@
 			break;
 
 		case HID_UP_LED:
-			if (usage->hid - 1 >= LED_MAX)
+			if (((usage->hid - 1) & 0xffff) >= LED_MAX)
 				goto ignore;
-			map_led(usage->hid - 1);
+			map_led((usage->hid - 1) & 0xffff);
 			break;
 
 		case HID_UP_DIGITIZER:
