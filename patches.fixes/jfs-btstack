diff -urp linux-2.6.5-7.69/fs/jfs/jfs_btree.h linux/fs/jfs/jfs_btree.h
--- linux-2.6.5-7.69/fs/jfs/jfs_btree.h	2004-06-07 09:20:44.817116792 -0500
+++ linux/fs/jfs/jfs_btree.h	2004-06-07 09:24:17.446792168 -0500
@@ -125,14 +125,14 @@ struct btstack {
 	(btstack)->top = (btstack)->stack
 
 #define BT_STACK_FULL(btstack)\
-	( (btstack)->top == &((btstack)->stack[MAXTREEHEIGHT]))
+	( (btstack)->top == &((btstack)->stack[MAXTREEHEIGHT-1]))
 
 #define BT_PUSH(BTSTACK, BN, INDEX)\
 {\
+	assert(!BT_STACK_FULL(BTSTACK));\
 	(BTSTACK)->top->bn = BN;\
 	(BTSTACK)->top->index = INDEX;\
 	++(BTSTACK)->top;\
-	assert(!BT_STACK_FULL(BTSTACK));\
 }
 
 #define BT_POP(btstack)\
