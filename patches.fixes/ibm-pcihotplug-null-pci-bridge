Check for NULL pointer when dereferencing PCI slot

Index: linux-2.6.5/drivers/pci/hotplug/rpaphp_pci.c
===================================================================
--- linux-2.6.5.orig/drivers/pci/hotplug/rpaphp_pci.c
+++ linux-2.6.5/drivers/pci/hotplug/rpaphp_pci.c
@@ -377,8 +377,8 @@ int rpaphp_unconfig_pci_adapter(struct s
 	
 		func = list_entry(ln, struct rpaphp_pci_func, sibling);
 		if (func->pci_dev) {
-			rpaphp_eeh_remove_bus_device(func->pci_dev);
 			pci_remove_bus_device(func->pci_dev); 
+			rpaphp_eeh_remove_bus_device(func->pci_dev);
 		}
 		kfree(func);
 	}
@@ -527,9 +527,18 @@ struct hotplug_slot *rpaphp_find_hotplug_slot(
 		struct list_head *ln;
 
 		slot = list_entry(tmp, struct slot, rpaphp_slot_list);
+		if (slot->bridge == NULL) {
+			if (slot->dev_type == PCI_DEV) {
+				printk (KERN_WARNING "PCI slot missing bridge %s %s \n", 
+				                    slot->name, slot->location);
+			}
+			continue;
+		}
+
 		bus = slot->bridge->subordinate;
-		if (!bus)
-			return NULL; /* shouldn't be here */
+		if (!bus) {
+			continue;  /* should never happen? */
+		}
 		for (ln = bus->devices.next; ln != &bus->devices; ln = ln->next) {
                                 struct pci_dev *pdev = pci_dev_b(ln);
 				if (pdev == dev)
