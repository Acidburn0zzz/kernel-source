#date: 2004-04-16
#id: 1.1371.714.3
#tag: other
#time: 14:27:00
#title: remount: fs/openpromfs
#who: viro@www.linux.org.uk[torvalds]
#
# ChangeSet
#   1.1371.714.3 04/04/16 14:27:00 viro@www.linux.org.uk[torvalds] +1 -0
#   [PATCH] remount: fs/openpromfs
#   
#    - we should force noatime both on mount and remount.  Fixed.
#
# fs/openpromfs/inode.c +8 -1
#
diff -Nru a/fs/openpromfs/inode.c b/fs/openpromfs/inode.c
--- a/fs/openpromfs/inode.c	Wed Apr 28 00:46:29 2004
+++ b/fs/openpromfs/inode.c	Wed Apr 28 00:46:29 2004
@@ -1018,16 +1018,23 @@
 	}
 }
 
+static int openprom_remount(struct super_block *sb, int *flags, char *data)
+{
+	*flags |= MS_NOATIME;
+	return 0;
+}
+
 static struct super_operations openprom_sops = { 
 	.read_inode	= openprom_read_inode,
 	.statfs		= simple_statfs,
+	.remount	= openprom_remount,
 };
 
 static int openprom_fill_super(struct super_block *s, void *data, int silent)
 {
 	struct inode * root_inode;
 
-	s->s_flags |= MS_NODIRATIME;
+	s->s_flags |= MS_NOATIME;
 	s->s_blocksize = 1024;
 	s->s_blocksize_bits = 10;
 	s->s_magic = OPENPROM_SUPER_MAGIC;
