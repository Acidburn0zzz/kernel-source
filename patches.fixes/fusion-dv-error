From: Hannes Reinecke <hare@suse.de>
Subject: SGI hangs during boot

Occasionally SGI machines hangs during boot with:
sr 1:0:2:0: Attached scsi CD-ROM sr0
mptscsih: ioc1: attempting task abort! (sc=e000000ff1d52300)
sr 1:0:2:0: 
        command: Inquiry: 12 01 00 00 fe 00
mptbase: Initiating ioc1 recovery
mptscsih: ioc1: task abort: SUCCESS (sc=e000000ff1d52300)
kernel BUG at kernel/timer.c:295!

Appearently the Domain validation cannot cope with failing commands.
So just do not call the specific code if it's known to fail.

Signed-off-by: Hannes Reinecke <hare@suse.de>

--- linux-2.6.15/drivers/message/fusion/mptscsih.c.orig	2006-03-07 07:56:59.990055651 +0100
+++ linux-2.6.15/drivers/message/fusion/mptscsih.c	2006-03-07 16:34:56.374509247 +0100
@@ -1438,7 +1438,8 @@ mptscsih_qcmd(struct scsi_cmnd *SCpnt, v
 			/* Trying to do DV to this target, extend timeout.
 			 * Wait to issue until flag is clear
 			 */
-			if (dvStatus & MPT_SCSICFG_DV_PENDING) {
+			if (SCpnt->eh_timeout.function && 
+			    (dvStatus & MPT_SCSICFG_DV_PENDING)) {
 				mod_timer(&SCpnt->eh_timeout, jiffies + 40 * HZ);
 				issueCmd = 0;
 			}
