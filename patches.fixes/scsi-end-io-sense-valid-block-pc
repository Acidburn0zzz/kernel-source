From: Jens Axboe <axboe@suse.de>
Subject: Don't assume a REQ_BLOCK_PC always has room for sense
Patch-mainline: 
References: SUSE50416

See subj

Acked-by: 
Signed-off-by: 

--- linux-2.6.10/drivers/scsi/scsi_lib.c~	2005-02-02 11:06:49.000000000 +0100
+++ linux-2.6.10/drivers/scsi/scsi_lib.c	2005-02-02 11:07:11.000000000 +0100
@@ -726,7 +726,7 @@
 		req->errors = result;
 		if (result) {
 			clear_errors = 0;
-			if (sense_valid) {
+			if (sense_valid && req->sense) {
 				/*
 				 * SG_IO wants current and deferred errors
 				 */

