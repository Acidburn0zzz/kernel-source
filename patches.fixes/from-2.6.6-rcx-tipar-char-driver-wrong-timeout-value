#date: 2004-04-22
#id: 1.1371.742.2
#tag: other
#time: 14:36:55
#title: tipar char driver: wrong timeout value
#who: lkml@lievin.net
#
# ChangeSet
#   1.1371.742.2 04/04/22 14:36:55 lkml@lievin.net +1 -0
#   [PATCH] tipar char driver: wrong timeout value
#   
#   this patch (2.4 & 2.6) fixes a bug about the timeout value. The formula
#   used to calculate jiffies from timeout is wrong.
#   The new formula is ok and takes care of integer computation/rounding.
#   There is the same bug in the tiglusb.c module which will be fixed by another
#   patch.
#
# drivers/char/tipar.c +1 -1
#
diff -Nru a/drivers/char/tipar.c b/drivers/char/tipar.c
--- a/drivers/char/tipar.c	Wed Apr 28 10:45:40 2004
+++ b/drivers/char/tipar.c	Wed Apr 28 10:45:40 2004
@@ -121,7 +121,7 @@
 
 /* ----- global defines ----------------------------------------------- */
 
-#define START(x) { x=jiffies+HZ/(timeout/10); }
+#define START(x) { x = jiffies + (HZ * timeout) / 10; }
 #define WAIT(x)  { \
   if (time_before((x), jiffies)) return -1; \
   if (need_resched()) schedule(); }
