--- linux-2.6.0-test2/Makefile.cflags	2003-08-06 09:06:32.000000000 +0200
+++ linux-2.6.0-test2/Makefile	2003-08-06 09:07:42.000000000 +0200
@@ -217,6 +217,10 @@
 	  	   -fno-strict-aliasing -fno-common
 AFLAGS		:= -D__ASSEMBLY__ $(CPPFLAGS)
 
+# Disable unit-at-a-time.
+check_gcc = $(shell if $(CC) $(1) -S -o /dev/null -xc /dev/null > /dev/null 2>&1 ; then echo "$(1)"; else echo "$(2)"; fi)
+CFLAGS += $(call check_gcc,-fno-unit-at-a-time,)
+
 export	VERSION PATCHLEVEL SUBLEVEL EXTRAVERSION KERNELRELEASE ARCH \
 	CONFIG_SHELL TOPDIR HOSTCC HOSTCFLAGS CROSS_COMPILE AS LD CC \
 	CPP AR NM STRIP OBJCOPY OBJDUMP MAKE AWK GENKSYMS PERL UTS_MACHINE \
