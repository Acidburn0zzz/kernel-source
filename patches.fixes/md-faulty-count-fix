From:  	 Paul Zirnik <paul.zirnik@novell.com>
Subject: Fix incorrect count of 'faulty' devices
Patch-mainline: 2.6.17-rc1
References: 158278


Signed-off-by: Neil Brown <neilb@suse.de>

Index: linux-2.6.16/drivers/md/md.c
===================================================================
--- linux-2.6.16.orig/drivers/md/md.c	2006-03-28 10:12:09.000000000 +1100
+++ linux-2.6.16/drivers/md/md.c	2006-03-28 16:44:52.000000000 +1100
@@ -891,10 +891,9 @@
 			d->raid_disk = rdev2->raid_disk;
 		else
 			d->raid_disk = rdev2->desc_nr; /* compatibility */
-		if (test_bit(Faulty, &rdev2->flags)) {
+		if (test_bit(Faulty, &rdev2->flags))
 			d->state = (1<<MD_DISK_FAULTY);
-			failed++;
-		} else if (test_bit(In_sync, &rdev2->flags)) {
+		else if (test_bit(In_sync, &rdev2->flags)) {
 			d->state = (1<<MD_DISK_ACTIVE);
 			d->state |= (1<<MD_DISK_SYNC);
 			active++;
