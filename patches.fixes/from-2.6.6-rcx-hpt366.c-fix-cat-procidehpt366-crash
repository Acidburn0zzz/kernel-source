#date: 2004-04-13
#id: 1.1371.1.408
#tag: other
#time: 18:28:16
#title: hpt366.c: fix 'cat /proc/ide/hpt366' crash
#who: B.Zolnierkiewicz@elka.pw.edu.pl[torvalds]
#
# ChangeSet
#   1.1371.1.408 04/04/13 18:28:16 B.Zolnierkiewicz@elka.pw.edu.pl[torvalds] +1 -0
#   [PATCH] hpt366.c: fix 'cat /proc/ide/hpt366' crash
#   
#   Disable code doing outb() without any locking in /proc handler.
#   Otherwise 'cat /proc/ide/hpt366' crashes if done during I/O.
#   
#   Noticed by John Stoffel <stoffel@lucent.com>.
#
# drivers/ide/pci/hpt366.c +2 -2
#
diff -Nru a/drivers/ide/pci/hpt366.c b/drivers/ide/pci/hpt366.c
--- a/drivers/ide/pci/hpt366.c	Tue Apr 27 23:13:52 2004
+++ b/drivers/ide/pci/hpt366.c	Tue Apr 27 23:13:52 2004
@@ -107,7 +107,7 @@
 				"                             %s\n",
 			(c0 & 0x80) ? "no" : "yes",
 			(c1 & 0x80) ? "no" : "yes");
-
+#if 0
 		if (hpt_minimum_revision(dev, 3)) {
 			u8 cbl;
 			cbl = inb(iobase + 0x7b);
@@ -120,7 +120,7 @@
 				(cbl & 0x01) ? 33 : 66);
 			p += sprintf(p, "\n");
 		}
-
+#endif
 		p += sprintf(p, "--------------- drive0 --------- drive1 "
 				"------- drive0 ---------- drive1 -------\n");
 		p += sprintf(p, "DMA capable:    %s              %s" 
