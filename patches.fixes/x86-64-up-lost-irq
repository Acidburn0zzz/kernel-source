From: Petr Vandrovec <vandrove@vc.cvut.cz>
Subject: Edge triggered IRQ lost forever when delivered while IRQ disabled

On x86_64 uniprocessor, edge triggered interrupts can get lost forever
when delivered while IRQ disabled

Acked-by: ak@suse.de

diff -urNp linux-2.6.8/include/asm-x86_64/hw_irq.h linux-2.6.8.SUSE/include/asm-x86_64/hw_irq.h
--- linux-2.6.8/include/asm-x86_64/hw_irq.h	2004-12-13 14:45:24.312740772 +0100
+++ linux-2.6.8.SUSE/include/asm-x86_64/hw_irq.h	2004-12-13 14:45:54.879842867 +0100
@@ -130,7 +130,7 @@ __asm__( \
 	"push $" #nr "-256 ; " \
 	"jmp common_interrupt");
 
-#if defined(CONFIG_X86_IO_APIC) && defined(CONFIG_SMP)
+#if defined(CONFIG_X86_IO_APIC)
 static inline void hw_resend_irq(struct hw_interrupt_type *h, unsigned int i) {
 	if (IO_APIC_IRQ(i))
 		send_IPI_self(IO_APIC_VECTOR(i));
