From: aviro@redhat.com
Subject: fix kernel sendmsg() DoS
Patch-mainline: 2.6.13.1
References: 114365

Fix unchecked __get_user that could be tricked into generating a
memory read on an arbitrary address.  The result of the read is not
returned directly but you may be able to divine some information about
it, or use the read to cause a crash on some architectures by reading
hardware state.  CAN-2004-2492.

Fix from Al Viro, ack from Dave Miller.

Acked-by: okir@suse.de

diff -urNp linux-2.6.13/net/ipv4/raw.c linux-2.6.13.SUSE/net/ipv4/raw.c
--- linux-2.6.13/net/ipv4/raw.c	2005-09-12 14:00:47.107116944 +0200
+++ linux-2.6.13.SUSE/net/ipv4/raw.c	2005-09-12 14:00:59.432126301 +0200
@@ -359,7 +359,7 @@ static void raw_probe_proto_opt(struct f
 
 			if (type && code) {
 				get_user(fl->fl_icmp_type, type);
-				__get_user(fl->fl_icmp_code, code);
+			        get_user(fl->fl_icmp_code, code);
 				probed = 1;
 			}
 			break;
diff -urNp linux-2.6.13/net/ipv6/raw.c linux-2.6.13.SUSE/net/ipv6/raw.c
--- linux-2.6.13/net/ipv6/raw.c	2005-08-29 01:41:01.000000000 +0200
+++ linux-2.6.13.SUSE/net/ipv6/raw.c	2005-09-12 14:00:59.433126140 +0200
@@ -619,7 +619,7 @@ static void rawv6_probe_proto_opt(struct
 
 			if (type && code) {
 				get_user(fl->fl_icmp_type, type);
-				__get_user(fl->fl_icmp_code, code);
+				get_user(fl->fl_icmp_code, code);
 				probed = 1;
 			}
 			break;
