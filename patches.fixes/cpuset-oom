From: npiggin@suse.de
Subject: fix oom interaction with cpuset_excl_nodes_overlap
References: 184759

cpuset_excl_nodes_overlap always returns 0 for exiting procs.
This makes it impossible for the oom killer to properly kill them.
The fix is to make it return 1 instead.

Index: linux-2.6.16/kernel/cpuset.c
===================================================================
--- linux-2.6.16.orig/kernel/cpuset.c
+++ linux-2.6.16/kernel/cpuset.c
@@ -2364,7 +2364,7 @@ EXPORT_SYMBOL_GPL(cpuset_mem_spread_node
 int cpuset_excl_nodes_overlap(const struct task_struct *p)
 {
 	const struct cpuset *cs1, *cs2;	/* my and p's cpuset ancestors */
-	int overlap = 0;		/* do cpusets overlap? */
+	int overlap = 1;		/* do cpusets overlap? */
 
 	task_lock(current);
 	if (current->flags & PF_EXITING) {
