# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/09/14 07:51:24-07:00 roland@frob.com 
#   [PATCH] BSD disklabel: handle more than 8 partitions
#   
#   NetBSD allows 16 partitions, not just 8.  This patch both ups the number,
#   and makes the recognition code tell you if the count in the disklabel
#   exceeds the number supported by the kernel.
#   
#   Signed-off-by: Andrew Morton <akpm@osdl.org>
#   Signed-off-by: Linus Torvalds <torvalds@osdl.org>
# 
# fs/partitions/msdos.c
#   2004/09/13 17:23:25-07:00 roland@frob.com +3 -0
#   BSD disklabel: handle more than 8 partitions
# 
# include/linux/genhd.h
#   2004/09/13 17:23:25-07:00 roland@frob.com +1 -1
#   BSD disklabel: handle more than 8 partitions
# 
diff -Nru a/fs/partitions/msdos.c b/fs/partitions/msdos.c
--- a/fs/partitions/msdos.c	2004-09-18 01:01:27 -07:00
+++ b/fs/partitions/msdos.c	2004-09-18 01:01:27 -07:00
@@ -246,6 +246,9 @@
 		put_partition(state, state->next++, bsd_start, bsd_size);
 	}
 	put_dev_sector(sect);
+	if (le16_to_cpu(l->d_npartitions) > max_partitions)
+		printk(" (ignored %d more)",
+		       le16_to_cpu(l->d_npartitions) - max_partitions);
 	printk(" >\n");
 }
 #endif
diff -Nru a/include/linux/genhd.h b/include/linux/genhd.h
--- a/include/linux/genhd.h	2004-09-18 01:01:27 -07:00
+++ b/include/linux/genhd.h	2004-09-18 01:01:27 -07:00
@@ -249,7 +249,7 @@
 /* check against BSD src/sys/sys/disklabel.h for consistency */
 
 #define BSD_DISKMAGIC	(0x82564557UL)	/* The disk magic number */
-#define BSD_MAXPARTITIONS	8
+#define BSD_MAXPARTITIONS	16
 #define OPENBSD_MAXPARTITIONS	16
 #define BSD_FS_UNUSED		0	/* disklabel unused partition entry ID */
 struct bsd_disklabel {
