From: kaber@trash.net
Subject: Fix memory leak in ip_conntrack_ftp
Acked-by: mantel@suse.de
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Patrick McHardy <kaber@trash.net>
Patch-mainline: 2.6.10
References: 49047

Fix memory leak in ip_conntrack_ftp

# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/12/08 13:37:53-08:00 kaber@trash.net 
#   [NETFILTER]: Fix memory leak in ip_conntrack_ftp
#   
#   Signed-off-by: Patrick McHardy <kaber@trash.net>
#   Signed-off-by: David S. Miller <davem@davemloft.net>
# 
# net/ipv4/netfilter/ip_conntrack_ftp.c
#   2004/12/08 13:37:32-08:00 kaber@trash.net +1 -0
#   [NETFILTER]: Fix memory leak in ip_conntrack_ftp
#   
#   Signed-off-by: Patrick McHardy <kaber@trash.net>
#   Signed-off-by: David S. Miller <davem@davemloft.net>
# 
diff -Nru a/net/ipv4/netfilter/ip_conntrack_ftp.c b/net/ipv4/netfilter/ip_conntrack_ftp.c
--- a/net/ipv4/netfilter/ip_conntrack_ftp.c	2004-12-09 02:14:37 -08:00
+++ b/net/ipv4/netfilter/ip_conntrack_ftp.c	2004-12-09 02:14:37 -08:00
@@ -381,6 +381,7 @@
 		   problem (DMZ machines opening holes to internal
 		   networks, or the packet filter itself). */
 		if (!loose) {
+			ip_conntrack_expect_put(exp);
 			ret = NF_ACCEPT;
 			goto out;
 		}
