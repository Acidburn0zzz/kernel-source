#date: 2004-04-21
#from: Andrea Arcangeli <andrea@suse.de>
#id: 1.1371.737.17
#tag: via-mm
#time: 07:44:18
#title: i810_dma range check
#who: akpm@osdl.org[torvalds]
#
# ChangeSet
#   1.1371.737.17 04/04/21 07:44:18 akpm@osdl.org[torvalds] +1 -0
#   [PATCH] i810_dma range check
#   
#   From: Andrea Arcangeli <andrea@suse.de>
#   
#   Correctly range-check an incoming-from-userspace argument.  Found by the
#   Stanford checker.
#
# drivers/char/drm/i810_dma.c +3 -0
#
diff -Nru a/drivers/char/drm/i810_dma.c b/drivers/char/drm/i810_dma.c
--- a/drivers/char/drm/i810_dma.c	Wed Apr 28 10:53:42 2004
+++ b/drivers/char/drm/i810_dma.c	Wed Apr 28 10:53:42 2004
@@ -1275,6 +1275,9 @@
 		return -EINVAL;
 	}
 
+	if (mc.idx >= dma->buf_count || mc.idx < 0)
+		return -EINVAL;
+
 	i810_dma_dispatch_mc(dev, dma->buflist[mc.idx], mc.used,
 		mc.last_render );
 
