#date: 2004-04-09
#id: 1.1371.691.5
#tag: other
#time: 22:33:45
#title: [SERIAL] Don't try to free resources we didn't request.
#who: rmk@flint.arm.linux.org.uk
#
# ChangeSet
#   1.1371.691.5 04/04/09 22:33:45 rmk@flint.arm.linux.org.uk +1 -0
#   [SERIAL] Don't try to free resources we didn't request.
#
# drivers/serial/8250.c +2 -0
#   If UPF_RESOURCES wasn't set, we didn't request any resources.
#     Therefore, we shouldn't try to free them.
#
diff -Nru a/drivers/serial/8250.c b/drivers/serial/8250.c
--- a/drivers/serial/8250.c	Wed Apr 28 00:12:54 2004
+++ b/drivers/serial/8250.c	Wed Apr 28 00:12:54 2004
@@ -1667,6 +1667,8 @@
 	struct uart_8250_port *up = (struct uart_8250_port *)port;
 	unsigned long start, offset = 0, size = 0;
 
+	if (!(up->port.flags & UPF_RESOURCES))
+		return;
 	if (up->port.type == PORT_RSA) {
 		offset = UART_RSA_BASE << up->port.regshift;
 		size = 8;
