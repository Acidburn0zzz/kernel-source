From: Tetsuo Takata <takatan.linux@gmail.com>
Subject: Sometimes barriers didn't get enabled on SCSI
Patch-mainline: 
References: 

The patch below fixes the aforementioned problem.

Signed-off-by: Tetsuo Takata <takatatt@intellilink.co.jp>
Signed-off-by: Jens Axboe <axboe@suse.de>

---

diff -urpN linux-2.6.16-rc1-git4/block/ll_rw_blk.c linux-2.6.16-rc1-git4-fixed/block/ll_rw_blk.c
--- linux-2.6.16-rc1-git4/block/ll_rw_blk.c	2006-01-23 21:29:12.000000000 +0900
+++ linux-2.6.16-rc1-git4-fixed/block/ll_rw_blk.c	2006-01-23 22:05:11.000000000 +0900
@@ -332,6 +332,7 @@ int blk_queue_ordered(request_queue_t *q
 		return -EINVAL;
 	}
 
+	q->ordered = ordered;
 	q->next_ordered = ordered;
 	q->prepare_flush_fn = prepare_flush_fn;

