From: Matthew J Galgoci <mgalgoci@parcelfarce.linux.theplanet.co.uk>
To: netdev@oss.sgi.com
Subject: 2.6.10-bk4 ip_conntrack oops fix
Sender: netdev-bounce@oss.sgi.com
Patch-mainline: 2.6.11

I stumbled onto an annoying oops in 2.6.10-bk4.

Here is how to cause the oops.

load ip_conntrack
remove ip_conntrack
ls /proc/net/stat
boom

Acked-by: Olaf Kirch <okir@suse.de>


--- linux-2.6.10-bk4/net/ipv4/netfilter/ip_conntrack_standalone.c.orig	2005-01-01 23:44:42.000000000 -0500
+++ linux-2.6.10-bk4/net/ipv4/netfilter/ip_conntrack_standalone.c	2005-01-02 00:57:20.000000000 -0500
@@ -820,7 +820,7 @@
 	nf_unregister_hook(&ip_conntrack_defrag_ops);
  cleanup_proc_stat:
 #ifdef CONFIG_PROC_FS
-	proc_net_remove("ip_conntrack_stat");
+	remove_proc_entry("ip_conntrack", proc_net_stat);
 cleanup_proc_exp:
 	proc_net_remove("ip_conntrack_expect");
  cleanup_proc:
