From: NeilBrown <neilb@suse.de>
Subject: fix collision handling problem in 3c59x
Patch-mainline: 2.6.17-rc1 (simplified version)
References: 159727

This is a simplified version of
  http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=0000754c27f07d5656eff17367c05dc4cfb7d965

To fix a recent break in collision handling


Signed-off-by: Neil Brown <neilb@suse.de>

Index: linux-2.6.16/drivers/net/3c59x.c
===================================================================
--- linux-2.6.16.orig/drivers/net/3c59x.c	2006-05-29 09:29:06.000000000 +1000
+++ linux-2.6.16/drivers/net/3c59x.c	2006-05-29 09:30:43.000000000 +1000
@@ -2118,7 +2118,8 @@
 				do_tx_reset = 1;
 				reset_mask = 0x0108;		/* Reset interface logic, but not download logic */
 			}
-		} else {						/* Merely re-enable the transmitter. */
+		}
+		if (!do_tx_reset) {						/* Merely re-enable the transmitter. */
 			iowrite16(TxEnable, ioaddr + EL3_CMD);
 		}
 	}
