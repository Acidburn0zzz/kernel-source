
flocks aren't supposed to be on the blocked list in the first place.
I'm not sure how this hasn't been noticed before.  The correct patch
would be something like (compile-tested only):

Index: linux-2.6/fs/locks.c
===================================================================
RCS file: /var/cvs/linux-2.6/fs/locks.c,v
retrieving revision 1.12
diff -u -p -r1.12 locks.c
--- linux-2.6/fs/locks.c	13 Aug 2004 14:30:02 -0000	1.12
+++ linux-2.6/fs/locks.c	14 Sep 2004 00:54:13 -0000
@@ -459,7 +459,8 @@ static void locks_insert_block(struct fi
 	}
 	list_add_tail(&waiter->fl_block, &blocker->fl_block);
 	waiter->fl_next = blocker;
-	list_add(&waiter->fl_link, &blocked_list);
+	if (IS_POSIX(blocker))
+		list_add(&waiter->fl_link, &blocked_list);
 }
 
 /* Wake up processes blocked waiting for blocker.

