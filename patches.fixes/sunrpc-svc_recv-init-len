ChangeSet
  1.1782 04/05/19 16:41:11 akpm@osdl.org[torvalds] +1 -0
  [PATCH] svc_recv() fix
  
  From: "J. Bruce Fields" <bfields@fieldses.org>
  
  svc_recv may call svc_sock_release before rqstp->rq_res is initialized.

  net/sunrpc/svcsock.c
    1.69 04/05/19 09:02:59 akpm@osdl.org[torvalds] +1 -0
    svc_recv() fix

diff -p -Nru a/net/sunrpc/svcsock.c b/net/sunrpc/svcsock.c
--- a/net/sunrpc/svcsock.c	Thu May 20 06:33:09 2004
+++ b/net/sunrpc/svcsock.c	Thu May 20 06:33:09 2004
@@ -1255,6 +1255,7 @@ svc_recv(struct svc_serv *serv, struct s
 
 	/* No data, incomplete (TCP) read, or accept() */
 	if (len == 0 || len == -EAGAIN) {
+		rqstp->rq_res.len = 0;
 		svc_sock_release(rqstp);
 		return -EAGAIN;
 	}
.........................................................................
# vim: syntax=diff

