From: dell
Subject: ipmi should schedule instead of udelay in ipmi_thread
Patch-mainline: yes
References: 188256

Acked-by: mason@suse.de

diff -urNp --exclude-from=/home/mdomsch/excludes --minimal linux-2.6.16.20-20060622145417.orig/drivers/char/ipmi/ipmi_msghandler.c linux-2.6.16.20-20060622145417/drivers/char/ipmi/ipmi_msghandler.c
--- linux-2.6.16.20-20060622145417.orig/drivers/char/ipmi/ipmi_msghandler.c	Thu Jun 22 10:23:34 2006
+++ linux-2.6.16.20-20060622145417/drivers/char/ipmi/ipmi_msghandler.c	Mon Jun 26 09:14:33 2006
@@ -48,7 +48,7 @@
 
 #define PFX "IPMI message handler: "
 
-#define IPMI_DRIVER_VERSION "38.1"
+#define IPMI_DRIVER_VERSION "38.2"
 
 static struct ipmi_recv_msg *ipmi_alloc_recv_msg(void);
 static int ipmi_init_msghandler(void);
diff -urNp --exclude-from=/home/mdomsch/excludes --minimal linux-2.6.16.20-20060622145417.orig/drivers/char/ipmi/ipmi_si_intf.c linux-2.6.16.20-20060622145417/drivers/char/ipmi/ipmi_si_intf.c
--- linux-2.6.16.20-20060622145417.orig/drivers/char/ipmi/ipmi_si_intf.c	Thu Jun 22 10:23:34 2006
+++ linux-2.6.16.20-20060622145417/drivers/char/ipmi/ipmi_si_intf.c	Mon Jun 26 09:14:19 2006
@@ -797,7 +797,7 @@ static int ipmi_thread(void *data)
 			/* do nothing */
 		}
 		else if (smi_result == SI_SM_CALL_WITH_DELAY)
-			udelay(1);
+			schedule();
 		else
 			schedule_timeout_interruptible(1);
 	}
