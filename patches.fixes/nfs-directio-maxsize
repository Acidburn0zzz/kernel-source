Subject: Correctly deal with oversized NFS DIRECTIO requests
References: 49685
From: Mainline
Patch-mainline: 2.6.11

This patch ensures that NFS DIRECTIO requests exceeding the size limit
get rejected properly.

Acked-by: okir@suse.de

Index: linux-2.6.5/fs/nfs/direct.c
===================================================================
--- linux-2.6.5.orig/fs/nfs/direct.c	2005-01-06 20:14:23.000000000 +0100
+++ linux-2.6.5/fs/nfs/direct.c	2005-01-11 11:38:58.000000000 +0100
@@ -71,8 +71,10 @@ nfs_get_user_pages(int rw, unsigned long
 	size_t array_size;
 
 	/* set an arbitrary limit to prevent arithmetic overflow */
-	if (size > MAX_DIRECTIO_SIZE)
+	if (size > MAX_DIRECTIO_SIZE) {
+		*pages = NULL;
 		return -EFBIG;
+	}
 
 	page_count = (user_addr + size + PAGE_SIZE - 1) >> PAGE_SHIFT;
 	page_count -= user_addr >> PAGE_SHIFT;
