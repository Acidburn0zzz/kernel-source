# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/04/30 14:08:29-05:00 shaggy@austin.ibm.com 
#   JFS: [CHECKER] Fix a possible null-pointer dereference
# 
diff -Nru a/fs/jfs/jfs_dtree.c b/fs/jfs/jfs_dtree.c
--- a/fs/jfs/jfs_dtree.c	Tue May  4 15:04:34 2004
+++ b/fs/jfs/jfs_dtree.c	Tue May  4 15:04:34 2004
@@ -982,7 +982,9 @@
 		split->pxdlist = &pxdlist;
 		rc = dtSplitRoot(tid, ip, split, &rmp);
 
-		DT_PUTPAGE(rmp);
+		if (!rc)
+			DT_PUTPAGE(rmp);
+
 		DT_PUTPAGE(smp);
 
 		goto freeKeyName;
@@ -1876,6 +1878,9 @@
 	xlen = lengthPXD(pxd);
 	xsize = xlen << JFS_SBI(sb)->l2bsize;
 	rmp = get_metapage(ip, rbn, xsize, 1);
+	if (!rmp)
+		return -EIO;
+
 	rp = rmp->data;
 
 	BT_MARK_DIRTY(rmp, ip);
