From: Olaf Kirch <okir@suse.de>
Subject: [devicemapper] Fix an oops in dm_get_mdptr
Patch-mainline: obsolete
References: 173151

This fixes an oops introduced by patches.fixes/dm-proper-refcounting.diff

Not needed in future mainline versions, as the refcounting in
__find_device_hash_cell was fixed differently.

Acked-by: hare@suse.de

 drivers/md/dm.c |    2 +-
 1 files changed, 1 insertion(+), 1 deletion(-)

Index: build/drivers/md/dm.c
===================================================================
--- build.orig/drivers/md/dm.c
+++ build/drivers/md/dm.c
@@ -1010,7 +1010,7 @@ void *dm_get_mdptr(dev_t dev)
 	if (md)
 		mdptr = md->interface_ptr;
 
-	if (mdptr == NULL)
+	if (md != NULL && mdptr == NULL)
 		dm_put(md);
 
 	return mdptr;
