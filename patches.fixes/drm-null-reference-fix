From: Egbert Eich <eich@suse.de>
Subject: Fix NULL reference in drm
Patch-mainline: 
References: 132271

Acked-by: Takashi Iwai <tiwai@suse.de>

--- a/drivers/char/drm/drm_context.c	2005-08-29 01:41:01.000000000 +0200
+++ b/drivers/char/drm/drm_context.c	2005-11-24 17:19:21.000000000 +0100
@@ -418,7 +418,10 @@
 	if ( ctx.handle != DRM_KERNEL_CONTEXT )
 	{
 		if (dev->driver->context_ctor)
-			dev->driver->context_ctor(dev, ctx.handle);
+			if (!dev->driver->context_ctor(dev, ctx.handle)) {
+				DRM_DEBUG( "Running out of ctxs or memory.\n");
+				return -ENOMEM;
+			}
 	}
 
 	ctx_entry = drm_alloc( sizeof(*ctx_entry), DRM_MEM_CTXLIST );
