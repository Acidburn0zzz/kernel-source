From: Jens Axboe <axboe@suse.de>
Subject: Use stack completion pointer, it is always safe
Patch-mainline: 
References: 

If request completes really fast, ->waiting will be NULL. Use the stack
variable instead, that is always safe.

Acked-by: 
Signed-off-by: 

--- linux-2.6.10/drivers/block/ll_rw_blk.c~	2005-02-02 11:43:32.000000000 +0100
+++ linux-2.6.10/drivers/block/ll_rw_blk.c	2005-02-02 11:43:43.000000000 +0100
@@ -2224,7 +2224,7 @@
 	rq->end_io = blk_end_sync_rq;
 	elv_add_request(q, rq, ELEVATOR_INSERT_BACK, 1);
 	generic_unplug_device(q);
-	wait_for_completion(rq->waiting);
+	wait_for_completion(&wait);
 	rq->waiting = NULL;
 
 	if (rq->errors)

