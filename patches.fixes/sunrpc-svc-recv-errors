Subject: nfsd exiting on recv() errors
From: Olaf Kirch <okir@suse.de>
References: SUSE45132
Patch-mainline: submitted 2005-07-11

svc_recv is not equipped to deal with error codes other than EAGAIN,
and will propagate anything else (such as ECONNRESET) up to nfsd,
causing it to exit.

Signed-off-by: Olaf Kirch <okir@suse.de>

Index: linux-2.6.14/net/sunrpc/svcsock.c
===================================================================
--- linux-2.6.14.orig/net/sunrpc/svcsock.c
+++ linux-2.6.14/net/sunrpc/svcsock.c
@@ -1032,7 +1032,7 @@ svc_tcp_recvfrom(struct svc_rqst *rqstp)
 	} else {
 		printk(KERN_NOTICE "%s: recvfrom returned errno %d\n",
 					svsk->sk_server->sv_name, -len);
-		svc_sock_received(svsk);
+		goto err_delete;
 	}
 
 	return len;
