From: SGI
Subject: optimize run_hrtimer_queue when there is no work to do
Patch-mainline: yes
References: 161587

Acked-by: mason@suse.com

Index: linux-2.6.15/kernel/hrtimer.c
===================================================================
--- linux-2.6.15.orig/kernel/hrtimer.c	2006-03-28 12:16:22.000000000 -0600
+++ linux-2.6.15/kernel/hrtimer.c	2006-03-28 12:20:00.093356079 -0600
@@ -586,8 +586,13 @@ int hrtimer_get_res(const clockid_t whic
  */
 static inline void run_hrtimer_queue(struct hrtimer_base *base)
 {
-	ktime_t now = base->get_time();
+	ktime_t now;
 	struct rb_node *node;
+
+	if (!base->first)
+		return;
+
+	now = base->get_time();
 
 	spin_lock_irq(&base->lock);
 
