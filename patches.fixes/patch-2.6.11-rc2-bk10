From: olh@suse.de
Subject: patch-2.6.11-rc2-bk10

 -- www.kernel.org/pub/linux/kernel/v2.6/snapshots/patch-2.6.11-rc2-bk9.log	2005-01-31 13:52:05.000000000 +0100
 ++ www.kernel.org/pub/linux/kernel/v2.6/snapshots/patch-2.6.11-rc2-bk10.log	2005-02-01 13:51:53.000000000 +0100
 ChangeSet@1.1991.1.1, 2005-01-30 13:20:58-08:00, kaber@trash.net
 ChangeSet@1.1992, 2005-01-31 07:47:51-08:00, torvalds@ppc970.osdl.org
   Merge bk://linux-acpi.bkbits.net/to-linus
   into ppc970.osdl.org:/home/torvalds/v2.6/linux
 
 ChangeSet@1.1991, 2005-01-31 07:43:58-08:00, torvalds@ppc970.osdl.org
   Merge bk://kernel.bkbits.net/davem/net-2.6
   into ppc970.osdl.org:/home/torvalds/v2.6/linux
 
 ChangeSet@1.1983.5.3, 2005-01-31 01:37:39-05:00, len.brown@intel.com
   Merge intel.com:/home/lenb/src/26-stable-dev
   into intel.com:/home/lenb/src/26-latest-dev
 
 ChangeSet@1.1938.498.12, 2005-01-31 01:35:48-05:00, len.brown@intel.com
   [ACPI] tell parse_cmdline_early() that "pnpacpi=off" != "acpi=off"
   
   Signed-off-by: Len Brown <len.brown@intel.com>
 
 ChangeSet@1.1990, 2005-01-30 22:26:36-08:00, yoshfuji@linux-ipv6.org
   [NET]: Fix kernel oops if base_reachable_time is set to zero.
   
   Signed-off-by: Hideaki YOSHIFUJI <yoshfuji@linux-ipv6.org>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1989, 2005-01-30 22:23:36-08:00, kaber@trash.net
   [NETFILTER]: Fix ICMP checksumming in icmp_reply_translation()
   
   The function returns before recalculating the checksum in some cases.
   
   Signed-off-by: Patrick McHardy <kaber@trash.net>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1988, 2005-01-30 22:22:23-08:00, kaber@trash.net
   [NETFILTER]: Fix TCP header offset used in tcp_manip_pkt().
   
   Signed-off-by: Patrick McHardy <kaber@trash.net>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1983.5.2, 2005-01-31 00:15:20-05:00, len.brown@intel.com
   Merge intel.com:/home/lenb/src/26-stable-dev
   into intel.com:/home/lenb/src/26-latest-dev
 
 ChangeSet@1.1938.498.11, 2005-01-31 00:12:40-05:00, len.brown@intel.com
   [ACPI] add "pnpacpi=off"
   
   Signed-off-by: David Shaohua Li <shaohua.li@intel.com>
   Signed-off-by: Len Brown <len.brown@intel.com>
 
 ChangeSet@1.1987, 2005-01-30 20:47:06-08:00, yoshfuji@linux-ipv6.org
   [IPV6]: Fix ip6_copy_metadata potential dst leak too.
   
   Same fix as per ipv4 ip_copy_metadata().
   
   Signed-off-by: Hideaki YOSHIFUJI <yoshfuji@linux-ipv6.org>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1986, 2005-01-30 18:24:03-08:00, kaber@trash.net
   [IPV4]: Do not leak dst entries in ip_copy_metadata().
   
   Netfilter conntrack can defragment locally generated
   packets before they hit ip_fragment().  In this case
   the fragments have skb->dst set already, so we have to
   release that existing reference before overwriting
   skb->dst.
   
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1983.4.1, 2005-01-30 13:20:58-08:00, kaber@trash.net
 ChangeSet@1.1992, 2005-01-30 19:38:54+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1983.1.9, 2005-01-30 19:38:54+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1990, 2005-01-29 09:24:47-08:00, axboe@suse.de
 ChangeSet@1.1983.2.5, 2005-01-30 02:30:50+01:00, marcel@holtmann.org
   [Bluetooth] Skip raw mode devices when choosing source device
   
   When selecting the best source device for outgoing connections the
   devices in raw mode should be skipped.
   
   Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
 
 ChangeSet@1.1983.1.7, 2005-01-29 09:24:47-08:00, axboe@suse.de
 ChangeSet@1.1989, 2005-01-29 09:24:34-08:00, ak@suse.de
 ChangeSet@1.1983.1.6, 2005-01-29 09:24:34-08:00, ak@suse.de
 ChangeSet@1.1988, 2005-01-29 09:24:19-08:00, ak@suse.de
 ChangeSet@1.1983.1.5, 2005-01-29 09:24:19-08:00, ak@suse.de
 ChangeSet@1.1986.1.1, 2005-01-29 13:08:30+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1983.3.1, 2005-01-29 13:08:30+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1987, 2005-01-28 22:29:02-05:00, mkrikis@yahoo.com
 ChangeSet@1.1983.1.4, 2005-01-28 22:29:02-05:00, mkrikis@yahoo.com
 ChangeSet@1.1986, 2005-01-28 16:13:31-08:00, Andries.Brouwer@cwi.nl
 ChangeSet@1.1983.2.4, 2005-01-29 03:34:45+01:00, marcel@holtmann.org
   [Bluetooth] Use raw mode for the CSR sniffer device
   
   The CSR sniffer device looks like a normal H:2 Bluetooth device,
   but it is not and so mark it as raw mode device.
   
   Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
 
 ChangeSet@1.1983.2.3, 2005-01-29 03:30:32+01:00, marcel@holtmann.org
   [Bluetooth] Support raw mode only devices
   
   This patch introduces a quirk flag for turning a device into a raw
   mode only device.
   
   Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
 
 ChangeSet@1.1983.2.2, 2005-01-29 03:22:56+01:00, marcel@holtmann.org
   [Bluetooth] Update inquiry cache from clock offset event
   
   The HCI clock offset event contains the actual clock offset for the
   connection. It is the same value that is received from an inquiry
   response and it can be used to make further reconnections faster.
   
   Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
 
 ChangeSet@1.1983.2.1, 2005-01-29 03:15:35+01:00, marcel@holtmann.org
   [Bluetooth] Remove MTU check for the L2CAP raw socket
   
   The L2CAP raw socket is associated with the signal channel and the
   check for the maximum transfer unit makes no sense here.
   
   Signed-off-by: Marcel Holtmann <marcel@holtmann.org>
 
 ChangeSet@1.1983.1.3, 2005-01-28 16:13:31-08:00, Andries.Brouwer@cwi.nl
 ChangeSet@1.1984, 2005-01-28 22:38:30+01:00, wim@iguana.be
 ChangeSet@1.1983.1.1, 2005-01-28 22:38:30+01:00, wim@iguana.be
 ChangeSet@1.1966.86.6, 2005-01-28 00:08:57+00:00, dvrabel@com.rmk.(none)
 ChangeSet@1.1966.89.6, 2005-01-28 00:08:57+00:00, dvrabel@com.rmk.(none)
 ChangeSet@1.1966.87.5, 2005-01-27 17:13:18-05:00, shemminger@osdl.org
 ChangeSet@1.1938.498.10, 2005-01-27 18:16:15-05:00, len.brown@intel.com
   [ACPI] ACPI_FUTURE_USAGE for acpi_ut_create_pkg_state_and_push() 
   
   Signed-off-by: Adrian Bunk <bunk@stusta.de>
   Signed-off-by: Len Brown <len.brown@intel.com>
 
 ChangeSet@1.1938.498.9, 2005-01-27 18:15:47-05:00, len.brown@intel.com
   [ACPI] reduce stack usage
   http://bugzilla.kernel.org/show_bug.cgi?id=2901
   
   Written-by: Luming Yu <luming.yu@intel.com>
   Signed-off-by: Len Brown <len.brown@intel.com>
 
 ChangeSet@1.1966.90.5, 2005-01-27 17:13:18-05:00, shemminger@osdl.org
 ChangeSet@1.1966.87.4, 2005-01-27 17:12:59-05:00, shemminger@osdl.org
 ChangeSet@1.1966.90.4, 2005-01-27 17:12:59-05:00, shemminger@osdl.org
 ChangeSet@1.1966.87.3, 2005-01-27 17:08:40-05:00, galak@freescale.com
 ChangeSet@1.1966.90.3, 2005-01-27 17:08:40-05:00, galak@freescale.com
 ChangeSet@1.1966.87.2, 2005-01-27 16:57:11-05:00, akpm@osdl.org
 ChangeSet@1.1966.90.2, 2005-01-27 16:57:11-05:00, akpm@osdl.org
 ChangeSet@1.1966.87.1, 2005-01-27 16:13:14-05:00, viro@parcelfarce.linux.theplanet.co.uk
 ChangeSet@1.1966.90.1, 2005-01-27 16:13:14-05:00, viro@parcelfarce.linux.theplanet.co.uk
 ChangeSet@1.1966.86.5, 2005-01-27 19:31:47+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1966.84.22, 2005-01-27 12:15:37-08:00, davem@nuts.davemloft.net
   [NET]: Kill now unused local var from sock_init().
   
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.89.5, 2005-01-27 19:31:47+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1966.86.4, 2005-01-27 19:13:38+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1966.84.21, 2005-01-27 11:21:55-08:00, bcrl@kvack.org
   [NET]: Kill excess initializer
   
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.89.4, 2005-01-27 19:13:38+00:00, rmk@flint.arm.linux.org.uk
 ChangeSet@1.1966.84.20, 2005-01-26 23:10:48-08:00, rddunlap@osdl.org
   [ATALK]: Remove gcc warning when PROC_FS=n
   
   Signed-off-by: Randy Dunlap <rddunlap@osdl.org>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.19, 2005-01-26 23:07:31-08:00, bunk@stusta.de
   [NET]: Remove mandoc reference to deleted file net_init.c
   
   This patch by Jesper Juhl is still required in 2.6.11-rc2-mm1.
   
   Signed-off-by: Adrian Bunk <bunk@stusta.de>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.18, 2005-01-26 23:06:05-08:00, chas@cmf.nrl.navy.mil
   [ATM]: replace schedule_timeout() with msleep()
   
   Signed-off-by: Nishanth Aravamudan <nacc@us.ibm.com>
   Signed-off-by: Chas Williams <chas@cmf.nrl.navy.mil>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.17, 2005-01-26 23:04:28-08:00, chas@cmf.nrl.navy.mil
   [ATM]: [svc] get accounting right when we remove skb
   
   Signed-off-by: Chas Williams <chas@cmf.nrl.navy.mil>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.16, 2005-01-26 23:03:31-08:00, chas@cmf.nrl.navy.mil
   [ATM]: [nicstar] small cleanup for some globals
   
   Signed-off-by: Adrian Bunk <bunk@stusta.de>
   Signed-off-by: Chas Williams <chas@cmf.nrl.navy.mil>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.15, 2005-01-26 23:01:23-08:00, chas@cmf.nrl.navy.mil
   [ATM]: [he] reorder add_wait_queue() and set_current_state()
   
   Signed-off-by: Nishanth Aravamudan <nacc@us.ibm.com>
   Signed-off-by: Chas Williams <chas@cmf.nrl.navy.mil>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.14, 2005-01-26 23:00:11-08:00, chas@cmf.nrl.navy.mil
   [ATM]: [fore200e] can't cleap in transmit routine
   
   Signed-off-by: Chas Williams <chas@cmf.nrl.navy.mil>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.13, 2005-01-26 22:16:16-08:00, kazunori@miyazawa.org
   [IPSEC]: Fix processing of error from crypto module.
   
   ESP needs to check for error returns from calls
   to crypto_cipher_setkey().
   
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.12, 2005-01-26 22:03:38-08:00, kaber@trash.net
   [IPV4]: Keep fragment queues private to each user.
   
   Signed-off-by: Patrick McHardy <kaber@trash.net>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.11, 2005-01-26 21:53:44-08:00, herbert@gondor.apana.org.au
   [ATM]: Fix IRQ flags type in lec_arp_expire_vcc
   
   It should be unsigned long.
   
   Signed-off-by: Herbert Xu <herbert@gondor.apana.org.au>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.10, 2005-01-26 15:09:21-08:00, davem@nuts.davemloft.net
   [TG3]: Update driver version and reldate.
   
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.84.9, 2005-01-26 15:03:05-08:00, mchan@broadcom.com
   [TG3]: 5750 fixes
   
   Some misc. fixes for 5750. The first 2 fixes below are for correctness.
   
   - Do not set extended MAC addresses for 5750
   - Do not set NIC ring addresses in send ring and receive return ring
     RCBs for 5750
   - Check eeprom write protect bit for 5750
   
   Signed-off-by: Michael Chan <mchan@broadcom.com>
   Signed-off-by: David S. Miller <davem@davemloft.net>
 
 ChangeSet@1.1966.82.8, 2005-01-25 22:06:30-08:00, tgraf@suug.ch
 ChangeSet@1.1938.498.8, 2005-01-26 02:32:41-05:00, len.brown@intel.com
   [ACPI] ACPICA 20050125 from Bob Moore
   
   Fixed a recently introduced problem with the Global
   Lock where the underlying semaphore was not created.
   This problem was introduced in version 20050114, and
   caused an AE_AML_NO_OPERAND exception during an Acquire()
   operation on _GL.
   
   The local object cache is now optional, and is disabled
   by default.  #define ACPI_ENABLE_OBJECT_CACHE to enable
   the local cache.
   
   Fixed an issue in the internal function
   acpi_ut_evaluate_object() concerning the optional "implicit
   return" support where an error was returned if no return
   object was expected, but one was implicitly returned. AE_OK
   is now returned in this case and the implicitly returned
   object is deleted.  acpi_ut_evaluate_object() is only
   occasionally used, and only to execute reserved methods
   such as _STA and _INI where the return type is known
   up front.
   
   Fixed a few issues with the internal convert-to-integer
   code. It now returns an error if an attempt is made to
   convert a null string, a string of only blanks/tabs, or a
   zero-length buffer. This affects both implicit conversion
   and explicit conversion via the ToInteger() operator.
   
   The internal debug code in acpi_ut_acquire_mutex()
   has been commented out. It is not needed for normal
   operation and should increase the performance of the entire
   subsystem. The code remains in case it is needed for debug
   purposes again.
   acpica-unix-20050125.patch
 
 ChangeSet@1.1966.84.8, 2005-01-25 22:06:30-08:00, tgraf@suug.ch
 ChangeSet@1.1966.82.7, 2005-01-25 21:53:42-08:00, herbert@gondor.apana.org.au
 ChangeSet@1.1966.84.7, 2005-01-25 21:53:42-08:00, herbert@gondor.apana.org.au
 ChangeSet@1.1966.83.18, 2005-01-25 21:34:49-08:00, akpm@osdl.org
 ChangeSet@1.1966.85.18, 2005-01-25 21:34:49-08:00, akpm@osdl.org
 ChangeSet@1.1966.83.17, 2005-01-25 21:33:24-08:00, akpm@osdl.org
 ChangeSet@1.1966.85.17, 2005-01-25 21:33:24-08:00, akpm@osdl.org
 ChangeSet@1.1966.83.16, 2005-01-25 21:31:12-08:00, mostrows@watson.ibm.com
 ChangeSet@1.1966.85.16, 2005-01-25 21:31:12-08:00, mostrows@watson.ibm.com
 ChangeSet@1.1966.83.15, 2005-01-25 21:19:37-08:00, rusty@rustcorp.com.au
 ChangeSet@1.1966.85.15, 2005-01-25 21:19:37-08:00, rusty@rustcorp.com.au
 ChangeSet@1.1966.83.14, 2005-01-25 21:18:13-08:00, rusty@rustcorp.com.au
 ChangeSet@1.1966.85.14, 2005-01-25 21:18:13-08:00, rusty@rustcorp.com.au
 ChangeSet@1.1966.83.13, 2005-01-25 21:16:24-08:00, rddunlap@osdl.org
 ChangeSet@1.1966.85.13, 2005-01-25 21:16:24-08:00, rddunlap@osdl.org
 ChangeSet@1.1966.86.3, 2005-01-25 22:51:34+00:00, nico@org.rmk.(none)
 ChangeSet@1.1966.89.3, 2005-01-25 22:51:34+00:00, nico@org.rmk.(none)
 ChangeSet@1.1966.86.2, 2005-01-25 22:43:59+00:00, ben-linux@org.rmk.(none)
 ChangeSet@1.1966.89.2, 2005-01-25 22:43:59+00:00, ben-linux@org.rmk.(none)
 ChangeSet@1.1966.86.1, 2005-01-25 22:36:39+00:00, ben-linux@org.rmk.(none)
 ChangeSet@1.1966.89.1, 2005-01-25 22:36:39+00:00, ben-linux@org.rmk.(none)
 ChangeSet@1.1966.84.1, 2005-01-25 10:10:51+00:00, aia21@cantab.net
 ChangeSet@1.1966.87.1, 2005-01-25 10:10:51+00:00, aia21@cantab.net
 ChangeSet@1.1966.83.12, 2005-01-25 04:31:49+01:00, kernel@linuxace.com
 ChangeSet@1.1966.86.1, 2005-01-24 23:32:11-05:00, len.brown@intel.com
   Merge
 
 ChangeSet@1.1966.85.12, 2005-01-25 04:31:49+01:00, kernel@linuxace.com
 ChangeSet@1.1966.83.11, 2005-01-25 04:12:44+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.85.11, 2005-01-25 04:12:44+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.83.10, 2005-01-25 04:10:59+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.85.10, 2005-01-25 04:10:59+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.83.9, 2005-01-25 03:56:48+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.85.9, 2005-01-25 03:56:48+01:00, gandalf@wlug.westbo.se
 ChangeSet@1.1966.83.8, 2005-01-24 17:41:45-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.85.8, 2005-01-24 17:41:45-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.83.7, 2005-01-24 17:39:51-08:00, mchan@broadcom.com
 ChangeSet@1.1966.85.7, 2005-01-24 17:39:51-08:00, mchan@broadcom.com
 ChangeSet@1.1966.83.6, 2005-01-24 16:40:33-08:00, herbert@gondor.apana.org.au
 ChangeSet@1.1966.85.6, 2005-01-24 16:40:33-08:00, herbert@gondor.apana.org.au
 ChangeSet@1.1966.65.22, 2005-01-23 17:44:52-06:00, hch@lst.de
 ChangeSet@1.1966.66.22, 2005-01-23 17:44:52-06:00, hch@lst.de
 ChangeSet@1.1966.83.5, 2005-01-23 11:09:59-08:00, torvalds@ppc970.osdl.org
 ChangeSet@1.1966.85.5, 2005-01-23 11:09:59-08:00, torvalds@ppc970.osdl.org
 ChangeSet@1.1966.82.5, 2005-01-23 20:01:39+01:00, marcel@holtmann.org
 ChangeSet@1.1966.84.5, 2005-01-23 20:01:39+01:00, marcel@holtmann.org
 ChangeSet@1.1966.82.4, 2005-01-23 19:55:30+01:00, marcel@holtmann.org
 ChangeSet@1.1966.84.4, 2005-01-23 19:55:30+01:00, marcel@holtmann.org
 ChangeSet@1.1966.83.4, 2005-01-23 10:29:42-08:00, kaos@ocs.com.au
 ChangeSet@1.1966.85.4, 2005-01-23 10:29:42-08:00, kaos@ocs.com.au
 ChangeSet@1.1966.83.3, 2005-01-23 10:29:27-08:00, ak@suse.de
 ChangeSet@1.1966.85.3, 2005-01-23 10:29:27-08:00, ak@suse.de
 ChangeSet@1.1966.83.2, 2005-01-23 10:29:11-08:00, ak@suse.de
 ChangeSet@1.1966.85.2, 2005-01-23 10:29:11-08:00, ak@suse.de
 ChangeSet@1.1966.83.1, 2005-01-23 10:28:57-08:00, ak@suse.de
 ChangeSet@1.1966.85.1, 2005-01-23 10:28:57-08:00, ak@suse.de
 ChangeSet@1.1966.82.3, 2005-01-23 18:50:26+01:00, marcel@holtmann.org
 ChangeSet@1.1966.84.3, 2005-01-23 18:50:26+01:00, marcel@holtmann.org
 ChangeSet@1.1966.82.2, 2005-01-23 18:40:28+01:00, marcel@holtmann.org
 ChangeSet@1.1966.84.2, 2005-01-23 18:40:28+01:00, marcel@holtmann.org
 ChangeSet@1.1966.82.1, 2005-01-23 18:36:35+01:00, marcel@holtmann.org
 ChangeSet@1.1966.84.1, 2005-01-23 18:36:35+01:00, marcel@holtmann.org
 ChangeSet@1.1966.65.21, 2005-01-23 09:26:01-06:00, jejb@mulgrave.(none)
 ChangeSet@1.1966.66.21, 2005-01-23 09:26:01-06:00, jejb@mulgrave.(none)
 ChangeSet@1.1966.65.20, 2005-01-23 09:20:23-06:00, bunk@stusta.de
 ChangeSet@1.1966.66.20, 2005-01-23 09:20:23-06:00, bunk@stusta.de
 ChangeSet@1.1966.65.19, 2005-01-23 09:12:43-06:00, markh@osdl.org
 ChangeSet@1.1966.66.19, 2005-01-23 09:12:43-06:00, markh@osdl.org
 ChangeSet@1.1966.65.18, 2005-01-23 08:51:23-06:00, jejb@mulgrave.(none)
 ChangeSet@1.1966.66.18, 2005-01-23 08:51:23-06:00, jejb@mulgrave.(none)
 ChangeSet@1.1966.65.17, 2005-01-23 08:41:37-06:00, dougg@torque.net
 ChangeSet@1.1966.66.17, 2005-01-23 08:41:37-06:00, dougg@torque.net
 ChangeSet@1.1966.65.16, 2005-01-23 08:36:14-06:00, dougg@torque.net
 ChangeSet@1.1966.66.16, 2005-01-23 08:36:14-06:00, dougg@torque.net
 ChangeSet@1.1966.77.145, 2005-01-22 19:46:13-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.79.145, 2005-01-22 19:46:13-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.75.19, 2005-01-22 19:42:06-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.78.5, 2005-01-22 19:42:06-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.80.16, 2005-01-22 11:37:01-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.16, 2005-01-22 11:37:01-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.15, 2005-01-22 11:36:47-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.15, 2005-01-22 11:36:47-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.14, 2005-01-22 11:36:33-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.14, 2005-01-22 11:36:33-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.13, 2005-01-22 11:36:18-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.13, 2005-01-22 11:36:18-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.12, 2005-01-22 11:36:05-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.12, 2005-01-22 11:36:05-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.11, 2005-01-22 11:35:52-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.11, 2005-01-22 11:35:52-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.10, 2005-01-22 11:35:38-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.10, 2005-01-22 11:35:38-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.9, 2005-01-22 11:35:24-08:00, js@linuxtv.org
 ChangeSet@1.1966.82.9, 2005-01-22 11:35:24-08:00, js@linuxtv.org
 ChangeSet@1.1966.80.8, 2005-01-22 11:02:00-08:00, roland@redhat.com
 ChangeSet@1.1966.82.8, 2005-01-22 11:02:00-08:00, roland@redhat.com
 ChangeSet@1.1966.80.7, 2005-01-22 10:31:39-08:00, nanhai.zou@intel.com
 ChangeSet@1.1966.82.7, 2005-01-22 10:31:39-08:00, nanhai.zou@intel.com
 ChangeSet@1.1966.77.144, 2005-01-21 20:04:07-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.79.144, 2005-01-21 20:04:07-08:00, davem@nuts.davemloft.net
 ChangeSet@1.1966.80.6, 2005-01-21 17:45:41-08:00, torvalds@ppc970.osdl.org
 ChangeSet@1.1966.82.6, 2005-01-21 17:45:41-08:00, torvalds@ppc970.osdl.org
diff -purN linux-2.6.11-rc2-bk9/Documentation/DocBook/kernel-api.tmpl linux-2.6.11-rc2-bk10/Documentation/DocBook/kernel-api.tmpl
--- linux-2.6.11-rc2-bk9/Documentation/DocBook/kernel-api.tmpl	2005-01-22 02:46:41.000000000 +0100
+++ linux-2.6.11-rc2-bk10/Documentation/DocBook/kernel-api.tmpl	2005-02-01 16:06:26.551778283 +0100
@@ -152,7 +152,6 @@ KAO -->
   <chapter id="netdev">
      <title>Network device support</title>
      <sect1><title>Driver Support</title>
-!Edrivers/net/net_init.c
 !Enet/core/dev.c
      </sect1>
      <sect1><title>8390 Based Network Cards</title>
diff -purN linux-2.6.11-rc2-bk9/Documentation/kernel-parameters.txt linux-2.6.11-rc2-bk10/Documentation/kernel-parameters.txt
--- linux-2.6.11-rc2-bk9/Documentation/kernel-parameters.txt	2005-02-01 16:06:18.902769282 +0100
+++ linux-2.6.11-rc2-bk10/Documentation/kernel-parameters.txt	2005-02-01 16:06:26.560776881 +0100
@@ -1018,6 +1018,9 @@ running once the system is up.
 			Format: { parport<nr> | timid | 0 }
 			See also Documentation/parport.txt.
 
+	pnpacpi=	[ACPI]
+			{ off }
+
 	pnpbios=	[ISAPNP]
 			{ on | off | curr | res | no-curr | no-res }
 
diff -purN linux-2.6.11-rc2-bk9/Makefile linux-2.6.11-rc2-bk10/Makefile
--- linux-2.6.11-rc2-bk9/Makefile	2005-02-01 16:06:18.910768035 +0100
+++ linux-2.6.11-rc2-bk10/Makefile	2005-02-01 16:06:26.569775478 +0100
@@ -1,7 +1,7 @@
 VERSION = 2
 PATCHLEVEL = 6
 SUBLEVEL = 11
-EXTRAVERSION = -rc2-bk9
+EXTRAVERSION = -rc2-bk10
 NAME=Woozy Numbat
 
 # *DOCUMENTATION*
diff -purN linux-2.6.11-rc2-bk9/arch/i386/kernel/setup.c linux-2.6.11-rc2-bk10/arch/i386/kernel/setup.c
--- linux-2.6.11-rc2-bk9/arch/i386/kernel/setup.c	2005-01-22 02:48:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/arch/i386/kernel/setup.c	2005-02-01 16:06:26.595771426 +0100
@@ -675,6 +675,8 @@ static void __init parse_cmdline_early (
 	saved_command_line[COMMAND_LINE_SIZE-1] = '\0';
 
 	for (;;) {
+		if (c != ' ')
+			goto next_char;
 		/*
 		 * "mem=nopentium" disables the 4MB page tables.
 		 * "mem=XXX[kKmM]" defines a memory region from HIGH_MEM
@@ -685,7 +687,7 @@ static void __init parse_cmdline_early (
 		 * HPA tells me bootloaders need to parse mem=, so no new
 		 * option should be mem=  [also see Documentation/i386/boot.txt]
 		 */
-		if (c == ' ' && !memcmp(from, "mem=", 4)) {
+		if (!memcmp(from, "mem=", 4)) {
 			if (to != command_line)
 				to--;
 			if (!memcmp(from+4, "nopentium", 9)) {
@@ -707,7 +709,7 @@ static void __init parse_cmdline_early (
 			}
 		}
 
-		if (c == ' ' && !memcmp(from, "memmap=", 7)) {
+		else if (!memcmp(from, "memmap=", 7)) {
 			if (to != command_line)
 				to--;
 			if (!memcmp(from+7, "exactmap", 8)) {
@@ -819,7 +821,7 @@ static void __init parse_cmdline_early (
 		 * This works even on boxes that have no highmem otherwise.
 		 * This also works to reduce highmem size on bigger boxes.
 		 */
-		if (c == ' ' && !memcmp(from, "highmem=", 8))
+		else if (!memcmp(from, "highmem=", 8))
 			highmem_pages = memparse(from+8, &from) >> PAGE_SHIFT;
 	
 		/*
@@ -827,9 +829,10 @@ static void __init parse_cmdline_early (
 		 * bytes. This can be used to increase (or decrease) the
 		 * vmalloc area - the default is 128m.
 		 */
-		if (c == ' ' && !memcmp(from, "vmalloc=", 8))
+		else if (!memcmp(from, "vmalloc=", 8))
 			__VMALLOC_RESERVE = memparse(from+8, &from);
 
+	next_char:
 		c = *(from++);
 		if (!c)
 			break;
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/debug.c linux-2.6.11-rc2-bk10/drivers/acpi/debug.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/debug.c	2005-01-22 02:48:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/debug.c	2005-02-01 16:06:26.784741970 +0100
@@ -5,6 +5,7 @@
 #include <linux/proc_fs.h>
 #include <linux/init.h>
 #include <linux/module.h>
+#include <linux/kernel.h>
 #include <linux/moduleparam.h>
 #include <asm/uaccess.h>
 #include <acpi/acpi_drivers.h>
@@ -89,7 +90,6 @@ const struct acpi_dlevel acpi_debug_leve
 	ACPI_DEBUG_INIT(ACPI_LV_FULL_TABLES),
 	ACPI_DEBUG_INIT(ACPI_LV_EVENTS),             
 };
-#define NUM_OF(v)	( sizeof(v)/sizeof(v[0]) )
 
 static int
 acpi_system_read_debug (
@@ -102,7 +102,7 @@ acpi_system_read_debug (
 {
 	char			*p = page;
 	int 			size = 0;
-	int			i;
+	unsigned int		i;
 
 	if (off != 0)
 		goto end;
@@ -111,7 +111,7 @@ acpi_system_read_debug (
 
 	switch ((unsigned long) data) {
 	case 0:
-		for (i = 0; i < NUM_OF(acpi_debug_layers); i++) {
+		for (i = 0; i < ARRAY_SIZE(acpi_debug_layers); i++) {
 			p += sprintf(p, "%-25s\t0x%08lX [%c]\n",
 				acpi_debug_layers[i].name,
 				acpi_debug_layers[i].value,
@@ -128,7 +128,7 @@ acpi_system_read_debug (
 			acpi_dbg_layer);
 		break;
 	case 1:
-		for (i = 0; i < NUM_OF(acpi_debug_levels); i++) {
+		for (i = 0; i < ARRAY_SIZE(acpi_debug_levels); i++) {
 			p += sprintf(p, "%-25s\t0x%08lX [%c]\n",
 				acpi_debug_levels[i].name,
 				acpi_debug_levels[i].value,
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsfield.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsfield.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsfield.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsfield.c	2005-02-01 16:06:26.785741814 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsinit.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsinit.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsinit.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsinit.c	2005-02-01 16:06:26.786741659 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsmethod.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsmethod.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsmethod.c	2005-01-22 02:48:01.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsmethod.c	2005-02-01 16:06:26.788741347 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsmthdat.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsmthdat.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsmthdat.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsmthdat.c	2005-02-01 16:06:26.789741191 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsobject.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsobject.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsobject.c	2005-01-22 02:46:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsobject.c	2005-02-01 16:06:26.791740879 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -516,7 +516,7 @@ acpi_ds_init_object_from_op (
 
 			case AML_REVISION_OP:
 
-				obj_desc->integer.value = ACPI_CA_SUPPORT_LEVEL;
+				obj_desc->integer.value = ACPI_CA_VERSION;
 				break;
 
 			default:
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsopcode.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsopcode.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsopcode.c	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsopcode.c	2005-02-01 16:06:26.793740568 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsutils.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dsutils.c	2005-01-22 02:48:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dsutils.c	2005-02-01 16:06:26.794740412 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -88,11 +88,13 @@ acpi_ds_is_result_used (
 	}
 
 	/*
-	 * If there is no parent, we are executing at the method level.
-	 * An executing method typically has no parent, since each method
-	 * is parsed separately.
+	 * If there is no parent, or the parent is a scope_op, we are executing
+	 * at the method level. An executing method typically has no parent,
+	 * since each method is parsed separately.  A method invoked externally
+	 * via execute_control_method has a scope_op as the parent.
 	 */
-	if (!op->common.parent) {
+	if ((!op->common.parent) ||
+		(op->common.parent->common.aml_opcode == AML_SCOPE_OP)) {
 		/*
 		 * If this is the last statement in the method, we know it is not a
 		 * Return() operator (would not come here.) The following code is the
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswexec.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswexec.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswexec.c	2005-01-22 02:49:12.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswexec.c	2005-02-01 16:06:26.796740100 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswload.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswload.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswload.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswload.c	2005-02-01 16:06:26.798739788 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswscope.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswscope.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswscope.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswscope.c	2005-02-01 16:06:26.799739632 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswstate.c linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswstate.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/dispatcher/dswstate.c	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/dispatcher/dswstate.c	2005-02-01 16:06:26.801739321 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -1071,6 +1071,7 @@ acpi_ds_delete_walk_state (
 }
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 /******************************************************************************
  *
  * FUNCTION:    acpi_ds_delete_walk_state_cache
@@ -1094,5 +1095,6 @@ acpi_ds_delete_walk_state_cache (
 	acpi_ut_delete_generic_cache (ACPI_MEM_LIST_WALK);
 	return_VOID;
 }
+#endif
 
 
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evevent.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evevent.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evevent.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evevent.c	2005-02-01 16:06:26.802739165 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evgpe.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evgpe.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evgpe.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evgpe.c	2005-02-01 16:06:26.804738853 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evgpeblk.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evgpeblk.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evgpeblk.c	2005-01-22 02:48:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evgpeblk.c	2005-02-01 16:06:26.806738541 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evmisc.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evmisc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evmisc.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evmisc.c	2005-02-01 16:06:26.807738386 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evregion.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evregion.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evregion.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evregion.c	2005-02-01 16:06:26.809738074 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evrgnini.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evrgnini.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evrgnini.c	2005-01-22 02:47:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evrgnini.c	2005-02-01 16:06:26.811737762 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evsci.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evsci.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evsci.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evsci.c	2005-02-01 16:06:26.812737606 +0100
@@ -6,7 +6,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evxface.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evxface.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evxface.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evxface.c	2005-02-01 16:06:26.813737451 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evxfevnt.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evxfevnt.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evxfevnt.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evxfevnt.c	2005-02-01 16:06:26.815737139 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/events/evxfregn.c linux-2.6.11-rc2-bk10/drivers/acpi/events/evxfregn.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/events/evxfregn.c	2005-01-22 02:47:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/events/evxfregn.c	2005-02-01 16:06:26.816736983 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exconfig.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exconfig.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exconfig.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exconfig.c	2005-02-01 16:06:26.817736827 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exconvrt.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exconvrt.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exconvrt.c	2005-01-22 02:46:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exconvrt.c	2005-02-01 16:06:26.819736515 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -136,6 +136,12 @@ acpi_ex_convert_to_integer (
 
 	case ACPI_TYPE_BUFFER:
 
+		/* Check for zero-length buffer */
+
+		if (!count) {
+			return_ACPI_STATUS (AE_AML_BUFFER_LIMIT);
+		}
+
 		/* Transfer no more than an integer's worth of data */
 
 		if (count > acpi_gbl_integer_byte_width) {
@@ -239,8 +245,13 @@ acpi_ex_convert_to_buffer (
 		/*
 		 * Create a new Buffer object
 		 * Size will be the string length
+		 *
+		 * NOTE: Add one to the string length to include the null terminator.
+		 * The ACPI spec is unclear on this subject, but there is existing
+		 * ASL/AML code that depends on the null being transferred to the new
+		 * buffer.
 		 */
-		return_desc = acpi_ut_create_buffer_object ((acpi_size) obj_desc->string.length);
+		return_desc = acpi_ut_create_buffer_object ((acpi_size) obj_desc->string.length + 1);
 		if (!return_desc) {
 			return_ACPI_STATUS (AE_NO_MEMORY);
 		}
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/excreate.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/excreate.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/excreate.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/excreate.c	2005-02-01 16:06:26.820736360 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exdump.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exdump.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exdump.c	2005-01-22 02:47:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exdump.c	2005-02-01 16:06:26.822736048 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exfield.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exfield.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exfield.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exfield.c	2005-02-01 16:06:26.823735892 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exfldio.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exfldio.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exfldio.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exfldio.c	2005-02-01 16:06:26.825735580 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exmisc.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exmisc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exmisc.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exmisc.c	2005-02-01 16:06:26.826735424 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exmutex.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exmutex.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exmutex.c	2005-01-22 02:48:45.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exmutex.c	2005-02-01 16:06:26.827735269 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exnames.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exnames.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exnames.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exnames.c	2005-02-01 16:06:26.829734957 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg1.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg1.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg1.c	2005-01-22 02:48:57.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg1.c	2005-02-01 16:06:26.830734801 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg2.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg2.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg2.c	2005-01-22 02:48:03.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg2.c	2005-02-01 16:06:26.832734489 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg3.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg3.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg3.c	2005-01-22 02:46:44.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg3.c	2005-02-01 16:06:26.833734334 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -218,6 +218,10 @@ acpi_ex_opcode_3A_1T_1R (
 			return_desc->string.pointer = buffer;
 			return_desc->string.length = (u32) length;
 		}
+
+		/* Mark buffer initialized */
+
+		return_desc->buffer.flags |= AOPOBJ_DATA_VALID;
 		break;
 
 
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg6.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg6.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exoparg6.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exoparg6.c	2005-02-01 16:06:26.834734178 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exprep.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exprep.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exprep.c	2005-01-22 02:47:30.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exprep.c	2005-02-01 16:06:26.835734022 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exregion.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exregion.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exregion.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exregion.c	2005-02-01 16:06:26.837733710 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresnte.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresnte.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresnte.c	2005-01-22 02:47:30.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresnte.c	2005-02-01 16:06:26.838733554 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresolv.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresolv.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresolv.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresolv.c	2005-02-01 16:06:26.839733398 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresop.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresop.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exresop.c	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exresop.c	2005-02-01 16:06:26.841733087 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -584,6 +584,45 @@ acpi_ex_resolve_operands (
 			goto next_operand;
 
 
+		case ARGI_DATAREFOBJ:
+
+			/* Used by the Store() operator only */
+
+			switch (ACPI_GET_OBJECT_TYPE (obj_desc)) {
+			case ACPI_TYPE_INTEGER:
+			case ACPI_TYPE_PACKAGE:
+			case ACPI_TYPE_STRING:
+			case ACPI_TYPE_BUFFER:
+			case ACPI_TYPE_BUFFER_FIELD:
+			case ACPI_TYPE_LOCAL_REFERENCE:
+			case ACPI_TYPE_LOCAL_REGION_FIELD:
+			case ACPI_TYPE_LOCAL_BANK_FIELD:
+			case ACPI_TYPE_LOCAL_INDEX_FIELD:
+			case ACPI_TYPE_DDB_HANDLE:
+
+				/* Valid operand */
+				break;
+
+			default:
+
+				if (acpi_gbl_enable_interpreter_slack) {
+					/*
+					 * Enable original behavior of Store(), allowing any and all
+					 * objects as the source operand.  The ACPI spec does not
+					 * allow this, however.
+					 */
+					break;
+				}
+
+				ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+					"Needed Integer/Buffer/String/Package/Ref/Ddb], found [%s] %p\n",
+					acpi_ut_get_object_type_name (obj_desc), obj_desc));
+
+				return_ACPI_STATUS (AE_AML_OPERAND_TYPE);
+			}
+			goto next_operand;
+
+
 		default:
 
 			/* Unknown type */
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstore.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstore.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstore.c	2005-01-22 02:47:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstore.c	2005-02-01 16:06:26.842732931 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstoren.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstoren.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstoren.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstoren.c	2005-02-01 16:06:26.843732775 +0100
@@ -7,7 +7,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstorob.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstorob.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exstorob.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exstorob.c	2005-02-01 16:06:26.844732619 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exsystem.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exsystem.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exsystem.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exsystem.c	2005-02-01 16:06:26.845732463 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/executer/exutils.c linux-2.6.11-rc2-bk10/drivers/acpi/executer/exutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/executer/exutils.c	2005-01-22 02:49:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/executer/exutils.c	2005-02-01 16:06:26.846732307 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwacpi.c linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwacpi.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwacpi.c	2005-01-22 02:46:44.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwacpi.c	2005-02-01 16:06:26.847732152 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwgpe.c linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwgpe.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwgpe.c	2005-01-22 02:46:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwgpe.c	2005-02-01 16:06:26.848731996 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwregs.c linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwregs.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwregs.c	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwregs.c	2005-02-01 16:06:26.850731684 +0100
@@ -7,7 +7,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwsleep.c linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwsleep.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwsleep.c	2005-01-22 02:47:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwsleep.c	2005-02-01 16:06:26.851731528 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwtimer.c linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwtimer.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/hardware/hwtimer.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/hardware/hwtimer.c	2005-02-01 16:06:26.852731372 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsaccess.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsaccess.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsaccess.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsaccess.c	2005-02-01 16:06:26.854731061 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -155,8 +155,7 @@ acpi_ns_root_initialize (void)
 			 */
 			switch (init_val->type) {
 			case ACPI_TYPE_METHOD:
-				obj_desc->method.param_count = (u8) ACPI_STRTOUL
-						  (val, NULL, 10);
+				obj_desc->method.param_count = (u8) ACPI_TO_INTEGER (val);
 				obj_desc->common.flags |= AOPOBJ_DATA_VALID;
 
 #if defined (_ACPI_ASL_COMPILER) || defined (_ACPI_DUMP_App)
@@ -176,8 +175,7 @@ acpi_ns_root_initialize (void)
 
 			case ACPI_TYPE_INTEGER:
 
-				obj_desc->integer.value =
-						(acpi_integer) ACPI_STRTOUL (val, NULL, 10);
+				obj_desc->integer.value = ACPI_TO_INTEGER (val);
 				break;
 
 
@@ -195,8 +193,7 @@ acpi_ns_root_initialize (void)
 			case ACPI_TYPE_MUTEX:
 
 				obj_desc->mutex.node = new_node;
-				obj_desc->mutex.sync_level = (u8) ACPI_STRTOUL
-						  (val, NULL, 10);
+				obj_desc->mutex.sync_level = (u8) (ACPI_TO_INTEGER (val) - 1);
 
 				if (ACPI_STRCMP (init_val->name, "_GL_") == 0) {
 					/*
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsalloc.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsalloc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsalloc.c	2005-01-22 02:48:14.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsalloc.c	2005-02-01 16:06:26.856730749 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsdump.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsdump.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsdump.c	2005-01-22 02:48:57.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsdump.c	2005-02-01 16:06:26.857730593 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsdumpdv.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsdumpdv.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsdumpdv.c	2005-01-22 02:46:42.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsdumpdv.c	2005-02-01 16:06:26.858730437 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nseval.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nseval.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nseval.c	2005-01-22 02:47:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nseval.c	2005-02-01 16:06:26.859730281 +0100
@@ -6,7 +6,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsinit.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsinit.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsinit.c	2005-01-22 02:47:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsinit.c	2005-02-01 16:06:26.860730126 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -420,6 +420,12 @@ acpi_ns_init_one_device (
 		status = AE_OK;
 	}
 	else {
+		/* Delete any return object (especially if implicit_return is enabled) */
+
+		if (pinfo.return_object) {
+			acpi_ut_remove_reference (pinfo.return_object);
+		}
+
 		/* Count of successful INIs */
 
 		info->num_INI++;
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsload.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsload.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsload.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsload.c	2005-02-01 16:06:26.861729970 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsnames.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsnames.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsnames.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsnames.c	2005-02-01 16:06:26.862729814 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsobject.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsobject.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsobject.c	2005-01-22 02:47:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsobject.c	2005-02-01 16:06:26.864729502 +0100
@@ -6,7 +6,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsparse.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsparse.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsparse.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsparse.c	2005-02-01 16:06:26.864729502 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nssearch.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nssearch.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nssearch.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nssearch.c	2005-02-01 16:06:26.865729346 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsutils.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsutils.c	2005-01-22 02:48:03.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsutils.c	2005-02-01 16:06:26.867729035 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nswalk.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nswalk.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nswalk.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nswalk.c	2005-02-01 16:06:26.869728723 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfeval.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfeval.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfeval.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfeval.c	2005-02-01 16:06:26.870728567 +0100
@@ -6,7 +6,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfname.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfname.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfname.c	2005-01-22 02:49:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfname.c	2005-02-01 16:06:26.871728411 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfobj.c linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfobj.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/namespace/nsxfobj.c	2005-01-22 02:46:40.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/namespace/nsxfobj.c	2005-02-01 16:06:26.872728255 +0100
@@ -6,7 +6,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psargs.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psargs.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psargs.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psargs.c	2005-02-01 16:06:26.874727944 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psopcode.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psopcode.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psopcode.c	2005-01-22 02:47:17.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psopcode.c	2005-02-01 16:06:26.876727632 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -322,7 +322,7 @@
 #define ARGI_SLEEP_OP                   ARGI_LIST1 (ARGI_INTEGER)
 #define ARGI_STALL_OP                   ARGI_LIST1 (ARGI_INTEGER)
 #define ARGI_STATICSTRING_OP            ARGI_INVALID_OPCODE
-#define ARGI_STORE_OP                   ARGI_LIST2 (ARGI_ANYTYPE,    ARGI_TARGETREF)
+#define ARGI_STORE_OP                   ARGI_LIST2 (ARGI_DATAREFOBJ, ARGI_TARGETREF)
 #define ARGI_STRING_OP                  ARGI_INVALID_OPCODE
 #define ARGI_SUBTRACT_OP                ARGI_LIST3 (ARGI_INTEGER,    ARGI_INTEGER,       ARGI_TARGETREF)
 #define ARGI_THERMAL_ZONE_OP            ARGI_INVALID_OPCODE
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psparse.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psparse.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psparse.c	2005-01-22 02:47:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psparse.c	2005-02-01 16:06:26.879727164 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psscope.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psscope.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psscope.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psscope.c	2005-02-01 16:06:26.880727009 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/pstree.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/pstree.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/pstree.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/pstree.c	2005-02-01 16:06:26.881726853 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psutils.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psutils.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psutils.c	2005-02-01 16:06:26.882726697 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -208,6 +208,7 @@ acpi_ps_free_op (
 }
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 /*******************************************************************************
  *
  * FUNCTION:    acpi_ps_delete_parse_cache
@@ -231,6 +232,7 @@ acpi_ps_delete_parse_cache (
 	acpi_ut_delete_generic_cache (ACPI_MEM_LIST_PSNODE_EXT);
 	return_VOID;
 }
+#endif
 
 
 /*******************************************************************************
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/pswalk.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/pswalk.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/pswalk.c	2005-01-22 02:48:34.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/pswalk.c	2005-02-01 16:06:26.883726541 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/parser/psxface.c linux-2.6.11-rc2-bk10/drivers/acpi/parser/psxface.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/parser/psxface.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/parser/psxface.c	2005-02-01 16:06:26.884726385 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/pci_bind.c linux-2.6.11-rc2-bk10/drivers/acpi/pci_bind.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/pci_bind.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/pci_bind.c	2005-02-01 16:06:26.885726229 +0100
@@ -276,17 +276,25 @@ int acpi_pci_unbind(
 	int                     result = 0;
 	acpi_status             status = AE_OK;
 	struct acpi_pci_data    *data = NULL;
-	char                    pathname[ACPI_PATHNAME_MAX] = {0};
-	struct acpi_buffer      buffer = {ACPI_PATHNAME_MAX, pathname};
+	char                    *pathname = NULL;
+	struct acpi_buffer      buffer = {0, NULL};
 
 	ACPI_FUNCTION_TRACE("acpi_pci_unbind");
 
 	if (!device || !device->parent)
 		return_VALUE(-EINVAL);
 
+	pathname = (char *) kmalloc(ACPI_PATHNAME_MAX, GFP_KERNEL);
+	if(!pathname)
+		return_VALUE(-ENOMEM);
+	memset(pathname, 0, ACPI_PATHNAME_MAX);
+
+	buffer.length = ACPI_PATHNAME_MAX;
+	buffer.pointer = pathname;
 	acpi_get_name(device->handle, ACPI_FULL_PATHNAME, &buffer);
 	ACPI_DEBUG_PRINT((ACPI_DB_INFO, "Unbinding PCI device [%s]...\n",
 		pathname));
+	kfree(pathname);
 
 	status = acpi_get_data(device->handle, acpi_pci_data_handler, (void**)&data);
 	if (ACPI_FAILURE(status)) {
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/processor_idle.c linux-2.6.11-rc2-bk10/drivers/acpi/processor_idle.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/processor_idle.c	2005-01-22 02:48:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/processor_idle.c	2005-02-01 16:06:26.887725918 +0100
@@ -60,6 +60,15 @@ module_param(max_cstate, uint, 0644);
 static unsigned int nocst = 0;
 module_param(nocst, uint, 0000);
 
+/*
+ * bm_history -- bit-mask with a bit per jiffy of bus-master activity
+ * 1000 HZ: 0xFFFFFFFF: 32 jiffies = 32ms
+ * 800 HZ: 0xFFFFFFFF: 32 jiffies = 40ms
+ * 100 HZ: 0x0000000F: 4 jiffies = 40ms
+ * reduce history for more aggressive entry into C3
+ */
+static unsigned int bm_history = (HZ >= 800 ? 0xFFFFFFFF : ((1U << (HZ / 25)) - 1));
+module_param(bm_history, uint, 0644);
 /* --------------------------------------------------------------------------
                                 Power Management
    -------------------------------------------------------------------------- */
@@ -193,8 +202,18 @@ static void acpi_processor_idle (void)
 	 */
 	if (pr->flags.bm_check) {
 		u32		bm_status = 0;
+		unsigned long	diff = jiffies - pr->power.bm_check_timestamp;
+
+		if (diff > 32)
+			diff = 32;
 
-		pr->power.bm_activity <<= 1;
+		while (diff) {
+			/* if we didn't get called, assume there was busmaster activity */
+			diff--;
+			if (diff)
+				pr->power.bm_activity |= 0x1;
+			pr->power.bm_activity <<= 1;
+		}
 
 		acpi_get_register(ACPI_BITREG_BUS_MASTER_STATUS,
 			&bm_status, ACPI_MTX_DO_NOT_LOCK);
@@ -213,6 +232,9 @@ static void acpi_processor_idle (void)
 				|| (inb_p(errata.piix4.bmisx + 0x0A) & 0x01))
 				pr->power.bm_activity++;
 		}
+
+		pr->power.bm_check_timestamp = jiffies;
+
 		/*
 		 * Apply bus mastering demotion policy.  Automatically demote
 		 * to avoid a faulty transition.  Note that the processor
@@ -425,7 +447,7 @@ acpi_processor_set_power_policy (
 			cx->demotion.threshold.ticks = cx->latency_ticks;
 			cx->demotion.threshold.count = 1;
 			if (cx->type == ACPI_STATE_C3)
-				cx->demotion.threshold.bm = 0x0F;
+				cx->demotion.threshold.bm = bm_history;
 		}
 
 		lower = cx;
@@ -445,7 +467,7 @@ acpi_processor_set_power_policy (
 			else
 				cx->promotion.threshold.count = 10;
 			if (higher->type == ACPI_STATE_C3)
-				cx->promotion.threshold.bm = 0x0F;
+				cx->promotion.threshold.bm = bm_history;
 		}
 
 		higher = cx;
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsaddr.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsaddr.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsaddr.c	2005-01-22 02:48:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsaddr.c	2005-02-01 16:06:26.889725606 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rscalc.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rscalc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rscalc.c	2005-01-22 02:48:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rscalc.c	2005-02-01 16:06:26.891725294 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rscreate.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rscreate.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rscreate.c	2005-01-22 02:47:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rscreate.c	2005-02-01 16:06:26.892725138 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsdump.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsdump.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsdump.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsdump.c	2005-02-01 16:06:26.894724827 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsio.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsio.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsio.c	2005-01-22 02:46:41.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsio.c	2005-02-01 16:06:26.896724515 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsirq.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsirq.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsirq.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsirq.c	2005-02-01 16:06:26.897724359 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rslist.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rslist.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rslist.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rslist.c	2005-02-01 16:06:26.898724203 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsmemory.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsmemory.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsmemory.c	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsmemory.c	2005-02-01 16:06:26.900723892 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsmisc.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsmisc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsmisc.c	2005-01-22 02:47:31.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsmisc.c	2005-02-01 16:06:26.901723736 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsutils.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsutils.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsutils.c	2005-02-01 16:06:26.902723580 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -339,6 +339,13 @@ acpi_rs_set_srs_method_data (
 	 * Execute the method, no return value
 	 */
 	status = acpi_ns_evaluate_relative ("_SRS", &info);
+	if (ACPI_SUCCESS (status)) {
+		/* Delete any return object (especially if implicit_return is enabled) */
+
+		if (info.return_object) {
+			acpi_ut_remove_reference (info.return_object);
+		}
+	}
 
 	/*
 	 * Clean up and return the status from acpi_ns_evaluate_relative
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsxface.c linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsxface.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/resources/rsxface.c	2005-01-22 02:48:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/resources/rsxface.c	2005-02-01 16:06:26.903723424 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbconvrt.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbconvrt.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbconvrt.c	2005-01-22 02:47:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbconvrt.c	2005-02-01 16:06:26.905723112 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbget.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbget.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbget.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbget.c	2005-02-01 16:06:26.906722956 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbgetall.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbgetall.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbgetall.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbgetall.c	2005-02-01 16:06:26.907722801 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbinstal.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbinstal.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbinstal.c	2005-01-22 02:47:30.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbinstal.c	2005-02-01 16:06:26.908722645 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbrsdt.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbrsdt.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbrsdt.c	2005-01-22 02:48:27.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbrsdt.c	2005-02-01 16:06:26.909722489 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbutils.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbutils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbutils.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbutils.c	2005-02-01 16:06:26.910722333 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbxface.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbxface.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbxface.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbxface.c	2005-02-01 16:06:26.912722021 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbxfroot.c linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbxfroot.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/tables/tbxfroot.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/tables/tbxfroot.c	2005-02-01 16:06:26.914721710 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -114,8 +114,10 @@ acpi_tb_find_table (
 
 	/* Check oem_id and oem_table_id */
 
-	if ((oem_id[0]     && ACPI_STRCMP (oem_id, table->oem_id)) ||
-		(oem_table_id[0] && ACPI_STRCMP (oem_table_id, table->oem_table_id))) {
+	if ((oem_id[0]     && ACPI_STRNCMP (
+			 oem_id, table->oem_id, sizeof (table->oem_id))) ||
+		(oem_table_id[0] && ACPI_STRNCMP (
+				   oem_table_id, table->oem_table_id, sizeof (table->oem_table_id)))) {
 		return_ACPI_STATUS (AE_AML_NAME_NOT_FOUND);
 	}
 
@@ -358,7 +360,8 @@ acpi_find_root_pointer (
 
 	status = acpi_tb_find_rsdp (&table_info, flags);
 	if (ACPI_FAILURE (status)) {
-		ACPI_DEBUG_PRINT ((ACPI_DB_ERROR, "RSDP structure not found, %s Flags=%X\n",
+		ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+			"RSDP structure not found, %s Flags=%X\n",
 			acpi_format_exception (status), flags));
 		return_ACPI_STATUS (AE_NO_ACPI_TABLES);
 	}
@@ -411,7 +414,7 @@ acpi_tb_scan_memory_for_rsdp (
 
 		/* Signature matches, check the appropriate checksum */
 
-		if (((struct rsdp_descriptor *) mem_rover)->revision < 2) {
+		if ((ACPI_CAST_PTR (struct rsdp_descriptor, mem_rover))->revision < 2) {
 			/* ACPI version 1.0 */
 
 			checksum = acpi_tb_checksum (mem_rover, ACPI_RSDP_CHECKSUM_LENGTH);
@@ -490,7 +493,8 @@ acpi_tb_find_rsdp (
 				  ACPI_EBDA_PTR_LENGTH,
 				  (void *) &table_ptr);
 		if (ACPI_FAILURE (status)) {
-			ACPI_DEBUG_PRINT ((ACPI_DB_ERROR, "Could not map memory at %8.8X for length %X\n",
+			ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+				"Could not map memory at %8.8X for length %X\n",
 				ACPI_EBDA_PTR_LOCATION, ACPI_EBDA_PTR_LENGTH));
 			return_ACPI_STATUS (status);
 		}
@@ -509,7 +513,8 @@ acpi_tb_find_rsdp (
 					  ACPI_EBDA_WINDOW_SIZE,
 					  (void *) &table_ptr);
 			if (ACPI_FAILURE (status)) {
-				ACPI_DEBUG_PRINT ((ACPI_DB_ERROR, "Could not map memory at %8.8X for length %X\n",
+				ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+					"Could not map memory at %8.8X for length %X\n",
 					physical_address, ACPI_EBDA_WINDOW_SIZE));
 				return_ACPI_STATUS (status);
 			}
@@ -534,7 +539,8 @@ acpi_tb_find_rsdp (
 				  ACPI_HI_RSDP_WINDOW_SIZE,
 				  (void *) &table_ptr);
 		if (ACPI_FAILURE (status)) {
-			ACPI_DEBUG_PRINT ((ACPI_DB_ERROR, "Could not map memory at %8.8X for length %X\n",
+			ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+				"Could not map memory at %8.8X for length %X\n",
 				ACPI_HI_RSDP_WINDOW_BASE, ACPI_HI_RSDP_WINDOW_SIZE));
 			return_ACPI_STATUS (status);
 		}
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utalloc.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utalloc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utalloc.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utalloc.c	2005-02-01 16:06:26.916721398 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -73,9 +73,12 @@ acpi_ut_release_to_cache (
 	ACPI_FUNCTION_ENTRY ();
 
 
+	cache_info = &acpi_gbl_memory_lists[list_id];
+
+#ifdef ACPI_ENABLE_OBJECT_CACHE
+
 	/* If walk cache is full, just free this wallkstate object */
 
-	cache_info = &acpi_gbl_memory_lists[list_id];
 	if (cache_info->cache_depth >= cache_info->max_cache_depth) {
 		ACPI_MEM_FREE (object);
 		ACPI_MEM_TRACKING (cache_info->total_freed++);
@@ -101,6 +104,14 @@ acpi_ut_release_to_cache (
 
 		(void) acpi_ut_release_mutex (ACPI_MTX_CACHES);
 	}
+
+#else
+
+	/* Object cache is disabled; just free the object */
+
+	ACPI_MEM_FREE (object);
+	ACPI_MEM_TRACKING (cache_info->total_freed++);
+#endif
 }
 
 
@@ -130,6 +141,9 @@ acpi_ut_acquire_from_cache (
 
 
 	cache_info = &acpi_gbl_memory_lists[list_id];
+
+#ifdef ACPI_ENABLE_OBJECT_CACHE
+
 	if (ACPI_FAILURE (acpi_ut_acquire_mutex (ACPI_MTX_CACHES))) {
 		return (NULL);
 	}
@@ -174,10 +188,19 @@ acpi_ut_acquire_from_cache (
 		ACPI_MEM_TRACKING (cache_info->total_allocated++);
 	}
 
+#else
+
+	/* Object cache is disabled; just allocate the object */
+
+	object = ACPI_MEM_CALLOCATE (cache_info->object_size);
+	ACPI_MEM_TRACKING (cache_info->total_allocated++);
+#endif
+
 	return (object);
 }
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 /******************************************************************************
  *
  * FUNCTION:    acpi_ut_delete_generic_cache
@@ -212,6 +235,7 @@ acpi_ut_delete_generic_cache (
 		cache_info->cache_depth--;
 	}
 }
+#endif
 
 
 /*******************************************************************************
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utcopy.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utcopy.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utcopy.c	2005-01-22 02:47:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utcopy.c	2005-02-01 16:06:26.918721086 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utdebug.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utdebug.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utdebug.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utdebug.c	2005-02-01 16:06:26.920720774 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utdelete.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utdelete.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utdelete.c	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utdelete.c	2005-02-01 16:06:26.921720619 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/uteval.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/uteval.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/uteval.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/uteval.c	2005-02-01 16:06:26.923720307 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -198,6 +198,17 @@ acpi_ut_evaluate_object (
 		break;
 	}
 
+	if ((acpi_gbl_enable_interpreter_slack) &&
+		(!expected_return_btypes)) {
+		/*
+		 * We received a return object, but one was not expected.  This can
+		 * happen frequently if the "implicit return" feature is enabled.
+		 * Just delete the return object and return AE_OK.
+		 */
+		acpi_ut_remove_reference (info.return_object);
+		return_ACPI_STATUS (AE_OK);
+	}
+
 	/* Is the return object one of the expected types? */
 
 	if (!(expected_return_btypes & return_btype)) {
@@ -205,8 +216,9 @@ acpi_ut_evaluate_object (
 			prefix_node, path, AE_TYPE);
 
 		ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
-			"Type returned from %s was incorrect: %X\n",
-			path, ACPI_GET_OBJECT_TYPE (info.return_object)));
+			"Type returned from %s was incorrect: %s, expected Btypes: %X\n",
+			path, acpi_ut_get_object_type_name (info.return_object),
+			expected_return_btypes));
 
 		/* On error exit, we must delete the return object */
 
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utglobal.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utglobal.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utglobal.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utglobal.c	2005-02-01 16:06:26.925719995 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -219,6 +219,8 @@ const char                          *acp
  * NOTES:
  * 1) _SB_ is defined to be a device to allow \_SB_._INI to be run
  *    during the initialization sequence.
+ * 2) _TZ_ is defined to be a thermal zone in order to allow ASL code to
+ *    perform a Notify() operation on it.
  */
 const struct acpi_predefined_names      acpi_gbl_pre_defined_names[] =
 { {"_GPE",    ACPI_TYPE_LOCAL_SCOPE,      NULL},
@@ -226,12 +228,12 @@ const struct acpi_predefined_names      
 	{"_SB_",    ACPI_TYPE_DEVICE,           NULL},
 	{"_SI_",    ACPI_TYPE_LOCAL_SCOPE,      NULL},
 	{"_TZ_",    ACPI_TYPE_THERMAL,          NULL},
-	{"_REV",    ACPI_TYPE_INTEGER,          "2"},
+	{"_REV",    ACPI_TYPE_INTEGER,          (char *) ACPI_CA_SUPPORT_LEVEL},
 	{"_OS_",    ACPI_TYPE_STRING,           ACPI_OS_NAME},
-	{"_GL_",    ACPI_TYPE_MUTEX,            "0"},
+	{"_GL_",    ACPI_TYPE_MUTEX,            (char *) 1},
 
 #if !defined (ACPI_NO_METHOD_EXECUTION) || defined (ACPI_CONSTANT_EVAL_ONLY)
-	{"_OSI",    ACPI_TYPE_METHOD,           "1"},
+	{"_OSI",    ACPI_TYPE_METHOD,           (char *) 1},
 #endif
 	{NULL,      ACPI_TYPE_ANY,              NULL}              /* Table terminator */
 };
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utinit.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utinit.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utinit.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utinit.c	2005-02-01 16:06:26.926719839 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utmath.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utmath.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utmath.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utmath.c	2005-02-01 16:06:26.927719684 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utmisc.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utmisc.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utmisc.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utmisc.c	2005-02-01 16:06:26.931719060 +0100
@@ -5,7 +5,7 @@
  ******************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -422,6 +422,12 @@ acpi_ut_strtoul64 (
 		string++;
 	}
 
+	/* Any string left? */
+
+	if (!(*string)) {
+		goto error_exit;
+	}
+
 	/* Main loop: convert the string to a 64-bit integer */
 
 	while (*string) {
@@ -672,7 +678,6 @@ acpi_ut_acquire_mutex (
 	acpi_mutex_handle               mutex_id)
 {
 	acpi_status                     status;
-	u32                             i;
 	u32                             this_thread_id;
 
 
@@ -685,30 +690,37 @@ acpi_ut_acquire_mutex (
 
 	this_thread_id = acpi_os_get_thread_id ();
 
-	/*
-	 * Deadlock prevention.  Check if this thread owns any mutexes of value
-	 * greater than or equal to this one.  If so, the thread has violated
-	 * the mutex ordering rule.  This indicates a coding error somewhere in
-	 * the ACPI subsystem code.
-	 */
-	for (i = mutex_id; i < MAX_MUTEX; i++) {
-		if (acpi_gbl_mutex_info[i].owner_id == this_thread_id) {
-			if (i == mutex_id) {
-				ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
-						"Mutex [%s] already acquired by this thread [%X]\n",
-						acpi_ut_get_mutex_name (mutex_id), this_thread_id));
+#ifdef ACPI_MUTEX_DEBUG
+	{
+		u32                             i;
+		/*
+		 * Mutex debug code, for internal debugging only.
+		 *
+		 * Deadlock prevention.  Check if this thread owns any mutexes of value
+		 * greater than or equal to this one.  If so, the thread has violated
+		 * the mutex ordering rule.  This indicates a coding error somewhere in
+		 * the ACPI subsystem code.
+		 */
+		for (i = mutex_id; i < MAX_MUTEX; i++) {
+			if (acpi_gbl_mutex_info[i].owner_id == this_thread_id) {
+				if (i == mutex_id) {
+					ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+							"Mutex [%s] already acquired by this thread [%X]\n",
+							acpi_ut_get_mutex_name (mutex_id), this_thread_id));
 
-				return (AE_ALREADY_ACQUIRED);
-			}
+					return (AE_ALREADY_ACQUIRED);
+				}
 
-			ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
-					"Invalid acquire order: Thread %X owns [%s], wants [%s]\n",
-					this_thread_id, acpi_ut_get_mutex_name (i),
-					acpi_ut_get_mutex_name (mutex_id)));
+				ACPI_DEBUG_PRINT ((ACPI_DB_ERROR,
+						"Invalid acquire order: Thread %X owns [%s], wants [%s]\n",
+						this_thread_id, acpi_ut_get_mutex_name (i),
+						acpi_ut_get_mutex_name (mutex_id)));
 
-			return (AE_ACQUIRE_DEADLOCK);
+				return (AE_ACQUIRE_DEADLOCK);
+			}
 		}
 	}
+#endif
 
 	ACPI_DEBUG_PRINT ((ACPI_DB_MUTEX,
 			 "Thread %X attempting to acquire Mutex [%s]\n",
@@ -872,7 +884,7 @@ acpi_ut_create_update_state_and_push (
  * DESCRIPTION: Create a new state and push it
  *
  ******************************************************************************/
-
+#ifdef ACPI_FUTURE_USAGE
 acpi_status
 acpi_ut_create_pkg_state_and_push (
 	void                            *internal_object,
@@ -894,7 +906,7 @@ acpi_ut_create_pkg_state_and_push (
 	acpi_ut_push_generic_state (state_list, state);
 	return (AE_OK);
 }
-
+#endif  /*  ACPI_FUTURE_USAGE  */
 
 /*******************************************************************************
  *
@@ -1187,6 +1199,7 @@ acpi_ut_delete_generic_state (
 }
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 /*******************************************************************************
  *
  * FUNCTION:    acpi_ut_delete_generic_state_cache
@@ -1210,6 +1223,7 @@ acpi_ut_delete_generic_state_cache (
 	acpi_ut_delete_generic_cache (ACPI_MEM_LIST_STATE);
 	return_VOID;
 }
+#endif
 
 
 /*******************************************************************************
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utobject.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utobject.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utobject.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utobject.c	2005-02-01 16:06:26.933718748 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -368,6 +368,7 @@ acpi_ut_delete_object_desc (
 }
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 /*******************************************************************************
  *
  * FUNCTION:    acpi_ut_delete_object_cache
@@ -391,6 +392,7 @@ acpi_ut_delete_object_cache (
 	acpi_ut_delete_generic_cache (ACPI_MEM_LIST_OPERAND);
 	return_VOID;
 }
+#endif
 
 
 /*******************************************************************************
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utxface.c linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utxface.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utilities/utxface.c	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utilities/utxface.c	2005-02-01 16:06:26.934718593 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -514,10 +514,12 @@ acpi_purge_cached_objects (void)
 	ACPI_FUNCTION_TRACE ("acpi_purge_cached_objects");
 
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 	acpi_ut_delete_generic_state_cache ();
 	acpi_ut_delete_object_cache ();
 	acpi_ds_delete_walk_state_cache ();
 	acpi_ps_delete_parse_cache ();
+#endif
 
 	return_ACPI_STATUS (AE_OK);
 }
diff -purN linux-2.6.11-rc2-bk9/drivers/acpi/utils.c linux-2.6.11-rc2-bk10/drivers/acpi/utils.c
--- linux-2.6.11-rc2-bk9/drivers/acpi/utils.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/acpi/utils.c	2005-02-01 16:06:26.935718437 +0100
@@ -244,26 +244,34 @@ acpi_evaluate_integer (
 	unsigned long		*data)
 {
 	acpi_status             status = AE_OK;
-	union acpi_object	element;
-	struct acpi_buffer	buffer = {sizeof(union acpi_object), &element};
+	union acpi_object	*element;
+	struct acpi_buffer	buffer = {0,NULL};
 
 	ACPI_FUNCTION_TRACE("acpi_evaluate_integer");
 
 	if (!data)
 		return_ACPI_STATUS(AE_BAD_PARAMETER);
 
+	element = kmalloc(sizeof(union acpi_object), GFP_KERNEL);
+	if(!element)
+		return_ACPI_STATUS(AE_NO_MEMORY);
+
+	memset(element, 0, sizeof(union acpi_object));
+	buffer.length = sizeof(union acpi_object);
+	buffer.pointer = element;
 	status = acpi_evaluate_object(handle, pathname, arguments, &buffer);
 	if (ACPI_FAILURE(status)) {
 		acpi_util_eval_error(handle, pathname, status);
 		return_ACPI_STATUS(status);
 	}
 
-	if (element.type != ACPI_TYPE_INTEGER) {
+	if (element->type != ACPI_TYPE_INTEGER) {
 		acpi_util_eval_error(handle, pathname, AE_BAD_DATA);
 		return_ACPI_STATUS(AE_BAD_DATA);
 	}
 
-	*data = element.integer.value;
+	*data = element->integer.value;
+	kfree(element);
 
 	ACPI_DEBUG_PRINT((ACPI_DB_INFO, "Return value [%lu]\n", *data));
 
diff -purN linux-2.6.11-rc2-bk9/drivers/atm/fore200e.c linux-2.6.11-rc2-bk10/drivers/atm/fore200e.c
--- linux-2.6.11-rc2-bk9/drivers/atm/fore200e.c	2005-01-22 02:49:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/atm/fore200e.c	2005-02-01 16:06:26.940717657 +0100
@@ -1779,7 +1779,7 @@ fore200e_send(struct atm_vcc *vcc, struc
 
 	    /* retry once again? */
 	    if (--retry > 0) {
-		schedule();
+		udelay(50);
 		goto retry_here;
 	    }
 
diff -purN linux-2.6.11-rc2-bk9/drivers/atm/he.c linux-2.6.11-rc2-bk10/drivers/atm/he.c
--- linux-2.6.11-rc2-bk9/drivers/atm/he.c	2005-01-22 02:47:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/atm/he.c	2005-02-01 16:06:26.945716878 +0100
@@ -2575,8 +2575,8 @@ he_close(struct atm_vcc *vcc)
 			udelay(250);
 		}
 
-		add_wait_queue(&he_vcc->rx_waitq, &wait);
 		set_current_state(TASK_UNINTERRUPTIBLE);
+		add_wait_queue(&he_vcc->rx_waitq, &wait);
 
 		he_writel_rsr0(he_dev, RSR0_CLOSE_CONN, cid);
 		(void) he_readl_rsr0(he_dev, cid);		/* flush posted writes */
@@ -2650,8 +2650,8 @@ he_close(struct atm_vcc *vcc)
 		tpd->vcc = vcc;
 		wmb();
 
-		add_wait_queue(&he_vcc->tx_waitq, &wait);
 		set_current_state(TASK_UNINTERRUPTIBLE);
+		add_wait_queue(&he_vcc->tx_waitq, &wait);
 		__enqueue_tpd(he_dev, tpd, cid);
 		spin_unlock_irqrestore(&he_dev->global_lock, flags);
 
diff -purN linux-2.6.11-rc2-bk9/drivers/atm/nicstar.c linux-2.6.11-rc2-bk10/drivers/atm/nicstar.c
--- linux-2.6.11-rc2-bk9/drivers/atm/nicstar.c	2005-01-22 02:47:30.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/atm/nicstar.c	2005-02-01 16:06:26.950716099 +0100
@@ -54,7 +54,6 @@
 #include <asm/uaccess.h>
 #include <asm/atomic.h>
 #include "nicstar.h"
-#include "nicstarmac.h"
 #ifdef CONFIG_ATM_NICSTAR_USE_SUNI
 #include "suni.h"
 #endif /* CONFIG_ATM_NICSTAR_USE_SUNI */
diff -purN linux-2.6.11-rc2-bk9/drivers/atm/nicstarmac.c linux-2.6.11-rc2-bk10/drivers/atm/nicstarmac.c
--- linux-2.6.11-rc2-bk9/drivers/atm/nicstarmac.c	2005-01-22 02:49:17.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/atm/nicstarmac.c	2005-02-01 16:06:26.951715943 +0100
@@ -7,6 +7,8 @@
  * Read this ForeRunner's MAC address from eprom/eeprom
  */
 
+typedef void __iomem *virt_addr_t;
+
 #define CYCLE_DELAY 5
 
 /* This was the original definition
@@ -213,7 +215,7 @@ read_eprom_byte(virt_addr_t base, u_int8
 }
 
 
-void
+static void
 nicstar_init_eprom( virt_addr_t base )
 {
     u_int32_t val;
@@ -246,7 +248,7 @@ nicstar_init_eprom( virt_addr_t base )
  * above.
  */ 
 
-void
+static void
 nicstar_read_eprom(
     virt_addr_t	base,
     u_int8_t	prom_offset,
diff -purN linux-2.6.11-rc2-bk9/drivers/atm/nicstarmac.h linux-2.6.11-rc2-bk10/drivers/atm/nicstarmac.h
--- linux-2.6.11-rc2-bk9/drivers/atm/nicstarmac.h	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/atm/nicstarmac.h	1970-01-01 01:00:00.000000000 +0100
@@ -1,13 +0,0 @@
-/******************************************************************************
- *
- * nicstarmac.h
- *
- * Header file for nicstarmac.c
- *
- ******************************************************************************/
-
-
-typedef void __iomem *virt_addr_t;
-
-void nicstar_init_eprom( virt_addr_t base );
-void nicstar_read_eprom( virt_addr_t, u_int8_t, u_int8_t *, u_int32_t);
diff -purN linux-2.6.11-rc2-bk9/drivers/bluetooth/hci_usb.c linux-2.6.11-rc2-bk10/drivers/bluetooth/hci_usb.c
--- linux-2.6.11-rc2-bk9/drivers/bluetooth/hci_usb.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/bluetooth/hci_usb.c	2005-02-01 16:06:26.972712670 +0100
@@ -113,12 +113,15 @@ static struct usb_device_id blacklist_id
 	/* ISSC Bluetooth Adapter v3.1 */
 	{ USB_DEVICE(0x1131, 0x1001), .driver_info = HCI_RESET },
 
+	/* RTX Telecom based adapter with buggy SCO support */
+	{ USB_DEVICE(0x0400, 0x0807), .driver_info = HCI_BROKEN_ISOC },
+
 	/* Digianswer devices */
 	{ USB_DEVICE(0x08fd, 0x0001), .driver_info = HCI_DIGIANSWER },
 	{ USB_DEVICE(0x08fd, 0x0002), .driver_info = HCI_IGNORE },
 
-	/* RTX Telecom based adapter with buggy SCO support */
-	{ USB_DEVICE(0x0400, 0x0807), .driver_info = HCI_BROKEN_ISOC },
+	/* CSR BlueCore Bluetooth Sniffer */
+	{ USB_DEVICE(0x0a12, 0x0002), .driver_info = HCI_SNIFFER },
 
 	{ }	/* Terminating entry */
 };
@@ -969,6 +972,11 @@ static int hci_usb_probe(struct usb_inte
 	if (reset || id->driver_info & HCI_RESET)
 		set_bit(HCI_QUIRK_RESET_ON_INIT, &hdev->quirks);
 
+	if (id->driver_info & HCI_SNIFFER) {
+		if (le16_to_cpu(udev->descriptor.bcdDevice) > 0x997)
+			set_bit(HCI_QUIRK_RAW_DEVICE, &hdev->quirks);
+	}
+
 	if (hci_register_dev(hdev) < 0) {
 		BT_ERR("Can't register HCI device");
 		hci_free_dev(hdev);
diff -purN linux-2.6.11-rc2-bk9/drivers/bluetooth/hci_usb.h linux-2.6.11-rc2-bk10/drivers/bluetooth/hci_usb.h
--- linux-2.6.11-rc2-bk9/drivers/bluetooth/hci_usb.h	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/bluetooth/hci_usb.h	2005-02-01 16:06:26.973712514 +0100
@@ -31,7 +31,8 @@
 #define HCI_IGNORE		0x01
 #define HCI_RESET		0x02
 #define HCI_DIGIANSWER		0x04
-#define HCI_BROKEN_ISOC		0x08
+#define HCI_SNIFFER		0x08
+#define HCI_BROKEN_ISOC		0x10
 
 #define HCI_MAX_IFACE_NUM	3
 
diff -purN linux-2.6.11-rc2-bk9/drivers/net/tg3.c linux-2.6.11-rc2-bk10/drivers/net/tg3.c
--- linux-2.6.11-rc2-bk9/drivers/net/tg3.c	2005-02-01 16:06:19.544802750 +0100
+++ linux-2.6.11-rc2-bk10/drivers/net/tg3.c	2005-02-01 16:06:27.386778673 +0100
@@ -60,8 +60,8 @@
 
 #define DRV_MODULE_NAME		"tg3"
 #define PFX DRV_MODULE_NAME	": "
-#define DRV_MODULE_VERSION	"3.18"
-#define DRV_MODULE_RELDATE	"January 24, 2005"
+#define DRV_MODULE_VERSION	"3.19"
+#define DRV_MODULE_RELDATE	"January 26, 2005"
 
 #define TG3_DEF_MAC_MODE	0
 #define TG3_DEF_RX_MODE		0
@@ -4866,9 +4866,8 @@ static void __tg3_set_mac_addr(struct tg
 		tw32(MAC_ADDR_0_LOW + (i * 8), addr_low);
 	}
 
-	if (GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5700 &&
-	    GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5701 &&
-	    GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5705) {
+	if (GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5703 ||
+	    GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5704) {
 		for (i = 0; i < 12; i++) {
 			tw32(MAC_EXTADDR_0_HIGH + (i * 8), addr_high);
 			tw32(MAC_EXTADDR_0_LOW + (i * 8), addr_low);
@@ -4914,7 +4913,8 @@ static void tg3_set_bdinfo(struct tg3 *t
 		      (bdinfo_addr + TG3_BDINFO_MAXLEN_FLAGS),
 		       maxlen_flags);
 
-	if (GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5705)
+	if ((GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5705) &&
+	    (GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5750))
 		tg3_write_mem(tp,
 			      (bdinfo_addr + TG3_BDINFO_NIC_ADDR),
 			      nic_addr);
@@ -7577,9 +7577,8 @@ static int __devinit tg3_phy_probe(struc
 		    tp->pdev->subsystem_vendor == PCI_VENDOR_ID_DELL)
 			tp->led_ctrl = LED_CTRL_MODE_PHY_2;
 
-		if (((GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5703) ||
-		     (GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5704) ||
-		     (GET_ASIC_REV(tp->pci_chip_rev_id) == ASIC_REV_5705)) &&
+		if ((GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5700) &&
+		    (GET_ASIC_REV(tp->pci_chip_rev_id) != ASIC_REV_5701) &&
 		    (nic_cfg & NIC_SRAM_DATA_CFG_EEPROM_WP))
 			tp->tg3_flags |= TG3_FLAG_EEPROM_WRITE_PROT;
 
diff -purN linux-2.6.11-rc2-bk9/drivers/pnp/pnpacpi/core.c linux-2.6.11-rc2-bk10/drivers/pnp/pnpacpi/core.c
--- linux-2.6.11-rc2-bk9/drivers/pnp/pnpacpi/core.c	2005-01-22 02:48:01.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/pnp/pnpacpi/core.c	2005-02-01 16:06:27.436770880 +0100
@@ -241,10 +241,11 @@ static acpi_status __init pnpacpi_add_de
 	return AE_OK;
 }
 
+int pnpacpi_disabled __initdata;
 int __init pnpacpi_init(void)
 {
-	if (acpi_disabled) {
-		pnp_info("PnP ACPI: ACPI disable");
+	if (acpi_disabled || pnpacpi_disabled) {
+		pnp_info("PnP ACPI: disabled");
 		return 0;
 	}
 	pnp_info("PnP ACPI init");
@@ -255,4 +256,14 @@ int __init pnpacpi_init(void)
 }
 subsys_initcall(pnpacpi_init);
 
+static int __init pnpacpi_setup(char *str)
+{
+	if (str == NULL)
+		return 1;
+	if (!strncmp(str, "off", 3))
+		pnpacpi_disabled = 1;
+	return 1;
+}
+__setup("pnpacpi=", pnpacpi_setup);
+
 EXPORT_SYMBOL(pnpacpi_protocol);
diff -purN linux-2.6.11-rc2-bk9/drivers/pnp/pnpbios/core.c linux-2.6.11-rc2-bk10/drivers/pnp/pnpbios/core.c
--- linux-2.6.11-rc2-bk9/drivers/pnp/pnpbios/core.c	2005-01-22 02:46:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/drivers/pnp/pnpbios/core.c	2005-02-01 16:06:27.438770569 +0100
@@ -538,10 +538,11 @@ int __init pnpbios_init(void)
 		return -ENODEV;
 	}
 
-#ifdef CONFIG_ACPI
-	if (!acpi_disabled) {
+#ifdef CONFIG_PNPACPI
+	extern int pnpacpi_disabled;
+	if (!acpi_disabled && !pnpacpi_disabled) {
 		pnpbios_disabled = 1;
-		printk(KERN_INFO "PnPBIOS: Disabled by ACPI\n");
+		printk(KERN_INFO "PnPBIOS: Disabled by ACPI PNP\n");
 		return -ENODEV;
 	}
 #endif /* CONFIG_ACPI */
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acconfig.h linux-2.6.11-rc2-bk10/include/acpi/acconfig.h
--- linux-2.6.11-rc2-bk9/include/acpi/acconfig.h	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acconfig.h	2005-02-01 16:06:27.686731918 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -64,7 +64,7 @@
 
 /* Version string */
 
-#define ACPI_CA_VERSION                 0x20041210
+#define ACPI_CA_VERSION                 0x20050125
 
 /*
  * OS name, used for the _OS object.  The _OS object is essentially obsolete,
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acdebug.h linux-2.6.11-rc2-bk10/include/acpi/acdebug.h
--- linux-2.6.11-rc2-bk9/include/acpi/acdebug.h	2005-01-22 02:47:29.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acdebug.h	2005-02-01 16:06:27.688731606 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acdisasm.h linux-2.6.11-rc2-bk10/include/acpi/acdisasm.h
--- linux-2.6.11-rc2-bk9/include/acpi/acdisasm.h	2005-01-22 02:48:16.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acdisasm.h	2005-02-01 16:06:27.689731450 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acdispat.h linux-2.6.11-rc2-bk10/include/acpi/acdispat.h
--- linux-2.6.11-rc2-bk9/include/acpi/acdispat.h	2005-01-22 02:48:34.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acdispat.h	2005-02-01 16:06:27.690731294 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -484,9 +484,11 @@ struct acpi_walk_state *
 acpi_ds_get_current_walk_state (
 	struct acpi_thread_state        *thread);
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 void
 acpi_ds_delete_walk_state_cache (
 	void);
+#endif
 
 #ifdef ACPI_FUTURE_USAGE
 acpi_status
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acevents.h linux-2.6.11-rc2-bk10/include/acpi/acevents.h
--- linux-2.6.11-rc2-bk9/include/acpi/acevents.h	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acevents.h	2005-02-01 16:06:27.691731139 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acexcep.h linux-2.6.11-rc2-bk10/include/acpi/acexcep.h
--- linux-2.6.11-rc2-bk9/include/acpi/acexcep.h	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acexcep.h	2005-02-01 16:06:27.692730983 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acglobal.h linux-2.6.11-rc2-bk10/include/acpi/acglobal.h
--- linux-2.6.11-rc2-bk9/include/acpi/acglobal.h	2005-01-22 02:46:40.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acglobal.h	2005-02-01 16:06:27.694730671 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -96,6 +96,7 @@ extern      u32                         
  * 1) Allow "implicit return" of last value in a control method
  * 2) Allow access beyond end of operation region
  * 3) Allow access to uninitialized locals/args (auto-init to integer 0)
+ * 4) Allow ANY object type to be a source operand for the Store() operator
  */
 ACPI_EXTERN u8       ACPI_INIT_GLOBAL (acpi_gbl_enable_interpreter_slack, FALSE);
 
diff -purN linux-2.6.11-rc2-bk9/include/acpi/achware.h linux-2.6.11-rc2-bk10/include/acpi/achware.h
--- linux-2.6.11-rc2-bk9/include/acpi/achware.h	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/achware.h	2005-02-01 16:06:27.695730515 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acinterp.h linux-2.6.11-rc2-bk10/include/acpi/acinterp.h
--- linux-2.6.11-rc2-bk9/include/acpi/acinterp.h	2005-01-22 02:48:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acinterp.h	2005-02-01 16:06:27.696730359 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/aclocal.h linux-2.6.11-rc2-bk10/include/acpi/aclocal.h
--- linux-2.6.11-rc2-bk9/include/acpi/aclocal.h	2005-01-22 02:48:26.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/aclocal.h	2005-02-01 16:06:27.698730048 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acmacros.h linux-2.6.11-rc2-bk10/include/acpi/acmacros.h
--- linux-2.6.11-rc2-bk9/include/acpi/acmacros.h	2005-01-22 02:48:19.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acmacros.h	2005-02-01 16:06:27.700729736 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acnamesp.h linux-2.6.11-rc2-bk10/include/acpi/acnamesp.h
--- linux-2.6.11-rc2-bk9/include/acpi/acnamesp.h	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acnamesp.h	2005-02-01 16:06:27.701729580 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acobject.h linux-2.6.11-rc2-bk10/include/acpi/acobject.h
--- linux-2.6.11-rc2-bk9/include/acpi/acobject.h	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acobject.h	2005-02-01 16:06:27.703729268 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acoutput.h linux-2.6.11-rc2-bk10/include/acpi/acoutput.h
--- linux-2.6.11-rc2-bk9/include/acpi/acoutput.h	2005-01-22 02:47:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acoutput.h	2005-02-01 16:06:27.703729268 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acparser.h linux-2.6.11-rc2-bk10/include/acpi/acparser.h
--- linux-2.6.11-rc2-bk9/include/acpi/acparser.h	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acparser.h	2005-02-01 16:06:27.704729112 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -303,9 +303,11 @@ void
 acpi_ps_free_op (
 	union acpi_parse_object         *op);
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 void
 acpi_ps_delete_parse_cache (
 	void);
+#endif
 
 u8
 acpi_ps_is_leading_char (
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acpi.h linux-2.6.11-rc2-bk10/include/acpi/acpi.h
--- linux-2.6.11-rc2-bk9/include/acpi/acpi.h	2005-01-22 02:48:03.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acpi.h	2005-02-01 16:06:27.705728957 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acpiosxf.h linux-2.6.11-rc2-bk10/include/acpi/acpiosxf.h
--- linux-2.6.11-rc2-bk9/include/acpi/acpiosxf.h	2005-01-22 02:46:47.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acpiosxf.h	2005-02-01 16:06:27.706728801 +0100
@@ -9,7 +9,7 @@
 
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acpixf.h linux-2.6.11-rc2-bk10/include/acpi/acpixf.h
--- linux-2.6.11-rc2-bk9/include/acpi/acpixf.h	2005-01-22 02:46:41.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acpixf.h	2005-02-01 16:06:27.707728645 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acresrc.h linux-2.6.11-rc2-bk10/include/acpi/acresrc.h
--- linux-2.6.11-rc2-bk9/include/acpi/acresrc.h	2005-01-22 02:47:15.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acresrc.h	2005-02-01 16:06:27.709728333 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acstruct.h linux-2.6.11-rc2-bk10/include/acpi/acstruct.h
--- linux-2.6.11-rc2-bk9/include/acpi/acstruct.h	2005-01-22 02:47:14.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acstruct.h	2005-02-01 16:06:27.710728177 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/actables.h linux-2.6.11-rc2-bk10/include/acpi/actables.h
--- linux-2.6.11-rc2-bk9/include/acpi/actables.h	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/actables.h	2005-02-01 16:06:27.710728177 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/actbl.h linux-2.6.11-rc2-bk10/include/acpi/actbl.h
--- linux-2.6.11-rc2-bk9/include/acpi/actbl.h	2005-01-22 02:48:03.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/actbl.h	2005-02-01 16:06:27.712727866 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/actbl1.h linux-2.6.11-rc2-bk10/include/acpi/actbl1.h
--- linux-2.6.11-rc2-bk9/include/acpi/actbl1.h	2005-01-22 02:47:16.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/actbl1.h	2005-02-01 16:06:27.712727866 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/actbl2.h linux-2.6.11-rc2-bk10/include/acpi/actbl2.h
--- linux-2.6.11-rc2-bk9/include/acpi/actbl2.h	2005-01-22 02:48:26.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/actbl2.h	2005-02-01 16:06:27.713727710 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/actypes.h linux-2.6.11-rc2-bk10/include/acpi/actypes.h
--- linux-2.6.11-rc2-bk9/include/acpi/actypes.h	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/actypes.h	2005-02-01 16:06:27.716727242 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/acutils.h linux-2.6.11-rc2-bk10/include/acpi/acutils.h
--- linux-2.6.11-rc2-bk9/include/acpi/acutils.h	2005-01-22 02:46:44.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/acutils.h	2005-02-01 16:06:27.718726931 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -683,6 +683,7 @@ void
 acpi_ut_delete_generic_state (
 	union acpi_generic_state        *state);
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 void
 acpi_ut_delete_generic_state_cache (
 	void);
@@ -690,6 +691,7 @@ acpi_ut_delete_generic_state_cache (
 void
 acpi_ut_delete_object_cache (
 	void);
+#endif
 
 /*
  * utmisc
@@ -778,9 +780,11 @@ acpi_ut_release_to_cache (
 	u32                             list_id,
 	void                            *object);
 
+#ifdef ACPI_ENABLE_OBJECT_CACHE
 void
 acpi_ut_delete_generic_cache (
 	u32                             list_id);
+#endif
 
 acpi_status
 acpi_ut_validate_buffer (
diff -purN linux-2.6.11-rc2-bk9/include/acpi/amlcode.h linux-2.6.11-rc2-bk10/include/acpi/amlcode.h
--- linux-2.6.11-rc2-bk9/include/acpi/amlcode.h	2005-01-22 02:49:22.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/amlcode.h	2005-02-01 16:06:27.719726775 +0100
@@ -7,7 +7,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -278,6 +278,7 @@
 #define ARGI_COMPLEXOBJ             0x13    /* Buffer, String, or package (Used by INDEX op only) */
 #define ARGI_REF_OR_STRING          0x14    /* Reference or String (Used by DEREFOF op only) */
 #define ARGI_REGION_OR_FIELD        0x15    /* Used by LOAD op only */
+#define ARGI_DATAREFOBJ             0x16
 
 /* Note: types above can expand to 0x1F maximum */
 
diff -purN linux-2.6.11-rc2-bk9/include/acpi/amlresrc.h linux-2.6.11-rc2-bk10/include/acpi/amlresrc.h
--- linux-2.6.11-rc2-bk9/include/acpi/amlresrc.h	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/amlresrc.h	2005-02-01 16:06:27.721726463 +0100
@@ -6,7 +6,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/platform/acenv.h linux-2.6.11-rc2-bk10/include/acpi/platform/acenv.h
--- linux-2.6.11-rc2-bk9/include/acpi/platform/acenv.h	2005-01-22 02:47:30.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/platform/acenv.h	2005-02-01 16:06:27.722726307 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
@@ -57,6 +57,7 @@
 #define ACPI_DISASSEMBLER
 #define ACPI_NO_METHOD_EXECUTION
 #define ACPI_USE_SYSTEM_CLIBRARY
+#define ACPI_ENABLE_OBJECT_CACHE
 #endif
 
 #ifdef _ACPI_EXEC_APP
@@ -67,6 +68,7 @@
 #define ACPI_DEBUGGER
 #define ACPI_DISASSEMBLER
 #define ACPI_USE_SYSTEM_CLIBRARY
+#define ACPI_ENABLE_OBJECT_CACHE
 #endif
 
 #ifdef _ACPI_ASL_COMPILER
@@ -75,6 +77,7 @@
 #define ACPI_DISASSEMBLER
 #define ACPI_CONSTANT_EVAL_ONLY
 #define ACPI_USE_SYSTEM_CLIBRARY
+#define ACPI_ENABLE_OBJECT_CACHE
 #endif
 
 /*
diff -purN linux-2.6.11-rc2-bk9/include/acpi/platform/acgcc.h linux-2.6.11-rc2-bk10/include/acpi/platform/acgcc.h
--- linux-2.6.11-rc2-bk9/include/acpi/platform/acgcc.h	2005-01-22 02:49:12.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/platform/acgcc.h	2005-02-01 16:06:27.723726151 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/platform/aclinux.h linux-2.6.11-rc2-bk10/include/acpi/platform/aclinux.h
--- linux-2.6.11-rc2-bk9/include/acpi/platform/aclinux.h	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/platform/aclinux.h	2005-02-01 16:06:27.723726151 +0100
@@ -5,7 +5,7 @@
  *****************************************************************************/
 
 /*
- * Copyright (C) 2000 - 2004, R. Byron Moore
+ * Copyright (C) 2000 - 2005, R. Byron Moore
  * All rights reserved.
  *
  * Redistribution and use in source and binary forms, with or without
diff -purN linux-2.6.11-rc2-bk9/include/acpi/processor.h linux-2.6.11-rc2-bk10/include/acpi/processor.h
--- linux-2.6.11-rc2-bk9/include/acpi/processor.h	2005-01-22 02:47:49.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/acpi/processor.h	2005-02-01 16:06:27.724725995 +0100
@@ -54,6 +54,7 @@ struct acpi_processor_cx {
 
 struct acpi_processor_power {
 	struct acpi_processor_cx *state;
+	unsigned long		bm_check_timestamp;
 	u32			default_state;
 	u32			bm_activity;
 	int			count;
diff -purN linux-2.6.11-rc2-bk9/include/linux/atalk.h linux-2.6.11-rc2-bk10/include/linux/atalk.h
--- linux-2.6.11-rc2-bk9/include/linux/atalk.h	2005-01-22 02:48:45.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/linux/atalk.h	2005-02-01 16:06:27.792715398 +0100
@@ -229,7 +229,7 @@ extern void atalk_unregister_sysctl(void
 extern int atalk_proc_init(void);
 extern void atalk_proc_exit(void);
 #else
-#define atalk_proc_init()	0
+#define atalk_proc_init()	({ 0; })
 #define atalk_proc_exit()	do { } while(0)
 #endif /* CONFIG_PROC_FS */
 
diff -purN linux-2.6.11-rc2-bk9/include/linux/netfilter_ipv4/ip_conntrack.h linux-2.6.11-rc2-bk10/include/linux/netfilter_ipv4/ip_conntrack.h
--- linux-2.6.11-rc2-bk9/include/linux/netfilter_ipv4/ip_conntrack.h	2005-02-01 16:06:19.926743215 +0100
+++ linux-2.6.11-rc2-bk10/include/linux/netfilter_ipv4/ip_conntrack.h	2005-02-01 16:06:27.811712436 +0100
@@ -262,10 +262,9 @@ extern void (*ip_conntrack_destroyed)(st
 /* Fake conntrack entry for untracked connections */
 extern struct ip_conntrack ip_conntrack_untracked;
 
-extern int ip_ct_no_defrag;
 /* Returns new sk_buff, or NULL */
 struct sk_buff *
-ip_ct_gather_frags(struct sk_buff *skb);
+ip_ct_gather_frags(struct sk_buff *skb, u_int32_t user);
 
 /* Iterate over all conntracks: if iter returns true, it's deleted. */
 extern void
diff -purN linux-2.6.11-rc2-bk9/include/net/bluetooth/hci.h linux-2.6.11-rc2-bk10/include/net/bluetooth/hci.h
--- linux-2.6.11-rc2-bk9/include/net/bluetooth/hci.h	2005-01-22 02:48:57.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/net/bluetooth/hci.h	2005-02-01 16:06:27.824710410 +0100
@@ -53,7 +53,8 @@
 
 /* HCI device quirks */
 enum {
-	HCI_QUIRK_RESET_ON_INIT
+	HCI_QUIRK_RESET_ON_INIT,
+	HCI_QUIRK_RAW_DEVICE
 };
 
 /* HCI device flags */
@@ -576,6 +577,13 @@ struct hci_ev_rmt_version {
 	__u16    lmp_subver;
 } __attribute__ ((packed));
 
+#define HCI_EV_CLOCK_OFFSET	0x01C
+struct hci_ev_clock_offset {
+	__u8     status;
+	__u16    handle;
+	__u16    clock_offset;
+} __attribute__ ((packed));
+
 /* Internal events generated by Bluetooth stack */
 #define HCI_EV_STACK_INTERNAL	0xFD
 struct hci_ev_stack_internal {
diff -purN linux-2.6.11-rc2-bk9/include/net/ip.h linux-2.6.11-rc2-bk10/include/net/ip.h
--- linux-2.6.11-rc2-bk9/include/net/ip.h	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/include/net/ip.h	2005-02-01 16:06:27.826710099 +0100
@@ -286,9 +286,20 @@ extern int	ip_call_ra_chain(struct sk_bu
 /*
  *	Functions provided by ip_fragment.o
  */
- 
-struct sk_buff *ip_defrag(struct sk_buff *skb);
-extern void ipfrag_flush(void);
+
+enum ip_defrag_users
+{
+	IP_DEFRAG_LOCAL_DELIVER,
+	IP_DEFRAG_CALL_RA_CHAIN,
+	IP_DEFRAG_CONNTRACK_IN,
+	IP_DEFRAG_CONNTRACK_OUT,
+	IP_DEFRAG_NAT_OUT,
+	IP_DEFRAG_VS_IN,
+	IP_DEFRAG_VS_OUT,
+	IP_DEFRAG_VS_FWD
+};
+
+struct sk_buff *ip_defrag(struct sk_buff *skb, u32 user);
 extern int ip_frag_nqueues;
 extern atomic_t ip_frag_mem;
 
diff -purN linux-2.6.11-rc2-bk9/net/atm/lec.c linux-2.6.11-rc2-bk10/net/atm/lec.c
--- linux-2.6.11-rc2-bk9/net/atm/lec.c	2005-01-22 02:48:26.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/atm/lec.c	2005-02-01 16:06:27.858705111 +0100
@@ -1818,7 +1818,7 @@ lec_arp_expire_arp(unsigned long data)
 static void
 lec_arp_expire_vcc(unsigned long data)
 {
-	unsigned flags;
+	unsigned long flags;
         struct lec_arp_table *to_remove = (struct lec_arp_table*)data;
         struct lec_priv *priv = (struct lec_priv *)to_remove->priv;
         struct lec_arp_table *entry = NULL;
diff -purN linux-2.6.11-rc2-bk9/net/atm/resources.c linux-2.6.11-rc2-bk10/net/atm/resources.c
--- linux-2.6.11-rc2-bk9/net/atm/resources.c	2005-01-22 02:48:58.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/atm/resources.c	2005-02-01 16:06:27.859704956 +0100
@@ -16,6 +16,7 @@
 #include <linux/kernel.h> /* for barrier */
 #include <linux/module.h>
 #include <linux/bitops.h>
+#include <linux/delay.h>
 #include <net/sock.h>	 /* for struct sock */
 
 #include "common.h"
@@ -138,8 +139,7 @@ void atm_dev_deregister(struct atm_dev *
 
         warning_time = jiffies;
         while (atomic_read(&dev->refcnt) != 1) {
-                current->state = TASK_INTERRUPTIBLE;
-                schedule_timeout(HZ / 4);
+                msleep(250);
                 if ((jiffies - warning_time) > 10 * HZ) {
                         printk(KERN_EMERG "atm_dev_deregister: waiting for "
                                "dev %d to become free. Usage count = %d\n",
diff -purN linux-2.6.11-rc2-bk9/net/atm/svc.c linux-2.6.11-rc2-bk10/net/atm/svc.c
--- linux-2.6.11-rc2-bk9/net/atm/svc.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/atm/svc.c	2005-02-01 16:06:27.861704644 +0100
@@ -67,6 +67,7 @@ static void svc_disconnect(struct atm_vc
 	/* beware - socket is still in use by atmsigd until the last
 	   as_indicate has been answered */
 	while ((skb = skb_dequeue(&vcc->sk->sk_receive_queue)) != NULL) {
+		atm_return(vcc, skb->truesize);
 		DPRINTK("LISTEN REL\n");
 		sigd_enq2(NULL,as_reject,vcc,NULL,NULL,&vcc->qos,0);
 		dev_kfree_skb(skb);
diff -purN linux-2.6.11-rc2-bk9/net/bluetooth/hci_conn.c linux-2.6.11-rc2-bk10/net/bluetooth/hci_conn.c
--- linux-2.6.11-rc2-bk9/net/bluetooth/hci_conn.c	2005-01-22 02:49:25.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/bluetooth/hci_conn.c	2005-02-01 16:06:27.864704176 +0100
@@ -226,7 +226,7 @@ struct hci_dev *hci_get_route(bdaddr_t *
 	list_for_each(p, &hci_dev_list) {
 		struct hci_dev *d = list_entry(p, struct hci_dev, list);
 
-		if (!test_bit(HCI_UP, &d->flags))
+		if (!test_bit(HCI_UP, &d->flags) || test_bit(HCI_RAW, &d->flags))
 			continue;
 
 		/* Simple routing: 
diff -purN linux-2.6.11-rc2-bk9/net/bluetooth/hci_core.c linux-2.6.11-rc2-bk10/net/bluetooth/hci_core.c
--- linux-2.6.11-rc2-bk9/net/bluetooth/hci_core.c	2005-01-22 02:47:31.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/bluetooth/hci_core.c	2005-02-01 16:06:27.866703865 +0100
@@ -457,6 +457,9 @@ int hci_dev_open(__u16 dev)
 		goto done;
 	}
 
+	if (test_bit(HCI_QUIRK_RAW_DEVICE, &hdev->quirks))
+		set_bit(HCI_RAW, &hdev->flags);
+
 	if (hdev->open(hdev)) {
 		ret = -EIO;
 		goto done;
@@ -532,9 +535,11 @@ static int hci_dev_do_close(struct hci_d
 	/* Reset device */
 	skb_queue_purge(&hdev->cmd_q);
 	atomic_set(&hdev->cmd_cnt, 1);
-	set_bit(HCI_INIT, &hdev->flags);
-	__hci_request(hdev, hci_reset_req, 0, HZ/4);
-	clear_bit(HCI_INIT, &hdev->flags);
+	if (!test_bit(HCI_RAW, &hdev->flags)) {
+		set_bit(HCI_INIT, &hdev->flags);
+		__hci_request(hdev, hci_reset_req, 0, HZ/4);
+		clear_bit(HCI_INIT, &hdev->flags);
+	}
 
 	/* Kill cmd task */
 	tasklet_kill(&hdev->cmd_task);
@@ -604,7 +609,8 @@ int hci_dev_reset(__u16 dev)
 	atomic_set(&hdev->cmd_cnt, 1); 
 	hdev->acl_cnt = 0; hdev->sco_cnt = 0;
 
-	ret = __hci_request(hdev, hci_reset_req, 0, HCI_INIT_TIMEOUT);
+	if (!test_bit(HCI_RAW, &hdev->flags))
+		ret = __hci_request(hdev, hci_reset_req, 0, HCI_INIT_TIMEOUT);
 
 done:
 	tasklet_enable(&hdev->tx_task);
@@ -1192,10 +1198,12 @@ static inline void hci_sched_acl(struct 
 
 	BT_DBG("%s", hdev->name);
 
-	/* ACL tx timeout must be longer than maximum
-	 * link supervision timeout (40.9 seconds) */
-	if (!hdev->acl_cnt && (jiffies - hdev->acl_last_tx) > (HZ * 45))
-		hci_acl_tx_to(hdev);
+	if (!test_bit(HCI_RAW, &hdev->flags)) {
+		/* ACL tx timeout must be longer than maximum
+		 * link supervision timeout (40.9 seconds) */
+		if (!hdev->acl_cnt && (jiffies - hdev->acl_last_tx) > (HZ * 45))
+			hci_acl_tx_to(hdev);
+	}
 
 	while (hdev->acl_cnt && (conn = hci_low_sent(hdev, ACL_LINK, &quote))) {
 		while (quote-- && (skb = skb_dequeue(&conn->data_q))) {
diff -purN linux-2.6.11-rc2-bk9/net/bluetooth/hci_event.c linux-2.6.11-rc2-bk10/net/bluetooth/hci_event.c
--- linux-2.6.11-rc2-bk9/net/bluetooth/hci_event.c	2005-01-22 02:46:46.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/bluetooth/hci_event.c	2005-02-01 16:06:27.869703397 +0100
@@ -818,6 +818,30 @@ static inline void hci_link_key_notify_e
 {
 }
 
+/* Clock Offset */
+static inline void hci_clock_offset_evt(struct hci_dev *hdev, struct sk_buff *skb)
+{
+	struct hci_ev_clock_offset *ev = (struct hci_ev_clock_offset *) skb->data;
+	struct hci_conn *conn = NULL;
+	__u16 handle = __le16_to_cpu(ev->handle);
+
+	BT_DBG("%s status %d", hdev->name, ev->status);
+
+	hci_dev_lock(hdev);
+
+	conn = hci_conn_hash_lookup_handle(hdev, handle);
+	if (conn && !ev->status) {
+		struct inquiry_entry *ie;
+
+		if ((ie = hci_inquiry_cache_lookup(hdev, &conn->dst))) {
+			ie->data.clock_offset = ev->clock_offset;
+			ie->timestamp = jiffies;
+		}
+	}
+
+	hci_dev_unlock(hdev);
+}
+
 void hci_event_packet(struct hci_dev *hdev, struct sk_buff *skb)
 {
 	struct hci_event_hdr *hdr = (struct hci_event_hdr *) skb->data;
@@ -886,6 +910,10 @@ void hci_event_packet(struct hci_dev *hd
 		hci_link_key_notify_evt(hdev, skb);
 		break;
 
+	case HCI_EV_CLOCK_OFFSET:
+		hci_clock_offset_evt(hdev, skb);
+		break;
+
 	case HCI_EV_CMD_STATUS:
 		cs = (struct hci_ev_cmd_status *) skb->data;
 		skb_pull(skb, sizeof(cs));
diff -purN linux-2.6.11-rc2-bk9/net/bluetooth/hci_sock.c linux-2.6.11-rc2-bk10/net/bluetooth/hci_sock.c
--- linux-2.6.11-rc2-bk9/net/bluetooth/hci_sock.c	2005-01-22 02:48:21.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/bluetooth/hci_sock.c	2005-02-01 16:06:27.870703241 +0100
@@ -179,6 +179,9 @@ static inline int hci_sock_bound_ioctl(s
 		if (!capable(CAP_NET_ADMIN))
 			return -EACCES;
 
+		if (test_bit(HCI_QUIRK_RAW_DEVICE, &hdev->quirks))
+			return -EPERM;
+
 		if (arg)
 			set_bit(HCI_RAW, &hdev->flags);
 		else
diff -purN linux-2.6.11-rc2-bk9/net/bluetooth/l2cap.c linux-2.6.11-rc2-bk10/net/bluetooth/l2cap.c
--- linux-2.6.11-rc2-bk9/net/bluetooth/l2cap.c	2005-01-22 02:48:28.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/bluetooth/l2cap.c	2005-02-01 16:06:27.875702462 +0100
@@ -770,7 +770,7 @@ static int l2cap_sock_sendmsg(struct kio
 		return -EOPNOTSUPP;
 
 	/* Check outgoing MTU */
-	if (len > l2cap_pi(sk)->omtu)
+	if (sk->sk_type != SOCK_RAW && len > l2cap_pi(sk)->omtu)
 		return -EINVAL;
 
 	lock_sock(sk);
diff -purN linux-2.6.11-rc2-bk9/net/core/neighbour.c linux-2.6.11-rc2-bk10/net/core/neighbour.c
--- linux-2.6.11-rc2-bk9/net/core/neighbour.c	2005-02-01 16:06:19.986733864 +0100
+++ linux-2.6.11-rc2-bk10/net/core/neighbour.c	2005-02-01 16:06:27.893699657 +0100
@@ -109,7 +109,7 @@ static int neigh_blackhole(struct sk_buf
 
 unsigned long neigh_rand_reach_time(unsigned long base)
 {
-	return (net_random() % base) + (base >> 1);
+	return (base ? (net_random() % base) + (base >> 1) : 0);
 }
 
 
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/esp4.c linux-2.6.11-rc2-bk10/net/ipv4/esp4.c
--- linux-2.6.11-rc2-bk9/net/ipv4/esp4.c	2005-02-01 16:06:19.995732461 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/esp4.c	2005-02-01 16:06:27.903698098 +0100
@@ -427,7 +427,8 @@ static int esp_init_state(struct xfrm_st
 			goto error;
 		get_random_bytes(esp->conf.ivec, esp->conf.ivlen);
 	}
-	crypto_cipher_setkey(esp->conf.tfm, esp->conf.key, esp->conf.key_len);
+	if (crypto_cipher_setkey(esp->conf.tfm, esp->conf.key, esp->conf.key_len))
+		goto error;
 	x->props.header_len = sizeof(struct ip_esp_hdr) + esp->conf.ivlen;
 	if (x->props.mode)
 		x->props.header_len += sizeof(struct iphdr);
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/ip_fragment.c linux-2.6.11-rc2-bk10/net/ipv4/ip_fragment.c
--- linux-2.6.11-rc2-bk9/net/ipv4/ip_fragment.c	2005-01-22 02:47:32.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/ip_fragment.c	2005-02-01 16:06:27.905697786 +0100
@@ -73,6 +73,7 @@ struct ipfrag_skb_cb
 struct ipq {
 	struct ipq	*next;		/* linked list pointers			*/
 	struct list_head lru_list;	/* lru list member 			*/
+	u32		user;
 	u32		saddr;
 	u32		daddr;
 	u16		id;
@@ -243,13 +244,13 @@ static void ipq_kill(struct ipq *ipq)
 /* Memory limiting on fragments.  Evictor trashes the oldest 
  * fragment queue until we are back under the threshold.
  */
-static void __ip_evictor(int threshold)
+static void ip_evictor(void)
 {
 	struct ipq *qp;
 	struct list_head *tmp;
 	int work;
 
-	work = atomic_read(&ip_frag_mem) - threshold;
+	work = atomic_read(&ip_frag_mem) - sysctl_ipfrag_low_thresh;
 	if (work <= 0)
 		return;
 
@@ -274,11 +275,6 @@ static void __ip_evictor(int threshold)
 	}
 }
 
-static inline void ip_evictor(void)
-{
-	__ip_evictor(sysctl_ipfrag_low_thresh);
-}
-
 /*
  * Oops, a fragment queue timed out.  Kill it and send an ICMP reply.
  */
@@ -325,7 +321,8 @@ static struct ipq *ip_frag_intern(unsign
 		if(qp->id == qp_in->id		&&
 		   qp->saddr == qp_in->saddr	&&
 		   qp->daddr == qp_in->daddr	&&
-		   qp->protocol == qp_in->protocol) {
+		   qp->protocol == qp_in->protocol &&
+		   qp->user == qp_in->user) {
 			atomic_inc(&qp->refcnt);
 			write_unlock(&ipfrag_lock);
 			qp_in->last_in |= COMPLETE;
@@ -352,7 +349,7 @@ static struct ipq *ip_frag_intern(unsign
 }
 
 /* Add an entry to the 'ipq' queue for a newly received IP datagram. */
-static struct ipq *ip_frag_create(unsigned hash, struct iphdr *iph)
+static struct ipq *ip_frag_create(unsigned hash, struct iphdr *iph, u32 user)
 {
 	struct ipq *qp;
 
@@ -364,6 +361,7 @@ static struct ipq *ip_frag_create(unsign
 	qp->id = iph->id;
 	qp->saddr = iph->saddr;
 	qp->daddr = iph->daddr;
+	qp->user = user;
 	qp->len = 0;
 	qp->meat = 0;
 	qp->fragments = NULL;
@@ -386,7 +384,7 @@ out_nomem:
 /* Find the correct entry in the "incomplete datagrams" queue for
  * this IP datagram, and create new one, if nothing is found.
  */
-static inline struct ipq *ip_find(struct iphdr *iph)
+static inline struct ipq *ip_find(struct iphdr *iph, u32 user)
 {
 	__u16 id = iph->id;
 	__u32 saddr = iph->saddr;
@@ -400,7 +398,8 @@ static inline struct ipq *ip_find(struct
 		if(qp->id == id		&&
 		   qp->saddr == saddr	&&
 		   qp->daddr == daddr	&&
-		   qp->protocol == protocol) {
+		   qp->protocol == protocol &&
+		   qp->user == user) {
 			atomic_inc(&qp->refcnt);
 			read_unlock(&ipfrag_lock);
 			return qp;
@@ -408,7 +407,7 @@ static inline struct ipq *ip_find(struct
 	}
 	read_unlock(&ipfrag_lock);
 
-	return ip_frag_create(hash, iph);
+	return ip_frag_create(hash, iph, user);
 }
 
 /* Add new segment to existing queue. */
@@ -642,7 +641,7 @@ out_fail:
 }
 
 /* Process an incoming IP datagram fragment. */
-struct sk_buff *ip_defrag(struct sk_buff *skb)
+struct sk_buff *ip_defrag(struct sk_buff *skb, u32 user)
 {
 	struct iphdr *iph = skb->nh.iph;
 	struct ipq *qp;
@@ -657,7 +656,7 @@ struct sk_buff *ip_defrag(struct sk_buff
 	dev = skb->dev;
 
 	/* Lookup (or create) queue header */
-	if ((qp = ip_find(iph)) != NULL) {
+	if ((qp = ip_find(iph, user)) != NULL) {
 		struct sk_buff *ret = NULL;
 
 		spin_lock(&qp->lock);
@@ -689,10 +688,4 @@ void ipfrag_init(void)
 	add_timer(&ipfrag_secret_timer);
 }
 
-void ipfrag_flush(void)
-{
-	__ip_evictor(0);
-}
-
 EXPORT_SYMBOL(ip_defrag);
-EXPORT_SYMBOL(ipfrag_flush);
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/ip_input.c linux-2.6.11-rc2-bk10/net/ipv4/ip_input.c
--- linux-2.6.11-rc2-bk9/net/ipv4/ip_input.c	2005-01-22 02:46:59.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/ip_input.c	2005-02-01 16:06:27.907829844 +0100
@@ -172,7 +172,7 @@ int ip_call_ra_chain(struct sk_buff *skb
 		    (!sk->sk_bound_dev_if ||
 		     sk->sk_bound_dev_if == skb->dev->ifindex)) {
 			if (skb->nh.iph->frag_off & htons(IP_MF|IP_OFFSET)) {
-				skb = ip_defrag(skb);
+				skb = ip_defrag(skb, IP_DEFRAG_CALL_RA_CHAIN);
 				if (skb == NULL) {
 					read_unlock(&ip_ra_lock);
 					return 1;
@@ -273,7 +273,7 @@ int ip_local_deliver(struct sk_buff *skb
 	 */
 
 	if (skb->nh.iph->frag_off & htons(IP_MF|IP_OFFSET)) {
-		skb = ip_defrag(skb);
+		skb = ip_defrag(skb, IP_DEFRAG_LOCAL_DELIVER);
 		if (!skb)
 			return 0;
 	}
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/ipvs/ip_vs_core.c linux-2.6.11-rc2-bk10/net/ipv4/ipvs/ip_vs_core.c
--- linux-2.6.11-rc2-bk9/net/ipv4/ipvs/ip_vs_core.c	2005-01-22 02:46:42.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/ipvs/ip_vs_core.c	2005-02-01 16:06:27.913828909 +0100
@@ -544,9 +544,9 @@ u16 ip_vs_checksum_complete(struct sk_bu
 }
 
 static inline struct sk_buff *
-ip_vs_gather_frags(struct sk_buff *skb)
+ip_vs_gather_frags(struct sk_buff *skb, u_int32_t user)
 {
-	skb = ip_defrag(skb);
+	skb = ip_defrag(skb, user);
 	if (skb)
 		ip_send_check(skb->nh.iph);
 	return skb;
@@ -620,7 +620,7 @@ static int ip_vs_out_icmp(struct sk_buff
 
 	/* reassemble IP fragments */
 	if (skb->nh.iph->frag_off & __constant_htons(IP_MF|IP_OFFSET)) {
-		skb = ip_vs_gather_frags(skb);
+		skb = ip_vs_gather_frags(skb, IP_DEFRAG_VS_OUT);
 		if (!skb)
 			return NF_STOLEN;
 		*pskb = skb;
@@ -759,7 +759,7 @@ ip_vs_out(unsigned int hooknum, struct s
 	/* reassemble IP fragments */
 	if (unlikely(iph->frag_off & __constant_htons(IP_MF|IP_OFFSET) &&
 		     !pp->dont_defrag)) {
-		skb = ip_vs_gather_frags(skb);
+		skb = ip_vs_gather_frags(skb, IP_DEFRAG_VS_OUT);
 		if (!skb)
 			return NF_STOLEN;
 		iph = skb->nh.iph;
@@ -839,7 +839,8 @@ ip_vs_out(unsigned int hooknum, struct s
  *	forward to the right destination host if relevant.
  *	Currently handles error types - unreachable, quench, ttl exceeded.
  */
-static int ip_vs_in_icmp(struct sk_buff **pskb, int *related)
+static int 
+ip_vs_in_icmp(struct sk_buff **pskb, int *related, unsigned int hooknum)
 {
 	struct sk_buff *skb = *pskb;
 	struct iphdr *iph;
@@ -853,7 +854,9 @@ static int ip_vs_in_icmp(struct sk_buff 
 
 	/* reassemble IP fragments */
 	if (skb->nh.iph->frag_off & __constant_htons(IP_MF|IP_OFFSET)) {
-		skb = ip_vs_gather_frags(skb);
+		skb = ip_vs_gather_frags(skb,
+		                         hooknum == NF_IP_LOCAL_IN ?
+					 IP_DEFRAG_VS_IN : IP_DEFRAG_VS_FWD);
 		if (!skb)
 			return NF_STOLEN;
 		*pskb = skb;
@@ -962,7 +965,7 @@ ip_vs_in(unsigned int hooknum, struct sk
 
 	iph = skb->nh.iph;
 	if (unlikely(iph->protocol == IPPROTO_ICMP)) {
-		int related, verdict = ip_vs_in_icmp(pskb, &related);
+		int related, verdict = ip_vs_in_icmp(pskb, &related, hooknum);
 
 		if (related)
 			return verdict;
@@ -1057,7 +1060,7 @@ ip_vs_forward_icmp(unsigned int hooknum,
 	if ((*pskb)->nh.iph->protocol != IPPROTO_ICMP)
 		return NF_ACCEPT;
 
-	return ip_vs_in_icmp(pskb, &r);
+	return ip_vs_in_icmp(pskb, &r, hooknum);
 }
 
 
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_conntrack_core.c linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_conntrack_core.c
--- linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_conntrack_core.c	2005-01-22 02:46:41.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_conntrack_core.c	2005-02-01 16:06:27.915828597 +0100
@@ -936,29 +936,22 @@ void ip_ct_refresh_acct(struct ip_conntr
 	}
 }
 
-int ip_ct_no_defrag;
-
 /* Returns new sk_buff, or NULL */
 struct sk_buff *
-ip_ct_gather_frags(struct sk_buff *skb)
+ip_ct_gather_frags(struct sk_buff *skb, u_int32_t user)
 {
 	struct sock *sk = skb->sk;
 #ifdef CONFIG_NETFILTER_DEBUG
 	unsigned int olddebug = skb->nf_debug;
 #endif
 
-	if (unlikely(ip_ct_no_defrag)) {
-		kfree_skb(skb);
-		return NULL;
-	}
-
 	if (sk) {
 		sock_hold(sk);
 		skb_orphan(skb);
 	}
 
 	local_bh_disable(); 
-	skb = ip_defrag(skb);
+	skb = ip_defrag(skb, user);
 	local_bh_enable();
 
 	if (!skb) {
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_conntrack_standalone.c linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_conntrack_standalone.c
--- linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_conntrack_standalone.c	2005-01-22 02:48:00.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_conntrack_standalone.c	2005-02-01 16:06:27.918828129 +0100
@@ -391,7 +391,10 @@ static unsigned int ip_conntrack_defrag(
 
 	/* Gather fragments. */
 	if ((*pskb)->nh.iph->frag_off & htons(IP_MF|IP_OFFSET)) {
-		*pskb = ip_ct_gather_frags(*pskb);
+		*pskb = ip_ct_gather_frags(*pskb,
+		                           hooknum == NF_IP_PRE_ROUTING ? 
+					   IP_DEFRAG_CONNTRACK_IN :
+					   IP_DEFRAG_CONNTRACK_OUT);
 		if (!*pskb)
 			return NF_STOLEN;
 	}
@@ -823,12 +826,6 @@ static int init_or_cleanup(int init)
  cleanup_defraglocalops:
 	nf_unregister_hook(&ip_conntrack_defrag_local_out_ops);
  cleanup_defragops:
-	/* Frag queues may hold fragments with skb->dst == NULL */
-	ip_ct_no_defrag = 1;
-	synchronize_net();
-	local_bh_disable();
-	ipfrag_flush();
-	local_bh_enable();
 	nf_unregister_hook(&ip_conntrack_defrag_ops);
  cleanup_proc_stat:
 #ifdef CONFIG_PROC_FS
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_core.c linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_core.c
--- linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_core.c	2005-01-22 02:47:16.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_core.c	2005-02-01 16:06:27.920827818 +0100
@@ -450,6 +450,13 @@ int icmp_reply_translation(struct sk_buf
 		       !manip))
 		return 0;
 
+	/* Reloading "inside" here since manip_pkt inner. */
+	inside = (void *)(*pskb)->data + (*pskb)->nh.iph->ihl*4;
+	inside->icmp.checksum = 0;
+	inside->icmp.checksum = csum_fold(skb_checksum(*pskb, hdrlen,
+						       (*pskb)->len - hdrlen,
+						       0));
+
 	/* Change outer to look the reply to an incoming packet
 	 * (proto 0 means don't invert per-proto part). */
 
@@ -468,13 +475,6 @@ int icmp_reply_translation(struct sk_buf
 			return 0;
 	}
 
-	/* Reloading "inside" here since manip_pkt inner. */
-	inside = (void *)(*pskb)->data + (*pskb)->nh.iph->ihl*4;
-
-	inside->icmp.checksum = 0;
-	inside->icmp.checksum = csum_fold(skb_checksum(*pskb, hdrlen,
-						       (*pskb)->len - hdrlen,
-						       0));
 	return 1;
 }
 
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_proto_tcp.c linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_proto_tcp.c
--- linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_proto_tcp.c	2005-01-22 02:46:45.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_proto_tcp.c	2005-02-01 16:06:27.922827506 +0100
@@ -105,7 +105,7 @@ tcp_manip_pkt(struct sk_buff **pskb,
 		return 0;
 
 	iph = (struct iphdr *)((*pskb)->data + iphdroff);
-	hdr = (struct tcphdr *)((*pskb)->data + iph->ihl*4);
+	hdr = (struct tcphdr *)((*pskb)->data + hdroff);
 
 	if (maniptype == IP_NAT_MANIP_SRC) {
 		/* Get rid of src ip and src pt */
diff -purN linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_standalone.c linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_standalone.c
--- linux-2.6.11-rc2-bk9/net/ipv4/netfilter/ip_nat_standalone.c	2005-01-22 02:48:35.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv4/netfilter/ip_nat_standalone.c	2005-02-01 16:06:27.924827194 +0100
@@ -195,7 +195,7 @@ ip_nat_out(unsigned int hooknum,
 	   I'm starting to have nightmares about fragments.  */
 
 	if ((*pskb)->nh.iph->frag_off & htons(IP_MF|IP_OFFSET)) {
-		*pskb = ip_ct_gather_frags(*pskb);
+		*pskb = ip_ct_gather_frags(*pskb, IP_DEFRAG_NAT_OUT);
 
 		if (!*pskb)
 			return NF_STOLEN;
diff -purN linux-2.6.11-rc2-bk9/net/ipv6/esp6.c linux-2.6.11-rc2-bk10/net/ipv6/esp6.c
--- linux-2.6.11-rc2-bk9/net/ipv6/esp6.c	2005-02-01 16:06:20.007730591 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv6/esp6.c	2005-02-01 16:06:27.929826415 +0100
@@ -364,7 +364,8 @@ static int esp6_init_state(struct xfrm_s
 			goto error;
 		get_random_bytes(esp->conf.ivec, esp->conf.ivlen);
 	}
-	crypto_cipher_setkey(esp->conf.tfm, esp->conf.key, esp->conf.key_len);
+	if (crypto_cipher_setkey(esp->conf.tfm, esp->conf.key, esp->conf.key_len))
+		goto error;
 	x->props.header_len = sizeof(struct ipv6_esp_hdr) + esp->conf.ivlen;
 	if (x->props.mode)
 		x->props.header_len += sizeof(struct ipv6hdr);
@@ -372,15 +373,9 @@ static int esp6_init_state(struct xfrm_s
 	return 0;
 
 error:
-	if (esp) {
-		if (esp->auth.tfm)
-			crypto_free_tfm(esp->auth.tfm);
-		if (esp->auth.work_icv)
-			kfree(esp->auth.work_icv);
-		if (esp->conf.tfm)
-			crypto_free_tfm(esp->conf.tfm);
-		kfree(esp);
-	}
+	x->data = esp;
+	esp6_destroy(x);
+	x->data = NULL;
 	return -EINVAL;
 }
 
diff -purN linux-2.6.11-rc2-bk9/net/ipv6/ip6_output.c linux-2.6.11-rc2-bk10/net/ipv6/ip6_output.c
--- linux-2.6.11-rc2-bk9/net/ipv6/ip6_output.c	2005-02-01 16:06:20.009730280 +0100
+++ linux-2.6.11-rc2-bk10/net/ipv6/ip6_output.c	2005-02-01 16:06:27.931826103 +0100
@@ -463,6 +463,7 @@ static void ip6_copy_metadata(struct sk_
 	to->priority = from->priority;
 	to->protocol = from->protocol;
 	to->security = from->security;
+	dst_release(to->dst);
 	to->dst = dst_clone(from->dst);
 	to->dev = from->dev;
 
diff -purN linux-2.6.11-rc2-bk9/net/socket.c linux-2.6.11-rc2-bk10/net/socket.c
--- linux-2.6.11-rc2-bk9/net/socket.c	2005-01-22 02:47:48.000000000 +0100
+++ linux-2.6.11-rc2-bk10/net/socket.c	2005-02-01 16:06:27.946823766 +0100
@@ -2026,15 +2026,6 @@ extern void sk_init(void);
 
 void __init sock_init(void)
 {
-	int i;
-
-	/*
-	 *	Initialize all address (protocol) families. 
-	 */
-	 
-	for (i = 0; i < NPROTO; i++) 
-		net_families[i] = NULL;
-
 	/*
 	 *	Initialize sock SLAB cache.
 	 */
