#date: 2004-04-09
#id: 1.1371.691.6
#tag: other
#time: 22:52:50
#title: [SERIAL] Pass device pointer through to tty_register_device.
#who: rmk@flint.arm.linux.org.uk
#
# ChangeSet
#   1.1371.691.6 04/04/09 22:52:50 rmk@flint.arm.linux.org.uk +2 -0
#   [SERIAL] Pass device pointer through to tty_register_device.
#   
#   This allows drivers to pass their struct device through to
#   tty_register_device, which in turn allows sysfs to show which
#   device and driver owns the UART.
#
# include/linux/serial_core.h +2 -0
#   Add struct device member to uart_port.
# drivers/serial/serial_core.c +1 -1
#   Pass struct device through to tty_register_device.
#
diff -Nru a/drivers/serial/serial_core.c b/drivers/serial/serial_core.c
--- a/drivers/serial/serial_core.c	Wed Apr 28 00:12:48 2004
+++ b/drivers/serial/serial_core.c	Wed Apr 28 00:12:48 2004
@@ -2227,7 +2227,7 @@
 	 * Register the port whether it's detected or not.  This allows
 	 * setserial to be used to alter this ports parameters.
 	 */
-	tty_register_device(drv->tty_driver, port->line, NULL);
+	tty_register_device(drv->tty_driver, port->line, port->dev);
 
  out:
 	up(&port_sem);
diff -Nru a/include/linux/serial_core.h b/include/linux/serial_core.h
--- a/include/linux/serial_core.h	Wed Apr 28 00:12:48 2004
+++ b/include/linux/serial_core.h	Wed Apr 28 00:12:48 2004
@@ -97,6 +97,7 @@
 struct uart_port;
 struct uart_info;
 struct serial_struct;
+struct device;
 
 /*
  * This structure describes all the operations that can be
@@ -218,6 +219,7 @@
 	unsigned int		custom_divisor;
 	unsigned int		line;			/* port index */
 	unsigned long		mapbase;		/* for ioremap */
+	struct device		*dev;			/* parent device */
 	unsigned char		hub6;			/* this should be in the 8250 driver */
 	unsigned char		unused[3];
 };
