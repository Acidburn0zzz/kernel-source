#date: 2004-04-16
#id: 1.1371.1.462
#tag: other
#time: 14:50:17
#title: [IRDA]: Replace sleep_on with wait_event
#who: jt@bougret.hpl.hp.com
#
# ChangeSet
#   1.1371.1.462 04/04/16 14:50:17 jt@bougret.hpl.hp.com +1 -0
#   [IRDA]: Replace sleep_on with wait_event
#   
#   From Stephen Hemminger.
#
# net/irda/irlan/irlan_eth.c +4 -4
#   [IRDA]: Replace sleep_on with wait_event
#     
#     From Stephen Hemminger.
#
diff -Nru a/net/irda/irlan/irlan_eth.c b/net/irda/irlan/irlan_eth.c
--- a/net/irda/irlan/irlan_eth.c	Wed Apr 28 00:45:08 2004
+++ b/net/irda/irlan/irlan_eth.c	Wed Apr 28 00:45:08 2004
@@ -115,10 +115,10 @@
 	self->disconnect_reason = 0;
 	irlan_client_wakeup(self, self->saddr, self->daddr);
 
-	/* Make sure we have a hardware address before we return, so DHCP clients gets happy */
-	interruptible_sleep_on(&self->open_wait);
-	
-	return 0;
+	/* Make sure we have a hardware address before we return, 
+	   so DHCP clients gets happy */
+	return wait_event_interruptible(self->open_wait,
+					!self->tsap_data->connected);
 }
 
 /*
