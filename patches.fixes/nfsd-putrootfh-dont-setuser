From: Andy Adamson <andros@citi.umich.edu>
Subject: Don't call nfsd_setuser in put_rootfh, it isn't needed or appropriate
References: 158462
Patch-mainline: yes

nfsd_setuser() sets the current tasks fsuid, fsgid from the rpc cred cr_uid,
cr_fid. it also squashes all or root. it needs to be called prior to any
directory or file access. it is called in fh_verify()

Signed-off-by: Andy Adamson <andros@citi.umich.edu>
Signed-off-by: NeilBrown <neilb@suse.de>
Acked-by: NeilBrown <neilb@suse.de>

Index: linux-2.6.16/fs/nfsd/nfs4proc.c
===================================================================
--- linux-2.6.16.orig/fs/nfsd/nfs4proc.c	2006-03-20 16:53:29.000000000 +1100
+++ linux-2.6.16/fs/nfsd/nfs4proc.c	2006-03-23 17:16:07.000000000 +1100
@@ -288,8 +288,6 @@
 	fh_put(current_fh);
 	status = exp_pseudoroot(rqstp->rq_client, current_fh,
 			      &rqstp->rq_chandle);
-	if (!status)
-		status = nfserrno(nfsd_setuser(rqstp, current_fh->fh_export));
 	return status;
 }
 
