From: kraxel@suse.de
Subject: Fix UART_BUG_TXEN test.
Patch-mainline: 
References: 49840

Bug: Test gives false positives in case the UART_IER_THRI bit is set.
Fix: Explicitly clear UART_IER register first.
Trigger: Serial console writes set UART_IER_THRI.

--- linux-2.6.16/drivers/serial/8250.c.serial	2006-04-05 12:04:31.000000000 +0200
+++ linux-2.6.16/drivers/serial/8250.c	2006-04-05 12:04:49.000000000 +0200
@@ -1712,6 +1712,7 @@
 	 * Do a quick test to see if we receive an
 	 * interrupt when we enable the TX irq.
 	 */
+	serial_outp(up, UART_IER, 0);
 	serial_outp(up, UART_IER, UART_IER_THRI);
 	lsr = serial_in(up, UART_LSR);
 	iir = serial_in(up, UART_IIR);
