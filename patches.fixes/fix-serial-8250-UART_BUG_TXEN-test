From: kraxel@suse.de
Subject: Fix UART_BUG_TXEN test.
Patch-mainline: 
References: 49840

Bug: Test gives false positives in case the UART_IER_THRI bit is set.
Fix: Explicitly clear UART_IER register first.
Trigger: Serial console writes set UART_IER_THRI.

---
 drivers/serial/8250.c |    1 +
 1 files changed, 1 insertion(+)

--- linux-2.6.18.orig/drivers/serial/8250.c
+++ linux-2.6.18/drivers/serial/8250.c
@@ -1682,6 +1682,7 @@ static int serial8250_startup(struct uar
 	 * Do a quick test to see if we receive an
 	 * interrupt when we enable the TX irq.
 	 */
+	serial_outp(up, UART_IER, 0);
 	serial_outp(up, UART_IER, UART_IER_THRI);
 	lsr = serial_in(up, UART_LSR);
 	iir = serial_in(up, UART_IIR);
