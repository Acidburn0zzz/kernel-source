# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/09/13 14:05:42-07:00 akpm@osdl.org 
#   [PATCH] isofs buffer management fix
#   
#   There's a double-free in the isofs filesystem.
#   
#   Invalidate this pointer so it doesn't get freed twice.
#   
#   Signed-off-by: Andrew Morton <akpm@osdl.org>
#   Signed-off-by: Linus Torvalds <torvalds@osdl.org>
# 
# fs/isofs/rock.c
#   2004/09/10 01:47:00-07:00 akpm@osdl.org +1 -1
#   isofs buffer management fix
# 
diff -Nru a/fs/isofs/rock.c b/fs/isofs/rock.c
--- a/fs/isofs/rock.c	2004-09-18 01:10:24 -07:00
+++ b/fs/isofs/rock.c	2004-09-18 01:10:24 -07:00
@@ -62,7 +62,7 @@
 }                                     
 
 #define MAYBE_CONTINUE(LABEL,DEV) \
-  {if (buffer) kfree(buffer); \
+  {if (buffer) { kfree(buffer); buffer = NULL; } \
   if (cont_extent){ \
     int block, offset, offset1; \
     struct buffer_head * pbh; \
