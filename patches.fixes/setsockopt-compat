When checking for an option name, always check for the level as
well. Otherwise we break SOL_IPV6/IPV6_V6ONLY and maybe others.
Thanks to Marcus Meissner for spotting this.

Index: linux-2.6.8/net/compat.c
===================================================================
--- linux-2.6.8.orig/net/compat.c
+++ linux-2.6.8/net/compat.c
@@ -455,9 +455,9 @@ static int do_set_sock_timeout(int fd, i
 asmlinkage long compat_sys_setsockopt(int fd, int level, int optname,
 				char __user *optval, int optlen)
 {
 	/* SO_SET_REPLACE seems to be the same in all levels */
-	if (optname == IPT_SO_SET_REPLACE)
+	if (/*level == SOL_IP && */optname == IPT_SO_SET_REPLACE)
 		return do_netfilter_replace(fd, level, optname,
 					    optval, optlen);
 	if (level == SOL_SOCKET && optname == SO_ATTACH_FILTER)
 		return do_set_attach_filter(fd, level, optname,
@@ -500,9 +500,10 @@ static int do_get_sock_timeout(int fd, i
 
 asmlinkage long compat_sys_getsockopt(int fd, int level, int optname,
 				char __user *optval, int __user *optlen)
 {
-	if (optname == SO_RCVTIMEO || optname == SO_SNDTIMEO)
+	if (level == SOL_SOCKET &&
+	    (optname == SO_RCVTIMEO || optname == SO_SNDTIMEO))
 		return do_get_sock_timeout(fd, level, optname, optval, optlen);
 	return sys_getsockopt(fd, level, optname, optval, optlen);
 }
 
