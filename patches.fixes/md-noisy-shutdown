Subject: Make md shutdown a bit quieter
References: 155553
From: NeilBrown <neilb@suse.de>
Patch-mainline: not yet

If several md devices have been polled, then on shutdown when they are
switch to read-only, we get some unpleasant noice.

Signed-off-by: NeilBrown <neilb@suse.de>

Index: linux-2.6.15/drivers/md/md.c
===================================================================
--- linux-2.6.15.orig/drivers/md/md.c	2006-03-07 13:38:19.000000000 +1100
+++ linux-2.6.15/drivers/md/md.c	2006-03-07 14:42:55.000000000 +1100
@@ -2723,7 +2723,7 @@
 		if (disk)
 			set_capacity(disk, 0);
 		mddev->changed = 1;
-	} else
+	} else if (mddev->pers)
 		printk(KERN_INFO "md: %s switched to read-only mode.\n",
 			mdname(mddev));
 	err = 0;
