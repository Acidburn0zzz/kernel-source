
Patch from Chuck Lever:

	A "short read" occurs if the server returns fewer bytes than the client
	requested. Short reads often happen at the end of a file where the
	client requests a full page, and the file ends in the middle of the
	page. However, if a short read should occurs in a page that resides the
	middle of a file, this is an error. This patch adds logic to set the
	PageError bit on the page being read if the client detects short reads
	in the middle of a file.

--- linux-2.6.3/fs/nfs/read.c.orig	2004-02-04 04:43:03.000000000 +0100
+++ linux-2.6.3/fs/nfs/read.c	2004-03-09 16:28:36.000000000 +0100
@@ -276,7 +276,8 @@
 				memclear_highpage_flush(page,
 							req->wb_pgbase + count,
 							req->wb_bytes - count);
-
+				if (!data->res.eof)
+					SetPageError(page);
 				count = 0;
 			} else
 				count -= PAGE_CACHE_SIZE;
