
Patch from Chuck Lever:

	A "short read" occurs if the server returns fewer bytes than the client
	requested. Short reads often happen at the end of a file where the
	client requests a full page, and the file ends in the middle of the
	page. However, if a short read should occurs in a page that resides the
	middle of a file, this is an error. This patch adds logic to set the
	PageError bit on the page being read if the client detects short reads
	in the middle of a file.

Index: linux-2.6.7/fs/nfs/read.c
===================================================================
--- linux-2.6.7.orig/fs/nfs/read.c	2004-06-16 07:18:37.000000000 +0200
+++ linux-2.6.7/fs/nfs/read.c	2004-08-04 13:54:15.752727645 +0200
@@ -453,6 +453,8 @@
 					memclear_highpage_flush(page,
 							req->wb_pgbase + count,
 							req->wb_bytes - count);
+				if (!data->res.eof)
+					SetPageError(page);
 				count = 0;
 			} else
 				count -= PAGE_CACHE_SIZE;
