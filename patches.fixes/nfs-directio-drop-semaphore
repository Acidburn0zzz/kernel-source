
This patch allows for more than one concurrent directio NFS read or write
request, by releasing the i_sem while we're doing the call. According
to Chuck Lever and Andrea Arcangeli, releasing the semaphore is not
problematic.

Index: linux-2.6.7/fs/nfs/direct.c
===================================================================
--- linux-2.6.7.orig/fs/nfs/direct.c	2004-08-04 13:50:08.923627014 +0200
+++ linux-2.6.7/fs/nfs/direct.c	2004-08-04 13:52:58.089247507 +0200
@@ -423,6 +423,8 @@
 	if (!is_sync_kiocb(iocb))
 		return result;
 
+	up(&inode->i_sem);
+
 	switch (rw) {
 	case READ:
 		dprintk("NFS: direct_IO(read) (%s) off/no(%Lu/%lu)\n",
@@ -441,6 +443,8 @@
 	default:
 		break;
 	}
+
+	down(&inode->i_sem);
 	return result;
 }
 
