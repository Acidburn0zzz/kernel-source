Subject: Prevent IPv6 oops on PPP devices
From: Olaf Kirch <okir@suse.de>
References: 72444

We weren't initializing dev->generate_eui64 for PPP and similar
devices, causing a jump to address zero whenever assigning an
IPv6 address to the device.

This problem was introduced by patches.arch/s390-netdev-eui64.patch.

Index: linux-2.6.5/net/ipv6/addrconf.c
===================================================================
--- linux-2.6.5.orig/net/ipv6/addrconf.c	2005-03-14 12:59:11.000000000 +0100
+++ linux-2.6.5/net/ipv6/addrconf.c	2005-03-14 17:04:42.000000000 +0100
@@ -1972,6 +1972,9 @@ static void addrconf_dev_config(struct n
 
 	ASSERT_RTNL();
 
+	if (!dev->generate_eui64) 
+		dev->generate_eui64 = ipv6_generate_eui64;
+
 	if ((dev->type != ARPHRD_ETHER) && 
 	    (dev->type != ARPHRD_FDDI) &&
 	    (dev->type != ARPHRD_IEEE802_TR) &&
@@ -1980,9 +1983,6 @@ static void addrconf_dev_config(struct n
 		return;
 	}
 
-	if (!dev->generate_eui64) 
-		dev->generate_eui64 = ipv6_generate_eui64;
-
 	idev = addrconf_add_dev(dev);
 	if (idev == NULL)
 		return;
