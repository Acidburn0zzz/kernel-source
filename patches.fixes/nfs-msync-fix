Patch by Chuck Lever:
	msync() didn't flush any pages at all, because we didn't know
	the struct file from the VMA. Drop the test for wb_file.

	(The original patch by Chuck is larger, because he eliminated
	 the struct file * argument from nfs_scan_list and
	 nfs_wait_one_request entirely. We don't, in order to keep
	 the diff small)

diff -X /home/cel/src/linux/dont-diff -Naurp 00-stock/fs/nfs/pagelist.c 01-msync/fs/nfs/pagelist.c
--- 00-stock/fs/nfs/pagelist.c	2004-01-09 02:00:02.000000000 -0500
+++ 01-msync/fs/nfs/pagelist.c	2004-02-02 12:51:44.676260000 -0500
@@ -276,9 +276,6 @@ nfs_scan_list(struct list_head *head, st
 
 		req = nfs_list_entry(pos);
 
-		if (file && req->wb_file != file)
-			continue;
-
 		if (req->wb_index < idx_start)
 			continue;
 		if (req->wb_index > idx_end)
diff -X /home/cel/src/linux/dont-diff -Naurp 00-stock/fs/nfs/write.c 01-msync/fs/nfs/write.c
--- 00-stock/fs/nfs/write.c	2004-01-09 01:59:48.000000000 -0500
+++ 01-msync/fs/nfs/write.c	2004-02-02 12:51:44.699256000 -0500
@@ -427,8 +427,6 @@ nfs_wait_on_requests(struct inode *inode
 			break;
 
 		next = req->wb_index + 1;
-		if (file && req->wb_file != file)
-			continue;
 		if (!NFS_WBACK_BUSY(req))
 			continue;
 
