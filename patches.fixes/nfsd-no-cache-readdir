From: Olaf Kirch <okir@suse.de>
Subject: Do not cache NFSv2 readdir replies
References: 50435

nfsd would put incomplete readdir replies in the reply cache,
so that incomplete replies are returned in response to retransmitted
READDIR calls.

Index: linux-2.6.5/fs/nfsd/nfsproc.c
===================================================================
--- linux-2.6.5.orig/fs/nfsd/nfsproc.c	2005-01-27 17:32:42.000000000 +0100
+++ linux-2.6.5/fs/nfsd/nfsproc.c	2005-02-07 13:41:36.000000000 +0100
@@ -539,7 +539,7 @@ static struct svc_procedure		nfsd_proced
   PROC(symlink,	 symlinkargs,	void,		none,		RC_REPLSTAT, ST),
   PROC(mkdir,	 createargs,	diropres,	fhandle,	RC_REPLBUFF, ST+FH+AT),
   PROC(rmdir,	 diropargs,	void,		none,		RC_REPLSTAT, ST),
-  PROC(readdir,	 readdirargs,	readdirres,	none,		RC_REPLBUFF, 0),
+  PROC(readdir,	 readdirargs,	readdirres,	none,		RC_NOCACHE, 0),
   PROC(statfs,	 fhandle,	statfsres,	none,		RC_NOCACHE, ST+5),
 };
 
