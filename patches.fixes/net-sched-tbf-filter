
old status OK
ChangeSet
  1.1755.1.1 04/05/25 23:13:48 dtor_core@ameritech.net +1 -0
  [NET_SCHED] Do not oops when user tries to attach a filter to a TBF qdisc.
  
  (TBF does not allow attaching filters as it has only one class,
  filter should be attached either to TBF's parent or to its child)

  net/sched/sch_tbf.c
    1.17 04/05/25 23:13:35 dtor_core@ameritech.net +6 -0
    [NET_SCHED] Do not oops when user tries to attach a filter to a TBF qdisc.
    
    (TBF does not allow attaching filters as it has only one class,
    filter should be attached either to TBF's parent or to its child)

.........................................................................
diff -p -Nru a/net/sched/sch_tbf.c b/net/sched/sch_tbf.c
--- a/net/sched/sch_tbf.c	Thu May 27 06:29:55 2004
+++ b/net/sched/sch_tbf.c	Thu May 27 06:29:55 2004
@@ -495,6 +495,11 @@ static void tbf_walk(struct Qdisc *sch, 
 	}
 }
 
+static struct tcf_proto **tbf_find_tcf(struct Qdisc *sch, unsigned long cl)
+{
+	return NULL;
+}
+
 static struct Qdisc_class_ops tbf_class_ops =
 {
 	.graft		=	tbf_graft,
@@ -504,6 +509,7 @@ static struct Qdisc_class_ops tbf_class_
 	.change		=	tbf_change_class,
 	.delete		=	tbf_delete,
 	.walk		=	tbf_walk,
+	.tcf_chain	=	tbf_find_tcf,
 	.dump		=	tbf_dump_class,
 };
 
.........................................................................
# vim: syntax=diff


