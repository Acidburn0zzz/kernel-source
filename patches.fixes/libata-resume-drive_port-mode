From: Jens Axboe <axboe@suse.de>
Subject: Fix order of port vs drive transfer settings on resume
Patch-mainline: 
References: 157619

Simpler fix - just reset the device first, it should be in a known
mode then. Works for me, at least.

Acked-by: 
Signed-off-by: 

--- linux-2.6.16/drivers/scsi/libata-core.c~	2006-03-23 21:06:21.000000000 +0100
+++ linux-2.6.16/drivers/scsi/libata-core.c	2006-03-23 21:42:15.000000000 +0100
@@ -4310,7 +4310,10 @@ int ata_device_resume(struct ata_port *a
 
 	if (!ata_dev_present(dev))
 		return 0;
+
+	ata_bus_reset(ap);
 	ata_acpi_exec_tfs(ap);
+
 	if (ap->flags & ATA_FLAG_SUSPENDED) {
 		ap->flags &= ~ATA_FLAG_SUSPENDED;
 		ata_set_mode(ap);
