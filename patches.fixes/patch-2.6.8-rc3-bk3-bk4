
 arch/arm/kernel/io.c                    |   14 +++++----
 arch/arm/nwfpe/fpa11.h                  |    2 -
 arch/arm/nwfpe/fpa11_cpdt.c             |   48 ++++++++++++++++----------------
 arch/arm/nwfpe/fpmodule.c               |    2 -
 arch/arm/nwfpe/fpmodule.inl             |   33 +++++++---------------
 arch/ia64/kernel/perfmon.c              |   13 --------
 arch/ppc/8xx_io/cs4218_tdm.c            |    6 ++--
 arch/ppc64/kernel/rtc.c                 |   20 ++++---------
 arch/um/drivers/harddog_kern.c          |    6 ----
 drivers/bluetooth/hci_vhci.c            |    2 -
 drivers/char/ds1620.c                   |   26 ++++++++++-------
 drivers/char/dtlk.c                     |    6 ----
 drivers/char/ftape/zftape/zftape-init.c |    1 
 drivers/char/ipmi/ipmi_watchdog.c       |   10 ------
 drivers/char/nwbutton.c                 |    2 -
 drivers/char/nwbutton.h                 |    2 -
 drivers/char/nwflash.c                  |   23 +++++++--------
 drivers/char/scx200_gpio.c              |    8 -----
 drivers/char/tipar.c                    |    5 ---
 drivers/char/watchdog/acquirewdt.c      |    6 ----
 drivers/char/watchdog/advantechwdt.c    |    6 ----
 drivers/char/watchdog/alim1535_wdt.c    |    6 ----
 drivers/char/watchdog/alim7101_wdt.c    |    6 ----
 drivers/char/watchdog/eurotechwdt.c     |    6 ----
 drivers/char/watchdog/i8xx_tco.c        |    6 ----
 drivers/char/watchdog/ib700wdt.c        |    6 ----
 drivers/char/watchdog/indydog.c         |    6 ----
 drivers/char/watchdog/ixp2000_wdt.c     |    6 ----
 drivers/char/watchdog/ixp4xx_wdt.c      |    6 ----
 drivers/char/watchdog/machzwd.c         |    6 ----
 drivers/char/watchdog/mixcomwd.c        |    6 ----
 drivers/char/watchdog/pcwd.c            |   12 +-------
 drivers/char/watchdog/pcwd_pci.c        |   12 +-------
 drivers/char/watchdog/pcwd_usb.c        |   12 +-------
 drivers/char/watchdog/sa1100_wdt.c      |    5 ---
 drivers/char/watchdog/sbc60xxwdt.c      |    6 +---
 drivers/char/watchdog/sc1200wdt.c       |    5 +--
 drivers/char/watchdog/sc520_wdt.c       |    6 +---
 drivers/char/watchdog/scx200_wdt.c      |    5 ---
 drivers/char/watchdog/shwdt.c           |    6 ----
 drivers/char/watchdog/softdog.c         |    6 ----
 drivers/char/watchdog/w83627hf_wdt.c    |    6 ----
 drivers/char/watchdog/w83877f_wdt.c     |    6 ----
 drivers/char/watchdog/wafer5823wdt.c    |    6 ----
 drivers/char/watchdog/wdt.c             |   12 +-------
 drivers/char/watchdog/wdt285.c          |    5 ---
 drivers/char/watchdog/wdt977.c          |   27 ++++++++++--------
 drivers/char/watchdog/wdt_pci.c         |   12 +-------
 drivers/isdn/capi/capi.c                |    8 -----
 drivers/isdn/hardware/eicon/divamnt.c   |    5 ---
 drivers/isdn/hardware/eicon/divasproc.c |    4 --
 drivers/isdn/hysdn/hysdn_procconf.c     |    7 ----
 drivers/isdn/hysdn/hysdn_proclog.c      |    5 ---
 drivers/isdn/i4l/isdn_common.c          |    7 ----
 drivers/s390/char/tape_char.c           |   18 ------------
 drivers/sbus/char/cpwatchdog.c          |    5 ---
 drivers/sbus/char/riowatchdog.c         |    4 --
 drivers/scsi/osst.c                     |   13 --------
 drivers/usb/class/audio.c               |    8 +----
 drivers/usb/class/usb-midi.c            |    8 -----
 drivers/usb/media/dabusb.c              |    2 -
 drivers/usb/misc/auerswald.c            |    2 -
 drivers/usb/misc/legousbtower.c         |    1 
 drivers/usb/misc/tiglusb.c              |    2 -
 fs/devfs/base.c                         |    8 +----
 sound/oss/ad1889.c                      |    5 ---
 sound/oss/ali5455.c                     |    8 +----
 sound/oss/au1000.c                      |    8 +----
 sound/oss/cmpci.c                       |    8 +----
 sound/oss/cs4281/cs4281m.c              |   14 ++-------
 sound/oss/cs46xx.c                      |   13 +-------
 sound/oss/emu10k1/audio.c               |    8 -----
 sound/oss/emu10k1/midi.c                |    8 -----
 sound/oss/es1370.c                      |   18 ++----------
 sound/oss/es1371.c                      |   18 ++----------
 sound/oss/esssolo1.c                    |   16 ++--------
 sound/oss/forte.c                       |    8 -----
 sound/oss/hal2.c                        |    8 +----
 sound/oss/i810_audio.c                  |    8 +----
 sound/oss/ite8172.c                     |    8 +----
 sound/oss/maestro.c                     |    8 +----
 sound/oss/maestro3.c                    |    8 +----
 sound/oss/nec_vrc5477.c                 |    9 ++----
 sound/oss/rme96xx.c                     |    8 +----
 sound/oss/sonicvibes.c                  |   16 ++--------
 sound/oss/swarm_cs4297a.c               |   20 ++-----------
 sound/oss/trident.c                     |    8 +----
 sound/oss/via82cxxx_audio.c             |   14 +--------
 sound/oss/ymfpci.c                      |    8 +----
 89 files changed, 217 insertions(+), 595 deletions(-)

# --- /mirror/kernel/v2.6/snapshots/patch-2.6.8-rc3-bk3.log	2004-08-08 11:28:00.000000000 +0200
# +++ /mirror/kernel/v2.6/snapshots/patch-2.6.8-rc3-bk4.log	2004-08-09 11:26:00.000000000 +0200
# @@ -1,3 +1,68 @@
# +ChangeSet@1.1952, 2004-08-08 21:29:26-07:00, torvalds@ppc970.osdl.org
# +  Merge bk://bk.arm.linux.org.uk/linux-2.6-rmk
# +  into ppc970.osdl.org:/home/torvalds/v2.6/linux
# +
# +ChangeSet@1.1951, 2004-08-08 14:22:10-07:00, torvalds@ppc970.osdl.org
# +  ppc64: add user annotations to rtc driver
# +
# +ChangeSet@1.1950, 2004-08-08 14:07:55-07:00, torvalds@ppc970.osdl.org
# +  Remove ESPIPE logic from drivers, letting the VFS layer handle it instead.
# +  
# +  This cleans up and simplifies drivers, and also allows us future
# +  simplification in the VFS layer, since it removes knowledge about
# +  internal VFS layer handling of "f_pos".
# +
# +ChangeSet@1.1948.1.6, 2004-08-08 19:16:21+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Fix wdt977 sparse warnings
# +  
# +  drivers/char/watchdog/wdt977.c:291:9: warning: incorrect type in initializer (different address spaces)
# +  drivers/char/watchdog/wdt977.c:291:9:    expected char const [noderef] *register __p<asn:1>
# +  drivers/char/watchdog/wdt977.c:291:9:    got char const *buf
# +  ...
# +
# +ChangeSet@1.1948.1.5, 2004-08-08 18:05:49+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Fix nwflash sparse warnings
# +
# +ChangeSet@1.1948.1.4, 2004-08-08 17:56:07+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Fix nwbutton sparse warnings
# +  
# +  drivers/char/nwbutton.c:177:24: warning: incorrect type in argument 1 (different address spaces)/home/rmk/bk/linux-2.6-rmk/drivers/char/nwbutton.c:177:24:    expected void [noderef] *to<asn:1>
# +  drivers/char/nwbutton.c:177:24:    got char *buffer
# +  drivers/char/nwbutton.c:177:24: warning: incorrect type in initializer (different address spaces)
# +  drivers/char/nwbutton.c:177:24:    expected void [noderef] *to<asn:1>
# +  drivers/char/nwbutton.c:177:24:    got char *buffer
# +  drivers/char/nwbutton.c:189:11: warning: incorrect type in initializer (incompatible argument 2 (different address spaces))
# +  drivers/char/nwbutton.c:189:11:    expected int [usertype] ( *read )( ... )
# +  drivers/char/nwbutton.c:189:11:    got int ( static [addressable] [toplevel] *<noident> )( ... )
# +
# +ChangeSet@1.1948.1.3, 2004-08-08 17:24:24+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Fix sparse warnings in ds1620.c
# +  
# +  drivers/char/ds1620.c:230:19: warning: incorrect type in argument 1 (different address spaces)
# +  drivers/char/ds1620.c:230:19:    expected void [noderef] *to<asn:1>
# +  drivers/char/ds1620.c:230:19:    got char *buf
# +  drivers/char/ds1620.c:230:19: warning: incorrect type in initializer (different address spaces)
# +  drivers/char/ds1620.c:230:19:    expected void [noderef] *to<asn:1>
# +  drivers/char/ds1620.c:230:19:    got char *buf
# +  ...
# +  drivers/char/ds1620.c:383:52: warning: Using plain integer as NULL pointer
# +
# +ChangeSet@1.1948.1.2, 2004-08-08 16:50:31+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Eliminate io.c sparse warnings/ gcc 3.4 errors.
# +  
# +  arch/arm/kernel/io.c:15:5: warning: generating address of non-lvalue
# +  arch/arm/kernel/io.c:15:5: warning: loading unknown expression
# +  arch/arm/kernel/io.c:29:5: warning: generating address of non-lvalue
# +  arch/arm/kernel/io.c:29:5: warning: loading unknown expression
# +
# +ChangeSet@1.1948.1.1, 2004-08-08 16:04:49+01:00, rmk@flint.arm.linux.org.uk
# +  [ARM] Fix sparse warnings in nwfpe.
# +  
# +  This fixes sparse warnings in fpa11_cpdt (coprocessor data transfer)
# +  instruction emulation.  Note that pointers need to be cast to unsigned
# +  long not unsigned int, so convert user registers to be unsigned long
# +  type.
# +
#  ChangeSet@1.1949, 2004-08-07 23:43:47-07:00, torvalds@ppc970.osdl.org
#    Make sysctl pass the pos pointer around properly.
#    

diff -p -purN linux-2.6.8-rc3-bk3/arch/arm/kernel/io.c linux-2.6.8-rc3-bk4/arch/arm/kernel/io.c
--- linux-2.6.8-rc3-bk3/arch/arm/kernel/io.c	2004-06-16 05:19:10.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/arm/kernel/io.c	2004-08-09 12:23:21.000000000 +0000
@@ -7,12 +7,13 @@
  * Copy data from IO memory space to "real" memory space.
  * This needs to be optimized.
  */
-void _memcpy_fromio(void * to, unsigned long from, size_t count)
+void _memcpy_fromio(void *to, unsigned long from, size_t count)
 {
+	unsigned char *t = to;
 	while (count) {
 		count--;
-		*(char *) to = readb(from);
-		((char *) to)++;
+		*t = readb(from);
+		t++;
 		from++;
 	}
 }
@@ -21,12 +22,13 @@ void _memcpy_fromio(void * to, unsigned 
  * Copy data from "real" memory space to IO memory space.
  * This needs to be optimized.
  */
-void _memcpy_toio(unsigned long to, const void * from, size_t count)
+void _memcpy_toio(unsigned long to, const void *from, size_t count)
 {
+	const unsigned char *f = from;
 	while (count) {
 		count--;
-		writeb(*(char *) from, to);
-		((char *) from)++;
+		writeb(*f, to);
+		f++;
 		to++;
 	}
 }
diff -p -purN linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpa11.h linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpa11.h
--- linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpa11.h	2004-06-16 05:19:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpa11.h	2004-08-09 12:23:21.000000000 +0000
@@ -29,7 +29,7 @@
  * stack+task struct.  Use the same method as 'current' uses to
  * reach them.
  */
-register unsigned int *user_registers asm("sl");
+register unsigned long *user_registers asm("sl");
 
 #define GET_USERREG() (user_registers)
 
diff -p -purN linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpa11_cpdt.c linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpa11_cpdt.c
--- linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpa11_cpdt.c	2004-06-16 05:20:04.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpa11_cpdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -29,14 +29,14 @@
 
 #include <asm/uaccess.h>
 
-static inline void loadSingle(const unsigned int Fn, const unsigned int *pMem)
+static inline void loadSingle(const unsigned int Fn, const unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	fpa11->fType[Fn] = typeSingle;
 	get_user(fpa11->fpreg[Fn].fSingle, pMem);
 }
 
-static inline void loadDouble(const unsigned int Fn, const unsigned int *pMem)
+static inline void loadDouble(const unsigned int Fn, const unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	unsigned int *p;
@@ -47,7 +47,7 @@ static inline void loadDouble(const unsi
 }
 
 #ifdef CONFIG_FPE_NWFPE_XP
-static inline void loadExtended(const unsigned int Fn, const unsigned int *pMem)
+static inline void loadExtended(const unsigned int Fn, const unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	unsigned int *p;
@@ -59,7 +59,7 @@ static inline void loadExtended(const un
 }
 #endif
 
-static inline void loadMultiple(const unsigned int Fn, const unsigned int *pMem)
+static inline void loadMultiple(const unsigned int Fn, const unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	register unsigned int *p;
@@ -91,7 +91,7 @@ static inline void loadMultiple(const un
 	}
 }
 
-static inline void storeSingle(const unsigned int Fn, unsigned int *pMem)
+static inline void storeSingle(const unsigned int Fn, unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	union {
@@ -117,7 +117,7 @@ static inline void storeSingle(const uns
 	put_user(val.i[0], pMem);
 }
 
-static inline void storeDouble(const unsigned int Fn, unsigned int *pMem)
+static inline void storeDouble(const unsigned int Fn, unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	union {
@@ -145,7 +145,7 @@ static inline void storeDouble(const uns
 }
 
 #ifdef CONFIG_FPE_NWFPE_XP
-static inline void storeExtended(const unsigned int Fn, unsigned int *pMem)
+static inline void storeExtended(const unsigned int Fn, unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	union {
@@ -172,7 +172,7 @@ static inline void storeExtended(const u
 }
 #endif
 
-static inline void storeMultiple(const unsigned int Fn, unsigned int *pMem)
+static inline void storeMultiple(const unsigned int Fn, unsigned int __user *pMem)
 {
 	FPA11 *fpa11 = GET_FPA11();
 	register unsigned int nType, *p;
@@ -204,10 +204,10 @@ static inline void storeMultiple(const u
 
 unsigned int PerformLDF(const unsigned int opcode)
 {
-	unsigned int *pBase, *pAddress, *pFinal, nRc = 1,
-	    write_back = WRITE_BACK(opcode);
+	unsigned int __user *pBase, *pAddress, *pFinal;
+	unsigned int nRc = 1, write_back = WRITE_BACK(opcode);
 
-	pBase = (unsigned int *) readRegister(getRn(opcode));
+	pBase = (unsigned int __user *) readRegister(getRn(opcode));
 	if (REG_PC == getRn(opcode)) {
 		pBase += 2;
 		write_back = 0;
@@ -241,18 +241,18 @@ unsigned int PerformLDF(const unsigned i
 	}
 
 	if (write_back)
-		writeRegister(getRn(opcode), (unsigned int) pFinal);
+		writeRegister(getRn(opcode), (unsigned long) pFinal);
 	return nRc;
 }
 
 unsigned int PerformSTF(const unsigned int opcode)
 {
-	unsigned int *pBase, *pAddress, *pFinal, nRc = 1,
-	    write_back = WRITE_BACK(opcode);
+	unsigned int __user *pBase, *pAddress, *pFinal;
+	unsigned int nRc = 1, write_back = WRITE_BACK(opcode);
 
 	SetRoundingMode(ROUND_TO_NEAREST);
 
-	pBase = (unsigned int *) readRegister(getRn(opcode));
+	pBase = (unsigned int __user *) readRegister(getRn(opcode));
 	if (REG_PC == getRn(opcode)) {
 		pBase += 2;
 		write_back = 0;
@@ -286,16 +286,16 @@ unsigned int PerformSTF(const unsigned i
 	}
 
 	if (write_back)
-		writeRegister(getRn(opcode), (unsigned int) pFinal);
+		writeRegister(getRn(opcode), (unsigned long) pFinal);
 	return nRc;
 }
 
 unsigned int PerformLFM(const unsigned int opcode)
 {
-	unsigned int i, Fd, *pBase, *pAddress, *pFinal,
-	    write_back = WRITE_BACK(opcode);
+	unsigned int __user *pBase, *pAddress, *pFinal;
+	unsigned int i, Fd, write_back = WRITE_BACK(opcode);
 
-	pBase = (unsigned int *) readRegister(getRn(opcode));
+	pBase = (unsigned int __user *) readRegister(getRn(opcode));
 	if (REG_PC == getRn(opcode)) {
 		pBase += 2;
 		write_back = 0;
@@ -322,16 +322,16 @@ unsigned int PerformLFM(const unsigned i
 	}
 
 	if (write_back)
-		writeRegister(getRn(opcode), (unsigned int) pFinal);
+		writeRegister(getRn(opcode), (unsigned long) pFinal);
 	return 1;
 }
 
 unsigned int PerformSFM(const unsigned int opcode)
 {
-	unsigned int i, Fd, *pBase, *pAddress, *pFinal,
-	    write_back = WRITE_BACK(opcode);
+	unsigned int __user *pBase, *pAddress, *pFinal;
+	unsigned int i, Fd, write_back = WRITE_BACK(opcode);
 
-	pBase = (unsigned int *) readRegister(getRn(opcode));
+	pBase = (unsigned int __user *) readRegister(getRn(opcode));
 	if (REG_PC == getRn(opcode)) {
 		pBase += 2;
 		write_back = 0;
@@ -358,7 +358,7 @@ unsigned int PerformSFM(const unsigned i
 	}
 
 	if (write_back)
-		writeRegister(getRn(opcode), (unsigned int) pFinal);
+		writeRegister(getRn(opcode), (unsigned long) pFinal);
 	return 1;
 }
 
diff -p -purN linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpmodule.c linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpmodule.c
--- linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpmodule.c	2004-06-16 05:19:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpmodule.c	2004-08-09 12:23:21.000000000 +0000
@@ -131,7 +131,7 @@ void float_raise(signed char flags)
 
 #ifdef CONFIG_DEBUG_USER
 	printk(KERN_DEBUG
-	       "NWFPE: %s[%d] takes exception %08x at %p from %08x\n",
+	       "NWFPE: %s[%d] takes exception %08x at %p from %08lx\n",
 	       current->comm, current->pid, flags,
 	       __builtin_return_address(0), GET_USERREG()[15]);
 #endif
diff -p -purN linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpmodule.inl linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpmodule.inl
--- linux-2.6.8-rc3-bk3/arch/arm/nwfpe/fpmodule.inl	2004-06-16 05:20:03.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/arm/nwfpe/fpmodule.inl	2004-08-09 12:23:21.000000000 +0000
@@ -19,8 +19,7 @@
     Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
 */
 
-extern __inline__
-unsigned int readRegister(const unsigned int nReg)
+static inline unsigned long readRegister(const unsigned int nReg)
 {
 	/* Note: The CPU thinks it has dealt with the current instruction.
 	   As a result the program counter has been advanced to the next
@@ -29,34 +28,31 @@ unsigned int readRegister(const unsigned
 	   for this in this routine.  LDF/STF instructions with Rn = PC
 	   depend on the PC being correct, as they use PC+8 in their
 	   address calculations. */
-	unsigned int *userRegisters = GET_USERREG();
+	unsigned long *userRegisters = GET_USERREG();
 	unsigned int val = userRegisters[nReg];
 	if (REG_PC == nReg)
 		val -= 4;
 	return val;
 }
 
-extern __inline__
-void writeRegister(const unsigned int nReg, const unsigned int val)
+static inline void
+writeRegister(const unsigned int nReg, const unsigned long val)
 {
-	unsigned int *userRegisters = GET_USERREG();
+	unsigned long *userRegisters = GET_USERREG();
 	userRegisters[nReg] = val;
 }
 
-extern __inline__
-unsigned int readCPSR(void)
+static inline unsigned long readCPSR(void)
 {
 	return (readRegister(REG_CPSR));
 }
 
-extern __inline__
-void writeCPSR(const unsigned int val)
+static inline void writeCPSR(const unsigned long val)
 {
 	writeRegister(REG_CPSR, val);
 }
 
-extern __inline__
-unsigned int readConditionCodes(void)
+static inline unsigned long readConditionCodes(void)
 {
 #ifdef __FPEM_TEST__
 	return (0);
@@ -65,11 +61,10 @@ unsigned int readConditionCodes(void)
 #endif
 }
 
-extern __inline__
-void writeConditionCodes(const unsigned int val)
+static inline void writeConditionCodes(const unsigned long val)
 {
-	unsigned int *userRegisters = GET_USERREG();
-	unsigned int rval;
+	unsigned long *userRegisters = GET_USERREG();
+	unsigned long rval;
 	/*
 	 * Operate directly on userRegisters since
 	 * the CPSR may be the PC register itself.
@@ -77,9 +72,3 @@ void writeConditionCodes(const unsigned 
 	rval = userRegisters[REG_CPSR] & ~CC_MASK;
 	userRegisters[REG_CPSR] = rval | (val & CC_MASK);
 }
-
-extern __inline__
-unsigned int readMemoryInt(unsigned int *pMem)
-{
-	return *pMem;
-}
diff -p -purN linux-2.6.8-rc3-bk3/arch/ia64/kernel/perfmon.c linux-2.6.8-rc3-bk4/arch/ia64/kernel/perfmon.c
--- linux-2.6.8-rc3-bk3/arch/ia64/kernel/perfmon.c	2004-08-09 12:22:17.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/ia64/kernel/perfmon.c	2004-08-09 12:23:21.000000000 +0000
@@ -1512,13 +1512,6 @@ exit_pfm_fs(void)
 	mntput(pfmfs_mnt);
 }
 
-static loff_t
-pfm_lseek(struct file *file, loff_t offset, int whence)
-{
-	DPRINT(("pfm_lseek called\n"));
-	return -ESPIPE;
-}
-
 static ssize_t
 pfm_read(struct file *filp, char *buf, size_t size, loff_t *ppos)
 {
@@ -1545,10 +1538,6 @@ pfm_read(struct file *filp, char *buf, s
 		DPRINT(("message is too small ctx=%p (>=%ld)\n", ctx, sizeof(pfm_msg_t)));
 		return -EINVAL;
 	}
-	/*
-	 * seeks are not allowed on message queues
-	 */
-	if (ppos != &filp->f_pos) return -ESPIPE;
 
 	PROTECT_CTX(ctx, flags);
 
@@ -2141,7 +2130,7 @@ pfm_no_open(struct inode *irrelevant, st
 
 
 static struct file_operations pfm_file_ops = {
-	.llseek   = pfm_lseek,
+	.llseek   = no_llseek,
 	.read     = pfm_read,
 	.write    = pfm_write,
 	.poll     = pfm_poll,
diff -p -purN linux-2.6.8-rc3-bk3/arch/ppc/8xx_io/cs4218_tdm.c linux-2.6.8-rc3-bk4/arch/ppc/8xx_io/cs4218_tdm.c
--- linux-2.6.8-rc3-bk3/arch/ppc/8xx_io/cs4218_tdm.c	2004-08-09 12:22:17.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/ppc/8xx_io/cs4218_tdm.c	2004-08-09 12:23:21.000000000 +0000
@@ -1619,7 +1619,7 @@ static ssize_t sound_copy_translate_read
 static int mixer_open(struct inode *inode, struct file *file)
 {
 	mixer.busy = 1;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -2105,7 +2105,7 @@ static int sq_open(struct inode *inode, 
 		sound_set_format(AFMT_MU_LAW);
 	}
 
-	return 0;
+	return nonseekable_open(inode, file);
 
 err_out_nobusy:
 	if (file->f_mode & FMODE_WRITE) {
@@ -2404,7 +2404,7 @@ static int state_open(struct inode *inod
 	len += sprintf(buffer+len, "\tsq.active = %d sq.syncing = %d\n",
 		       sq.active, sq.syncing);
 	state.len = len;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
diff -p -purN linux-2.6.8-rc3-bk3/arch/ppc64/kernel/rtc.c linux-2.6.8-rc3-bk4/arch/ppc64/kernel/rtc.c
--- linux-2.6.8-rc3-bk3/arch/ppc64/kernel/rtc.c	2004-08-09 12:22:17.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/ppc64/kernel/rtc.c	2004-08-09 12:23:21.000000000 +0000
@@ -56,9 +56,7 @@ extern int piranha_simulator;
  *	ioctls.
  */
 
-static loff_t rtc_llseek(struct file *file, loff_t offset, int origin);
-
-static ssize_t rtc_read(struct file *file, char *buf,
+static ssize_t rtc_read(struct file *file, char __user *buf,
 			size_t count, loff_t *ppos);
 
 static int rtc_ioctl(struct inode *inode, struct file *file,
@@ -81,12 +79,7 @@ static const unsigned char days_in_mo[] 
  *	Now all the various file operations that we export.
  */
 
-static loff_t rtc_llseek(struct file *file, loff_t offset, int origin)
-{
-	return -ESPIPE;
-}
-
-static ssize_t rtc_read(struct file *file, char *buf,
+static ssize_t rtc_read(struct file *file, char __user *buf,
 			size_t count, loff_t *ppos)
 {
 	return -EIO;
@@ -113,7 +106,7 @@ static int rtc_ioctl(struct inode *inode
 		if (!capable(CAP_SYS_TIME))
 			return -EACCES;
 
-		if (copy_from_user(&rtc_tm, (struct rtc_time*)arg,
+		if (copy_from_user(&rtc_tm, (struct rtc_time __user *)arg,
 				   sizeof(struct rtc_time)))
 			return -EFAULT;
 
@@ -147,7 +140,7 @@ static int rtc_ioctl(struct inode *inode
 	}
 	case RTC_EPOCH_READ:	/* Read the epoch.	*/
 	{
-		return put_user (epoch, (unsigned long *)arg);
+		return put_user (epoch, (unsigned long __user *)arg);
 	}
 	case RTC_EPOCH_SET:	/* Set the epoch.	*/
 	{
@@ -166,11 +159,12 @@ static int rtc_ioctl(struct inode *inode
 	default:
 		return -EINVAL;
 	}
-	return copy_to_user((void *)arg, &wtime, sizeof wtime) ? -EFAULT : 0;
+	return copy_to_user((void __user *)arg, &wtime, sizeof wtime) ? -EFAULT : 0;
 }
 
 static int rtc_open(struct inode *inode, struct file *file)
 {
+	nonseekable_open(inode, file);
 	return 0;
 }
 
@@ -184,7 +178,7 @@ static int rtc_release(struct inode *ino
  */
 static struct file_operations rtc_fops = {
 	.owner =	THIS_MODULE,
-	.llseek =	rtc_llseek,
+	.llseek =	no_llseek,
 	.read =		rtc_read,
 	.ioctl =	rtc_ioctl,
 	.open =		rtc_open,
diff -p -purN linux-2.6.8-rc3-bk3/arch/um/drivers/harddog_kern.c linux-2.6.8-rc3-bk4/arch/um/drivers/harddog_kern.c
--- linux-2.6.8-rc3-bk3/arch/um/drivers/harddog_kern.c	2004-06-16 05:19:37.000000000 +0000
+++ linux-2.6.8-rc3-bk4/arch/um/drivers/harddog_kern.c	2004-08-09 12:23:21.000000000 +0000
@@ -82,7 +82,7 @@ static int harddog_open(struct inode *in
 
 	timer_alive = 1;
 	unlock_kernel();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 extern void stop_watchdog(int in_fd, int out_fd);
@@ -108,10 +108,6 @@ extern int ping_watchdog(int fd);
 static ssize_t harddog_write(struct file *file, const char *data, size_t len,
 			     loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/*
 	 *	Refresh the timer.
 	 */
diff -p -purN linux-2.6.8-rc3-bk3/drivers/bluetooth/hci_vhci.c linux-2.6.8-rc3-bk4/drivers/bluetooth/hci_vhci.c
--- linux-2.6.8-rc3-bk3/drivers/bluetooth/hci_vhci.c	2004-06-16 05:20:04.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/bluetooth/hci_vhci.c	2004-08-09 12:23:21.000000000 +0000
@@ -302,7 +302,7 @@ static int hci_vhci_chr_open(struct inod
 	}
 
 	file->private_data = hci_vhci;
-	return 0;   
+	return nonseekable_open(inode, file);   
 }
 
 static int hci_vhci_chr_close(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/ds1620.c linux-2.6.8-rc3-bk4/drivers/char/ds1620.c
--- linux-2.6.8-rc3-bk3/drivers/char/ds1620.c	2004-08-09 12:23:14.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/ds1620.c	2004-08-09 12:23:21.000000000 +0000
@@ -213,7 +213,7 @@ static void ds1620_read_state(struct the
 }
 
 static ssize_t
-ds1620_read(struct file *file, char *buf, size_t count, loff_t *ptr)
+ds1620_read(struct file *file, char __user *buf, size_t count, loff_t *ptr)
 {
 	signed int cur_temp;
 	signed char cur_temp_degF;
@@ -233,8 +233,14 @@ static int
 ds1620_ioctl(struct inode *inode, struct file *file, unsigned int cmd, unsigned long arg)
 {
 	struct therm therm;
+	union {
+		struct therm __user *therm;
+		int __user *i;
+	} uarg;
 	int i;
 
+	uarg.i = (int __user *)arg;
+
 	switch(cmd) {
 	case CMD_SET_THERMOSTATE:
 	case CMD_SET_THERMOSTATE2:
@@ -242,11 +248,11 @@ ds1620_ioctl(struct inode *inode, struct
 			return -EPERM;
 
 		if (cmd == CMD_SET_THERMOSTATE) {
-			if (get_user(therm.hi, (int *)arg))
+			if (get_user(therm.hi, uarg.i))
 				return -EFAULT;
 			therm.lo = therm.hi - 3;
 		} else {
-			if (copy_from_user(&therm, (void *)arg, sizeof(therm)))
+			if (copy_from_user(&therm, uarg.therm, sizeof(therm)))
 				return -EFAULT;
 		}
 
@@ -264,10 +270,10 @@ ds1620_ioctl(struct inode *inode, struct
 		therm.hi >>= 1;
 
 		if (cmd == CMD_GET_THERMOSTATE) {
-			if (put_user(therm.hi, (int *)arg))
+			if (put_user(therm.hi, uarg.i))
 				return -EFAULT;
 		} else {
-			if (copy_to_user((void *)arg, &therm, sizeof(therm)))
+			if (copy_to_user(uarg.therm, &therm, sizeof(therm)))
 				return -EFAULT;
 		}
 		break;
@@ -279,23 +285,23 @@ ds1620_ioctl(struct inode *inode, struct
 		if (cmd == CMD_GET_TEMPERATURE)
 			i >>= 1;
 
-		return put_user(i, (int *)arg) ? -EFAULT : 0;
+		return put_user(i, uarg.i) ? -EFAULT : 0;
 
 	case CMD_GET_STATUS:
 		i = ds1620_in(THERM_READ_CONFIG, 8) & 0xe3;
 
-		return put_user(i, (int *)arg) ? -EFAULT : 0;
+		return put_user(i, uarg.i) ? -EFAULT : 0;
 
 	case CMD_GET_FAN:
 		i = netwinder_get_fan();
 
-		return put_user(i, (int *)arg) ? -EFAULT : 0;
+		return put_user(i, uarg.i) ? -EFAULT : 0;
 
 	case CMD_SET_FAN:
 		if (!capable(CAP_SYS_ADMIN))
 			return -EPERM;
 
-		if (get_user(i, (int *)arg))
+		if (get_user(i, uarg.i))
 			return -EFAULT;
 
 		netwinder_set_fan(i);
@@ -377,7 +383,7 @@ static int __init ds1620_init(void)
 		return ret;
 
 #ifdef THERM_USE_PROC
-	proc_therm_ds1620 = create_proc_entry("therm", 0, 0);
+	proc_therm_ds1620 = create_proc_entry("therm", 0, NULL);
 	if (proc_therm_ds1620)
 		proc_therm_ds1620->read_proc = proc_therm_ds1620_read;
 	else
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/dtlk.c linux-2.6.8-rc3-bk4/drivers/char/dtlk.c
--- linux-2.6.8-rc3-bk3/drivers/char/dtlk.c	2004-08-09 12:23:14.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/dtlk.c	2004-08-09 12:23:21.000000000 +0000
@@ -176,10 +176,6 @@ static ssize_t dtlk_write(struct file *f
 	}
 #endif
 
-	/* Can't seek (pwrite) on the DoubleTalk.  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (iminor(file->f_dentry->d_inode) != DTLK_MINOR)
 		return -EINVAL;
 
@@ -304,7 +300,7 @@ static int dtlk_open(struct inode *inode
 	case DTLK_MINOR:
 		if (dtlk_busy)
 			return -EBUSY;
-		return 0;
+		return nonseekable_open(inode, file);
 
 	default:
 		return -ENXIO;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/ftape/zftape/zftape-init.c linux-2.6.8-rc3-bk4/drivers/char/ftape/zftape/zftape-init.c
--- linux-2.6.8-rc3-bk3/drivers/char/ftape/zftape/zftape-init.c	2004-08-09 12:22:18.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/ftape/zftape/zftape-init.c	2004-08-09 12:23:21.000000000 +0000
@@ -113,6 +113,7 @@ static int zft_open(struct inode *ino, s
 	int result;
 	TRACE_FUN(ft_t_flow);
 
+	nonseekable_open(ino, filep);
 	TRACE(ft_t_flow, "called for minor %d", iminor(ino));
 	if ( test_and_set_bit(0,&busy_flag) ) {
 		TRACE_ABORT(-EBUSY, ft_t_warn, "failed: already busy");
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/ipmi/ipmi_watchdog.c linux-2.6.8-rc3-bk4/drivers/char/ipmi/ipmi_watchdog.c
--- linux-2.6.8-rc3-bk3/drivers/char/ipmi/ipmi_watchdog.c	2004-08-09 12:22:18.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/ipmi/ipmi_watchdog.c	2004-08-09 12:23:21.000000000 +0000
@@ -598,10 +598,6 @@ static ssize_t ipmi_write(struct file *f
 {
 	int rv;
 
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		rv = ipmi_heartbeat();
 		if (rv)
@@ -619,10 +615,6 @@ static ssize_t ipmi_read(struct file *fi
 	int          rv = 0;
 	wait_queue_t wait;
 
-	/*  Can't seek (pread) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count <= 0)
 		return 0;
 
@@ -678,7 +670,7 @@ static int ipmi_open(struct inode *ino, 
 		    /* Don't start the timer now, let it start on the
 		       first heartbeat. */
 		    ipmi_start_timer_on_heartbeat = 1;
-                    return(0);
+                    return nonseekable_open(ino, filep);
 
                 default:
                     return (-ENODEV);
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/nwbutton.c linux-2.6.8-rc3-bk4/drivers/char/nwbutton.c
--- linux-2.6.8-rc3-bk3/drivers/char/nwbutton.c	2004-06-16 05:20:04.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/nwbutton.c	2004-08-09 12:23:21.000000000 +0000
@@ -170,7 +170,7 @@ static irqreturn_t button_handler (int i
  * device at any one time.
  */
 
-static int button_read (struct file *filp, char *buffer,
+static int button_read (struct file *filp, char __user *buffer,
 			size_t count, loff_t *ppos)
 {
 	interruptible_sleep_on (&button_wait_queue);
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/nwbutton.h linux-2.6.8-rc3-bk4/drivers/char/nwbutton.h
--- linux-2.6.8-rc3-bk3/drivers/char/nwbutton.h	2004-06-16 05:19:02.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/nwbutton.h	2004-08-09 12:23:21.000000000 +0000
@@ -26,8 +26,6 @@ struct button_callback {
 
 static void button_sequence_finished (unsigned long parameters);
 static irqreturn_t button_handler (int irq, void *dev_id, struct pt_regs *regs);
-static int button_read (struct file *filp, char *buffer,
-			size_t count, loff_t *ppos);
 int button_init (void);
 int button_add_callback (void (*callback) (void), int count);
 int button_del_callback (void (*callback) (void));
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/nwflash.c linux-2.6.8-rc3-bk4/drivers/char/nwflash.c
--- linux-2.6.8-rc3-bk3/drivers/char/nwflash.c	2004-06-16 05:20:26.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/nwflash.c	2004-08-09 12:23:21.000000000 +0000
@@ -43,11 +43,7 @@
 static void kick_open(void);
 static int get_flash_id(void);
 static int erase_block(int nBlock);
-static int write_block(unsigned long p, const char *buf, int count);
-static int flash_ioctl(struct inode *inodep, struct file *filep, unsigned int cmd, unsigned long arg);
-static ssize_t flash_read(struct file *file, char *buf, size_t count, loff_t * ppos);
-static ssize_t flash_write(struct file *file, const char *buf, size_t count, loff_t * ppos);
-static loff_t flash_llseek(struct file *file, loff_t offset, int orig);
+static int write_block(unsigned long p, const char __user *buf, int count);
 
 #define KFLASH_SIZE	1024*1024	//1 Meg
 #define KFLASH_SIZE4	4*1024*1024	//4 Meg
@@ -132,15 +128,16 @@ static int flash_ioctl(struct inode *ino
 	return 0;
 }
 
-static ssize_t flash_read(struct file *file, char *buf, size_t size, loff_t * ppos)
+static ssize_t flash_read(struct file *file, char __user *buf, size_t size,
+			  loff_t *ppos)
 {
 	unsigned long p = *ppos;
 	unsigned int count = size;
 	int ret = 0;
 
 	if (flashdebug)
-		printk(KERN_DEBUG "flash_read: flash_read: offset=0x%lX, buffer=%p, count=0x%X.\n",
-		       p, buf, count);
+		printk(KERN_DEBUG "flash_read: flash_read: offset=0x%lX, "
+		       "buffer=%p, count=0x%X.\n", p, buf, count);
 
 	if (count)
 		ret = -ENXIO;
@@ -166,7 +163,8 @@ static ssize_t flash_read(struct file *f
 	return ret;
 }
 
-static ssize_t flash_write(struct file *file, const char *buf, size_t size, loff_t * ppos)
+static ssize_t flash_write(struct file *file, const char __user *buf,
+			   size_t size, loff_t * ppos)
 {
 	unsigned long p = *ppos;
 	unsigned int count = size;
@@ -244,8 +242,9 @@ static ssize_t flash_write(struct file *
 			break;
 		}
 		if (flashdebug)
-			printk(KERN_DEBUG "flash_write: writing offset %lX, from buf "
-				"%p, bytes left %X.\n", p, buf, count - written);
+			printk(KERN_DEBUG "flash_write: writing offset %lX, "
+			       "from buf %p, bytes left %X.\n", p, buf,
+			       count - written);
 
 		/*
 		 * write_block will limit write to space left in this block
@@ -460,7 +459,7 @@ static int erase_block(int nBlock)
 /*
  * write_block will limit number of bytes written to the space in this block
  */
-static int write_block(unsigned long p, const char *buf, int count)
+static int write_block(unsigned long p, const char __user *buf, int count)
 {
 	volatile unsigned int c1;
 	volatile unsigned int c2;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/scx200_gpio.c linux-2.6.8-rc3-bk4/drivers/char/scx200_gpio.c
--- linux-2.6.8-rc3-bk3/drivers/char/scx200_gpio.c	2004-06-16 05:18:52.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/scx200_gpio.c	2004-08-09 12:23:21.000000000 +0000
@@ -32,9 +32,6 @@ static ssize_t scx200_gpio_write(struct 
 	unsigned m = iminor(file->f_dentry->d_inode);
 	size_t i;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	for (i = 0; i < len; ++i) {
 		char c;
 		if (get_user(c, data+i))
@@ -83,9 +80,6 @@ static ssize_t scx200_gpio_read(struct f
 	unsigned m = iminor(file->f_dentry->d_inode);
 	int value;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	value = scx200_gpio_get(m);
 	if (put_user(value ? '1' : '0', buf))
 		return -EFAULT;
@@ -98,7 +92,7 @@ static int scx200_gpio_open(struct inode
 	unsigned m = iminor(inode);
 	if (m > 63)
 		return -EINVAL;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int scx200_gpio_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/tipar.c linux-2.6.8-rc3-bk4/drivers/char/tipar.c
--- linux-2.6.8-rc3-bk3/drivers/char/tipar.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/tipar.c	2004-08-09 12:23:21.000000000 +0000
@@ -262,7 +262,7 @@ tipar_open(struct inode *inode, struct f
 	init_ti_parallel(minor);
 	parport_release(table[minor].dev);
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
@@ -316,9 +316,6 @@ tipar_read(struct file *file, char __use
 	if (count == 0)
 		return 0;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	parport_claim_or_block(table[minor].dev);
 
 	while (n < count) {
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/acquirewdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/acquirewdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/acquirewdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/acquirewdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -113,10 +113,6 @@ static void acq_stop(void)
 
 static ssize_t acq_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if(count) {
 		if (!nowayout) {
@@ -206,7 +202,7 @@ static int acq_open(struct inode *inode,
 
 	/* Activate */
 	acq_keepalive();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int acq_close(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/advantechwdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/advantechwdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/advantechwdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/advantechwdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -102,10 +102,6 @@ advwdt_disable(void)
 static ssize_t
 advwdt_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
@@ -200,7 +196,7 @@ advwdt_open(struct inode *inode, struct 
 	 */
 
 	advwdt_ping();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/alim1535_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/alim1535_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/alim1535_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/alim1535_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -141,10 +141,6 @@ static int ali_settimer(int t)
 static ssize_t ali_write(struct file *file, const char __user *data,
 			      size_t len, loff_t * ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if (len) {
 		if (!nowayout) {
@@ -266,7 +262,7 @@ static int ali_open(struct inode *inode,
 
 	/* Activate */
 	ali_start();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /*
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/alim7101_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/alim7101_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/alim7101_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/alim7101_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -150,10 +150,6 @@ static void wdt_keepalive(void)
 
 static ssize_t fop_write(struct file * file, const char __user * buf, size_t count, loff_t * ppos)
 {
-	/* We can't seek */
-	if(ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if(count) {
 		if (!nowayout) {
@@ -185,7 +181,7 @@ static int fop_open(struct inode * inode
 		return -EBUSY;
 	/* Good, fire up the show */
 	wdt_startup();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int fop_close(struct inode * inode, struct file * file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/eurotechwdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/eurotechwdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/eurotechwdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/eurotechwdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -199,10 +199,6 @@ static void eurwdt_ping(void)
 static ssize_t eurwdt_write(struct file *file, const char __user *buf,
 size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-	return -ESPIPE;
-
 	if (count) 	{
 		if (!nowayout) {
 			size_t i;
@@ -310,7 +306,7 @@ static int eurwdt_open(struct inode *ino
 	eurwdt_timeout = WDT_TIMEOUT;	/* initial timeout */
 	/* Activate the WDT */
 	eurwdt_activate_timer();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/i8xx_tco.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/i8xx_tco.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/i8xx_tco.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/i8xx_tco.c	2004-08-09 12:23:21.000000000 +0000
@@ -193,7 +193,7 @@ static int i8xx_tco_open (struct inode *
 	 */
 	tco_timer_keepalive ();
 	tco_timer_start ();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int i8xx_tco_release (struct inode *inode, struct file *file)
@@ -215,10 +215,6 @@ static int i8xx_tco_release (struct inod
 static ssize_t i8xx_tco_write (struct file *file, const char __user *data,
 			      size_t len, loff_t * ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if (len) {
 		if (!nowayout) {
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/ib700wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/ib700wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/ib700wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/ib700wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -141,10 +141,6 @@ ibwdt_ping(void)
 static ssize_t
 ibwdt_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
@@ -228,7 +224,7 @@ ibwdt_open(struct inode *inode, struct f
 	/* Activate */
 	ibwdt_ping();
 	spin_unlock(&ibwdt_lock);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/indydog.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/indydog.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/indydog.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/indydog.c	2004-08-09 12:23:21.000000000 +0000
@@ -81,7 +81,7 @@ static int indydog_open(struct inode *in
 	indydog_alive = 1;
 	printk(KERN_INFO "Started watchdog timer.\n");
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int indydog_release(struct inode *inode, struct file *file)
@@ -98,10 +98,6 @@ static int indydog_release(struct inode 
 
 static ssize_t indydog_write(struct file *file, const char *data, size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* Refresh the timer. */
 	if (len) {
 		indydog_ping();
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/ixp2000_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/ixp2000_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/ixp2000_wdt.c	2004-08-03 21:30:14.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/ixp2000_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -74,16 +74,12 @@ ixp2000_wdt_open(struct inode *inode, st
 
 	wdt_enable();
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static ssize_t
 ixp2000_wdt_write(struct file *file, const char *data, size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		if (!nowayout) {
 			size_t i;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/ixp4xx_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/ixp4xx_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/ixp4xx_wdt.c	2004-06-16 05:19:52.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/ixp4xx_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -69,16 +69,12 @@ ixp4xx_wdt_open(struct inode *inode, str
 
 	wdt_enable();
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static ssize_t
 ixp4xx_wdt_write(struct file *file, const char *data, size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		if (!nowayout) {
 			size_t i;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/machzwd.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/machzwd.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/machzwd.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/machzwd.c	2004-08-09 12:23:21.000000000 +0000
@@ -305,10 +305,6 @@ static void zf_ping(unsigned long data)
 static ssize_t zf_write(struct file *file, const char __user *buf, size_t count,
 								loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character */
 	if(count){
 
@@ -389,7 +385,7 @@ static int zf_open(struct inode *inode, 
 
 	zf_timer_on();
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int zf_close(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/mixcomwd.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/mixcomwd.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/mixcomwd.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/mixcomwd.c	2004-08-09 12:23:21.000000000 +0000
@@ -108,7 +108,7 @@ static int mixcomwd_open(struct inode *i
 			mixcomwd_timer_alive=0;
 		}
 	}
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int mixcomwd_release(struct inode *inode, struct file *file)
@@ -136,10 +136,6 @@ static int mixcomwd_release(struct inode
 
 static ssize_t mixcomwd_write(struct file *file, const char __user *data, size_t len, loff_t *ppos)
 {
-	if (ppos != &file->f_pos) {
-		return -ESPIPE;
-	}
-
 	if(len)
 	{
 		if (!nowayout) {
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd.c	2004-06-16 05:18:57.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd.c	2004-08-09 12:23:21.000000000 +0000
@@ -485,10 +485,6 @@ static int pcwd_ioctl(struct inode *inod
 static ssize_t pcwd_write(struct file *file, const char __user *buf, size_t len,
 			  loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		if (!nowayout) {
 			size_t i;
@@ -523,7 +519,7 @@ static int pcwd_open(struct inode *inode
 	/* Activate */
 	pcwd_start();
 	pcwd_keepalive();
-	return(0);
+	return nonseekable_open(inode, file);
 }
 
 static int pcwd_close(struct inode *inode, struct file *file)
@@ -548,10 +544,6 @@ static ssize_t pcwd_temp_read(struct fil
 {
 	int temperature;
 
-	/* Can't seek (pread) on this device */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (pcwd_get_temperature(&temperature))
 		return -EFAULT;
 
@@ -566,7 +558,7 @@ static int pcwd_temp_open(struct inode *
 	if (!supports_temp)
 		return -ENODEV;
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int pcwd_temp_close(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd_pci.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd_pci.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd_pci.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd_pci.c	2004-08-09 12:23:21.000000000 +0000
@@ -261,10 +261,6 @@ static int pcipcwd_get_temperature(int *
 static ssize_t pcipcwd_write(struct file *file, const char __user *data,
 			      size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if (len) {
 		if (!nowayout) {
@@ -392,7 +388,7 @@ static int pcipcwd_open(struct inode *in
 	/* Activate */
 	pcipcwd_start();
 	pcipcwd_keepalive();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int pcipcwd_release(struct inode *inode, struct file *file)
@@ -420,10 +416,6 @@ static ssize_t pcipcwd_temp_read(struct 
 {
 	int temperature;
 
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (pcipcwd_get_temperature(&temperature))
 		return -EFAULT;
 
@@ -438,7 +430,7 @@ static int pcipcwd_temp_open(struct inod
 	if (!pcipcwd_private.supports_temp)
 		return -ENODEV;
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int pcipcwd_temp_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd_usb.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd_usb.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/pcwd_usb.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/pcwd_usb.c	2004-08-09 12:23:21.000000000 +0000
@@ -329,10 +329,6 @@ static int usb_pcwd_get_temperature(stru
 static ssize_t usb_pcwd_write(struct file *file, const char __user *data,
 			      size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if (len) {
 		if (!nowayout) {
@@ -445,7 +441,7 @@ static int usb_pcwd_open(struct inode *i
 	/* Activate */
 	usb_pcwd_start(usb_pcwd_device);
 	usb_pcwd_keepalive(usb_pcwd_device);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int usb_pcwd_release(struct inode *inode, struct file *file)
@@ -473,10 +469,6 @@ static ssize_t usb_pcwd_temperature_read
 {
 	int temperature;
 
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (usb_pcwd_get_temperature(usb_pcwd_device, &temperature))
 		return -EFAULT;
 
@@ -488,7 +480,7 @@ static ssize_t usb_pcwd_temperature_read
 
 static int usb_pcwd_temperature_open(struct inode *inode, struct file *file)
 {
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int usb_pcwd_temperature_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/sa1100_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/sa1100_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/sa1100_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/sa1100_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -49,6 +49,7 @@ static int nowayout = 0;
  */
 static int sa1100dog_open(struct inode *inode, struct file *file)
 {
+	nonseekable_open(inode, file);
 	if (test_and_set_bit(1,&sa1100wdt_users))
 		return -EBUSY;
 
@@ -84,10 +85,6 @@ static int sa1100dog_release(struct inod
 
 static ssize_t sa1100dog_write(struct file *file, const char *data, size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		if (!nowayout) {
 			size_t i;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/sbc60xxwdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/sbc60xxwdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/sbc60xxwdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/sbc60xxwdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -168,10 +168,6 @@ static void wdt_keepalive(void)
 
 static ssize_t fop_write(struct file * file, const char __user * buf, size_t count, loff_t * ppos)
 {
-	/* We can't seek */
-	if(ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if(count)
 	{
@@ -202,6 +198,8 @@ static ssize_t fop_write(struct file * f
 
 static int fop_open(struct inode * inode, struct file * file)
 {
+	nonseekable_open(inode, file);
+
 	/* Just in case we're already talking to someone... */
 	if(test_and_set_bit(0, &wdt_is_open))
 		return -EBUSY;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/sc1200wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/sc1200wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/sc1200wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/sc1200wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -157,6 +157,8 @@ static inline int sc1200wdt_status(void)
 
 static int sc1200wdt_open(struct inode *inode, struct file *file)
 {
+	nonseekable_open(inode, file);
+
 	/* allow one at a time */
 	if (down_trylock(&open_sem))
 		return -EBUSY;
@@ -258,9 +260,6 @@ static int sc1200wdt_release(struct inod
 
 static ssize_t sc1200wdt_write(struct file *file, const char __user *data, size_t len, loff_t *ppos)
 {
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (len) {
 		if (!nowayout) {
 			size_t i;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/sc520_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/sc520_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/sc520_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/sc520_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -227,10 +227,6 @@ static int wdt_set_heartbeat(int t)
 
 static ssize_t fop_write(struct file * file, const char __user * buf, size_t count, loff_t * ppos)
 {
-	/* We can't seek */
-	if(ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if(count) {
 		if (!nowayout) {
@@ -258,6 +254,8 @@ static ssize_t fop_write(struct file * f
 
 static int fop_open(struct inode * inode, struct file * file)
 {
+	nonseekable_open(inode, file);
+
 	/* Just in case we're already talking to someone... */
 	if(test_and_set_bit(0, &wdt_is_open))
 		return -EBUSY;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/scx200_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/scx200_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/scx200_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/scx200_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -101,7 +101,7 @@ static int scx200_wdt_open(struct inode 
 		return -EBUSY;
 	scx200_wdt_enable();
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int scx200_wdt_release(struct inode *inode, struct file *file)
@@ -135,9 +135,6 @@ static struct notifier_block scx200_wdt_
 static ssize_t scx200_wdt_write(struct file *file, const char __user *data,
 				     size_t len, loff_t *ppos)
 {
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* check for a magic close character */
 	if (len)
 	{
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/shwdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/shwdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/shwdt.c	2004-06-16 05:19:09.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/shwdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -209,7 +209,7 @@ static int sh_wdt_open(struct inode *ino
 
 	sh_wdt_start();
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
@@ -248,10 +248,6 @@ static int sh_wdt_close(struct inode *in
 static ssize_t sh_wdt_write(struct file *file, const char *buf,
 			    size_t count, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/softdog.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/softdog.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/softdog.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/softdog.c	2004-08-09 12:23:21.000000000 +0000
@@ -141,7 +141,7 @@ static int softdog_open(struct inode *in
 	 *	Activate timer
 	 */
 	softdog_keepalive();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int softdog_release(struct inode *inode, struct file *file)
@@ -163,10 +163,6 @@ static int softdog_release(struct inode 
 
 static ssize_t softdog_write(struct file *file, const char __user *data, size_t len, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/*
 	 *	Refresh the timer.
 	 */
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/w83627hf_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/w83627hf_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/w83627hf_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/w83627hf_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -144,10 +144,6 @@ wdt_set_heartbeat(int t)
 static ssize_t
 wdt_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
@@ -241,7 +237,7 @@ wdt_open(struct inode *inode, struct fil
 	 */
 
 	wdt_ping();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/w83877f_wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/w83877f_wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/w83877f_wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/w83877f_wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -190,10 +190,6 @@ static void wdt_keepalive(void)
 
 static ssize_t fop_write(struct file * file, const char __user * buf, size_t count, loff_t * ppos)
 {
-	/* We can't seek */
-	if(ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if(count)
 	{
@@ -230,7 +226,7 @@ static int fop_open(struct inode * inode
 
 	/* Good, fire up the show */
 	wdt_startup();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int fop_close(struct inode * inode, struct file * file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/wafer5823wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/wafer5823wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/wafer5823wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/wafer5823wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -97,10 +97,6 @@ wafwdt_stop(void)
 
 static ssize_t wafwdt_write(struct file *file, const char __user *buf, size_t count, loff_t * ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/* See if we got the magic character 'V' and reload the timer */
 	if (count) {
 		if (!nowayout) {
@@ -197,7 +193,7 @@ static int wafwdt_open(struct inode *ino
 	 *      Activate
 	 */
 	wafwdt_start();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt.c	2004-08-09 12:23:21.000000000 +0000
@@ -288,10 +288,6 @@ static irqreturn_t wdt_interrupt(int irq
 
 static ssize_t wdt_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if(count) {
 		if (!nowayout) {
 			size_t i;
@@ -397,7 +393,7 @@ static int wdt_open(struct inode *inode,
 	 *	Activate
 	 */
 	wdt_start();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
@@ -441,10 +437,6 @@ static ssize_t wdt_temp_read(struct file
 {
 	int temperature;
 
-	/*  Can't seek (pread) on this device  */
-	if (ptr != &file->f_pos)
-		return -ESPIPE;
-
 	if (wdt_get_temperature(&temperature))
 		return -EFAULT;
 
@@ -464,7 +456,7 @@ static ssize_t wdt_temp_read(struct file
 
 static int wdt_temp_open(struct inode *inode, struct file *file)
 {
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt285.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt285.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt285.c	2004-06-16 05:19:01.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt285.c	2004-08-09 12:23:21.000000000 +0000
@@ -97,6 +97,7 @@ static int watchdog_open(struct inode *i
 
 	ret = 0;
 #endif
+	nonseekable_open(inode, file);
 	return ret;
 }
 
@@ -117,10 +118,6 @@ static int watchdog_release(struct inode
 static ssize_t
 watchdog_write(struct file *file, const char *data, size_t len, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	/*
 	 *	Refresh the timer.
 	 */
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt977.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt977.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt977.c	2004-06-16 05:19:52.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt977.c	2004-08-09 12:23:21.000000000 +0000
@@ -240,7 +240,7 @@ static int wdt977_open(struct inode *ino
 		__module_get(THIS_MODULE);
 
 	wdt977_start();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int wdt977_release(struct inode *inode, struct file *file)
@@ -273,12 +273,9 @@ static int wdt977_release(struct inode *
  *      write of data will do, as we we don't define content meaning.
  */
 
-static ssize_t wdt977_write(struct file *file, const char *buf, size_t count, loff_t *ppos)
+static ssize_t wdt977_write(struct file *file, const char __user *buf,
+			    size_t count, loff_t *ppos)
 {
-	/* Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
@@ -325,6 +322,12 @@ static int wdt977_ioctl(struct inode *in
 	int status;
 	int new_options, retval = -EINVAL;
 	int new_timeout;
+	union {
+		struct watchdog_info __user *ident;
+		int __user *i;
+	} uarg;
+
+	uarg.i = (int __user *)arg;
 
 	switch(cmd)
 	{
@@ -332,22 +335,22 @@ static int wdt977_ioctl(struct inode *in
 		return -ENOIOCTLCMD;
 
 	case WDIOC_GETSUPPORT:
-		return copy_to_user((struct watchdog_info *)arg, &ident,
+		return copy_to_user(uarg.ident, &ident,
 			sizeof(ident)) ? -EFAULT : 0;
 
 	case WDIOC_GETSTATUS:
 		wdt977_get_status(&status);
-		return put_user(status, (int *) arg);
+		return put_user(status, uarg.i);
 
 	case WDIOC_GETBOOTSTATUS:
-		return put_user(0, (int *) arg);
+		return put_user(0, uarg.i);
 
 	case WDIOC_KEEPALIVE:
 		wdt977_keepalive();
 		return 0;
 
 	case WDIOC_SETOPTIONS:
-		if (get_user (new_options, (int *) arg))
+		if (get_user (new_options, uarg.i))
 			return -EFAULT;
 
 		if (new_options & WDIOS_DISABLECARD) {
@@ -363,7 +366,7 @@ static int wdt977_ioctl(struct inode *in
 		return retval;
 
 	case WDIOC_SETTIMEOUT:
-		if (get_user(new_timeout, (int *) arg))
+		if (get_user(new_timeout, uarg.i))
 			return -EFAULT;
 
 		if (wdt977_set_timeout(new_timeout))
@@ -373,7 +376,7 @@ static int wdt977_ioctl(struct inode *in
 		/* Fall */
 
 	case WDIOC_GETTIMEOUT:
-		return put_user(timeout, (int *)arg);
+		return put_user(timeout, uarg.i);
 
 	}
 }
diff -p -purN linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt_pci.c linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt_pci.c
--- linux-2.6.8-rc3-bk3/drivers/char/watchdog/wdt_pci.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/char/watchdog/wdt_pci.c	2004-08-09 12:23:21.000000000 +0000
@@ -333,10 +333,6 @@ static irqreturn_t wdtpci_interrupt(int 
 
 static ssize_t wdtpci_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	/*  Can't seek (pwrite) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		if (!nowayout) {
 			size_t i;
@@ -446,7 +442,7 @@ static int wdtpci_open(struct inode *ino
 	 *	Activate
 	 */
 	wdtpci_start();
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
@@ -490,10 +486,6 @@ static ssize_t wdtpci_temp_read(struct f
 {
 	int temperature;
 
-	/*  Can't seek (pread) on this device  */
-	if (ptr != &file->f_pos)
-		return -ESPIPE;
-
 	if (wdtpci_get_temperature(&temperature))
 		return -EFAULT;
 
@@ -513,7 +505,7 @@ static ssize_t wdtpci_temp_read(struct f
 
 static int wdtpci_temp_open(struct inode *inode, struct file *file)
 {
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 /**
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/capi/capi.c linux-2.6.8-rc3-bk4/drivers/isdn/capi/capi.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/capi/capi.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/capi/capi.c	2004-08-09 12:23:21.000000000 +0000
@@ -656,9 +656,6 @@ capi_read(struct file *file, char __user
 	struct sk_buff *skb;
 	size_t copied;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!cdev->ap.applid)
 		return -ENODEV;
 
@@ -699,9 +696,6 @@ capi_write(struct file *file, const char
 	struct sk_buff *skb;
 	u16 mlen;
 
-        if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!cdev->ap.applid)
 		return -ENODEV;
 
@@ -965,7 +959,7 @@ capi_open(struct inode *inode, struct fi
 	if ((file->private_data = capidev_alloc()) == 0)
 		return -ENOMEM;
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/hardware/eicon/divamnt.c linux-2.6.8-rc3-bk4/drivers/isdn/hardware/eicon/divamnt.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/hardware/eicon/divamnt.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/hardware/eicon/divamnt.c	2004-08-09 12:23:21.000000000 +0000
@@ -151,9 +151,6 @@ maint_read(struct file *file, char __use
 	int str_length;
 	int *str_msg;
 
-	if (off != &file->f_pos)
-		return -ESPIPE;
-
 	if (!file->private_data) {
 		for (;;) {
 			while (
@@ -306,7 +303,7 @@ static int maint_open(struct inode *ino,
 
 	filep->private_data = NULL;
 
-	return (0);
+	return nonseekable_open(ino, filep);
 }
 
 static int maint_close(struct inode *ino, struct file *filep)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/hardware/eicon/divasproc.c linux-2.6.8-rc3-bk4/drivers/isdn/hardware/eicon/divasproc.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/hardware/eicon/divasproc.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/hardware/eicon/divasproc.c	2004-08-09 12:23:21.000000000 +0000
@@ -63,8 +63,6 @@ divas_read(struct file *file, char __use
 
 	if (*off)
 		return 0;
-	if (off != &file->f_pos)
-		return -ESPIPE;
 
 	divas_get_version(tmpbuf);
 	if (copy_to_user(buf + len, &tmpbuf, strlen(tmpbuf)))
@@ -107,7 +105,7 @@ static unsigned int divas_poll(struct fi
 
 static int divas_open(struct inode *inode, struct file *file)
 {
-	return (0);
+	return nonseekable_open(inode, file);
 }
 
 static int divas_close(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/hysdn/hysdn_procconf.c linux-2.6.8-rc3-bk4/drivers/isdn/hysdn/hysdn_procconf.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/hysdn/hysdn_procconf.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/hysdn/hysdn_procconf.c	2004-08-09 12:23:21.000000000 +0000
@@ -95,8 +95,6 @@ hysdn_conf_write(struct file *file, cons
 	int i;
 	uchar ch, *cp;
 
-	if (&file->f_pos != off)	/* fs error check */
-		return (-ESPIPE);
 	if (!count)
 		return (0);	/* nothing to handle */
 
@@ -214,9 +212,6 @@ hysdn_conf_read(struct file *file, char 
 	char *cp;
 	int i;
 
-	if (off != &file->f_pos)	/* fs error check */
-		return -ESPIPE;
-
 	if (file->f_mode & FMODE_READ) {
 		if (!(cp = file->private_data))
 			return (-EFAULT);	/* should never happen */
@@ -320,7 +315,7 @@ hysdn_conf_open(struct inode *ino, struc
 		return (-EPERM);	/* no permission this time */
 	}
 	unlock_kernel();
-	return (0);
+	return nonseekable_open(ino, filep);
 }				/* hysdn_conf_open */
 
 /***************************/
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/hysdn/hysdn_proclog.c linux-2.6.8-rc3-bk4/drivers/isdn/hysdn/hysdn_proclog.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/hysdn/hysdn_proclog.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/hysdn/hysdn_proclog.c	2004-08-09 12:23:21.000000000 +0000
@@ -158,9 +158,6 @@ hysdn_log_write(struct file *file, const
 	long base = 10;
 	hysdn_card *card = (hysdn_card *) file->private_data;
 
-	if (&file->f_pos != off)	/* fs error check */
-		return (-ESPIPE);
-
 	if (count > (sizeof(valbuf) - 1))
 		count = sizeof(valbuf) - 1;	/* limit length */
 	if (copy_from_user(valbuf, buf, count))
@@ -285,7 +282,7 @@ hysdn_log_open(struct inode *ino, struct
 		return (-EPERM);	/* no permission this time */
 	}
 	unlock_kernel();
-	return (0);
+	return nonseekable_open(ino, filep);
 }				/* hysdn_log_open */
 
 /*******************************************************************************/
diff -p -purN linux-2.6.8-rc3-bk3/drivers/isdn/i4l/isdn_common.c linux-2.6.8-rc3-bk4/drivers/isdn/i4l/isdn_common.c
--- linux-2.6.8-rc3-bk3/drivers/isdn/i4l/isdn_common.c	2004-08-09 12:22:19.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/isdn/i4l/isdn_common.c	2004-08-09 12:23:21.000000000 +0000
@@ -946,9 +946,6 @@ isdn_read(struct file *file, char __user
 	int retval;
 	char *p;
 
-	if (off != &file->f_pos)
-		return -ESPIPE;
-
 	lock_kernel();
 	if (minor == ISDN_MINOR_STATUS) {
 		if (!file->private_data) {
@@ -1051,9 +1048,6 @@ isdn_write(struct file *file, const char
 	int chidx;
 	int retval;
 
-	if (off != &file->f_pos)
-		return -ESPIPE;
-
 	if (minor == ISDN_MINOR_STATUS)
 		return -EPERM;
 	if (!dev->drivers)
@@ -1659,6 +1653,7 @@ isdn_open(struct inode *ino, struct file
 	}
 #endif
  out:
+	nonseekable_open(ino, filep);
 	return retval;
 }
 
diff -p -purN linux-2.6.8-rc3-bk3/drivers/s390/char/tape_char.c linux-2.6.8-rc3-bk4/drivers/s390/char/tape_char.c
--- linux-2.6.8-rc3-bk3/drivers/s390/char/tape_char.c	2004-06-16 05:19:44.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/s390/char/tape_char.c	2004-08-09 12:23:21.000000000 +0000
@@ -145,16 +145,6 @@ tapechar_read(struct file *filp, char __
 
 	DBF_EVENT(6, "TCHAR:read\n");
 	device = (struct tape_device *) filp->private_data;
-	/* Check position. */
-	if (ppos != &filp->f_pos) {
-		/*
-		 * "A request was outside the capabilities of the device."
-		 * This check uses internal knowledge about how pread and
-		 * read work...
-		 */
-		DBF_EVENT(6, "TCHAR:ppos wrong\n");
-		return -EOVERFLOW;
-	}
 
 	/*
 	 * If the tape isn't terminated yet, do it now. And since we then
@@ -221,12 +211,6 @@ tapechar_write(struct file *filp, const 
 
 	DBF_EVENT(6, "TCHAR:write\n");
 	device = (struct tape_device *) filp->private_data;
-	/* Check position */
-	if (ppos != &filp->f_pos) {
-		/* "A request was outside the capabilities of the device." */
-		DBF_EVENT(6, "TCHAR:ppos wrong\n");
-		return -EOVERFLOW;
-	}
 	/* Find out block size and number of blocks */
 	if (device->char_data.block_size != 0) {
 		if (count < device->char_data.block_size) {
@@ -329,7 +313,7 @@ tapechar_open (struct inode *inode, stru
 	rc = tape_open(device);
 	if (rc == 0) {
 		filp->private_data = device;
-		return 0;
+		return nonseekable_open(inode, filp);
 	}
 	tape_put_device(device);
 
diff -p -purN linux-2.6.8-rc3-bk3/drivers/sbus/char/cpwatchdog.c linux-2.6.8-rc3-bk4/drivers/sbus/char/cpwatchdog.c
--- linux-2.6.8-rc3-bk3/drivers/sbus/char/cpwatchdog.c	2004-08-09 12:22:21.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/sbus/char/cpwatchdog.c	2004-08-09 12:23:21.000000000 +0000
@@ -324,7 +324,7 @@ static int wd_open(struct inode *inode, 
 		wd_dev.initialized = 1;
 	}
 
-	return(0);
+	return(nonseekable_open(inode, f));
 }
 
 static int wd_release(struct inode *inode, struct file *file)
@@ -419,9 +419,6 @@ static ssize_t wd_write(struct file 	*fi
 		return(-EINVAL);
 	}
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		wd_pingtimer(pTimer);
 		return 1;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/sbus/char/riowatchdog.c linux-2.6.8-rc3-bk4/drivers/sbus/char/riowatchdog.c
--- linux-2.6.8-rc3-bk3/drivers/sbus/char/riowatchdog.c	2004-08-09 12:22:21.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/sbus/char/riowatchdog.c	2004-08-09 12:23:21.000000000 +0000
@@ -116,6 +116,7 @@ static void riowd_starttimer(void)
 
 static int riowd_open(struct inode *inode, struct file *filp)
 {
+	nonseekable_open(inode, filp);
 	return 0;
 }
 
@@ -184,9 +185,6 @@ static int riowd_ioctl(struct inode *ino
 
 static ssize_t riowd_write(struct file *file, const char __user *buf, size_t count, loff_t *ppos)
 {
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (count) {
 		riowd_pingtimer();
 		return 1;
diff -p -purN linux-2.6.8-rc3-bk3/drivers/scsi/osst.c linux-2.6.8-rc3-bk4/drivers/scsi/osst.c
--- linux-2.6.8-rc3-bk3/drivers/scsi/osst.c	2004-08-09 12:22:21.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/scsi/osst.c	2004-08-09 12:23:21.000000000 +0000
@@ -3185,12 +3185,6 @@ static ssize_t osst_write(struct file * 
 		goto out;
 	}
 	
-	if (ppos != &filp->f_pos) {
-	 	/* "A request was outside the capabilities of the device." */
-		retval = (-ENXIO);
-		goto out;
-	}
-
 	if (STp->ready != ST_READY) {
 		if (STp->ready == ST_NO_TAPE)
 			retval = (-ENOMEDIUM);
@@ -3512,12 +3506,6 @@ static ssize_t osst_read(struct file * f
 		goto out;
 	}
 	
-	if (ppos != &filp->f_pos) {
-		/* "A request was outside the capabilities of the device." */
-		retval = (-ENXIO);
-		goto out;
-	}
-
 	if (STp->ready != ST_READY) {
 		if (STp->ready == ST_NO_TAPE)
 			retval = (-ENOMEDIUM);
@@ -4254,6 +4242,7 @@ static int os_scsi_tape_open(struct inod
 	int            dev  = TAPE_NR(inode);
 	int            mode = TAPE_MODE(inode);
 
+	nonseekable_open(inode, filp);
 	write_lock(&os_scsi_tapes_lock);
 	if (dev >= osst_max_dev || os_scsi_tapes == NULL ||
 	    (STp = os_scsi_tapes[dev]) == NULL || !STp->device) {
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/class/audio.c linux-2.6.8-rc3-bk4/drivers/usb/class/audio.c
--- linux-2.6.8-rc3-bk3/drivers/usb/class/audio.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/class/audio.c	2004-08-09 12:23:21.000000000 +0000
@@ -1974,7 +1974,7 @@ static int usb_audio_open_mixdev(struct 
 	s->count++;
 
 	up(&open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int usb_audio_release_mixdev(struct inode *inode, struct file *file)
@@ -2147,8 +2147,6 @@ static ssize_t usb_audio_read(struct fil
 	unsigned int ptr;
 	int cnt, err;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (as->usbin.dma.mapped)
 		return -ENXIO;
 	if (!as->usbin.dma.ready && (ret = prog_dmabuf_in(as)))
@@ -2216,8 +2214,6 @@ static ssize_t usb_audio_write(struct fi
 	unsigned int start_thr;
 	int cnt, err;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (as->usbout.dma.mapped)
 		return -ENXIO;
 	if (!as->usbout.dma.ready && (ret = prog_dmabuf_out(as)))
@@ -2688,7 +2684,7 @@ static int usb_audio_open(struct inode *
 	as->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	s->count++;
 	up(&open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int usb_audio_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/class/usb-midi.c linux-2.6.8-rc3-bk4/drivers/usb/class/usb-midi.c
--- linux-2.6.8-rc3-bk3/drivers/usb/class/usb-midi.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/class/usb-midi.c	2004-08-09 12:23:21.000000000 +0000
@@ -646,9 +646,6 @@ static ssize_t usb_midi_read(struct file
 	ssize_t ret;
 	DECLARE_WAITQUEUE(wait, current);
 
-	if ( ppos != &file->f_pos ) {
-		return -ESPIPE;
-	}
 	if ( !access_ok(VERIFY_READ, buffer, count) ) {
 		return -EFAULT;
 	}
@@ -728,9 +725,6 @@ static ssize_t usb_midi_write(struct fil
 	ssize_t ret;
 	unsigned long int flags;
 
-	if ( ppos != &file->f_pos ) {
-		return -ESPIPE;
-	}
 	if ( !access_ok(VERIFY_READ, buffer, count) ) {
 		return -EFAULT;
 	}
@@ -920,7 +914,7 @@ static int usb_midi_open(struct inode *i
 	printk(KERN_INFO "usb-midi: Open Succeeded. minor= %d.\n", minor);
 #endif
 
-	return 0; /** Success. **/
+	return nonseekable_open(inode, file); /** Success. **/
 }
 
 
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/media/dabusb.c linux-2.6.8-rc3-bk4/drivers/usb/media/dabusb.c
--- linux-2.6.8-rc3-bk3/drivers/usb/media/dabusb.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/media/dabusb.c	2004-08-09 12:23:21.000000000 +0000
@@ -616,7 +616,7 @@ static int dabusb_open (struct inode *in
 	file->f_pos = 0;
 	file->private_data = s;
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int dabusb_release (struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/misc/auerswald.c linux-2.6.8-rc3-bk4/drivers/usb/misc/auerswald.c
--- linux-2.6.8-rc3-bk3/drivers/usb/misc/auerswald.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/misc/auerswald.c	2004-08-09 12:23:21.000000000 +0000
@@ -1435,7 +1435,7 @@ static int auerchar_open (struct inode *
 	/* file IO stuff */
 	file->f_pos = 0;
 	file->private_data = ccp;
-	return 0;
+	return nonseekable_open(inode, file);
 
 	/* Error exit */
 ofail:	up (&cp->mutex);
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/misc/legousbtower.c linux-2.6.8-rc3-bk4/drivers/usb/misc/legousbtower.c
--- linux-2.6.8-rc3-bk3/drivers/usb/misc/legousbtower.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/misc/legousbtower.c	2004-08-09 12:23:21.000000000 +0000
@@ -344,6 +344,7 @@ static int tower_open (struct inode *ino
 
 	dbg(2, "%s: enter", __FUNCTION__);
 
+	nonseekable_open(inode, file);
 	subminor = iminor(inode);
 
 	down (&disconnect_sem);
diff -p -purN linux-2.6.8-rc3-bk3/drivers/usb/misc/tiglusb.c linux-2.6.8-rc3-bk4/drivers/usb/misc/tiglusb.c
--- linux-2.6.8-rc3-bk3/drivers/usb/misc/tiglusb.c	2004-08-09 12:22:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/drivers/usb/misc/tiglusb.c	2004-08-09 12:23:21.000000000 +0000
@@ -132,7 +132,7 @@ tiglusb_open (struct inode *inode, struc
 	filp->f_pos = 0;
 	filp->private_data = s;
 
-	return 0;
+	return nonseekable_open(inode, filp);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/fs/devfs/base.c linux-2.6.8-rc3-bk4/fs/devfs/base.c
--- linux-2.6.8-rc3-bk3/fs/devfs/base.c	2004-08-09 12:22:23.000000000 +0000
+++ linux-2.6.8-rc3-bk4/fs/devfs/base.c	2004-08-09 12:23:21.000000000 +0000
@@ -857,12 +857,14 @@ static int devfsd_close(struct inode *in
 static ssize_t stat_read(struct file *file, char __user *buf, size_t len,
 			 loff_t * ppos);
 static struct file_operations stat_fops = {
+	.open = nonseekable_open,
 	.read = stat_read,
 };
 #endif
 
 /*  Devfs daemon file operations  */
 static struct file_operations devfsd_fops = {
+	.open = nonseekable_open,
 	.read = devfsd_read,
 	.ioctl = devfsd_ioctl,
 	.release = devfsd_close,
@@ -2574,9 +2576,6 @@ static ssize_t devfsd_read(struct file *
 	struct devfsd_notify_struct *info = fs_info->devfsd_info;
 	DECLARE_WAITQUEUE(wait, current);
 
-	/*  Can't seek (pread) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	/*  Verify the task has grabbed the queue  */
 	if (fs_info->devfsd_task != current)
 		return -EPERM;
@@ -2763,9 +2762,6 @@ static ssize_t stat_read(struct file *fi
 
 	num = sprintf(txt, "Number of entries: %u  number of bytes: %u\n",
 		      stat_num_entries, stat_num_bytes) + 1;
-	/*  Can't seek (pread) on this device  */
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (*ppos >= num)
 		return 0;
 	if (*ppos + len > num)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/ad1889.c linux-2.6.8-rc3-bk4/sound/oss/ad1889.c
--- linux-2.6.8-rc3-bk3/sound/oss/ad1889.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/ad1889.c	2004-08-09 12:23:21.000000000 +0000
@@ -452,9 +452,6 @@ static ssize_t ad1889_write(struct file 
 	ssize_t ret = 0;
 	DECLARE_WAITQUEUE(wait, current);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	down(&state->sem);
 #if 0
 	if (dmabuf->mapped) {
@@ -764,7 +761,7 @@ static int ad1889_open(struct inode *ino
 	ad1889_set_wav_rate(ad1889_dev, 44100);
 	ad1889_set_wav_fmt(ad1889_dev, AFMT_S16_LE);
 	AD1889_WRITEW(ad1889_dev, AD_DSWADA, 0x0404); /* attenuation */
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int ad1889_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/ali5455.c linux-2.6.8-rc3-bk4/sound/oss/ali5455.c
--- linux-2.6.8-rc3-bk3/sound/oss/ali5455.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/ali5455.c	2004-08-09 12:23:21.000000000 +0000
@@ -1593,8 +1593,6 @@ static ssize_t ali_read(struct file *fil
 #ifdef DEBUG2
 	printk("ali_audio: ali_read called, count = %d\n", count);
 #endif
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (dmabuf->enable & DAC_RUNNING)
@@ -1734,8 +1732,6 @@ static ssize_t ali_write(struct file *fi
 #ifdef DEBUG2
 	printk("ali_audio: ali_write called, count = %d\n", count);
 #endif
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (dmabuf->enable & ADC_RUNNING)
@@ -2890,7 +2886,7 @@ found_virt:
 	state->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	outl(0x00000000, card->iobase + ALI_INTERRUPTCR);
 	outl(0x00000000, card->iobase + ALI_INTERRUPTSR);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int ali_release(struct inode *inode, struct file *file)
@@ -3047,7 +3043,7 @@ static int ali_open_mixdev(struct inode 
 			if (card->ac97_codec[i] != NULL
 			    && card->ac97_codec[i]->dev_mixer == minor) {
 				file->private_data = card->ac97_codec[i];
-				return 0;
+				return nonseekable_open(inode, file);
 			}
 	}
 	return -ENODEV;
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/au1000.c linux-2.6.8-rc3-bk4/sound/oss/au1000.c
--- linux-2.6.8-rc3-bk3/sound/oss/au1000.c	2004-06-16 05:19:37.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/au1000.c	2004-08-09 12:23:21.000000000 +0000
@@ -886,7 +886,7 @@ static loff_t au1000_llseek(struct file 
 static int au1000_open_mixdev(struct inode *inode, struct file *file)
 {
 	file->private_data = &au1000_state;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int au1000_release_mixdev(struct inode *inode, struct file *file)
@@ -1120,8 +1120,6 @@ static ssize_t au1000_read(struct file *
 	unsigned long   flags;
 	int             cnt, usercnt, avail;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (db->mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
@@ -1204,8 +1202,6 @@ static ssize_t au1000_write(struct file 
 	dbg("write: count=%d", count);
 #endif
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (db->mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_READ, buffer, count))
@@ -1907,7 +1903,7 @@ static int  au1000_open(struct inode *in
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
 	init_MUTEX(&s->sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int au1000_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/cmpci.c linux-2.6.8-rc3-bk4/sound/oss/cmpci.c
--- linux-2.6.8-rc3-bk3/sound/oss/cmpci.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/cmpci.c	2004-08-09 12:23:21.000000000 +0000
@@ -1852,7 +1852,7 @@ static int cm_open_mixdev(struct inode *
 	}
        	VALIDATE_STATE(s);
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int cm_release_mixdev(struct inode *inode, struct file *file)
@@ -1926,8 +1926,6 @@ static ssize_t cm_read(struct file *file
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf(s, 1)))
@@ -2028,8 +2026,6 @@ static ssize_t cm_write(struct file *fil
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf(s, 0)))
@@ -2878,7 +2874,7 @@ static int cm_open(struct inode *inode, 
 	set_fmt(s, fmtm, fmts);
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int cm_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/cs4281/cs4281m.c linux-2.6.8-rc3-bk4/sound/oss/cs4281/cs4281m.c
--- linux-2.6.8-rc3-bk3/sound/oss/cs4281/cs4281m.c	2004-06-16 05:20:26.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/cs4281/cs4281m.c	2004-08-09 12:23:21.000000000 +0000
@@ -2592,7 +2592,7 @@ static int cs4281_open_mixdev(struct ino
 	CS_DBGOUT(CS_FUNCTION | CS_OPEN, 4,
 		  printk(KERN_INFO "cs4281: cs4281_open_mixdev()- 0\n"));
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -2874,8 +2874,6 @@ static ssize_t cs4281_read(struct file *
 		  printk(KERN_INFO "cs4281: cs4281_read()+ %Zu \n", count));
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf_adc(s)))
@@ -2990,8 +2988,6 @@ static ssize_t cs4281_write(struct file 
 			 count));
 	VALIDATE_STATE(s);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf_dac(s)))
@@ -3725,7 +3721,7 @@ static int cs4281_open(struct inode *ino
 	}
 	CS_DBGOUT(CS_FUNCTION | CS_OPEN, 2,
 		  printk(KERN_INFO "cs4281: cs4281_open()- 0\n"));
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -3842,8 +3838,6 @@ static ssize_t cs4281_midi_read(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 	ret = 0;
@@ -3890,8 +3884,6 @@ static ssize_t cs4281_midi_write(struct 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	ret = 0;
@@ -4025,7 +4017,7 @@ static int cs4281_midi_open(struct inode
 	     f_mode << FMODE_MIDI_SHIFT) & (FMODE_MIDI_READ |
 					    FMODE_MIDI_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/cs46xx.c linux-2.6.8-rc3-bk4/sound/oss/cs46xx.c
--- linux-2.6.8-rc3-bk3/sound/oss/cs46xx.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/cs46xx.c	2004-08-09 12:23:21.000000000 +0000
@@ -1725,8 +1725,6 @@ static ssize_t cs_midi_read(struct file 
         unsigned ptr;
         int cnt;
 
-        if (ppos != &file->f_pos)
-                return -ESPIPE;
         if (!access_ok(VERIFY_WRITE, buffer, count))
                 return -EFAULT;
         ret = 0;
@@ -1770,8 +1768,6 @@ static ssize_t cs_midi_write(struct file
         unsigned ptr;
         int cnt;
 
-        if (ppos != &file->f_pos)
-                return -ESPIPE;
         if (!access_ok(VERIFY_READ, buffer, count))
                 return -EFAULT;
         ret = 0;
@@ -2106,8 +2102,6 @@ static ssize_t cs_read(struct file *file
 		return -ENODEV;
 	dmabuf = &state->dmabuf;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
@@ -2216,9 +2210,6 @@ static ssize_t cs_write(struct file *fil
 		return -EFAULT;
 	dmabuf = &state->dmabuf;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	down(&state->sem);
 	if (dmabuf->mapped)
 	{
@@ -3370,7 +3361,7 @@ static int cs_open(struct inode *inode, 
 			return ret;
 	}
 	CS_DBGOUT(CS_OPEN | CS_FUNCTION, 2, printk("cs46xx: cs_open()- 0\n") );
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int cs_release(struct inode *inode, struct file *file)
@@ -4104,7 +4095,7 @@ static int cs_open_mixdev(struct inode *
 	CS_INC_USE_COUNT(&card->mixer_use_cnt);
 	CS_DBGOUT(CS_FUNCTION | CS_OPEN, 4,
 		  printk(KERN_INFO "cs46xx: cs_open_mixdev()- 0\n"));
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int cs_release_mixdev(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/emu10k1/audio.c linux-2.6.8-rc3-bk4/sound/oss/emu10k1/audio.c
--- linux-2.6.8-rc3-bk3/sound/oss/emu10k1/audio.c	2004-06-16 05:18:57.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/emu10k1/audio.c	2004-08-09 12:23:21.000000000 +0000
@@ -59,9 +59,6 @@ static ssize_t emu10k1_audio_read(struct
 
 	DPD(3, "emu10k1_audio_read(), buffer=%p, count=%d\n", buffer, (u32) count);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 
@@ -146,9 +143,6 @@ static ssize_t emu10k1_audio_write(struc
 
 	DPD(3, "emu10k1_audio_write(), buffer=%p, count=%d\n", buffer, (u32) count);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 
@@ -1249,7 +1243,7 @@ match:
 
 	file->private_data = (void *) wave_dev;
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int emu10k1_audio_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/emu10k1/midi.c linux-2.6.8-rc3-bk4/sound/oss/emu10k1/midi.c
--- linux-2.6.8-rc3-bk3/sound/oss/emu10k1/midi.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/emu10k1/midi.c	2004-08-09 12:23:21.000000000 +0000
@@ -185,7 +185,7 @@ match:
 
 	up(&card->open_sem);
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int emu10k1_midi_release(struct inode *inode, struct file *file)
@@ -253,9 +253,6 @@ static ssize_t emu10k1_midi_read(struct 
 
 	DPD(4, "emu10k1_midi_read(), count %#x\n", (u32) count);
 
-	if (pos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 
@@ -328,9 +325,6 @@ static ssize_t emu10k1_midi_write(struct
 
 	DPD(4, "emu10k1_midi_write(), count=%#x\n", (u32) count);
 
-	if (pos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/es1370.c linux-2.6.8-rc3-bk4/sound/oss/es1370.c
--- linux-2.6.8-rc3-bk3/sound/oss/es1370.c	2004-06-16 05:20:26.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/es1370.c	2004-08-09 12:23:21.000000000 +0000
@@ -1037,7 +1037,7 @@ static int es1370_open_mixdev(struct ino
 	}
        	VALIDATE_STATE(s);
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1370_release_mixdev(struct inode *inode, struct file *file)
@@ -1147,8 +1147,6 @@ static ssize_t es1370_read(struct file *
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
@@ -1225,8 +1223,6 @@ static ssize_t es1370_write(struct file 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac2.mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_READ, buffer, count))
@@ -1789,7 +1785,7 @@ static int es1370_open(struct inode *ino
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
 	init_MUTEX(&s->sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1370_release(struct inode *inode, struct file *file)
@@ -1841,8 +1837,6 @@ static ssize_t es1370_write_dac(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac1.mapped)
 		return -ENXIO;
 	if (!s->dma_dac1.ready && (ret = prog_dmabuf_dac1(s)))
@@ -2222,7 +2216,7 @@ static int es1370_open_dac(struct inode 
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= FMODE_DAC;
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1370_release_dac(struct inode *inode, struct file *file)
@@ -2265,8 +2259,6 @@ static ssize_t es1370_midi_read(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2328,8 +2320,6 @@ static ssize_t es1370_midi_write(struct 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2464,7 +2454,7 @@ static int es1370_midi_open(struct inode
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= (file->f_mode << FMODE_MIDI_SHIFT) & (FMODE_MIDI_READ | FMODE_MIDI_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1370_midi_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/es1371.c linux-2.6.8-rc3-bk4/sound/oss/es1371.c
--- linux-2.6.8-rc3-bk3/sound/oss/es1371.c	2004-06-16 05:19:44.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/es1371.c	2004-08-09 12:23:21.000000000 +0000
@@ -1223,7 +1223,7 @@ static int es1371_open_mixdev(struct ino
 	}
        	VALIDATE_STATE(s);
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1371_release_mixdev(struct inode *inode, struct file *file)
@@ -1334,8 +1334,6 @@ static ssize_t es1371_read(struct file *
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
@@ -1413,8 +1411,6 @@ static ssize_t es1371_write(struct file 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac2.mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_READ, buffer, count))
@@ -1978,7 +1974,7 @@ static int es1371_open(struct inode *ino
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
 	init_MUTEX(&s->sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1371_release(struct inode *inode, struct file *file)
@@ -2029,8 +2025,6 @@ static ssize_t es1371_write_dac(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac1.mapped)
 		return -ENXIO;
 	if (!s->dma_dac1.ready && (ret = prog_dmabuf_dac1(s)))
@@ -2400,7 +2394,7 @@ static int es1371_open_dac(struct inode 
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= FMODE_DAC;
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1371_release_dac(struct inode *inode, struct file *file)
@@ -2443,8 +2437,6 @@ static ssize_t es1371_midi_read(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2506,8 +2498,6 @@ static ssize_t es1371_midi_write(struct 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2642,7 +2632,7 @@ static int es1371_midi_open(struct inode
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= (file->f_mode << FMODE_MIDI_SHIFT) & (FMODE_MIDI_READ | FMODE_MIDI_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int es1371_midi_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/esssolo1.c linux-2.6.8-rc3-bk4/sound/oss/esssolo1.c
--- linux-2.6.8-rc3-bk3/sound/oss/esssolo1.c	2004-06-16 05:18:58.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/esssolo1.c	2004-08-09 12:23:21.000000000 +0000
@@ -933,7 +933,7 @@ static int solo1_open_mixdev(struct inod
 		return -ENODEV;
        	VALIDATE_STATE(s);
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int solo1_release_mixdev(struct inode *inode, struct file *file)
@@ -1010,8 +1010,6 @@ static ssize_t solo1_read(struct file *f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf_adc(s)))
@@ -1106,8 +1104,6 @@ static ssize_t solo1_write(struct file *
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf_dac(s)))
@@ -1647,7 +1643,7 @@ static int solo1_open(struct inode *inod
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
 	prog_codec(s);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static /*const*/ struct file_operations solo1_audio_fops = {
@@ -1740,8 +1736,6 @@ static ssize_t solo1_midi_read(struct fi
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -1803,8 +1797,6 @@ static ssize_t solo1_midi_write(struct f
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -1951,7 +1943,7 @@ static int solo1_midi_open(struct inode 
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= (file->f_mode << FMODE_MIDI_SHIFT) & (FMODE_MIDI_READ | FMODE_MIDI_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int solo1_midi_release(struct inode *inode, struct file *file)
@@ -2161,7 +2153,7 @@ static int solo1_dmfm_open(struct inode 
 	outb(1, s->sbbase+3);  /* enable OPL3 */
 	s->open_mode |= FMODE_DMFM;
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int solo1_dmfm_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/forte.c linux-2.6.8-rc3-bk4/sound/oss/forte.c
--- linux-2.6.8-rc3-bk3/sound/oss/forte.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/forte.c	2004-08-09 12:23:21.000000000 +0000
@@ -1265,7 +1265,7 @@ forte_dsp_open (struct inode *inode, str
 	if (file->f_mode & FMODE_READ)
 		forte_channel_init (forte, &forte->rec);
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -1438,9 +1438,6 @@ forte_dsp_write (struct file *file, cons
 	unsigned int i = bytes, sz = 0;
 	unsigned long flags;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok (VERIFY_READ, buffer, bytes))
 		return -EFAULT;
 
@@ -1546,9 +1543,6 @@ forte_dsp_read (struct file *file, char 
 	unsigned int i = bytes, sz;
 	unsigned long flags;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (!access_ok (VERIFY_WRITE, buffer, bytes))
 		return -EFAULT;
 
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/hal2.c linux-2.6.8-rc3-bk4/sound/oss/hal2.c
--- linux-2.6.8-rc3-bk3/sound/oss/hal2.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/hal2.c	2004-08-09 12:23:21.000000000 +0000
@@ -959,7 +959,7 @@ static int hal2_open_mixdev(struct inode
 
 	if (hal2) {
 		file->private_data = hal2;
-		return 0;
+		return nonseekable_open(inode, file);
 	}
 	return -ENODEV;
 }
@@ -1178,8 +1178,6 @@ static ssize_t hal2_read(struct file *fi
 
 	if (!count)
 		return 0;
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (down_interruptible(&adc->sem))
 		return -EINTR;
 	if (file->f_flags & O_NONBLOCK) {
@@ -1234,8 +1232,6 @@ static ssize_t hal2_write(struct file *f
 
 	if (!count)
 		return 0;
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (down_interruptible(&dac->sem))
 		return -EINTR;
 	if (file->f_flags & O_NONBLOCK) {
@@ -1350,7 +1346,7 @@ static int hal2_open(struct inode *inode
 		dac->usecount++;
 	}
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int hal2_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/i810_audio.c linux-2.6.8-rc3-bk4/sound/oss/i810_audio.c
--- linux-2.6.8-rc3-bk3/sound/oss/i810_audio.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/i810_audio.c	2004-08-09 12:23:21.000000000 +0000
@@ -1434,8 +1434,6 @@ static ssize_t i810_read(struct file *fi
 	printk("i810_audio: i810_read called, count = %d\n", count);
 #endif
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (dmabuf->enable & DAC_RUNNING)
@@ -1574,8 +1572,6 @@ static ssize_t i810_write(struct file *f
 	printk("i810_audio: i810_write called, count = %d\n", count);
 #endif
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (dmabuf->enable & ADC_RUNNING)
@@ -2518,7 +2514,7 @@ found_virt:
 
 	state->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int i810_release(struct inode *inode, struct file *file)
@@ -2685,7 +2681,7 @@ static int i810_open_mixdev(struct inode
 			if (card->ac97_codec[i] != NULL &&
 			    card->ac97_codec[i]->dev_mixer == minor) {
 				file->private_data = card->ac97_codec[i];
-				return 0;
+				return nonseekable_open(inode, file);
 			}
 	}
 	return -ENODEV;
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/ite8172.c linux-2.6.8-rc3-bk4/sound/oss/ite8172.c
--- linux-2.6.8-rc3-bk3/sound/oss/ite8172.c	2004-06-16 05:19:01.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/ite8172.c	2004-08-09 12:23:21.000000000 +0000
@@ -878,7 +878,7 @@ static int it8172_open_mixdev(struct ino
 			break;
 	}
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int it8172_release_mixdev(struct inode *inode, struct file *file)
@@ -1093,8 +1093,6 @@ static ssize_t it8172_read(struct file *
 	unsigned long flags;
 	int cnt, remainder, avail;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (db->mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
@@ -1176,8 +1174,6 @@ static ssize_t it8172_write(struct file 
 	unsigned long flags;
 	int cnt, remainder, avail;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (db->mapped)
 		return -ENXIO;
 	if (!access_ok(VERIFY_READ, buffer, count))
@@ -1843,7 +1839,7 @@ static int it8172_open(struct inode *ino
 
 	s->open_mode |= (file->f_mode & (FMODE_READ | FMODE_WRITE));
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int it8172_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/maestro.c linux-2.6.8-rc3-bk4/sound/oss/maestro.c
--- linux-2.6.8-rc3-bk3/sound/oss/maestro.c	2004-06-16 05:19:52.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/maestro.c	2004-08-09 12:23:21.000000000 +0000
@@ -2158,7 +2158,7 @@ static int ess_open_mixdev(struct inode 
 	if (!card)
 		return -ENODEV;
 	file->private_data = card;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int ess_release_mixdev(struct inode *inode, struct file *file)
@@ -2274,8 +2274,6 @@ ess_read(struct file *file, char __user 
 	unsigned char *combbuf = NULL;
 	
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf(s, 1)))
@@ -2372,8 +2370,6 @@ ess_write(struct file *file, const char 
 	int cnt;
 	
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf(s, 0)))
@@ -3082,7 +3078,7 @@ ess_open(struct inode *inode, struct fil
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int 
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/maestro3.c linux-2.6.8-rc3-bk4/sound/oss/maestro3.c
--- linux-2.6.8-rc3-bk3/sound/oss/maestro3.c	2004-06-16 05:19:53.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/maestro3.c	2004-08-09 12:23:21.000000000 +0000
@@ -1333,8 +1333,6 @@ static ssize_t m3_read(struct file *file
     int cnt;
     
     VALIDATE_STATE(s);
-    if (ppos != &file->f_pos)
-        return -ESPIPE;
     if (s->dma_adc.mapped)
         return -ENXIO;
     if (!s->dma_adc.ready && (ret = prog_dmabuf(s, 1)))
@@ -1414,8 +1412,6 @@ static ssize_t m3_write(struct file *fil
     int cnt;
     
     VALIDATE_STATE(s);
-    if (ppos != &file->f_pos)
-        return -ESPIPE;
     if (s->dma_dac.mapped)
         return -ENXIO;
     if (!s->dma_dac.ready && (ret = prog_dmabuf(s, 0)))
@@ -2051,7 +2047,7 @@ static int m3_open(struct inode *inode, 
 
     up(&s->open_sem);
     spin_unlock_irqrestore(&c->lock, flags);
-    return 0;
+    return nonseekable_open(inode, file);
 }
 
 static int m3_release(struct inode *inode, struct file *file)
@@ -2165,7 +2161,7 @@ static int m3_open_mixdev(struct inode *
 
     file->private_data = card->ac97;
 
-    return 0;
+    return nonseekable_open(inode, file);
 }
 
 static int m3_release_mixdev(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/nec_vrc5477.c linux-2.6.8-rc3-bk4/sound/oss/nec_vrc5477.c
--- linux-2.6.8-rc3-bk3/sound/oss/nec_vrc5477.c	2004-06-16 05:19:43.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/nec_vrc5477.c	2004-08-09 12:23:21.000000000 +0000
@@ -868,7 +868,7 @@ static int vrc5477_ac97_open_mixdev(stru
 			break;
 	}
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int vrc5477_ac97_release_mixdev(struct inode *inode, struct file *file)
@@ -1043,8 +1043,6 @@ vrc5477_ac97_read(struct file *file, 
 	int copyCount;
 	size_t avail;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 
@@ -1229,8 +1227,6 @@ static ssize_t vrc5477_ac97_write(struct
 	unsigned long flags;
 	int copyCount, avail;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	ret = 0;
@@ -1574,7 +1570,8 @@ static int vrc5477_ac97_open(struct inod
 	struct list_head *list;
 	struct vrc5477_ac97_state *s;
 	int ret=0;
-    
+
+	nonseekable_open(inode, file);    
 	for (list = devs.next; ; list = list->next) {
 		if (list == &devs)
 			return -ENODEV;
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/rme96xx.c linux-2.6.8-rc3-bk4/sound/oss/rme96xx.c
--- linux-2.6.8-rc3-bk3/sound/oss/rme96xx.c	2004-06-16 05:19:13.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/rme96xx.c	2004-08-09 12:23:21.000000000 +0000
@@ -1454,6 +1454,7 @@ static int rme96xx_open(struct inode *in
 
 	DBG(printk("device num %d open\n",devnum));
 
+	nonseekable_open(in, f);
 	for (list = devs.next; ; list = list->next) {
 		if (list == &devs)
 			return -ENODEV;
@@ -1543,9 +1544,6 @@ static ssize_t rme96xx_write(struct file
 	if(dma == NULL || (dma->s) == NULL) 
 		return -ENXIO;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (dma->mmapped || !dma->opened)
 		return -ENXIO;
 
@@ -1611,9 +1609,6 @@ static ssize_t rme96xx_read(struct file 
 	if(dma == NULL || (dma->s) == NULL) 
 		return -ENXIO;
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
-
 	if (dma->mmapped || !dma->opened)
 		return -ENXIO;
 
@@ -1775,6 +1770,7 @@ static int rme96xx_mixer_open(struct ino
 
 	COMM  ("mixer open");
 
+	nonseekable_open(inode, file);
 	for (list = devs.next; ; list = list->next) {
 		if (list == &devs)
 			return -ENODEV;
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/sonicvibes.c linux-2.6.8-rc3-bk4/sound/oss/sonicvibes.c
--- linux-2.6.8-rc3-bk3/sound/oss/sonicvibes.c	2004-06-16 05:19:22.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/sonicvibes.c	2004-08-09 12:23:21.000000000 +0000
@@ -1252,7 +1252,7 @@ static int sv_open_mixdev(struct inode *
 	}
        	VALIDATE_STATE(s);
 	file->private_data = s;
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int sv_release_mixdev(struct inode *inode, struct file *file)
@@ -1325,8 +1325,6 @@ static ssize_t sv_read(struct file *file
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf(s, 1)))
@@ -1410,8 +1408,6 @@ static ssize_t sv_write(struct file *fil
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf(s, 0)))
@@ -1954,7 +1950,7 @@ static int sv_open(struct inode *inode, 
 	set_fmt(s, fmtm, fmts);
 	s->open_mode |= file->f_mode & (FMODE_READ | FMODE_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int sv_release(struct inode *inode, struct file *file)
@@ -2005,8 +2001,6 @@ static ssize_t sv_midi_read(struct file 
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_WRITE, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2068,8 +2062,6 @@ static ssize_t sv_midi_write(struct file
 	int cnt;
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (!access_ok(VERIFY_READ, buffer, count))
 		return -EFAULT;
 	if (count == 0)
@@ -2212,7 +2204,7 @@ static int sv_midi_open(struct inode *in
 	spin_unlock_irqrestore(&s->lock, flags);
 	s->open_mode |= (file->f_mode << FMODE_MIDI_SHIFT) & (FMODE_MIDI_READ | FMODE_MIDI_WRITE);
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int sv_midi_release(struct inode *inode, struct file *file)
@@ -2414,7 +2406,7 @@ static int sv_dmfm_open(struct inode *in
 	outb(1, s->iosynth+3);  /* enable OPL3 */
 	s->open_mode |= FMODE_DMFM;
 	up(&s->open_sem);
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int sv_dmfm_release(struct inode *inode, struct file *file)
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/swarm_cs4297a.c linux-2.6.8-rc3-bk4/sound/oss/swarm_cs4297a.c
--- linux-2.6.8-rc3-bk3/sound/oss/swarm_cs4297a.c	2004-06-16 05:19:35.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/swarm_cs4297a.c	2004-08-09 12:23:21.000000000 +0000
@@ -1526,14 +1526,6 @@ static int mixer_ioctl(struct cs4297a_st
 
 // --------------------------------------------------------------------- 
 
-static loff_t cs4297a_llseek(struct file *file, loff_t offset, int origin)
-{
-	return -ESPIPE;
-}
-
-
-// --------------------------------------------------------------------- 
-
 static int cs4297a_open_mixdev(struct inode *inode, struct file *file)
 {
 	int minor = iminor(inode);
@@ -1561,7 +1553,7 @@ static int cs4297a_open_mixdev(struct in
 	CS_DBGOUT(CS_FUNCTION | CS_OPEN, 4,
 		  printk(KERN_INFO "cs4297a: cs4297a_open_mixdev()- 0\n"));
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -1588,7 +1580,7 @@ static int cs4297a_ioctl_mixdev(struct i
 // ******************************************************************************************
 static /*const */ struct file_operations cs4297a_mixer_fops = {
 	.owner		= THIS_MODULE,
-	.llseek		= cs4297a_llseek,
+	.llseek		= no_llseek,
 	.ioctl		= cs4297a_ioctl_mixdev,
 	.open		= cs4297a_open_mixdev,
 	.release	= cs4297a_release_mixdev,
@@ -1658,8 +1650,6 @@ static ssize_t cs4297a_read(struct file 
 		  printk(KERN_INFO "cs4297a: cs4297a_read()+ %d \n", count));
 
 	VALIDATE_STATE(s);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_adc.mapped)
 		return -ENXIO;
 	if (!s->dma_adc.ready && (ret = prog_dmabuf_adc(s)))
@@ -1784,8 +1774,6 @@ static ssize_t cs4297a_write(struct file
 			 count));
 	VALIDATE_STATE(s);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (s->dma_dac.mapped)
 		return -ENXIO;
 	if (!s->dma_dac.ready && (ret = prog_dmabuf_dac(s)))
@@ -2494,7 +2482,7 @@ static int cs4297a_open(struct inode *in
 	}
 	CS_DBGOUT(CS_FUNCTION | CS_OPEN, 2,
 		  printk(KERN_INFO "cs4297a: cs4297a_open()- 0\n"));
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
@@ -2503,7 +2491,7 @@ static int cs4297a_open(struct inode *in
 // ******************************************************************************************
 static /*const */ struct file_operations cs4297a_audio_fops = {
 	.owner		= THIS_MODULE,
-	.llseek		= cs4297a_llseek,
+	.llseek		= no_llseek,
 	.read		= cs4297a_read,
 	.write		= cs4297a_write,
 	.poll		= cs4297a_poll,
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/trident.c linux-2.6.8-rc3-bk4/sound/oss/trident.c
--- linux-2.6.8-rc3-bk3/sound/oss/trident.c	2004-06-16 05:19:44.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/trident.c	2004-08-09 12:23:21.000000000 +0000
@@ -1874,8 +1874,6 @@ trident_read(struct file *file, char __u
 	pr_debug("trident: trident_read called, count = %d\n", count);
 
 	VALIDATE_STATE(state);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 
 	if (dmabuf->mapped)
 		return -ENXIO;
@@ -1992,8 +1990,6 @@ trident_write(struct file *file, const c
 	pr_debug("trident: trident_write called, count = %d\n", count);
 
 	VALIDATE_STATE(state);
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 
 	/*
 	 *      Guard against an mmap or ioctl while writing
@@ -2823,7 +2819,7 @@ trident_open(struct inode *inode, struct
 	pr_debug("trident: open virtual channel %d, hard channel %d\n",
 		 state->virt, dmabuf->channel->num);
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
@@ -4079,7 +4075,7 @@ trident_open_mixdev(struct inode *inode,
       match:
 	file->private_data = card->ac97_codec[i];
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/via82cxxx_audio.c linux-2.6.8-rc3-bk4/sound/oss/via82cxxx_audio.c
--- linux-2.6.8-rc3-bk3/sound/oss/via82cxxx_audio.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/via82cxxx_audio.c	2004-08-09 12:23:21.000000000 +0000
@@ -1580,7 +1580,7 @@ match:
 	file->private_data = card->ac97;
 
 	DPRINTK ("EXIT, returning 0\n");
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int via_mixer_ioctl (struct inode *inode, struct file *file, unsigned int cmd,
@@ -2401,11 +2401,6 @@ static ssize_t via_dsp_read(struct file 
 	card = file->private_data;
 	assert (card != NULL);
 
-	if (ppos != &file->f_pos) {
-		DPRINTK ("EXIT, returning -ESPIPE\n");
-		return -ESPIPE;
-	}
-
 	rc = via_syscall_down (card, nonblock);
 	if (rc) goto out;
 
@@ -2589,11 +2584,6 @@ static ssize_t via_dsp_write(struct file
 	card = file->private_data;
 	assert (card != NULL);
 
-	if (ppos != &file->f_pos) {
-		DPRINTK ("EXIT, returning -ESPIPE\n");
-		return -ESPIPE;
-	}
-
 	rc = via_syscall_down (card, nonblock);
 	if (rc) goto out;
 
@@ -3345,7 +3335,7 @@ match:
 	}
 
 	DPRINTK ("EXIT, returning 0\n");
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 
diff -p -purN linux-2.6.8-rc3-bk3/sound/oss/ymfpci.c linux-2.6.8-rc3-bk4/sound/oss/ymfpci.c
--- linux-2.6.8-rc3-bk3/sound/oss/ymfpci.c	2004-08-09 12:22:25.000000000 +0000
+++ linux-2.6.8-rc3-bk4/sound/oss/ymfpci.c	2004-08-09 12:23:21.000000000 +0000
@@ -1231,8 +1231,6 @@ ymf_read(struct file *file, char __user 
 	unsigned int swptr;
 	int cnt;			/* This many to go in this revolution */
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (!dmabuf->ready && (ret = prog_dmabuf(state, 1)))
@@ -1350,8 +1348,6 @@ ymf_write(struct file *file, const char 
 
 	YMFDBGW("ymf_write: count %d\n", count);
 
-	if (ppos != &file->f_pos)
-		return -ESPIPE;
 	if (dmabuf->mapped)
 		return -ENXIO;
 	if (!dmabuf->ready && (ret = prog_dmabuf(state, 0)))
@@ -1965,7 +1961,7 @@ static int ymf_open(struct inode *inode,
 #endif
 	up(&unit->open_sem);
 
-	return 0;
+	return nonseekable_open(inode, file);
 
 out_nodma:
 	/*
@@ -2043,7 +2039,7 @@ static int ymf_open_mixdev(struct inode 
  match:
 	file->private_data = unit->ac97_codec[i];
 
-	return 0;
+	return nonseekable_open(inode, file);
 }
 
 static int ymf_ioctl_mixdev(struct inode *inode, struct file *file,
