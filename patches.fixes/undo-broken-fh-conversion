Date: Mon, 30 Aug 2004 22:37:14 +0200
From: trond.myklebust@fys.uio.no
Subject: Undo broken FH conversion that broke nfsroot compile

# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/08/24 12:28:55-07:00 trond.myklebust@fys.uio.no 
#   [PATCH] Undo broken FH conversion that broke nfsroot compile
#   
#   That conversion to nfs_fh_copy() is bogus since we're not copying into
#   an nfs_fh anyway. Just revert it.
# 
# fs/nfs/nfsroot.c
#   2004/08/24 10:18:32-07:00 trond.myklebust@fys.uio.no +4 -2
#   Undo broken FH conversion that broke nfsroot compile
# 
diff -Nru a/fs/nfs/nfsroot.c b/fs/nfs/nfsroot.c
--- a/fs/nfs/nfsroot.c	2004-08-30 13:16:24 -07:00
+++ b/fs/nfs/nfsroot.c	2004-08-30 13:16:24 -07:00
@@ -495,8 +495,10 @@
 	if (status < 0)
 		printk(KERN_ERR "Root-NFS: Server returned error %d "
 				"while mounting %s\n", status, nfs_path);
-	else
-		nfs_copy_fh(nfs_data.root, fh);
+	else {
+		nfs_data.root.size = fh.size;
+		memcpy(nfs_data.root.data, fh.data, fh.size);
+	}
 
 	return status;
 }
