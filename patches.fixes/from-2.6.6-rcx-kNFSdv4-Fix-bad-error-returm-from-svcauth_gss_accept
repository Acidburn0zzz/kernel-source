#date: 2004-04-17
#from: NeilBrown <neilb@cse.unsw.edu.au>
#id: 1.1371.718.12
#tag: via-mm
#time: 17:25:42
#title: kNFSdv4: Fix bad error returm from svcauth_gss_accept
#who: akpm@osdl.org[torvalds]
#
# ChangeSet
#   1.1371.718.12 04/04/17 17:25:42 akpm@osdl.org[torvalds] +1 -0
#   [PATCH] kNFSdv4: Fix bad error returm from svcauth_gss_accept
#   
#   From: NeilBrown <neilb@cse.unsw.edu.au>
#   
#   From: "J. Bruce Fields" <bfields@fieldses.org>
#   
#   Error return when the client supplies a bad service should be badcred.
#
# net/sunrpc/auth_gss/svcauth_gss.c +1 -0
#
diff -Nru a/net/sunrpc/auth_gss/svcauth_gss.c b/net/sunrpc/auth_gss/svcauth_gss.c
--- a/net/sunrpc/auth_gss/svcauth_gss.c	Wed Apr 28 00:41:41 2004
+++ b/net/sunrpc/auth_gss/svcauth_gss.c	Wed Apr 28 00:41:41 2004
@@ -895,6 +895,7 @@
 		svc_putu32(resv, rpc_success);
 		goto complete;
 	case RPC_GSS_PROC_DATA:
+		*authp = rpc_autherr_badcred;
 		rqstp->rq_client =
 			find_gss_auth_domain(rsci->mechctx, gc->gc_svc);
 		if (rqstp->rq_client == NULL)
