# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/05/20 10:05:02-05:00 shaggy@austin.ibm.com 
#   JFS: [CHECKER] Memory leak on commonly executed path
#   
#   The jfs_log structure was never being freed at unmount time.
# 
diff -Nru a/fs/jfs/jfs_logmgr.c b/fs/jfs/jfs_logmgr.c
--- a/fs/jfs/jfs_logmgr.c	2004-05-20 16:47:41 -05:00
+++ b/fs/jfs/jfs_logmgr.c	2004-05-20 16:47:41 -05:00
@@ -1486,6 +1486,7 @@
 		 *      in-line log in host file system
 		 */
 		rc = lmLogShutdown(log);
+		kfree(log);
 		goto out;
 	}
 
@@ -1514,6 +1515,8 @@
 
 	bd_release(bdev);
 	blkdev_put(bdev);
+
+	kfree(log);
 
       out:
 	up(&jfs_log_sem);
_______________________________________________
Jfs-patches mailing list
Jfs-patches@www-124.ibm.com
http://www-124.ibm.com/developerworks/oss/mailman/listinfo/jfs-patches


