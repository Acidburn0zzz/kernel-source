#date: 2004-04-21
#from: Andrea Arcangeli <andrea@suse.de>
#id: 1.1371.737.18
#tag: via-mm
#time: 07:44:31
#title: fb_ioctl() usercopy fix
#who: akpm@osdl.org[torvalds]
#
# ChangeSet
#   1.1371.737.18 04/04/21 07:44:31 akpm@osdl.org[torvalds] +1 -0
#   [PATCH] fb_ioctl() usercopy fix
#   
#   From: Andrea Arcangeli <andrea@suse.de>
#   
#   Arrange for ioctl(FBIOPUTCMAP) to do copy_to_user() rather than memcpy.
#
# drivers/video/fbmem.c +1 -1
#
diff -Nru a/drivers/video/fbmem.c b/drivers/video/fbmem.c
--- a/drivers/video/fbmem.c	Wed Apr 28 10:53:35 2004
+++ b/drivers/video/fbmem.c	Wed Apr 28 10:53:35 2004
@@ -1037,7 +1037,7 @@
 	case FBIOPUTCMAP:
 		if (copy_from_user(&cmap, (void *) arg, sizeof(cmap)))
 			return -EFAULT;
-		return (fb_set_cmap(&cmap, 0, info));
+		return (fb_set_cmap(&cmap, 1, info));
 	case FBIOGETCMAP:
 		if (copy_from_user(&cmap, (void *) arg, sizeof(cmap)))
 			return -EFAULT;
