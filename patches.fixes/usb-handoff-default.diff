Date: Fri Mar  4 21:53:39 CET 2005
From: Vojtech Pavlik <vojtech@suse.cz>
Subject: Make "usb-handoff" the default, "usb-no-handoff" turns it off.

=============================================================================================

 Documentation/kernel-parameters.txt |    1 +
 drivers/pci/quirks.c                |   10 ++++++++++
 2 files changed, 11 insertions(+)

=============================================================================================

Index: linux-2.6.13/Documentation/kernel-parameters.txt
===================================================================
--- linux-2.6.13.orig/Documentation/kernel-parameters.txt	2005-10-07 21:47:05.000000000 -0700
+++ linux-2.6.13/Documentation/kernel-parameters.txt	2005-10-07 21:47:08.000000000 -0700
@@ -1499,6 +1499,7 @@
 			Format: <io>,<irq>
 
 	usb-handoff	[HW] Enable early USB BIOS -> OS handoff
+	usb-no-handoff	[HW] Disable early USB BIOS -> OS handoff
 
 	usbhid.mousepoll=
 			[USBHID] The interval which mice are to be polled at.
Index: linux-2.6.13/drivers/pci/quirks.c
===================================================================
--- linux-2.6.13.orig/drivers/pci/quirks.c	2005-10-07 21:47:05.000000000 -0700
+++ linux-2.6.13/drivers/pci/quirks.c	2005-10-07 21:47:08.000000000 -0700
@@ -959,13 +959,23 @@
 #define EHCI_USBLEGCTLSTS	4		/* legacy control/status */
 #define EHCI_USBLEGCTLSTS_SOOE	(1 << 13)	/* SMI on ownership change */
 
+#if defined(__i386__) || defined(__x86_64__)
+int usb_early_handoff __devinitdata = 1;	/* Do handoff by default */
+#else
 int usb_early_handoff __devinitdata = 0;
+#endif
 static int __init usb_handoff_early(char *str)
 {
 	usb_early_handoff = 1;
 	return 0;
 }
 __setup("usb-handoff", usb_handoff_early);
+static int __init usb_no_handoff_early(char *str)
+{
+	usb_early_handoff = 0;
+	return 0;
+}
+__setup("usb-no-handoff", usb_no_handoff_early);
 
 static void __devinit quirk_usb_handoff_uhci(struct pci_dev *pdev)
 {
