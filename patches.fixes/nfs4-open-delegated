From: mainline
Subject: [NFSv4] nfs4_open_delegated returned random garbage
Patch-mainline: 2.6.17

When _nfs4_open_delegated fails with an error, nfs4_open_delegated
will return a random pointer rather than an error.

Acked-by: okir@suse.de
Acked-by: ak@suse.de

 fs/nfs/nfs4proc.c |    2 +-
 1 files changed, 1 insertion(+), 1 deletion(-)

Index: build/fs/nfs/nfs4proc.c
===================================================================
--- build.orig/fs/nfs/nfs4proc.c
+++ build/fs/nfs/nfs4proc.c
@@ -908,7 +908,7 @@ out_put_state_owner:
 static struct nfs4_state *nfs4_open_delegated(struct inode *inode, int flags, struct rpc_cred *cred)
 {
 	struct nfs4_exception exception = { };
-	struct nfs4_state *res;
+	struct nfs4_state *res = ERR_PTR(-EIO);
 	int err;
 
 	do {
