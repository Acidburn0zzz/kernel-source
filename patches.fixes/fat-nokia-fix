This patch fixes a too strict sanity check in the FAT code, allowing
to mount the flash memory in Nokia phones, as well as in several
other devices.

Patch updated to strip bits off "first" instead of adding them
to FIRST_FAT_ENT().

--- linus/fs/fat/inode.c	2004-08-25 11:34:17.665758665 +0200
+++ input/fs/fat/inode.c	2004-08-25 11:23:47.000000000 +0200
@@ -999,11 +999,12 @@
 		error = first;
 		goto out_fail;
 	}
-	if (FAT_FIRST_ENT(sb, media) == first) {
-		/* all is as it should be */
-	} else if (media == 0xf8 && FAT_FIRST_ENT(sb, 0xfe) == first) {
+
+	if ((FAT_FIRST_ENT(sb, media)) == (first & ~3)) {
+		/* all is as it should be: -1 to -8 */
+	} else if (media == 0xf8 && FAT_FIRST_ENT(sb, 0xfe) == (first & ~3)) {
 		/* bad, reported on pc9800 */
-	} else if (media == 0xf0 && FAT_FIRST_ENT(sb, 0xf8) == first) {
+	} else if (media == 0xf0 && FAT_FIRST_ENT(sb, 0xf8) == (first & ~3)) {
 		/* bad, reported with a MO disk on win95/me */
 	} else if (first == 0) {
 		/* bad, reported with a SmartMedia card */

