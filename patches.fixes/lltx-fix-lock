diff -u linux/net/sched/sch_generic.c-o linux/net/sched/sch_generic.c
--- linux/net/sched/sch_generic.c-o	2004-09-17 19:08:53.000000000 +0200
+++ linux/net/sched/sch_generic.c	2004-09-17 19:14:13.000000000 +0200
@@ -148,8 +148,10 @@
 					spin_lock(&dev->queue_lock);
 					return -1;
 				}
-				if (ret == NETDEV_TX_LOCKED && nolock)
+				if (ret == NETDEV_TX_LOCKED && nolock) {
+					spin_lock(&dev->queue_lock);
 					goto collision; 
+				}
 			}
 
 			/* NETDEV_TX_BUSY - we need to requeue */
