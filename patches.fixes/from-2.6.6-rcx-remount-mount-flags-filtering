#date: 2004-04-16
#id: 1.1371.714.7
#tag: other
#time: 14:27:54
#title: remount: mount flags filtering
#who: viro@www.linux.org.uk[torvalds]
#
# ChangeSet
#   1.1371.714.7 04/04/16 14:27:54 viro@www.linux.org.uk[torvalds] +1 -0
#   [PATCH] remount: mount flags filtering
#   
#    - we could pass MS_ACTIVE in mount flags and it would be passed into
#      ->get_sb(), leading to interesting failure modes.  This flag is only
#      for internal use (it's set once fill_super is complete and reset
#      before the inode eviction on umount); made sure that we never get
#      tricked into having it set it too early.
#
# fs/namespace.c +1 -1
#
diff -Nru a/fs/namespace.c b/fs/namespace.c
--- a/fs/namespace.c	Wed Apr 28 00:46:04 2004
+++ b/fs/namespace.c	Wed Apr 28 00:46:04 2004
@@ -777,7 +777,7 @@
 		mnt_flags |= MNT_NODEV;
 	if (flags & MS_NOEXEC)
 		mnt_flags |= MNT_NOEXEC;
-	flags &= ~(MS_NOSUID|MS_NOEXEC|MS_NODEV);
+	flags &= ~(MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_ACTIVE);
 
 	/* ... and get the mountpoint */
 	retval = path_lookup(dir_name, LOOKUP_FOLLOW, &nd);
