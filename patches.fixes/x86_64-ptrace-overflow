From: John Blackwood
Subject: Fix ptrace overflow
Patch-mainline: 2.6.12
References: 84078

Don't allow accesses below register frame in ptrace

There was a "off by one quad word" error in there. I don't think
it is exploitable because it will only store into a unused area,
but better to plug it.

Found and fixed by John Blackwood

Signed-off-by: ak@suse.de

diff -u linux-2.6.11/arch/x86_64/kernel/ptrace.c-o linux-2.6.11/arch/x86_64/kernel/ptrace.c
--- linux-2.6.11/arch/x86_64/kernel/ptrace.c-o	2005-05-19 07:19:00.000000000 +0200
+++ linux-2.6.11/arch/x86_64/kernel/ptrace.c	2005-05-19 07:27:36.762159095 +0200
@@ -247,7 +247,7 @@
 			break;
 
 		switch (addr) { 
-		case 0 ... sizeof(struct user_regs_struct):
+		case 0 ... sizeof(struct user_regs_struct)-sizeof(long):
 			tmp = getreg(child, addr);
 			break;
 		case offsetof(struct user, u_debugreg[0]):
@@ -292,7 +292,7 @@
 			break;
 
 		switch (addr) { 
-		case 0 ... sizeof(struct user_regs_struct): 
+		case 0 ... sizeof(struct user_regs_struct)-sizeof(long): 
 			ret = putreg(child, addr, data);
 			break;
 		/* Disallows to set a breakpoint into the vsyscall */
