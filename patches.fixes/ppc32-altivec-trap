ChangeSet
  1.1371.704.13 04/04/12 12:41:46 akpm@osdl.org[torvalds] +1 -0
  [PATCH] ppc32: Fix thinko in the altivec exception code
  
  From: Benjamin Herrenschmidt <benh@kernel.crashing.org>
  
  Without this patch, executing an altivec instruction on an altivec capable
  CPU with a kernel that do not have CONFIG_ALTIVEC set would result in a
  kernel crash.
  
  (Fix forward ported from 2.4 by John Whitney
  <jwhitney-linuxppc@sands-edge.com>)

  arch/ppc/kernel/head.S
    1.45 04/04/12 10:54:01 akpm@osdl.org[torvalds] +4 -3
    ppc32: Fix thinko in the altivec exception code

diff -p -Nru a/arch/ppc/kernel/head.S b/arch/ppc/kernel/head.S
--- a/arch/ppc/kernel/head.S	Wed May 19 13:45:09 2004
+++ b/arch/ppc/kernel/head.S	Wed May 19 13:45:09 2004
@@ -493,13 +493,14 @@ SystemCall:
  * We effectively remap it to 0x3000.
  */
 	. = 0xf00
-
-#ifdef CONFIG_ALTIVEC
 	b	Trap_0f
+
 	. = 0xf20
+#ifdef CONFIG_ALTIVEC
 	b	AltiVecUnavailable
-Trap_0f:
 #endif
+
+Trap_0f:
 	EXCEPTION_PROLOG
 	addi	r3,r1,STACK_FRAME_OVERHEAD
 	EXC_XFER_EE(0xf00, UnknownException)
.........................................................................
# vim: syntax=diff

