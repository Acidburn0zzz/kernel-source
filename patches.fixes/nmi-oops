From: Kurt Garloff <garloff@suse.de>
Subject: Observe panic setting in x86-64 NMI watchdog

.

Signed-off-by: Kurt Garloff <garloff@suse.de>

Index: linux-2.6.11/arch/x86_64/kernel/nmi.c
===================================================================
--- linux-2.6.11.orig/arch/x86_64/kernel/nmi.c
+++ linux-2.6.11/arch/x86_64/kernel/nmi.c
@@ -392,14 +392,17 @@ void nmi_watchdog_tick (struct pt_regs *
 		 * wait a few IRQs (5 seconds) before doing the oops ...
 		 */
 		alert_counter[cpu]++;
 		if (alert_counter[cpu] == 5*nmi_hz) {
-			if (notify_die(DIE_NMI, "nmi", regs, reason, 2, SIGINT)
-							== NOTIFY_STOP) {
-				alert_counter[cpu] = 0; 
-				return;
-			} 
-			die_nmi("NMI Watchdog detected LOCKUP on CPU%d", regs);
+			if (panic_on_timeout) {
+				if (notify_die(DIE_NMI, "nmi", regs, reason, 2, SIGINT)
+								== NOTIFY_STOP) {
+					alert_counter[cpu] = 0; 
+					return;
+				}
+				die_nmi("NMI Watchdog detected LOCKUP on CPU%d", regs);
+			} else
+				printk(KERN_ALERT "NMI Watchdog detected LOCKUP on CPU%d\n", cpu);
 		}
 	} else {
 		last_irq_sums[cpu] = sum;
 		alert_counter[cpu] = 0;
