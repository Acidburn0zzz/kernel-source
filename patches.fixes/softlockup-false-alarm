From: Garry Forsgren <garry.forsgren@unisys.com>
Subject: Intermittent BUG: soft lockup detected on CPU#
References: 148176

The softlockup might generate false alarms under various
circumstances.

Modify watchdog() function in softlockup.c to execute the
touch_softlockup_watchdog() function prior to calling msleep_interruptible(). 
This will update the timestamp before the timer interrupt can call
softlockup_tick() which detects a false soft lockup.

Signed-off-by: Hannes Reinecke <hare@suse.de>

--- linux-2.6.15/kernel/softlockup.c.orig	2006-01-03 04:21:10.000000000 +0100
+++ linux-2.6.15/kernel/softlockup.c	2006-03-09 12:39:32.431867576 +0100
@@ -85,8 +85,8 @@ static int watchdog(void * __bind_cpu)
 	 * in softlockup_tick():
 	 */
 	while (!kthread_should_stop()) {
-		msleep_interruptible(1000);
 		touch_softlockup_watchdog();
+		msleep_interruptible(1000);
 	}
 	__set_current_state(TASK_RUNNING);
 
