Index: linux-2.6.0-test9/fs/jfs/acl.c
===================================================================
--- linux-2.6.0-test9.orig/fs/jfs/acl.c	2003-11-18 14:19:01.000000000 +0100
+++ linux-2.6.0-test9/fs/jfs/acl.c	2003-11-18 14:48:39.000000000 +0100
@@ -195,6 +195,9 @@ check_capabilities:
 		if (capable(CAP_DAC_OVERRIDE))
 			return 0;
 
+	if ((mask & MAY_EXEC) && S_ISDIR(inode->i_mode))
+		if (capable(CAP_DAC_OVERRIDE))
+			return 0;
 	/*
 	 * Searching includes executable on directories, else just read.
 	 */
Index: linux-2.6.0-test9/fs/xfs/xfs_inode.c
===================================================================
--- linux-2.6.0-test9.orig/fs/xfs/xfs_inode.c	2003-11-18 14:19:01.000000000 +0100
+++ linux-2.6.0-test9/fs/xfs/xfs_inode.c	2003-11-18 14:45:19.000000000 +0100
@@ -3725,6 +3725,9 @@ xfs_iaccess(
 	if (!(orgmode & S_IXUSR) || (inode->i_mode & S_IXUGO))
 		if (capable_cred(cr, CAP_DAC_OVERRIDE))
 			return 0;
+	if ((orgmode & S_IXUSR) && S_ISDIR(inode->i_mode))
+		if (capable_cred(cr, CAP_DAC_OVERRIDE))
+			return 0;
 
 	if ((orgmode == S_IRUSR) ||
 	    (((ip->i_d.di_mode & S_IFMT) == S_IFDIR) &&
Index: linux-2.6.0-test9/fs/ext2/acl.c
===================================================================
--- linux-2.6.0-test9.orig/fs/ext2/acl.c	2003-11-18 14:19:01.000000000 +0100
+++ linux-2.6.0-test9/fs/ext2/acl.c	2003-11-18 14:48:08.000000000 +0100
@@ -325,6 +325,9 @@ check_capabilities:
 	if (!(mask & MAY_EXEC) || (inode->i_mode & S_IXUGO))
 		if (capable(CAP_DAC_OVERRIDE))
 			return 0;
+	if ((mask & MAY_EXEC) && S_ISDIR(inode->i_mode))
+		if (capable(CAP_DAC_OVERRIDE))
+			return 0;
 	/* Read and search granted if capable(CAP_DAC_READ_SEARCH) */
 	if (capable(CAP_DAC_READ_SEARCH) && ((mask == MAY_READ) ||
 	    (S_ISDIR(inode->i_mode) && !(mask & MAY_WRITE))))
Index: linux-2.6.0-test9/fs/ext3/acl.c
===================================================================
--- linux-2.6.0-test9.orig/fs/ext3/acl.c	2003-11-18 14:19:01.000000000 +0100
+++ linux-2.6.0-test9/fs/ext3/acl.c	2003-11-18 14:48:13.000000000 +0100
@@ -330,6 +330,9 @@ check_capabilities:
 	if (!(mask & MAY_EXEC) || (inode->i_mode & S_IXUGO))
 		if (capable(CAP_DAC_OVERRIDE))
 			return 0;
+	if ((mask & MAY_EXEC) && S_ISDIR(inode->i_mode))
+		if (capable(CAP_DAC_OVERRIDE))
+			return 0;
 	/* Read and search granted if capable(CAP_DAC_READ_SEARCH) */
 	if (capable(CAP_DAC_READ_SEARCH) && ((mask == MAY_READ) ||
 	    (S_ISDIR(inode->i_mode) && !(mask & MAY_WRITE))))
Index: linux-2.6.0-test9/fs/namei.c
===================================================================
--- linux-2.6.0-test9.orig/fs/namei.c	2003-11-18 14:19:01.000000000 +0100
+++ linux-2.6.0-test9/fs/namei.c	2003-11-18 14:47:01.000000000 +0100
@@ -194,6 +194,21 @@ int vfs_permission(struct inode * inode,
 		if (capable(CAP_DAC_OVERRIDE))
 			return 0;
 
+	/* The real fix would be this:
+	if (capable(CAP_DAC_READ_SEARCH)) {
+		mask &= S_ISDIR(inode->i_mode) ?
+			~(MAY_READ|MAY_EXEC) : ~MAY_READ;
+	}
+
+	if (capable(CAP_DAC_WRITE))
+		mask &= ~MAY_WRITE;
+
+	return mask ? -EACCESS : 0;
+	*/
+	if ((mask & MAY_EXEC) && S_ISDIR(inode->i_mode))
+		if (capable(CAP_DAC_OVERRIDE))
+			return 0;
+
 	/*
 	 * Searching includes executable on directories, else just read.
 	 */
