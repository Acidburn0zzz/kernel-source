#date: 2004-04-06
#id: 1.1371.672.31
#tag: cpufreq
#time: 16:07:22
#title: [CPUFREQ] Stop preempt count from going negative.
#who: davej@redhat.com
#
# ChangeSet
#   1.1371.672.31 04/04/06 16:07:22 davej@redhat.com +1 -0
#   [CPUFREQ] Stop preempt count from going negative.
#   Broken failure path spotted by Dominik Brodowski.
#
# arch/i386/kernel/cpu/cpufreq/powernow-k8.c +2 -1
#   [CPUFREQ] Stop preempt count from going negative.
#     Broken failure path spotted by Dominik Brodowski.
#
diff -Nru a/arch/i386/kernel/cpu/cpufreq/powernow-k8.c b/arch/i386/kernel/cpu/cpufreq/powernow-k8.c
--- a/arch/i386/kernel/cpu/cpufreq/powernow-k8.c	Wed Apr 28 00:19:00 2004
+++ b/arch/i386/kernel/cpu/cpufreq/powernow-k8.c	Wed Apr 28 00:19:00 2004
@@ -848,7 +848,7 @@
 
 	if (smp_processor_id() != pol->cpu) {
 		printk(KERN_ERR "limiting to cpu %u failed\n", pol->cpu);
-		goto err_out;
+		goto sched_out;
 	}
 
 	/* from this point, do not exit without restoring preempt and cpu */
@@ -892,6 +892,7 @@
 
 err_out:
 	preempt_enable_no_resched();
+sched_out:
 	set_cpus_allowed(current, oldmask);
 	schedule();
 
