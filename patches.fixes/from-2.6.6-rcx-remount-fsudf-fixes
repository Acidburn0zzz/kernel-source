#date: 2004-04-16
#id: 1.1371.714.2
#tag: other
#time: 14:26:48
#title: remount: fs/udf fixes
#who: viro@www.linux.org.uk[torvalds]
#
# ChangeSet
#   1.1371.714.2 04/04/16 14:26:48 viro@www.linux.org.uk[torvalds] +1 -0
#   [PATCH] remount: fs/udf fixes
#   
#    - same problem as with sysv - mount-time checks for fs being good for
#      writing are absent on remount.  Check added.
#
# fs/udf/super.c +6 -0
#
diff -Nru a/fs/udf/super.c b/fs/udf/super.c
--- a/fs/udf/super.c	Wed Apr 28 00:46:36 2004
+++ b/fs/udf/super.c	Wed Apr 28 00:46:36 2004
@@ -460,6 +460,12 @@
 	UDF_SB(sb)->s_gid   = uopt.gid;
 	UDF_SB(sb)->s_umask = uopt.umask;
 
+	if (UDF_SB_LVIDBH(sb)) {
+		int write_rev = le16_to_cpu(UDF_SB_LVIDIU(sb)->minUDFWriteRev);
+		if (write_rev > UDF_MAX_WRITE_VERSION)
+			*flags |= MS_RDONLY;
+	}
+
 	if ((*flags & MS_RDONLY) == (sb->s_flags & MS_RDONLY))
 		return 0;
 	if (*flags & MS_RDONLY)
