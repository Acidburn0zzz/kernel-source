From: Olaf Kirch <okir@suse.de>
Subject: nfsd: ignore chmod calls on symlinks
Patch-mainline: submitted, resubmitted 2005-07-11
References: SUSE41602 - LTC9096

Ignore attempts to change a symlink's mode. These bogus calls are
generated by the SpecFS validation test.

Index: linux-2.6.5/fs/nfsd/vfs.c
===================================================================
--- linux-2.6.5.orig/fs/nfsd/vfs.c	2004-06-03 14:44:23.000000000 +0200
+++ linux-2.6.5/fs/nfsd/vfs.c	2004-06-08 13:30:01.000000000 +0200
@@ -240,12 +240,19 @@
 
 	/* Get inode */
 	err = fh_verify(rqstp, fhp, ftype, accmode);
-	if (err || !iap->ia_valid)
+	if (err)
 		goto out;
 
 	dentry = fhp->fh_dentry;
 	inode = dentry->d_inode;
 
+	/* Ignore any mode updates on symlinks */
+	if (S_ISLNK(inode->i_mode))
+		iap->ia_valid &= ~ATTR_MODE;
+
+	if (!iap->ia_valid)
+		goto out;
+
 	/* NFSv2 does not differentiate between "set-[ac]time-to-now"
 	 * which only requires access, and "set-[ac]time-to-X" which
 	 * requires ownership.

