From: Jan Blunck <jblunck@suse.de>
Subject: Realign unaligned bitops
References: 144310

Realign the arguments to bitops for s390x.

Signed-off-by: Jan Blunck <jblunck@suse.de>
---
 include/asm-s390/bitops.h |   13 +++++--------
 1 file changed, 5 insertions(+), 8 deletions(-)

Index: linux-2.6.15/include/asm-s390/bitops.h
===================================================================
--- linux-2.6.15.orig/include/asm-s390/bitops.h
+++ linux-2.6.15/include/asm-s390/bitops.h
@@ -52,16 +52,13 @@
  */
 
 /* set ALIGN_CS to 1 if the SMP safe bit operations should
- * align the address to 4 byte boundary. It seems to work
- * without the alignment. 
- */
-#ifdef __KERNEL__
-#define ALIGN_CS 0
-#else
+ * align the address to 4 byte boundary. */
+#ifdef CONFIG_SMP
 #define ALIGN_CS 1
-#ifndef CONFIG_SMP
-#error "bitops won't work without CONFIG_SMP"
 #endif
+
+#if !defined(__KERNEL__) && !defined(CONFIG_SMP)
+#error "bitops won't work without CONFIG_SMP"
 #endif
 
 /* bitmap tables from arch/S390/kernel/bitmap.S */
