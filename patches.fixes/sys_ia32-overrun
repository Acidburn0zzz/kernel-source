From: Jeremy Fitzhardinge <jeremy@goop.org>
Subject: Fix buffer overrun in arch/x86_64/sys_ia32.c
References: 48813
Patch-mainline: 

Fix buffer overrun in arch/x86_64/sys_ia32.c

Acked-by: mantel@suse.de

diff -urNp linux-2.6.5/arch/x86_64/ia32/sys_ia32.c linux-2.6.5.SUSE/arch/x86_64/ia32/sys_ia32.c
--- linux-2.6.5/arch/x86_64/ia32/sys_ia32.c	2004-12-02 14:35:24.518646212 +0100
+++ linux-2.6.5.SUSE/arch/x86_64/ia32/sys_ia32.c	2004-12-02 14:35:50.529479678 +0100
@@ -776,11 +776,12 @@ sys32_waitpid(compat_pid_t pid, unsigned
 int sys32_ni_syscall(int call)
 { 
 	struct task_struct *me = current;
-	static char lastcomm[8];
-	if (strcmp(lastcomm, me->comm)) {
-	printk(KERN_INFO "IA32 syscall %d from %s not implemented\n", call,
-	       current->comm);
-		strcpy(lastcomm, me->comm); 
+	static char lastcomm[sizeof(me->comm)];
+
+	if (strncmp(lastcomm, me->comm, sizeof(lastcomm))) {
+		printk(KERN_INFO "IA32 syscall %d from %s not implemented\n",
+		       call, me->comm);
+		strncpy(lastcomm, me->comm, sizeof(lastcomm));
 	} 
 	return -ENOSYS;	       
 } 
@@ -1761,11 +1762,11 @@ long sys32_fadvise64_64(int fd, __u32 of
 long sys32_vm86_warning(void)
 { 
 	struct task_struct *me = current;
-	static char lastcomm[8];
-	if (strcmp(lastcomm, me->comm)) {
+	static char lastcomm[sizeof(me->comm)];
+	if (strncmp(lastcomm, me->comm, sizeof(lastcomm))) {
 		printk(KERN_INFO "%s: vm86 mode not supported on 64 bit kernel\n",
 		       me->comm);
-		strcpy(lastcomm, me->comm); 
+		strncpy(lastcomm, me->comm, sizeof(lastcomm)); 
 	} 
 	return -ENOSYS;
 } 
