Date: Thu, 10 Jun 2004 11:16:32 -0700 (PDT)
From: Scott Feldman <scott.feldman@intel.com>
To: jgarzik@pobox.com
Cc: netdev@oss.sgi.com, scott.feldman@intel.com
Subject: [PATCH 2.6 1/3] e100: stepping over err return code
Message-ID: <Pine.LNX.4.58.0406101110270.5831@sfeldma-ich5.jf.intel.com>
ReplyTo: "Scott Feldman" <scott.feldman@intel.com>


* Spotted by Jay Vosburgh [fubar@us.ibm.com].  err return code was getting
stepped on in the case where we need to report low or no cb resources,
which in turn messed up the netif_stop_queue logic in xmit_frame.

Signed-off by: scott.feldman@intel.com

--------

--- linux-2.5/drivers/net/e100.c	2004-06-10 11:06:03.457155768 -0700
+++ linux-2.5/drivers/net/e100.c.mod	2004-06-10 11:06:59.105695904 -0700
@@ -827,8 +827,8 @@ static inline int e100_exec_cb(struct ni
 	cb->prev->command &= cpu_to_le16(~cb_s);

 	while(nic->cb_to_send != nic->cb_to_use) {
-		if(unlikely((err = e100_exec_cmd(nic, nic->cuc_cmd,
-			nic->cb_to_send->dma_addr)))) {
+		if(unlikely(e100_exec_cmd(nic, nic->cuc_cmd,
+			nic->cb_to_send->dma_addr))) {
 			/* Ok, here's where things get sticky.  It's
 			 * possible that we can't schedule the command
 			 * because the controller is too busy, so

