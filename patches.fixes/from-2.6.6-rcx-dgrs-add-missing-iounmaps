#date: 2004-04-06
#from: Leana Ogasawara <ogasawara@osdl.org>
#id: 1.1371.685.2
#tag: other
#time: 08:15:58
#title: dgrs: add missing iounmaps
#who: rddunlap@osdl.org
#
# ChangeSet
#   1.1371.685.2 04/04/06 08:15:58 rddunlap@osdl.org +1 -0
#   [PATCH] dgrs: add missing iounmaps
#   
#   [resend]
#   
#   
#   Insert missing iounmap's.
#   
#   From: Leana Ogasawara <ogasawara@osdl.org>
#
# drivers/net/dgrs.c +7 -1
#
diff -Nru a/drivers/net/dgrs.c b/drivers/net/dgrs.c
--- a/drivers/net/dgrs.c	Wed Apr 28 00:22:27 2004
+++ b/drivers/net/dgrs.c	Wed Apr 28 00:22:27 2004
@@ -327,8 +327,10 @@
 	 */
 	priv0->vplxdma[PLX_DMA0_MODE/4] = 0xFFFFFFFF;
 	x = priv0->vplxdma[PLX_DMA0_MODE/4];
-	if (x != 0x00001FFF)
+	if (x != 0x00001FFF) {
+		iounmap((void *)priv0->vplxdma);
 		return (0);
+	}
 
 	return (1);
 }
@@ -1020,6 +1022,8 @@
 		if (!is)
 		{
 			printk("%s: Illegal IRQ %d\n", dev0->name, dev0->irq);
+			iounmap(priv0->vmem);
+			priv0->vmem = NULL;
 			return -ENXIO;
 		}
 		OUTB(dev0->base_addr + ES4H_AS_31_24,
@@ -1101,6 +1105,8 @@
 	if (priv0->bcomm->bc_status < BC_RUN)
 	{
 		printk("%s: board not operating\n", dev0->name);
+		iounmap(priv0->vmem);
+		priv0->vmem = NULL;
 		return -ENXIO;
 	}
 
