axboe@suse.de

Bugfix

Some disks nedd much more than 2 hours to low-level format ...

On Tue, May 11 2004, Arjan van de Ven wrote:
> On Tue, 2004-05-11 at 14:20, Jens Axboe wrote:
> > On Tue, May 11 2004, Kurt Garloff wrote:
> > > Hi,
> > block/scsi_ioctl.c should likely receive similar treatment then.
> 
> how about sticking these in a shared header between the 2 files ?

yep would be best, ala

===== drivers/block/scsi_ioctl.c 1.42 vs edited =====
--- 1.42/drivers/block/scsi_ioctl.c	Tue Apr 27 15:20:34 2004
+++ edited/drivers/block/scsi_ioctl.c	Tue May 11 14:43:51 2004
@@ -209,11 +209,6 @@
 	return 0;
 }
 
-#define FORMAT_UNIT_TIMEOUT		(2 * 60 * 60 * HZ)
-#define START_STOP_TIMEOUT		(60 * HZ)
-#define MOVE_MEDIUM_TIMEOUT		(5 * 60 * HZ)
-#define READ_ELEMENT_STATUS_TIMEOUT	(5 * 60 * HZ)
-#define READ_DEFECT_DATA_TIMEOUT	(60 * HZ )
 #define OMAX_SB_LEN 16          /* For backward compatibility */
 
 static int sg_scsi_ioctl(request_queue_t *q, struct gendisk *bd_disk,
===== drivers/scsi/scsi_ioctl.c 1.24 vs edited =====
--- 1.24/drivers/scsi/scsi_ioctl.c	Mon Aug 25 15:37:40 2003
+++ edited/drivers/scsi/scsi_ioctl.c	Tue May 11 14:45:09 2004
@@ -27,11 +27,6 @@
 
 #define NORMAL_RETRIES			5
 #define IOCTL_NORMAL_TIMEOUT			(10 * HZ)
-#define FORMAT_UNIT_TIMEOUT		(2 * 60 * 60 * HZ)
-#define START_STOP_TIMEOUT		(60 * HZ)
-#define MOVE_MEDIUM_TIMEOUT		(5 * 60 * HZ)
-#define READ_ELEMENT_STATUS_TIMEOUT	(5 * 60 * HZ)
-#define READ_DEFECT_DATA_TIMEOUT	(60 * HZ )  /* ZIP-250 on parallel port takes as long! */
 
 #define MAX_BUF PAGE_SIZE
 
===== include/scsi/scsi.h 1.20 vs edited =====
--- 1.20/include/scsi/scsi.h	Wed Feb 25 12:37:46 2004
+++ edited/include/scsi/scsi.h	Tue May 11 14:45:25 2004
@@ -362,6 +362,14 @@
 #define SCSI_2          3
 #define SCSI_3          4
 
+/*
+ * default timeouts
+ */
+#define FORMAT_UNIT_TIMEOUT		(12 * 60 * 60 * HZ)
+#define START_STOP_TIMEOUT		(60 * HZ)
+#define MOVE_MEDIUM_TIMEOUT		(5 * 60 * HZ)
+#define READ_ELEMENT_STATUS_TIMEOUT	(5 * 60 * HZ)
+#define READ_DEFECT_DATA_TIMEOUT	(60 * HZ )
 
 /*
  * Here are some scsi specific ioctl commands which are sometimes useful.


-- 
Jens Axboe

-
To unsubscribe from this list: send the line "unsubscribe linux-scsi" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html

