#date: 2004-04-14
#id: 1.1371.710.3
#tag: other
#time: 21:04:48
#title: [libata sata_promise] fix taskfile delivery cases
#who: jgarzik@redhat.com
#
# ChangeSet
#   1.1371.710.3 04/04/14 21:04:48 jgarzik@redhat.com +1 -0
#   [libata sata_promise] fix taskfile delivery cases
#   
#   We should only be touching the ATA shadow registers if we are doing
#   PIO.
#
# drivers/scsi/sata_promise.c +2 -2
#   [libata sata_promise] fix taskfile delivery cases
#     
#     We should only be touching the ATA shadow registers if we are doing
#     PIO.
#
diff -Nru a/drivers/scsi/sata_promise.c b/drivers/scsi/sata_promise.c
--- a/drivers/scsi/sata_promise.c	Wed Apr 28 09:35:47 2004
+++ b/drivers/scsi/sata_promise.c	Wed Apr 28 09:35:47 2004
@@ -1180,14 +1180,14 @@
 
 static void pdc_tf_load_mmio(struct ata_port *ap, struct ata_taskfile *tf)
 {
-	if (tf->protocol != ATA_PROT_DMA)
+	if (tf->protocol == ATA_PROT_PIO)
 		ata_tf_load_mmio(ap, tf);
 }
 
 
 static void pdc_exec_command_mmio(struct ata_port *ap, struct ata_taskfile *tf)
 {
-	if (tf->protocol != ATA_PROT_DMA)
+	if (tf->protocol == ATA_PROT_PIO)
 		ata_exec_command_mmio(ap, tf);
 }
 
