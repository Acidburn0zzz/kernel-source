From nobody Tue Apr  6 16:04:36 2004
From: Bjorn Helgaas <bjorn.helgaas@hp.com>
Subject: [PATCH] HCDP IRQ fixup
To: Russell King <rmk@arm.linux.org.uk>
Cc: linux-ia64@vger.kernel.org
Date:	Fri, 2 Apr 2004 14:45:22 -0700

Some pre-production firmware has incorrect GSI values in the HCDP,
which tells us where the serial console port is, so we have to
do the auto-IRQ thing after all.

(This is in a function that will get removed if my recent early serial
console patches are accepted, but it would be convenient to have this
patch in the meantime.)

===== drivers/serial/8250_hcdp.c 1.3 vs edited =====
--- 1.3/drivers/serial/8250_hcdp.c	Mon Mar 15 15:53:32 2004
+++ edited/drivers/serial/8250_hcdp.c	Fri Apr  2 14:18:18 2004
@@ -186,6 +186,8 @@
 		port.irq = gsi;
 #endif
 		port.flags = UPF_SKIP_TEST | UPF_BOOT_AUTOCONF | UPF_RESOURCES;
+		if (gsi)
+			port.flags |= UPF_AUTO_IRQ;
 
 		/*
 		 * Note: the above memset() initializes port.line to 0,
-
To unsubscribe from this list: send the line "unsubscribe linux-ia64" in
the body of a message to majordomo@vger.kernel.org
More majordomo info at  http://vger.kernel.org/majordomo-info.html

