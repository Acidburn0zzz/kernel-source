# Fix for #35148
# Submitted to akpm Mar 23, 2004
# The check for signals pending should only check for "shutdown" signals.
#
Index: linux-2.6.7/fs/autofs/root.c
===================================================================
--- linux-2.6.7.orig/fs/autofs/root.c	2004-08-04 11:12:27.530487273 +0200
+++ linux-2.6.7/fs/autofs/root.c	2004-08-04 11:12:53.076014766 +0200
@@ -238,9 +238,15 @@
 	 * a signal. If so we can force a restart..
 	 */
 	if (dentry->d_flags & DCACHE_AUTOFS_PENDING) {
+		/* See if we were interrupted */
 		if (signal_pending(current)) {
-			unlock_kernel();
-			return ERR_PTR(-ERESTARTNOINTR);
+			sigset_t *sigset = &current->pending.signal;
+			if (sigismember (sigset, SIGKILL) ||
+			    sigismember (sigset, SIGQUIT) ||
+			    sigismember (sigset, SIGINT)) {
+				unlock_kernel();
+				return ERR_PTR(-ERESTARTNOINTR);
+			}
 		}
 	}
 	unlock_kernel();
