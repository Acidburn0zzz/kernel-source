From: Russ Anderson <rja@sgi.com>
Subject: sgi-xpc: need to pass the physical address, not virtual.
Patch-mainline: c8182f0016fb65a721c4fbe487909a2d56178135
References: bnc#458811
Acked-by: Raymund Will <rw@suse.de>

xpc needs to pass the physical address, not virtual.

[originally] Signed-off-by: Russ Anderson <rja@sgi.com>

---
Testing uncovered this problem.  The virtual address happens to work
most of the time due to the way bios was masking off the node bits.
Passing the physical address makes it work all of the time.

---
This version differs significantly from the community patch,
that breaks kABI after RC2, which is considered worse than
deviating from upstream (at least in this area).

Instead of actually _passing_ the physical address to
uv_bios_mq_watchlist_alloc() it's converted locally.


 arch/x86/kernel/bios_uv.c |    2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

 
--- a/arch/x86/kernel/bios_uv.c
+++ b/arch/x86/kernel/bios_uv.c
@@ -109,7 +109,7 @@ uv_bios_mq_watchlist_alloc(int blade, vo
 	u64 watchlist;
 	s64 ret;
 
-	addr = (unsigned long)mq;
+	addr = uv_gpa(mq);
 	size_blade.size = mq_size;
 	size_blade.blade = blade;
 
