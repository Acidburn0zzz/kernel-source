--- linux/drivers/block/ll_rw_blk.c~	2004-03-15 21:39:18.548547823 +0100
+++ linux/drivers/block/ll_rw_blk.c	2004-03-15 21:39:57.823286576 +0100
@@ -1127,8 +1127,11 @@
 	if (test_bit(QUEUE_FLAG_STOPPED, &q->queue_flags))
 		return;
 
-	if (!blk_remove_plug(q))
-		return;
+	/*
+	 * always call down, since we can race now with setting the plugged
+	 * bit outside of the queue lock
+	 */
+	(void) blk_remove_plug(q);
 
 	/*
 	 * was plugged, fire request_fn if queue has stuff to do
--- linux/drivers/md/dm-table.c~	2004-03-15 21:40:19.176971648 +0100
+++ linux/drivers/md/dm-table.c	2004-03-15 21:41:18.976493377 +0100
@@ -893,10 +893,8 @@
 		struct dm_dev *dd = list_entry(d, struct dm_dev, list);
 		request_queue_t *q = bdev_get_queue(dd->bdev);
 
-		if (q->unplug_fn) {
-			set_bit(QUEUE_FLAG_PLUGGED, &q->queue_flags);
+		if (q->unplug_fn)
 			q->unplug_fn(q);
-		}
 	}
 }
 
