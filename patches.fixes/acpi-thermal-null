# This is a BitKeeper generated diff -Nru style patch.
#
# ChangeSet
#   2004/09/14 07:40:27-07:00 davej@redhat.com 
#   [PATCH] Pointer dereference before NULL check in ACPI thermal driver
#   
#   Again, found with coverity's checker.
#   
#   Signed-off-by: Dave Jones <davej@redhat.com>
#   Signed-off-by: Andrew Morton <akpm@osdl.org>
#   Signed-off-by: Linus Torvalds <torvalds@osdl.org>
# 
# drivers/acpi/thermal.c
#   2004/09/13 17:23:11-07:00 davej@redhat.com +3 -1
#   Pointer dereference before NULL check in ACPI thermal driver
# 
diff -Nru a/drivers/acpi/thermal.c b/drivers/acpi/thermal.c
--- a/drivers/acpi/thermal.c	2004-09-18 01:05:53 -07:00
+++ b/drivers/acpi/thermal.c	2004-09-18 01:05:53 -07:00
@@ -659,7 +659,7 @@
 	struct acpi_thermal	*tz = (struct acpi_thermal *) data;
 	unsigned long		sleep_time = 0;
 	int			i = 0;
-	struct acpi_thermal_state state = tz->state;
+	struct acpi_thermal_state state;
 
 	ACPI_FUNCTION_TRACE("acpi_thermal_check");
 
@@ -667,6 +667,8 @@
 		ACPI_DEBUG_PRINT((ACPI_DB_ERROR, "Invalid (NULL) context.\n"));
 		return_VOID;
 	}
+
+	state = tz->state;
 
 	result = acpi_thermal_get_temperature(tz);
 	if (result)
