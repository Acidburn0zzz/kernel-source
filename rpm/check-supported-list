#! /bin/sh

sourcedir=$1
modpath=$2

# Check for modules not listed in supported.conf: First, for each module
# in the list, set mod_$module=1
for module in $($sourcedir/guards --list < $sourcedir/supported.conf \
		| sed -e 's,.*/,,'); do
    m=${module##*/}
    eval mod_${m//-/_}=1
done

# Check if any installed module was not listed
status=
cd $modpath
for module in $(find . -name '*.ko'); do
    module=${module%.ko}
    m=${module##*/}
    m=${m//-/_}
    m="mod_$m"
    if [ -z "${!m}" ]; then
	echo ${module#./}
	status=1
    fi
done

exit $status
