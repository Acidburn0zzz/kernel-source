--- linux-2.6.7/drivers/char/i8k.c	2004-06-16 21:11:35.000000000 +0100
+++ linux-2.6.7-viroized/drivers/char/i8k.c	2004-06-27 18:27:16.349789920 +0100
@@ -464,27 +464,32 @@
 
 static ssize_t i8k_read(struct file *f, char __user *buffer, size_t len, loff_t *fpos)
 {
+    loff_t pos = *fpos;
     int n;
     char info[128];
+    
+    /* XXX - seek locking required */
 
     n = i8k_get_info(info, NULL, 0, 128);
-    if (n <= 0) {
+    if (n <= 0)
 	return n;
-    }
+	
+    if (pos < 0)
+    	return -EINVAL;
 
-    if (*fpos >= n) {
+    if (pos >= n) {
 	return 0;
     }
 
-    if ((*fpos + len) >= n) {
-	len = n - *fpos;
+    if (pos + len >= n) {
+	len = n - pos;
     }
 
     if (copy_to_user(buffer, info, len) != 0) {
 	return -EFAULT;
     }
 
-    *fpos += len;
+    *fpos = pos + len;
     return len;
 }
 
