--- linux-2.6.7/drivers/mtd/mtdcore.c	2004-06-16 21:09:58.000000000 +0100
+++ linux-2.6.7-viroized/drivers/mtd/mtdcore.c	2004-06-27 22:44:28.062812952 +0100
@@ -59,6 +59,7 @@
 			mtd_table[i] = mtd;
 			mtd->index = i;
 			mtd->usecount = 0;
+			init_MUTEX(&mtd->mutex);
 
 			DEBUG(0, "mtd: Giving out device %d to %s\n",i, mtd->name);
 			/* No need to get a refcount on the module containing
