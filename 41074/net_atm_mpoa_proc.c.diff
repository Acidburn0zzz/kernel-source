--- linux-2.6.7/net/atm/mpoa_proc.c	2004-06-16 21:11:37.000000000 +0100
+++ linux-2.6.7-viroized/net/atm/mpoa_proc.c	2004-06-27 19:42:34.954857536 +0100
@@ -98,6 +98,7 @@
 
 /*
  * READING function - called when the /proc/atm/mpoa file is read from.
+ * FIXME: needs seek locking
  */
 static ssize_t proc_mpc_read(struct file *file, char __user *buff,
 			     size_t count, loff_t *pos){
@@ -110,7 +111,9 @@
 	eg_cache_entry *eg_entry;
 	struct timeval now;
 	unsigned char ip_string[16];
-	if(count == 0)
+	loff_t n = *pos;
+	
+	if(count == 0 || n < 0)
 	        return 0;
 	page = get_zeroed_page(GFP_KERNEL);
 	if(!page)
@@ -151,14 +154,14 @@
 		mpc = mpc->next;
 	}
 
-	if (*pos >= length) length = 0;
+	if (n >= length) length = 0;
 	else {
-	  if ((count + *pos) > length) count = length - *pos;
+	  if (count  > length - n) count = length - n;
 	  if (copy_to_user(buff, (char *)page , count)) {
  		  free_page(page);
 		  return -EFAULT;
           }
-	  *pos += count;
+	  *pos = n + count;
 	}
 
  	free_page(page);
