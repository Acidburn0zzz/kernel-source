From: Takashi Iwai <tiwai@suse.de>
Subject: [PATCH] kbuild: correctly link include/asm in external builds
Patch-mainline: 2.6.27?

Looking at this problem now, and found that it's likely a bug in the
upstream.  The patch below should fix the creation of include2/asm
symlink, which resulted in build errors.


Takashi

Signed-off-by: Takashi Iwai <tiwai@suse.de>
---

diff --git a/Makefile b/Makefile
index 53bf6ec..bcbb764 100644
--- a/Makefile
+++ b/Makefile
@@ -934,7 +934,11 @@ ifneq ($(KBUILD_SRC),)
 	fi;
 	$(Q)if [ ! -d include2 ]; then                                  \
 	    mkdir -p include2;                                          \
-	    ln -fsn $(srctree)/include/asm-$(SRCARCH) include2/asm;     \
+	    if [ -d $(srctree)/arch/$(SRCARCH)/include/asm ]; then	\
+		ln -fsn $(srctree)/arch/$(SRCARCH)/include/asm include2/asm; \
+	    else							\
+		ln -fsn $(srctree)/include/asm-$(SRCARCH) include2/asm;	\
+	    fi;								\
 	fi
 endif
 
