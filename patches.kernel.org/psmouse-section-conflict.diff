From: Jeff Mahoney <jeffm@suse.com>
Subject: [PATCH] psmouse: fix section type conflict

 It seems parameter functions aren't allowed to be static, or it causes
 a section type conflict. This feature isn't used very much outside
 of the standard types, which are all global and exported.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>

---

 drivers/char/ipmi/ipmi_watchdog.c  |   10 +++++-----
 drivers/input/mouse/psmouse-base.c |    9 +++++----
 drivers/md/md.c                    |    4 ++--
 3 files changed, 12 insertions(+), 11 deletions(-)

--- a/drivers/char/ipmi/ipmi_watchdog.c
+++ b/drivers/char/ipmi/ipmi_watchdog.c
@@ -188,7 +188,7 @@ static void ipmi_unregister_watchdog(int
    and ready. */
 static int start_now;
 
-static int set_param_int(const char *val, struct kernel_param *kp)
+int set_param_int(const char *val, struct kernel_param *kp)
 {
 	char *endp;
 	int  l;
@@ -207,7 +207,7 @@ static int set_param_int(const char *val
 	return rv;
 }
 
-static int get_param_int(char *buffer, struct kernel_param *kp)
+int get_param_int(char *buffer, struct kernel_param *kp)
 {
 	return sprintf(buffer, "%i", *((int *)kp->arg));
 }
@@ -219,7 +219,7 @@ static int preaction_op(const char *inva
 static int preop_op(const char *inval, char *outval);
 static void check_parms(void);
 
-static int set_param_str(const char *val, struct kernel_param *kp)
+int set_param_str(const char *val, struct kernel_param *kp)
 {
 	action_fn  fn = (action_fn) kp->arg;
 	int        rv = 0;
@@ -243,7 +243,7 @@ static int set_param_str(const char *val
 	return rv;
 }
 
-static int get_param_str(char *buffer, struct kernel_param *kp)
+int get_param_str(char *buffer, struct kernel_param *kp)
 {
 	action_fn fn = (action_fn) kp->arg;
 	int       rv;
@@ -255,7 +255,7 @@ static int get_param_str(char *buffer, s
 }
 
 
-static int set_param_wdog_ifnum(const char *val, struct kernel_param *kp)
+int set_param_wdog_ifnum(const char *val, struct kernel_param *kp)
 {
 	int rv = param_set_int(val, kp);
 	if (rv)
--- a/drivers/input/mouse/psmouse-base.c
+++ b/drivers/input/mouse/psmouse-base.c
@@ -36,8 +36,8 @@ MODULE_DESCRIPTION(DRIVER_DESC);
 MODULE_LICENSE("GPL");
 
 static unsigned int psmouse_max_proto = PSMOUSE_AUTO;
-static int psmouse_set_maxproto(const char *val, struct kernel_param *kp);
-static int psmouse_get_maxproto(char *buffer, struct kernel_param *kp);
+int psmouse_set_maxproto(const char *val, struct kernel_param *kp);
+int psmouse_get_maxproto(char *buffer, struct kernel_param *kp);
 #define param_check_proto_abbrev(name, p)	__param_check(name, p, unsigned int)
 #define param_set_proto_abbrev			psmouse_set_maxproto
 #define param_get_proto_abbrev			psmouse_get_maxproto
@@ -1573,7 +1573,8 @@ static ssize_t psmouse_attr_set_resoluti
 }
 
 
-static int psmouse_set_maxproto(const char *val, struct kernel_param *kp)
+/* These two should be static, but it causes a section type conflict */
+int psmouse_set_maxproto(const char *val, struct kernel_param *kp)
 {
 	const struct psmouse_protocol *proto;
 
@@ -1590,7 +1591,7 @@ static int psmouse_set_maxproto(const ch
 	return 0;
 }
 
-static int psmouse_get_maxproto(char *buffer, struct kernel_param *kp)
+int psmouse_get_maxproto(char *buffer, struct kernel_param *kp)
 {
 	int type = *((unsigned int *)kp->arg);
 
--- a/drivers/md/md.c
+++ b/drivers/md/md.c
@@ -6085,11 +6085,11 @@ static __exit void md_exit(void)
 subsys_initcall(md_init);
 module_exit(md_exit)
 
-static int get_ro(char *buffer, struct kernel_param *kp)
+int get_ro(char *buffer, struct kernel_param *kp)
 {
 	return sprintf(buffer, "%d", start_readonly);
 }
-static int set_ro(const char *val, struct kernel_param *kp)
+int set_ro(const char *val, struct kernel_param *kp)
 {
 	char *e;
 	int num = simple_strtoul(val, &e, 10);
