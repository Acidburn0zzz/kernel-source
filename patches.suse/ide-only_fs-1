--- linux-2.6.5/drivers/ide/ide-disk.c~	2004-05-26 13:19:15.008146459 +0200
+++ linux-2.6.5/drivers/ide/ide-disk.c	2004-05-26 13:20:17.723302593 +0200
@@ -539,13 +539,6 @@
  */
 ide_startstop_t __ide_do_rw_disk (ide_drive_t *drive, struct request *rq, sector_t block)
 {
-	BUG_ON(drive->blocked);
-	if (!blk_fs_request(rq)) {
-		blk_dump_rq_flags(rq, "__ide_do_rw_disk - bad command");
-		ide_end_request(drive, 0, 0);
-		return ide_stopped;
-	}
-
 	/*
 	 * 268435455  == 137439 MB or 28bit limit
 	 *
@@ -734,6 +727,17 @@
 {
 	ide_hwif_t *hwif = HWIF(drive);
 
+	BUG_ON(drive->blocked);
+
+	/*
+	 * ide-disk only understands file system requests
+	 */
+	if (!blk_fs_request(rq)) {
+		blk_dump_rq_flags(rq, "__ide_do_rw_disk - bad command");
+		ide_end_request(drive, 0, 0);
+		return ide_stopped;
+	}
+
 	if (hwif->rw_disk)
 		return hwif->rw_disk(drive, rq, block);
 	else
