diff -urp /opt/kernel/linux-2.6.5/fs/buffer.c linux-2.6.5/fs/buffer.c
--- /opt/kernel/linux-2.6.5/fs/buffer.c	2004-06-01 16:25:24.150795931 +0200
+++ linux-2.6.5/fs/buffer.c	2004-06-01 16:28:11.601723585 +0200
@@ -2754,8 +2754,10 @@ static int end_bio_bh_io_sync(struct bio
 	if (bio->bi_size)
 		return 1;
 
-	if (err == -EOPNOTSUPP)
+	if (err == -EOPNOTSUPP) {
 		set_bit(BIO_EOPNOTSUPP, &bio->bi_flags);
+		set_bit(BH_Eopnotsupp, &bh->b_state);
+	}
 
 	bh->b_end_io(bh, test_bit(BIO_UPTODATE, &bio->bi_flags));
 	bio_put(bio);
diff -urp /opt/kernel/linux-2.6.5/include/linux/buffer_head.h linux-2.6.5/include/linux/buffer_head.h
--- /opt/kernel/linux-2.6.5/include/linux/buffer_head.h	2004-06-01 16:25:24.152795715 +0200
+++ linux-2.6.5/include/linux/buffer_head.h	2004-06-01 16:25:55.583403529 +0200
@@ -27,6 +27,7 @@ enum bh_state_bits {
 	BH_Boundary,	/* Block is followed by a discontiguity */
 	BH_Write_EIO,	/* I/O error on write */
 	BH_Ordered,	/* ordered write */
+	BH_Eopnotsupp,	/* operation not supported (barrier) */
 
 	BH_PrivateStart,/* not a state bit, but the first bit available
 			 * for private allocation by other entities
