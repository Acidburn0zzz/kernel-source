From: Jeff Mahoney <jeffm@suse.com>
Subject: reiserfs: remove link detection code

 Early in the reiserfs xattr development, there was a plan to use hardlinks
 to save disk space for identical xattrs. That code never materialized and
 isn't going to, so this patch removes the detection code.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>

---
 fs/reiserfs/xattr.c |   13 -------------
 1 file changed, 13 deletions(-)

--- a/fs/reiserfs/xattr.c
+++ b/fs/reiserfs/xattr.c
@@ -432,7 +432,6 @@ reiserfs_xattr_set(struct inode *inode,
 	if (buffer && buffer_size)
 		xahash = xattr_hash(buffer, buffer_size);
 
-      open_file:
 	dentry = get_xa_file_dentry(inode, name, flags);
 	if (IS_ERR(dentry)) {
 		err = PTR_ERR(dentry);
@@ -441,18 +440,6 @@ reiserfs_xattr_set(struct inode *inode,
 
 	REISERFS_I(inode)->i_flags |= i_has_xattr_dir;
 
-	/* we need to copy it off.. */
-	if (dentry->d_inode->i_nlink > 1) {
-		dput(dentry);
-		err = reiserfs_xattr_del(inode, name);
-		if (err < 0)
-			goto out;
-		/* We just killed the old one, we're not replacing anymore */
-		if (flags & XATTR_REPLACE)
-			flags &= ~XATTR_REPLACE;
-		goto open_file;
-	}
-
 	/* Resize it so we're ok to write there */
 	newattrs.ia_size = buffer_size;
 	newattrs.ia_valid = ATTR_SIZE | ATTR_CTIME;
