From: Jeff Mahoney <jeffm@suse.com>
Subject: reiserfs: remove link detection code

 Early in the reiserfs xattr development, there was a plan to use hardlinks
 to save disk space for identical xattrs. That code never materialized and
 isn't going to, so this patch removes the detection code.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>

---
 fs/reiserfs/xattr.c |   14 --------------
 1 file changed, 14 deletions(-)

--- a/fs/reiserfs/xattr.c	2008-03-14 18:02:58.000000000 -0400
+++ b/fs/reiserfs/xattr.c	2008-03-14 18:03:44.000000000 -0400
@@ -402,7 +402,6 @@ reiserfs_xattr_set(struct inode *inode,
 	if (!buffer)
 		return reiserfs_xattr_del(inode, name);
 
-      open_file:
 	dentry = get_xa_file_dentry(inode, name, flags);
 	if (IS_ERR(dentry)) {
 		err = PTR_ERR(dentry);
@@ -412,19 +411,6 @@ reiserfs_xattr_set(struct inode *inode,
 	xahash = xattr_hash(buffer, buffer_size);
 	xinode = dentry->d_inode;
 
-	/* we need to copy it off.. */
-	if (xinode->i_nlink > 1) {
-		dput(dentry);
-		err = reiserfs_xattr_del(inode, name);
-		if (err < 0)
-			goto out;
-		/* We just killed the old one, we're not replacing anymore */
-		if (flags & XATTR_REPLACE)
-			flags &= ~XATTR_REPLACE;
-		mutex_unlock(&dentry->d_inode->i_mutex);
-		goto open_file;
-	}
-
 	/* Resize it so we're ok to write there */
 	newattrs.ia_size = buffer_size;
 	newattrs.ia_valid = ATTR_SIZE | ATTR_CTIME;
