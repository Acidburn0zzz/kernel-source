From: Chris Mason <mason@suse.com>
Subject: Make reiserfs default to barrier=flush

Change the default reiserfs mount option to barrier=flush

Index: linux.head/fs/reiserfs/super.c
===================================================================
--- linux.head.orig/fs/reiserfs/super.c	2004-12-17 08:12:14.884982589 -0500
+++ linux.head/fs/reiserfs/super.c	2004-12-17 08:14:02.486197995 -0500
@@ -1508,9 +1508,12 @@ static int reiserfs_fill_super (struct s
     } else {
         reiserfs_info (s, "using writeback data mode\n");
     }
-    if (reiserfs_barrier_flush(s)) {
+    /* make barrer=flush the default */
+
+    if (!reiserfs_barrier_none(s))
+	REISERFS_SB(s)->s_mount_opt |= (1 << REISERFS_BARRIER_FLUSH);
+    if (reiserfs_barrier_flush(s))
     	printk("reiserfs: using flush barriers\n");
-    }
 
     // set_device_ro(s->s_dev, 1) ;
     if( journal_init(s, jdev_name, old_format, commit_max_age) ) {
