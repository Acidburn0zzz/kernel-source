diff -Naur linux.org/include/linux/device.h linux.dev_pkat.patched/include/linux/device.h
--- linux.org/include/linux/device.h	Mon Dec 22 10:49:33 2003
+++ linux.dev_pkat.patched/include/linux/device.h	Mon Dec 22 10:49:33 2003
@@ -22,6 +22,7 @@
 #include <linux/pm.h>
 #include <asm/semaphore.h>
 #include <asm/atomic.h>
+#include <linux/printkat.h>
 
 #define DEVICE_NAME_SIZE	50
 #define DEVICE_NAME_HALF	__stringify(20)	/* Less than half to accommodate slop */
@@ -384,7 +385,8 @@
 
 /* debugging and troubleshooting/diagnostic helpers. */
 #define dev_printk(level, dev, format, arg...)	\
-	printk(level "%s %s: " format , (dev)->driver->name , (dev)->bus_id , ## arg)
+	printkat(level "{driver}%s {busid}%s: " format "{{line}%d}" , \
+		(dev)->driver->name , (dev)->bus_id , ## arg , __LINE__)
 
 #ifdef DEBUG
 #define dev_dbg(dev, format, arg...)		\
