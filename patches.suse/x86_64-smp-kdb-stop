From: ak@suse.de
Subject: Implement smp_kdb_stop in the proper way

Index: linux-2.6.15/arch/x86_64/kdb/kdbasupport.c
===================================================================
--- linux-2.6.15.orig/arch/x86_64/kdb/kdbasupport.c
+++ linux-2.6.15/arch/x86_64/kdb/kdbasupport.c
@@ -1312,3 +1312,10 @@ kdba_set_current_task(const struct task_
 	}
 	kdb_current_regs = NULL;
 }
+
+#include <asm/mach_apic.h>
+#include <asm/hw_irq.h>
+void smp_kdb_stop(void)
+{
+	send_IPI_allbutself(NMI_VECTOR);
+}
