From: Jan Kara <jack@suse.cz>
References: fate#302681
Subject: ocfs2: Fix recovery of nodes when quota feature is disabled
Patch-mainline: 2.6.29?

When quota feature is disabled, uninitialized content of variable status got
passed up from ocfs2_begin_quota_recovery() which could then cause problems,
even more so because we queued quota recovery structure even when pointer
was invalid.

Signed-off-by: Jan Kara <jack@suse.cz>

Index: linux-2.6.27/fs/ocfs2/journal.c
===================================================================
--- linux-2.6.27.orig/fs/ocfs2/journal.c	2008-10-31 07:59:08.000000000 +0100
+++ linux-2.6.27/fs/ocfs2/journal.c	2008-10-31 08:11:45.000000000 +0100
@@ -1134,6 +1134,7 @@
 		if (IS_ERR(qrec)) {
 			status = PTR_ERR(qrec);
 			mlog_errno(status);
+			continue;
 		}
 		ocfs2_queue_recovery_completion(osb->journal, rm_quota[i],
 						NULL, NULL, qrec);
Index: linux-2.6.27/fs/ocfs2/quota_local.c
===================================================================
--- linux-2.6.27.orig/fs/ocfs2/quota_local.c	2008-10-31 07:59:08.000000000 +0100
+++ linux-2.6.27/fs/ocfs2/quota_local.c	2008-10-31 08:10:53.000000000 +0100
@@ -365,7 +365,7 @@
 	struct inode *lqinode;
 	struct buffer_head *bh;
 	int type;
-	int status;
+	int status = 0;
 	struct ocfs2_quota_recovery *rec;
 
 	mlog(ML_NOTICE, "Beginning quota recovery in slot %u\n", slot_num);
