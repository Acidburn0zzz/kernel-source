diff -u linux/mm/policy.c-o linux/mm/policy.c
--- linux/mm/policy.c-o	2004-06-18 12:30:38.000000000 +0200
+++ linux/mm/policy.c	2004-06-18 17:01:39.000000000 +0200
@@ -130,7 +130,10 @@
 	unsigned long nlongs;
 	unsigned long endmask;
 
-	--maxnode;
+	bitmap_clear(nodes, MAX_NUMNODES);
+	if (--maxnode == 0) 
+		return 0;
+
 	nlongs = BITS_TO_LONGS(maxnode);
 	if ((maxnode % BITS_PER_LONG) == 0)
 		endmask = ~0UL;
@@ -154,7 +157,6 @@
 		endmask = ~0UL;
 	}
 
-	bitmap_clear(nodes, MAX_NUMNODES);
 	if (nmask && copy_from_user(nodes, nmask, nlongs*sizeof(unsigned long)))
 		return -EFAULT;
 	nodes[nlongs-1] &= endmask;
