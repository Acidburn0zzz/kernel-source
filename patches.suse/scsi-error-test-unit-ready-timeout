From: garloff@suse.de
Subject: Introduce own timeout for TEST_UNIT_READY
Reference: SUSE41689

In error recovery, a SCSI device may need more than the 10s SENSE_TIMEOUT
to respond to TEST_UNIT_READY, as reported in novell bugzilla #56689.
The patch introduces an own timeout for TEST_UNIT_READY which is set
to 30s and used.

Signed-off-by: Kurt Garloff <garloff@suse.de>

--- linux-2.6.15/drivers/scsi/scsi_error.c.orig	2006-02-03 12:44:29.783751743 +0100
+++ linux-2.6.15/drivers/scsi/scsi_error.c	2006-02-03 14:02:34.516975627 +0100
@@ -39,6 +39,7 @@
 
 #define SENSE_TIMEOUT		(10*HZ)
 #define START_UNIT_TIMEOUT	(30*HZ)
+#define TEST_UNIT_READY_TIMEOUT	(30*HZ)
 
 /*
  * These should *probably* be handled by the host itself.
@@ -721,7 +722,7 @@ retry_tur:
 	scmd->underflow = 0;
 	scmd->sc_data_direction = DMA_NONE;
 
-	rtn = scsi_send_eh_cmnd(scmd, SENSE_TIMEOUT);
+	rtn = scsi_send_eh_cmnd(scmd, TEST_UNIT_READY_TIMEOUT);
 
 	/*
 	 * when we eventually call scsi_finish, we really wish to complete
