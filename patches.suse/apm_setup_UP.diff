From: Olaf Dabrunz <od@suse.de>
Subject: [apm] default to "power_off" when SMP kernel is used on single processor machines
Reference: SUSE221667

This patch turns on support for the APM power_off function by default when the
SMP kernel is used on single processor machines.

Signed-off-by: Olaf Dabrunz <od@suse.de>


 arch/i386/kernel/apm.c |    4 ++++
 1 files changed, 4 insertions(+)

Index: arch/i386/kernel/apm.c
===================================================================
--- arch/i386/kernel/apm.c.orig	2007-01-15 14:41:28.000000000 +0100
+++ arch/i386/kernel/apm.c	2007-01-15 14:43:43.000000000 +0100
@@ -1847,6 +1847,10 @@ static int __init apm_setup(char *str)
 {
 	int	invert;
 
+#ifdef CONFIG_SMP
+	power_off = (num_online_cpus() == 1);
+#endif
+
 	while ((str != NULL) && (*str != '\0')) {
 		if (strncmp(str, "off", 3) == 0)
 			apm_disabled = 1;
