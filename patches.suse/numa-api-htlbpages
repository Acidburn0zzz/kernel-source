--- linux-2.6.5/arch/i386/mm/hugetlbpage.c.orig	2004-04-04 23:33:18.654254000 +0000
+++ linux-2.6.5/arch/i386/mm/hugetlbpage.c	2004-04-04 23:42:05.142451614 +0000
@@ -622,7 +622,7 @@ int is_hugepage_mem_enough(size_t size)
 /* Return the number pages of memory we physically have, in PAGE_SIZE units. */
 unsigned long hugetlb_total_pages(void)
 {
-	return htlbzone_pages * (HPAGE_SIZE / PAGE_SIZE);
+	return all_huge_pages() * (HPAGE_SIZE / PAGE_SIZE);
 }
 EXPORT_SYMBOL(hugetlb_total_pages);
 
