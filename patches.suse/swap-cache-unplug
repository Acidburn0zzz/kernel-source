--- /mnt/kscratch/linux-2.6.5/fs/buffer.c	2004-05-04 08:58:53.000000000 +0200
+++ linux-2.6.5-SUSE-20040504/fs/buffer.c	2004-05-04 13:08:45.898528279 +0200
@@ -3015,9 +3015,13 @@
 int block_sync_page(struct page *page)
 {
 	struct address_space *mapping;
-	smp_mb();
-	mapping = page_mapping(page);
-	blk_run_address_space(mapping);
+	if (PageSwapCache(page))
+		swap_unplug_io_fn(page);
+	else {
+		smp_mb();
+		mapping = page_mapping(page);
+		blk_run_address_space(mapping);
+	}
 	return 0;
 }
 
