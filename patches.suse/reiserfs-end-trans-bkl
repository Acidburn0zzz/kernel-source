Index: linux.t/fs/reiserfs/inode.c
===================================================================
--- linux.t.orig/fs/reiserfs/inode.c	2004-04-01 09:17:48.000000000 -0500
+++ linux.t/fs/reiserfs/inode.c	2004-04-01 11:05:18.000000000 -0500
@@ -2352,8 +2352,11 @@ int reiserfs_prepare_write(struct file *
 	if (th->t_refcount > old_ref) {
 	    if (old_ref)
 	    	th->t_refcount--;
-	    else
+	    else {
+		reiserfs_write_lock(inode->i_sb);
 		reiserfs_end_persistent_transaction(th);
+		reiserfs_write_unlock(inode->i_sb);
+	    }
 	}
     }
     return ret;
