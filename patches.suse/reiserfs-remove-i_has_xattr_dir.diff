From: Jeff Mahoney <jeffm@suse.com>
Subject: reiserfs: remove i_has_xattr_dir

 With the changes to xattr root locking, the i_has_xattr_dir flag
 is no longer needed. This patch removes it.

Signed-off-by: Jeff Mahoney <jeffm@suse.com>

---
 fs/reiserfs/xattr.c |    9 +--------
 1 file changed, 1 insertion(+), 8 deletions(-)

--- a/fs/reiserfs/xattr.c	2008-03-14 18:01:08.000000000 -0400
+++ b/fs/reiserfs/xattr.c	2008-03-14 18:02:58.000000000 -0400
@@ -411,7 +411,6 @@ reiserfs_xattr_set(struct inode *inode,
 
 	xahash = xattr_hash(buffer, buffer_size);
 	xinode = dentry->d_inode;
-	REISERFS_I(inode)->i_flags |= i_has_xattr_dir;
 
 	/* we need to copy it off.. */
 	if (xinode->i_nlink > 1) {
@@ -529,7 +528,6 @@ reiserfs_xattr_get(const struct inode *i
 
 	xinode = dentry->d_inode;
 	isize = xinode->i_size;
-	REISERFS_I(inode)->i_flags |= i_has_xattr_dir;
 
 	/* Just return the size needed */
 	if (buffer == NULL) {
@@ -734,10 +732,7 @@ out_unlock:
 	dput(root);
 
 out:
-	if (!err)
-		REISERFS_I(inode)->i_flags =
-		    REISERFS_I(inode)->i_flags & ~i_has_xattr_dir;
-	else
+	if (err)
 		reiserfs_warning(inode->i_sb, "jdm-20004",
 		                 "Couldn't remove some xattrs (%d)\n", err);
 	return err;
@@ -952,8 +947,6 @@ ssize_t reiserfs_listxattr(struct dentry
 	buf.r_pos = 0;
 	buf.r_inode = dentry->d_inode;
 
-	REISERFS_I(dentry->d_inode)->i_flags |= i_has_xattr_dir;
-
 	err = xattr_readdir(dir->d_inode, reiserfs_listxattr_filler, &buf);
 	if (err)
 		goto out_dir;
