# add reiserfs support for laptop mode
#
Index: linux.t/fs/reiserfs/journal.c
===================================================================
--- linux.t.orig/fs/reiserfs/journal.c	2004-03-21 14:59:57.000000000 -0500
+++ linux.t/fs/reiserfs/journal.c	2004-03-21 15:35:19.763542952 -0500
@@ -2304,11 +2304,12 @@ int journal_init(struct super_block *p_s
   SB_JOURNAL_TRANS_MAX(p_s_sb)      = le32_to_cpu (jh->jh_journal.jp_journal_trans_max);
   SB_JOURNAL_MAX_BATCH(p_s_sb)      = le32_to_cpu (jh->jh_journal.jp_journal_max_batch);
   if (commit_max_age != 0) {
-	  SB_JOURNAL_MAX_COMMIT_AGE(p_s_sb) = commit_max_age;
+      SB_JOURNAL_MAX_COMMIT_AGE(p_s_sb) = commit_max_age;
+      SB_JOURNAL_MAX_TRANS_AGE(p_s_sb) = commit_max_age;
   } else {
-  SB_JOURNAL_MAX_COMMIT_AGE(p_s_sb) = le32_to_cpu (jh->jh_journal.jp_journal_max_commit_age);
+      SB_JOURNAL_MAX_COMMIT_AGE(p_s_sb) = le32_to_cpu (jh->jh_journal.jp_journal_max_commit_age);
+      SB_JOURNAL_MAX_TRANS_AGE(p_s_sb)  = JOURNAL_MAX_TRANS_AGE;
   }
-  SB_JOURNAL_MAX_TRANS_AGE(p_s_sb)  = JOURNAL_MAX_TRANS_AGE;
 
   if (SB_JOURNAL_TRANS_MAX(p_s_sb)) {
     /* make sure these parameters are available, assign it if they are not */
Index: linux.t/fs/reiserfs/super.c
===================================================================
--- linux.t.orig/fs/reiserfs/super.c	2004-03-21 14:59:55.000000000 -0500
+++ linux.t/fs/reiserfs/super.c	2004-03-21 15:13:45.000000000 -0500
@@ -861,6 +861,7 @@ static int reiserfs_remount (struct supe
 
   if(commit_max_age != 0) {
 	  SB_JOURNAL_MAX_COMMIT_AGE(s) = commit_max_age;
+	  SB_JOURNAL_MAX_TRANS_AGE(s) = commit_max_age;
   }
 
   if(blocks) {
