diff -u linux/fs/locks.c-o linux/fs/locks.c
--- linux/fs/locks.c-o	2004-06-07 13:47:16.000000000 +0200
+++ linux/fs/locks.c	2004-06-07 14:21:59.000000000 +0200
@@ -134,6 +134,7 @@
 
 int leases_enable = 1;
 int lease_break_time = 45;
+int check_deadlocks = 1;
 
 #define for_each_lock(inode, lockp) \
 	for (lockp = &inode->i_flock; *lockp != NULL; lockp = &(*lockp)->fl_next)
@@ -749,7 +750,7 @@
 			if (!(request->fl_flags & FL_SLEEP))
 				goto out;
 			error = -EDEADLK;
-			if (posix_locks_deadlock(request, fl))
+			if (check_deadlocks && posix_locks_deadlock(request, fl))
 				goto out;
 			error = -EAGAIN;
 			locks_insert_block(fl, request);
diff -u linux/kernel/sysctl.c-o linux/kernel/sysctl.c
--- linux/kernel/sysctl.c-o	2004-06-07 13:47:23.000000000 +0200
+++ linux/kernel/sysctl.c	2004-06-07 15:06:21.000000000 +0200
@@ -133,6 +133,8 @@
 extern int acct_parm[];
 #endif
 
+extern int check_deadlocks;
+
 static int parse_table(int __user *, int, void __user *, size_t __user *, void __user *, size_t,
 		       ctl_table *, void **);
 static int proc_doutsstring(ctl_table *table, int write, struct file *filp,
@@ -580,6 +582,14 @@
 	},
 #endif
 	{
+		.ctl_name 	= 998,
+		.procname	= "check_deadlocks",
+		.data		= &check_deadlocks,
+		.maxlen		= sizeof(int),
+		.mode		= 0644,
+		.proc_handler	= &proc_dointvec,
+	},
+	{
 		.ctl_name	= KERN_OVERFLOWUID,
 		.procname	= "overflowuid",
 		.data		= &overflowuid,
