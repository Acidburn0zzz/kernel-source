Index: linux.t/mm/filemap.c
===================================================================
--- linux.t.orig/mm/filemap.c	2004-05-27 19:32:38.000000000 -0400
+++ linux.t/mm/filemap.c	2004-05-27 19:40:43.000000000 -0400
@@ -247,8 +247,8 @@ static ssize_t wait_on_page_writeback_ra
 			spin_unlock_irq(&mapping->tree_lock);
 			ret = wait_on_page_writeback_wq(page, wait);
 			if (ret == -EIOCBRETRY) {
-				if (curr > start)
-					ret = curr - start;
+				if (curr > end)
+printk(KERN_CRIT "retry with cur %ld ned %ld\n", curr, end);
 				done = 1;
 				break;
 			}
