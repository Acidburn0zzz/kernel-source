__lock_page_wq uses prepare_to_wait_exclusive, which causes
problems for aio, since it changes current->io_wait to always
be exclusive.

Index: linux.t/mm/filemap.c
===================================================================
--- linux.t.orig/mm/filemap.c	2004-08-13 14:52:11.000000000 -0400
+++ linux.t/mm/filemap.c	2004-08-13 20:34:24.850903920 -0400
@@ -579,7 +579,11 @@ int fastcall __lock_page_wq(struct page 
 		wait = &local_wait.wait;
  
  	while (TestSetPageLocked(page)) {
-		prepare_to_wait_exclusive(wqh, wait, TASK_UNINTERRUPTIBLE);
+		if (wait == &local_wait.wait)
+			prepare_to_wait_exclusive(wqh, wait, 
+						  TASK_UNINTERRUPTIBLE);
+		else 
+			prepare_to_wait(wqh, wait, TASK_UNINTERRUPTIBLE);
  		if (PageLocked(page)) {
  			sync_page(page);
 			if (!is_sync_wait(wait)) {
