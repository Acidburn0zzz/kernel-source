From: Takashi Iwai <tiwai@suse.de>
Subject: Fix wrong kfree in dump_setup()
Patch-mainline: 
References: 

Signed-off-by: Takashi Iwai <tiwai@suse.de>

--- linux-2.6.15/drivers/dump/dump_setup.c-dist	2006-01-30 16:50:15.000000000 +0100
+++ linux-2.6.15/drivers/dump/dump_setup.c	2006-01-30 18:22:20.000000000 +0100
@@ -598,13 +598,11 @@ static int dumper_setup(const char *devi
 
 	dump_config.dumper->dev = dump_dev;
 	
-	if (dump_config.dump_device)
+	if (dump_config.dump_device != devid) {
 		kfree(dump_config.dump_device);
-
-	if (!(dump_config.dump_device = kmalloc(strlen(devid), GFP_KERNEL)))
-		return -ENOMEM;
-
-	strcpy(dump_config.dump_device, devid);
+		if (!(dump_config.dump_device = kstrdup(devid, GFP_KERNEL)))
+			return -ENOMEM;
+	}
 
 	ret = dump_configure(devid);
 	if (!ret) {
