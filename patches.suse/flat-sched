diff -u linux/include/linux/sched.h-o linux/include/linux/sched.h
--- linux/include/linux/sched.h-o	2004-04-20 16:18:50.000000000 +0200
+++ linux/include/linux/sched.h	2004-04-21 19:11:51.000000000 +0200
@@ -31,6 +31,10 @@
 #include <linux/percpu.h>
 #include <linux/mempolicy.h>
 
+#if defined(CONFIG_NUMA) && !defined(__x86_64__)
+#define CONFIG_NUMA_SCHED 1 
+#endif
+
 struct exec_domain;
 
 /*
@@ -656,7 +660,7 @@
 	.nr_balance_failed	= 0,			\
 }
 
-#ifdef CONFIG_NUMA
+#ifdef CONFIG_NUMA_SCHED
 /* Common values for NUMA nodes */
 #define SD_NODE_INIT (struct sched_domain) {		\
 	.span			= CPU_MASK_NONE,	\
@@ -689,7 +693,7 @@
 
 extern unsigned long long sched_clock(void);
 
-#ifdef CONFIG_NUMA
+#ifdef CONFIG_NUMA_SCHED
 extern void sched_balance_exec(void);
 #else
 #define sched_balance_exec()   {}
diff -u linux/kernel/sched.c-o linux/kernel/sched.c
--- linux/kernel/sched.c-o	2004-04-20 16:18:49.000000000 +0200
+++ linux/kernel/sched.c	2004-04-21 19:02:31.000000000 +0200
@@ -41,7 +41,7 @@
 #include <linux/percpu.h>
 #include <linux/kthread.h>
 
-#ifdef CONFIG_NUMA
+#ifdef CONFIG_NUMA_SCHED
 #define cpu_to_node_mask(cpu) node_to_cpumask(cpu_to_node(cpu))
 #else
 #define cpu_to_node_mask(cpu) (cpu_online_map)
@@ -1099,7 +1099,7 @@
 };
 
 #ifdef CONFIG_SMP
-#ifdef CONFIG_NUMA
+#ifdef CONFIG_NUMA_SCHED
 /*
  * If dest_cpu is allowed for this process, migrate the task to it.
  * This is accomplished by forcing the cpu_allowed mask to only
@@ -1198,7 +1198,7 @@
 out:
 	put_cpu();
 }
-#endif /* CONFIG_NUMA */
+#endif /* CONFIG_NUMA_SCHED */
 
 /*
  * double_lock_balance - lock the busiest runqueue, this_rq is locked already.
@@ -3442,7 +3442,7 @@
 #else
 static struct sched_group sched_group_cpus[NR_CPUS];
 static DEFINE_PER_CPU(struct sched_domain, cpu_domains);
-#ifdef CONFIG_NUMA
+#ifdef CONFIG_NUMA_SCHED
 static struct sched_group sched_group_nodes[MAX_NUMNODES];
 static DEFINE_PER_CPU(struct sched_domain, node_domains);
 static void __init arch_init_sched_domains(void)
@@ -3513,7 +3513,7 @@
 	}
 }
 
-#else /* !CONFIG_NUMA */
+#else /* !CONFIG_NUMA_SCHED */
 static void __init arch_init_sched_domains(void)
 {
 	int i;
@@ -3551,7 +3551,7 @@
 	}
 }
 
-#endif /* CONFIG_NUMA */
+#endif /* CONFIG_NUMA_SCHED */
 #endif /* ARCH_HAS_SCHED_DOMAIN */
 
 #define SCHED_DOMAIN_DEBUG
