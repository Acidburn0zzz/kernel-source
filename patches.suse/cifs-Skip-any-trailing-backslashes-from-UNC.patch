From: Paulo Alcantara <paulo@paulo.ac>
Date: Wed, 14 Nov 2018 14:03:40 -0200
Subject: [PATCH] cifs: Skip any trailing backslashes from UNC
References: FATE#325270
Patch-mainline: Submitted, linux-cifs 2018-11-15

When extracting hostname from UNC, check for leading backslashes
before trying to remove them.

Signed-off-by: Paulo Alcantara <palcantara@suse.de>
Signed-off-by: Aurelien Aptel <aaptel@suse.com>
Acked-by: Aurelien Aptel <aaptel@suse.com>
---
 fs/cifs/connect.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/fs/cifs/connect.c b/fs/cifs/connect.c
index 946542e01470..02c5eea31423 100644
--- a/fs/cifs/connect.c
+++ b/fs/cifs/connect.c
@@ -973,7 +973,12 @@ extract_hostname(const char *unc)
 
 	/* skip double chars at beginning of string */
 	/* BB: check validity of these bytes? */
-	src = unc + 2;
+	if (strlen(unc) < 3)
+		return ERR_PTR(-EINVAL);
+	for (src = unc; *src && *src == '\\'; src++)
+		;
+	if (!*src)
+		return ERR_PTR(-EINVAL);
 
 	/* delimiter between hostname and sharename is always '\\' now */
 	delim = strchr(src, '\\');
-- 
2.13.7


