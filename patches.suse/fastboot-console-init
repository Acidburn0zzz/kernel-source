From: okir@suse.de
Subject: Don't generate vcs hotplug events

/etc/init.d/kbd start takes seconds(!) due to a sh*tload of unecessary 
hotplug events created. Kill them.

Acked-by: garloff@suse.de
Acked-by: vojtech@suse.cz

Index: linux-2.6.8/drivers/char/vc_screen.c
===================================================================
--- linux-2.6.8.orig/drivers/char/vc_screen.c	2004-08-14 07:36:33.000000000 +0200
+++ linux-2.6.8/drivers/char/vc_screen.c	2004-09-08 14:56:18.000000000 +0200
@@ -488,12 +488,21 @@ void vcs_remove_devfs(struct tty_struct 
 	class_simple_device_remove(MKDEV(VCS_MAJOR, tty->index + 129));
 }
 
+static int
+vcs_no_hotplug(struct class_device *dev, char **envp, int num_envp, char *buffer, int buffer_size)
+{
+	return 1;
+}
+
 int __init vcs_init(void)
 {
 	if (register_chrdev(VCS_MAJOR, "vcs", &vcs_fops))
 		panic("unable to get major %d for vcs device", VCS_MAJOR);
 	vc_class = class_create(THIS_MODULE, "vc");
 
+	/* Do not generate hotplug events for the vc device */
+	class_set_hotplug(vc_class, vcs_no_hotplug);
+
 	devfs_mk_cdev(MKDEV(VCS_MAJOR, 0), S_IFCHR|S_IRUSR|S_IWUSR, "vcc/0");
 	devfs_mk_cdev(MKDEV(VCS_MAJOR, 128), S_IFCHR|S_IRUSR|S_IWUSR, "vcc/a0");
 	class_simple_device_add(vc_class, MKDEV(VCS_MAJOR, 0), NULL, "vcs");
