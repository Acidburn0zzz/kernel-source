Subject: disable for ppc32: [SCSI] spi transport: don't allow dt to be set on SE or HVD buses
From: olh@suse.de

This patch causes machine checks on pmac:

http://www.kernel.org/git/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commit;h=60eef25701d25e99c991dd0f4a9f3832a0c3ad3e

Signed-off-by: Olaf Hering <olh@suse.de>

---
 drivers/scsi/scsi_transport_spi.c |    4 ++++
 1 file changed, 4 insertions(+)

Index: linux-2.6.18-rc6-a/drivers/scsi/scsi_transport_spi.c
===================================================================
--- linux-2.6.18-rc6-a.orig/drivers/scsi/scsi_transport_spi.c
+++ linux-2.6.18-rc6-a/drivers/scsi/scsi_transport_spi.c
@@ -844,14 +844,18 @@ spi_dv_device_internal(struct scsi_devic
 		if (spi_min_period(starget) == 8)
 			DV_SET(pcomp_en, 1);
 	}
+	/* http://lkml.org/lkml/2006/9/5/79 */
+#ifndef CONFIG_PPC32
 	/* now that we've done all this, actually check the bus
 	 * signal type (if known).  Some devices are stupid on
 	 * a SE bus and still claim they can try LVD only settings */
 	if (i->f->get_signalling)
 		i->f->get_signalling(shost);
+
 	if (spi_signalling(shost) == SPI_SIGNAL_SE ||
 	    spi_signalling(shost) == SPI_SIGNAL_HVD)
 		DV_SET(dt, 0);
+#endif
 	/* Do the read only INQUIRY tests */
 	spi_dv_retrain(sdev, buffer, buffer + sdev->inquiry_len,
 		       spi_dv_device_compare_inquiry);
