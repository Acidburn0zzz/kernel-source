From: Balbir Singh <balbir@in.ibm.com>
Subject: Minor delayacct performance fixes
References: 141936 - LTC20517 - LDP 11943

Acked-by: okir@suse.de

Index: linux-2.6.16-20060323193339/kernel/delayacct.c
===================================================================
--- linux-2.6.16-20060323193339.orig/kernel/delayacct.c
+++ linux-2.6.16-20060323193339/kernel/delayacct.c
@@ -19,7 +19,7 @@
 #include <linux/sysctl.h>
 #include <linux/delayacct.h>
 
-int delayacct_on = 0;		/* Delay accounting turned on/off */
+int delayacct_on __read_mostly = 0;	/* Delay accounting turned on/off */
 kmem_cache_t *delayacct_cache;
 
 static int __init delayacct_setup_enable(char *str)
Index: linux-2.6.16-20060323193339/kernel/sched.c
===================================================================
--- linux-2.6.16-20060323193339.orig/kernel/sched.c
+++ linux-2.6.16-20060323193339/kernel/sched.c
@@ -1299,7 +1299,8 @@ void fastcall sched_fork(task_t *p, int 
 	INIT_LIST_HEAD(&p->run_list);
 	p->array = NULL;
 #if defined(CONFIG_SCHEDSTATS) || defined(CONFIG_TASK_DELAY_ACCT)
-	memset(&p->sched_info, 0, sizeof(p->sched_info));
+	if (unlikely(sched_info_on()))
+		memset(&p->sched_info, 0, sizeof(p->sched_info));
 #endif
 #if defined(CONFIG_SMP) && defined(__ARCH_WANT_UNLOCKED_CTXSW)
 	p->oncpu = 0;
