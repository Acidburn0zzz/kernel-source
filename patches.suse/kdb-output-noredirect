From: unknown
Subject: No screen display of input after entering KDB
Patch-mainline: no
References: #40123

Our kernel redirects all printk output to tty10. This is annoying
with a kernel debugger. You can switch to tty10 before triggering
the kdb by hand, but there's no chance to do so when the kernel Oopses.

Acked-by: duwe@suse.de

--- linux-2.4.21/kdb/kdbmain.c	2003-09-10 13:42:23.000000000 +0200
+++ linux-2.4.19/kdb/kdbmain.c	2003-09-10 13:43:06.000000000 +0200
@@ -1080,6 +1080,8 @@ kdb_main_loop(kdb_reason_t reason, kdb_r
 	return(result != 0);
 }
 
+extern int kmsg_redirect;
+
 /*
  * kdb
  *
@@ -1210,6 +1212,9 @@ kdb(kdb_reason_t reason, int error, kdb_
 	if (!kdb_on)
 		return 0;
 
+#ifdef CONFIG_VT
+	kmsg_redirect = 0;
+#endif
 	KDB_DEBUG_STATE("kdb 1", reason);
 	KDB_STATE_CLEAR(SUPPRESS);
 
