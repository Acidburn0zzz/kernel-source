diff -u linux/kernel/fork.c-o linux/kernel/fork.c
--- linux/kernel/fork.c-o	2004-05-21 20:56:29.000000000 +0200
+++ linux/kernel/fork.c	2004-05-21 20:59:43.000000000 +0200
@@ -1202,9 +1202,11 @@
 			clone_flags |= CLONE_PTRACE;
 	}
 
+#ifdef CONFIG_CKRM_TYPE_TASKCLASS
 	if (numtasks_get_ref(current->taskclass, 0) == 0) {
 		return -ENOMEM;
 	}
+#endif
 
 	p = copy_process(clone_flags, stack_start, regs, stack_size, parent_tidptr, child_tidptr);
 	/*
@@ -1276,7 +1278,9 @@
 			 */
 			set_need_resched();
 	} else {
+#ifdef CONFIG_CKRM_TYPE_TASKCLASS
 		numtasks_put_ref(current->taskclass);
+#endif
 	}
 	return pid;
 }
diff -u linux/kernel/exit.c-o linux/kernel/exit.c
--- linux/kernel/exit.c-o	2004-05-21 20:56:29.000000000 +0200
+++ linux/kernel/exit.c	2004-05-21 21:01:35.000000000 +0200
@@ -810,7 +810,9 @@
 		module_put(tsk->binfmt->module);
 
 	tsk->exit_code = code;
+#ifdef CONFIG_CKRM_TYPE_TASKCLASS
 	numtasks_put_ref(tsk->taskclass);
+#endif
 	exit_notify(tsk);
 	schedule();
 	BUG();
