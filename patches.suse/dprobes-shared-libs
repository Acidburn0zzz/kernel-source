diff -urNp linux-2.6.5-7.69/drivers/dprobes/dprobes.c linux/drivers/dprobes/dprobes.c
--- linux-2.6.5-7.69/drivers/dprobes/dprobes.c	2004-06-03 04:59:49.000000000 +0530
+++ linux/drivers/dprobes/dprobes.c	2004-06-14 04:07:46.406324864 +0530
@@ -35,6 +35,7 @@
 #include <asm/semaphore.h>
 #include <asm/uaccess.h>
 #include <asm/errno.h>
+#include <asm/pgtable.h>
 #ifdef CONFIG_DEBUGREG
 #include <asm/debugreg.h>
 #endif
@@ -612,7 +613,7 @@ static inline pte_t *get_one_pte(struct 
 	pmd_t * pmd;
 	pte_t * pte = NULL;
 
-	pgd = pgd_offset(mm, addr);
+	pgd = pgd_offset_k(addr);
 	if (pgd_none(*pgd))
 		goto end;
 	if (pgd_bad(*pgd)) {
@@ -730,8 +731,10 @@ static int process_recs_in_cow_pages (st
 		 */
 		page = dp_vaddr_to_page (vma, addr, &swapped_pages_list);
 		spin_unlock(&mm->page_table_lock);
-		if (!page)
+		if (!page) {
+			vma = __vma_prio_tree_next(vma, head, &iter, start, end);
 			continue;
+		}
 		if (IS_COW_PAGE(page, m->inode)) {	
 			(*process_recs_in_page)(m, page, start, end, vma);
 		}
