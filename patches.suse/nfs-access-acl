nfs mount parameter noacl

This patch adds the [no]acl mount parameter for the nfs filesystem,
as discussed with Trond Myklebust <trond.myklebust@fys.uio.no> and
Olaf Kirch <okir@suse.de>.

   Andreas Gruenbacher <agruen@suse.de>

Index: linux-2.6.0-test9/fs/nfs/dir.c
===================================================================
--- linux-2.6.0-test9.orig/fs/nfs/dir.c	2003-10-25 20:43:36.000000000 +0200
+++ linux-2.6.0-test9/fs/nfs/dir.c	2003-11-16 13:04:01.000000000 +0100
@@ -1276,6 +1276,7 @@ out:
 int
 nfs_permission(struct inode *inode, int mask, struct nameidata *nd)
 {
+	struct nfs_server *server = NFS_SERVER(inode);
 	struct nfs_access_cache *cache = &NFS_I(inode)->cache_access;
 	struct rpc_cred *cred;
 	int mode = inode->i_mode;
@@ -1309,7 +1310,7 @@ nfs_permission(struct inode *inode, int 
 
 	lock_kernel();
 
-	if (!NFS_PROTO(inode)->access)
+	if ((server->flags & NFS_MOUNT_NOACL) || !NFS_PROTO(inode)->access)
 		goto out_notsup;
 
 	cred = rpcauth_lookupcred(NFS_CLIENT(inode)->cl_auth, 0);
Index: linux-2.6.0-test9/fs/nfs/inode.c
===================================================================
--- linux-2.6.0-test9.orig/fs/nfs/inode.c	2003-10-25 20:44:25.000000000 +0200
+++ linux-2.6.0-test9/fs/nfs/inode.c	2003-11-16 13:04:21.000000000 +0100
@@ -590,6 +590,7 @@ static int nfs_show_options(struct seq_f
 		{ NFS_MOUNT_NOAC, ",noac", "" },
 		{ NFS_MOUNT_NONLM, ",nolock", ",lock" },
 		{ NFS_MOUNT_BROKEN_SUID, ",broken_suid", "" },
+		{ NFS_MOUNT_NOACL, ",noacl", "" },
 		{ 0, NULL, NULL }
 	};
 	struct proc_nfs_info *nfs_infop;
Index: linux-2.6.0-test9/include/linux/nfs_mount.h
===================================================================
--- linux-2.6.0-test9.orig/include/linux/nfs_mount.h	2003-10-25 20:42:47.000000000 +0200
+++ linux-2.6.0-test9/include/linux/nfs_mount.h	2003-11-16 13:05:17.000000000 +0100
@@ -56,6 +56,7 @@ struct nfs_mount_data {
 #define NFS_MOUNT_KERBEROS	0x0100	/* 3 */
 #define NFS_MOUNT_NONLM		0x0200	/* 3 */
 #define NFS_MOUNT_BROKEN_SUID	0x0400	/* 4 */
+#define NFS_MOUNT_NOACL		0x0800  /* 4 */
 #define NFS_MOUNT_STRICTLOCK	0x1000	/* reserved for NFSv4 */
 #define NFS_MOUNT_SECFLAVOUR	0x2000	/* 5 */
 #define NFS_MOUNT_FLAGMASK	0xFFFF
