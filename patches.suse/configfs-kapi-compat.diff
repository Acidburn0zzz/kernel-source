From: Jeff Mahoney <jeffm@suse.com>
Subject: configfs: API compatibility layer

 ConfigFS makes use of a different kref API, but provides a compatibility
 layer for use until the kref API matches the one it uses.

 fs/configfs/Makefile                        |    2 ++
 fs/configfs/kapi-compat/include/kref_init.h |    9 +++++++++
 2 files changed, 11 insertions(+)

Index: linux-2.6.14/fs/configfs/kapi-compat/include/kref_init.h
===================================================================
--- /dev/null	1970-01-01 00:00:00.000000000 +0000
+++ linux-2.6.14/fs/configfs/kapi-compat/include/kref_init.h	2005-11-14 14:38:28.000000000 +0100
@@ -0,0 +1,9 @@
+#ifndef KAPI_KREF_INIT_H
+#define KAPI_KREF_INIT_H
+
+#include <linux/kref.h>
+
+/* kernel folks 1, universe 0 */
+#define kref_init(kref_obj, release_func)	kref_init(kref_obj)
+
+#endif /* KAPI_KREF_INIT_H */
Index: linux-2.6.14/fs/configfs/Makefile
===================================================================
--- linux-2.6.14.orig/fs/configfs/Makefile	2005-11-14 14:38:28.000000000 +0100
+++ linux-2.6.14/fs/configfs/Makefile	2005-11-14 14:42:57.000000000 +0100
@@ -4,4 +4,6 @@
 
 obj-$(CONFIG_CONFIGFS_FS)      += configfs.o
 
+EXTRA_CFLAGS += -include $(srctree)/fs/configfs/kapi-compat/include/kref_init.h
+
 configfs-objs  := inode.o file.o dir.o symlink.o mount.o item.o
