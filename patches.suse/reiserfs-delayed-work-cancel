mason@suse.com

Since reiserfs uses queue_delayed_work, it also needs to make sure
the timer has run before deleting the work queue

Index: linux.t/fs/reiserfs/journal.c
===================================================================
--- linux.t.orig/fs/reiserfs/journal.c	2004-04-19 09:13:33.000000000 -0400
+++ linux.t/fs/reiserfs/journal.c	2004-04-19 10:24:04.000000000 -0400
@@ -1704,6 +1704,7 @@ static int do_journal_release(struct rei
 
   reiserfs_mounted_fs_count-- ;
   /* wait for all commits to finish */
+  cancel_delayed_work(&SB_JOURNAL(p_s_sb)->j_work);
   flush_workqueue(commit_wq);
   if (!reiserfs_mounted_fs_count) {
     destroy_workqueue(commit_wq);
