--- linux-2.6.5/drivers/ide/ide-io.c~	2004-05-20 21:42:15.766914901 +0200
+++ linux-2.6.5/drivers/ide/ide-io.c	2004-05-20 21:42:42.127070162 +0200
@@ -1616,6 +1616,7 @@
 	err = 0;
 	if (must_wait) {
 		wait_for_completion(&wait);
+		rq->waiting = NULL;
 		if (rq->errors)
 			err = -EIO;
 
--- linux-2.6.5/drivers/block/ll_rw_blk.c~	2004-05-20 21:39:38.675867855 +0200
+++ linux-2.6.5/drivers/block/ll_rw_blk.c	2004-05-21 10:04:51.141193191 +0200
@@ -1899,7 +1899,7 @@
 {
 	DECLARE_COMPLETION(wait);
 	char sense[SCSI_SENSE_BUFFERSIZE];
-	int err = 0;
+	int err = 0, clear = 0;
 
 	rq->rq_disk = bd_disk;
 
@@ -1916,13 +1916,18 @@
 	}
 
 	rq->flags |= REQ_NOMERGE;
-	if (!rq->waiting)
+	if (!rq->waiting) {
 		rq->waiting = &wait;
+		clear = 1;
+	}
 	elv_add_request(q, rq, ELEVATOR_INSERT_BACK, 1);
 	generic_unplug_device(q);
 
-	if (rq->waiting)
+	if (rq->waiting) {
 		wait_for_completion(rq->waiting);
+		if (clear)
+			rq->waiting = NULL;
+	}
 
 	if (rq->errors)
 		err = -EIO;
