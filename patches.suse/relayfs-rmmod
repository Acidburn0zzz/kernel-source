bug 40653, fix problems on rmmod of relayfs

diff -urN a/fs/rcfs/rootdir.c b/fs/rcfs/rootdir.c
--- a/fs/rcfs/rootdir.c	2004-05-15 05:28:12.000000000 -0400
+++ b/fs/rcfs/rootdir.c	2004-05-15 05:59:27.772740760 -0400
@@ -133,11 +133,15 @@
 int 
 rcfs_rmroot(struct dentry *rootde)
 {
+	struct rcfs_inode_info *ri;
+
 	if (!rootde)
 		return -EINVAL;
 
 	rcfs_clear_magic(rootde);
-	kfree(RCFS_I(rootde->d_inode)->name);
+ 	ri = RCFS_I(rootde->d_inode);
+	kfree(ri->name);
+	ri->name = NULL;
 	rcfs_delete_internal(rootde);
 	return 0;
 }
@@ -174,6 +178,7 @@
 	if ((rc = rcfs_create_magic(clstype->rootde, &mfdesc[1], 
 				    clstype->mfcount-1))) {
 		kfree(rootri->name);
+		rootri->name = NULL;
 		rcfs_delete_internal(clstype->rootde);
 		return rc;
 	}
diff -urN a/fs/rcfs/super.c b/fs/rcfs/super.c
--- a/fs/rcfs/super.c	2004-05-15 05:28:12.000000000 -0400
+++ b/fs/rcfs/super.c	2004-05-15 05:38:15.316183560 -0400
@@ -73,7 +73,7 @@
 	struct rcfs_inode_info *ri = RCFS_I(inode);
 
 	kfree(ri->name);
-	kmem_cache_free(rcfs_inode_cachep, RCFS_I(inode));
+	kmem_cache_free(rcfs_inode_cachep, ri);
 }
 
 static void 
