From: garloff@suse.de
Subject: report real kernel timer tick frequency to user space

Forward port from andrea's 2.4 patch.

 include/linux/sched.h  |    1 +
 include/linux/sysctl.h |    3 +++
 kernel/sched.c         |   20 +++++++++++++++++---
 kernel/sysctl.c        |   25 +++++++++++++++++++++++++
 4 files changed, 46 insertions(+), 3 deletions(-)

Index: linux-2.6.15/include/linux/sysctl.h
===================================================================
--- linux-2.6.15.orig/include/linux/sysctl.h
+++ linux-2.6.15/include/linux/sysctl.h
@@ -150,12 +150,13 @@ enum
 	KERN_IA64_UNALIGNED=72, /* int: ia64 unaligned userland trap enable */
 	KERN_UNSUPPORTED=73,	/* int: allow loading of unsupported modules */
 	KERN_KDB=74,		/* int: kdb on/off */
 	KERN_DUMP=75,		/* directory: dump parameters */
 	KERN_DELAYACCT=76,	/* int: Per-task delay accounting on/off */
 	KERN_SCHEDSTATS=77,	/* int: Schedstats on/off */
+	KERN_HZ=78,		/* unsigned long: internal kernel HZ */
 };
 
 
 /* CTL_VM names: */
 enum
 {
Index: linux-2.6.15/kernel/sysctl.c
===================================================================
--- linux-2.6.15.orig/kernel/sysctl.c
+++ linux-2.6.15/kernel/sysctl.c
@@ -174,12 +174,13 @@ struct file_operations proc_sys_file_ope
 extern struct proc_dir_entry *proc_sys_root;
 
 static void register_proc_table(ctl_table *, struct proc_dir_entry *, void *);
 static void unregister_proc_table(ctl_table *, struct proc_dir_entry *);
 #endif
 
+static unsigned int __HZ = HZ;
 /* The default sysctl tables: */
 
 static ctl_table root_table[] = {
 	{
 		.ctl_name	= CTL_KERN,
 		.procname	= "kernel",
@@ -709,12 +710,20 @@ static ctl_table kern_table[] = {
 		.data		= &schedstats_sysctl,
 		.maxlen		= sizeof (int),
 		.mode		= 0644,
 		.proc_handler	= &schedstats_sysctl_handler,
 	},
 #endif
+	{
+		.ctl_name	= KERN_HZ,
+		.procname	= "HZ",
+		.data		= &__HZ,
+		.maxlen		= sizeof(int),
+		.mode		= 0444,
+		.proc_handler	= &proc_dointvec,
+	},
 	{ .ctl_name = 0 }
 };
 
 /* Constants for minimum and maximum testing in vm_table.
    We use these as one-element integer vectors. */
 static int zero;
