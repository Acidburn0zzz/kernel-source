patch for bug# 41748

Index: linux-2.6.5/ipc/msg.c
===================================================================
--- linux-2.6.5.orig/ipc/msg.c
+++ linux-2.6.5/ipc/msg.c
@@ -656,15 +656,15 @@ asmlinkage long sys_msgsnd (int msqid, s
 	int err;
 	
 	if (msgsz > msg_ctlmax || (long) msgsz < 0 || msqid < 0)
-		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgflg), audit_result(-EINVAL);
+		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgsz, msgflg), audit_result(-EINVAL);
 	if (get_user(mtype, &msgp->mtype))
-		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgflg), audit_result(-EFAULT);
+		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgsz, msgflg), audit_result(-EFAULT);
 	if (mtype < 1)
-		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgflg), audit_result(-EINVAL);
+		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgsz, msgflg), audit_result(-EINVAL);
 
 	msg = load_msg(msgp->mtext, msgsz);
 	if(IS_ERR(msg))
-		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgflg), audit_result(PTR_ERR(msg));
+		return audit_intercept(AUDIT_msgsnd, msqid, NULL, msgsz, msgflg), audit_result(PTR_ERR(msg));
 
 	msg->m_type = mtype;
 	msg->m_ts = msgsz;
Index: linux-2.6.5/drivers/audit/args.c
===================================================================
--- linux-2.6.5.orig/drivers/audit/args.c
+++ linux-2.6.5/drivers/audit/args.c
@@ -391,7 +391,7 @@ __audit_copy_from_user(struct aud_syscal
 
 	case AUDIT_ARG_IPC_MSG:
 		/* Flatten the structure */
-		len = sizeof(struct msgbuf) + ((struct msg_msg *)pvalue)->m_ts;
+		len = offsetof(struct msgbuf, mtext) + ((struct msg_msg *)pvalue)->m_ts;
 		target->at_type = AUDIT_ARG_POINTER;
 		break;
 
