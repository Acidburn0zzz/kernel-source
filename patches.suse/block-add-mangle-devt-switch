From: Tejun Heo <teheo@suse.de>
Subject: block: add genhd.mangle_minor parameter
References: fate#305584

Make block devt mangling a boot time option to ease setting up test
environment.  Enabling CONFIG_DEBUG_BLOCK_EXT_DEVT doesn't
automatically mangle devt minor.  Mangling can be enabled with
"genhd.mangle_minor=1".

Signed-off-by: Tejun Heo <teheo@suse.de>
---
 block/genhd.c |    6 ++++++
 1 file changed, 6 insertions(+)

Index: linux-2.6.29-master/block/genhd.c
===================================================================
--- linux-2.6.29-master.orig/block/genhd.c
+++ linux-2.6.29-master/block/genhd.c
@@ -37,6 +37,9 @@ static DEFINE_IDR(ext_devt_idr);
 
 static struct device_type disk_type;
 
+static int mangle_minor;
+module_param(mangle_minor, bool, 0444);
+
 /**
  * disk_get_part - get partition
  * @disk: disk to look partition from
@@ -374,6 +377,9 @@ static int blk_mangle_minor(int minor)
 #ifdef CONFIG_DEBUG_BLOCK_EXT_DEVT
 	int i;
 
+	if (!mangle_minor)
+		return minor;
+
 	for (i = 0; i < MINORBITS / 2; i++) {
 		int low = minor & (1 << i);
 		int high = minor & (1 << (MINORBITS - 1 - i));
