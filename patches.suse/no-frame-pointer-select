From: Andi Kleen <andi@firstfloor.org>
Subject: Fix stack unwinder Kconfig
Patch-mainline: no
References: bnc#402518

Incremental patch for dwarf2 unwinder

Fix the Kconfigs that do SELECT FRAME_POINTER to do select UNWIND_INFO
instead.

Signed-off-by: Andi Kleen <ak@linux.intel.com>
Acked-by: Jan Beulich <jbeulich@novell.com>

---
 kernel/trace/Kconfig |    3 ++-
 lib/Kconfig.debug    |    6 ++++--
 2 files changed, 6 insertions(+), 3 deletions(-)

--- a/kernel/trace/Kconfig
+++ b/kernel/trace/Kconfig
@@ -18,7 +18,8 @@ config TRACING
 config FTRACE
 	bool "Kernel Function Tracer"
 	depends on HAVE_FTRACE
-	select FRAME_POINTER
+	select FRAME_POINTER if !X86
+	select UNWIND_INFO if X86 && !FRAME_POINTER
 	select TRACING
 	select CONTEXT_SWITCH_TRACER
 	help
--- a/lib/Kconfig.debug
+++ b/lib/Kconfig.debug
@@ -694,13 +694,15 @@ config FAULT_INJECTION_STACKTRACE_FILTER
 	depends on FAULT_INJECTION_DEBUG_FS && STACKTRACE_SUPPORT
 	depends on !X86_64
 	select STACKTRACE
-	select FRAME_POINTER if !PPC
+	select FRAME_POINTER if !PPC && !X86
+	select UNWIND_INFO if X86 && !FRAME_POINTER
 	help
 	  Provide stacktrace filter for fault-injection capabilities
 
 config LATENCYTOP
 	bool "Latency measuring infrastructure"
-	select FRAME_POINTER if !MIPS && !PPC
+	select FRAME_POINTER if !MIPS && !PPC && !X86
+	select UNWIND_INFO if X86 && !FRAME_POINTER
 	select KALLSYMS
 	select KALLSYMS_ALL
 	select STACKTRACE
