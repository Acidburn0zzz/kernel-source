diff -Naur linux.org/include/linux/netdevice.h linux.netdev_pkat.patched/include/linux/netdevice.h
--- linux.org/include/linux/netdevice.h	Mon Dec 22 10:49:33 2003
+++ linux.netdev_pkat.patched/include/linux/netdevice.h	Mon Dec 22 10:49:33 2003
@@ -37,6 +37,7 @@
 #include <linux/config.h>
 #include <linux/device.h>
 #include <linux/percpu.h>
+#include <linux/printkat.h>
 
 struct divert_blk;
 struct vlan_group;
@@ -929,9 +930,17 @@
 extern int __netdev_printk(const char *sevlevel,
 	const struct net_device *netdev, int msglevel, const char *format, ...);
 #define netdev_printk(sevlevel, netdev, msglevel, format, arg...)	\
-	__netdev_printk(sevlevel , netdev , NETIF_MSG_##msglevel ,	\
-	format , ## arg)
-
+do {									\
+	if (__netdev_printk(sevlevel , netdev , NETIF_MSG_##msglevel ,	\
+	    format , ## arg) == 0) {					\
+		printkat_noprintk(sevlevel				\
+			"{netdev}%s ({driver}%s {busid}%s) {msglvl}%s: "\
+			format "{{line}%d}" , netdev->name ,		\
+			netdev->class_dev.dev->driver->name ,		\
+			netdev->class_dev.dev->bus_id , #msglevel ,	\
+			## arg , __LINE__);				\
+	}								\
+} while (0)
 #ifdef DEBUG
 #define netdev_dbg(netdev, msglevel, format, arg...)		\
 	netdev_printk(KERN_DEBUG , netdev , msglevel , format , ## arg)
diff -Naur linux.org/net/core/dev.c linux.netdev_pkat.patched/net/core/dev.c
--- linux.org/net/core/dev.c	Mon Dec 22 10:49:33 2003
+++ linux.netdev_pkat.patched/net/core/dev.c	Mon Dec 22 10:49:33 2003
@@ -3088,10 +3088,17 @@
  * or otherwise register the device before the probe completes successfully,
  * may need to take other steps to ensure that the failing device is clearly
  * identified.
+ *
+ * Returns:
+ *	negative number on error
+ *	1 if we didn't log the event because of the msglevel
+ *	2 if we logged the message but the struct device pointer is null
+ *	0 on success
  */
 int __netdev_printk(const char *sevlevel, const struct net_device *netdev,
 	int msglevel, const char *format, ...)
 {
+	int ret = 1;	/* not logged */
 	if (!netdev || !format) {
 		return -EINVAL;
 	}
@@ -3117,8 +3124,9 @@
 				dev->driver->name, dev->bus_id, msg);
 		}
 		spin_unlock_irqrestore(&netdev_printk_lock, flags);
+		ret = dev ? 0 : 2;
 	}
-	return 0;
+	return ret;
 }
 
 EXPORT_SYMBOL(__netdev_printk);
