Subject: Call populate_rootfs() prior to acpi_early_init()
From: Hannes Reinecke <hare@suse.de>
Patch-Mainline: no

populate_rootfs should be called prior to acpi_early_init()
if we ever want to be able to use a custom DSDT from initramfs.
Having done this, rootfs is available during acpi_early_init()
and the ACPI code can just call sys_open() to load a custom
DSDT.


 init/main.c |   16 ++++++++--------
 1 files changed, 8 insertions(+), 8 deletions(-)

--- linux-2.6.15.orig/init/main.c	2006-02-10 10:52:10.000000000 -0800
+++ linux-2.6.15/init/main.c	2006-02-10 10:53:33.000000000 -0800
@@ -572,8 +572,6 @@
 
 	check_bugs();
 
-	acpi_early_init(); /* before LAPIC and SMP init */
-
 	/* Do the rest non-__init'ed, we're now alive */
 	rest_init();
 }
@@ -700,6 +698,14 @@
 	 */
 	child_reaper = current;
 
+	/*
+	 * Do this before initcalls, because some drivers want to access
+	 * firmware files.
+	 */
+	populate_rootfs();
+
+	acpi_early_init(); /* before LAPIC and SMP init */
+
 	smp_prepare_cpus(max_cpus);
 
 	do_pre_smp_initcalls();
@@ -710,12 +716,6 @@
 
 	cpuset_init_smp();
 
-	/*
-	 * Do this before initcalls, because some drivers want to access
-	 * firmware files.
-	 */
-	populate_rootfs();
-
 	do_basic_setup();
 
 	/*
