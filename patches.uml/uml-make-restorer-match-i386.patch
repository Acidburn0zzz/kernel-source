Subject: [patch] uml make restorer match i386.patch
From: Bodo Stroesser
Patch-mainline: 2.6.11-rc1

$subject says all

Signed-off-by: Jeff Dike <jdike@addtoit.com>
Signed-off-by: Andrew Morton <akpm@osdl.org>
Acked-by: Gerd Knorr <kraxel@suse.de>
---
 arch/um/sys-i386/signal.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff -puN arch/um/sys-i386/signal.c~uml-make-restorer-match-i386 arch/um/sys-i386/signal.c
--- 25/arch/um/sys-i386/signal.c~uml-make-restorer-match-i386	2004-11-28 01:17:23.535510464 -0800
+++ 25-akpm/arch/um/sys-i386/signal.c	2004-11-28 01:17:23.538510008 -0800
@@ -227,15 +227,15 @@ int setup_signal_stack_sc(unsigned long 
 				      sizeof(frame->extramask));
 
 	/*
-	 * This is movl $,%eax ; int $0x80
+	 * This is popl %eax ; movl $,%eax ; int $0x80
 	 *
 	 * WE DO NOT USE IT ANY MORE! It's only left here for historical
 	 * reasons and because gdb uses it as a signature to notice
 	 * signal handler stack frames.
 	 */
-	err |= __put_user(0xb8, (char __user *)(frame->retcode+0));
-	err |= __put_user(__NR_rt_sigreturn, (int __user *)(frame->retcode+1));
-	err |= __put_user(0x80cd, (short __user *)(frame->retcode+5));
+	err |= __put_user(0xb858, (short __user *)(frame->retcode+0));
+	err |= __put_user(__NR_sigreturn, (int __user *)(frame->retcode+2));
+	err |= __put_user(0x80cd, (short __user *)(frame->retcode+6));
 
 	if(err)
 		return(err);
_
