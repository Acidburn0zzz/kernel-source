From: Joerg Roedel <jroedel@suse.de>
Date: Fri, 19 Oct 2018 17:53:29 +0200
Subject: [PATCH] kvm/x86: kABI fix for vm_alloc/vm_free changes
Patch-mainline: no, SUSE-specific
References: bsc#1111506

Hide the new call-backs in x86-ops at the end of the struct
to not change the layout.

Signed-off-by: Joerg Roedel <jroedel@suse.de>
---
 arch/x86/include/asm/kvm_host.h |    6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

--- a/arch/x86/include/asm/kvm_host.h
+++ b/arch/x86/include/asm/kvm_host.h
@@ -939,8 +939,6 @@ struct kvm_x86_ops {
 	bool (*has_emulated_msr)(int index);
 	void (*cpuid_update)(struct kvm_vcpu *vcpu);
 
-	struct kvm *(*vm_alloc)(void);
-	void (*vm_free)(struct kvm *);
 	int (*vm_init)(struct kvm *kvm);
 	void (*vm_destroy)(struct kvm *kvm);
 
@@ -1103,6 +1101,10 @@ struct kvm_x86_ops {
 	int (*mem_enc_unreg_region)(struct kvm *kvm, struct kvm_enc_region *argp);
 
 	int (*get_msr_feature)(struct kvm_msr_entry *entry);
+#ifndef __GENKSYMS__
+	struct kvm *(*vm_alloc)(void);
+	void (*vm_free)(struct kvm *);
+#endif
 };
 
 struct kvm_arch_async_pf {
