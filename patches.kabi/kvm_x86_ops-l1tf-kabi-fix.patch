From: Takashi Iwai <tiwai@suse.de>
Subject: Fix kABI breakage of kvm_x86_ops due to L1TF patches
Patch-mainline: Never, kABI fix
References: bsc#1089343 CVE-2018-3646

Signed-off-by: Takashi Iwai <tiwai@suse.de>

Add arch_capabilities too, which needs the exact same handling and since it is
close.

Signed-off-by: Borislav Petkov <bp@suse.de>

---
 arch/x86/include/asm/kvm_host.h |    6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

--- a/arch/x86/include/asm/kvm_host.h
+++ b/arch/x86/include/asm/kvm_host.h
@@ -710,7 +710,9 @@ struct kvm_vcpu_arch {
 	/* Flush the L1 Data cache for L1TF mitigation on VMENTER */
 	bool l1tf_flush_l1d;
 
+#ifndef __GENKSYMS__
 	u64 arch_capabilities;
+#endif
 };
 
 struct kvm_lpage_info {
